====================
==== Structures ====
====================
NOTE: Goal is to add "Save" action to Structure Editor.  [I will be implementing this next. - solprovider]

- Move Index Configuration to Modules.  Allow both module.xml and separate files.  (module.xml requires work when inherited.  Separate files are automatically inherited.)
- Read index configuration for names of Structures.  IndexConfiguration includes Structure and Revision names.  Load during initialization for use in adminstration.
- Generator for names of Structures.
- Create Design Resources.  Exclude Design Resources from "all" Index.
- ModuleSourceFactory: Check for Design Resource before file system.
Design resources: Module protocol can check datastore for design elements such as XSLT and CSS.  This is the reason for named resources; use UNID = publication + module + filepath.  Also useful for structures.
- Move Structures to Design Resources.
- "relate" Module: Change Editor to retrieve Structure as Design Resource.  Revisions, choose "live".
- Implement "Save Resource" with run Indexer.

==================
==== Security ====
==================

Resource-level Security.
Access Control List in Resource.xml
"admin" Group bypasses security and is allowed to do anything.
<acl><read default="yes"><person|group|role id="name" access="yes|no"></read><edit default="yes">same as read</edit></acl>
Implement in SitetreeGenerator and ContentSourceFactory.
"Not allowed" returns Sorry page (rather than error).
"Does not exist" returns same Sorry page.
Sorry: This resource is not available, either it does not exist or you do not have access to it.  (Link to Login page if not logged in.)
DESIGN: How to handle inheritance?  Multiple parents?  Assume "live" structure?
Workflow: Reproduce Lenya-1.2's approve/publish system.

==============================================
==== Links and i18n - Editor and Handling ====
==============================================

BUG?: Remove Attributes.removeAttribute from i18nTransformer.translateAttributes().

Add "Choose Lenya doc link" dialog to Xinha.
Add "Create file resource" to Xinha.

=== XML Serializer
Automatically pass through i18n Transformer using current module and current language.
Build catalog using Module Inheritance.  Cannot be file level inheritance; local overrides only local tags, and others are from ancestors.

i18n Transformer must not remove i18n tags that are not in current catalog.  Unknown messages must wait for other Modules and HTMLSerializer.

=== HTML Serializer
Add link rewriting.  
Change <RESOURCE UNID="xxx"> to appropriate A tag.
Change <RESOURCE UNID="xxx" TAG="img"> to appropriate IMG tag.

Automatically pass through i18n Transformer using current language.  Build catalog from current module (including inheritance), publication, and global.
Replace unfound i18n tags with default.

=== CreateRevisionTransformer
Replace all A and IMG tags with appropriate RESOURCE tags, creating new Resources as necessary.

==============================
==== Other Critical Tasks ====
==============================

BUG: Saving xhtml Resource did not change edit version as specified.  Selecting old version before new Revision.
BUG: File Resource: Create Translation does not save upload.  Create Revision works.
Edit File: Setting Default Language does not save.  (Fixed for XML earlier, probably also affects Links.)
Edit Resource: Add description for Revisions, edited separately.  Add return to edit and live.  Add show version.
Edit: Add return to live.


Only explicitly included Modules should appear on New Resource list.  Inherited Modules should not appear.  Configure default pub to exclude "text" (until working), "xml", and "homepage".

Edit-Save must clear Cache. (Or "cache" Module must check if Resource is still valid.)

New: ID Validation - No duplicates, periods, exclamation marks, or underscores.
New: UNID Validation - No < and >. Must be valid directory name (deny :!,?*_"&+#/\| and leading .~).

flat Module: content3.xsl sets doctype.  Need to use rules in {pub}/parameter-doctype.xmap
Migration: Copy XSLTs to proper modules and patch as needed.
Flat Module: Use Content directory from publication.xconf
flat/clean: move pub to ../pubs12, then copy 
content/index|relation|resource 
modules
config/???

==============================
==== Non-critical Updates ====
==============================
Add default option for Live Module to use old "xslt" directory when handling hierarchical content.

Modules are only added to Publications when server is started.  Should ModuleSourceFactory check for changes before erroring?

Modules - Add Resource description distinguished from Module description.

DESIGN: Does Module differentiation by ContentType cause confusion with inheritance?  A module overriding one type will intercept calls to all types.
Remove Module Types.  Let Module devs handle.

Administration navigation - Create Resource, return from edit resource.

Replace uses of post.xsp with RequestGenerator.

Resource @defaultlanguage is used to return one Translation for all requests.  Does it work?

Xinha adds xmlns:xhtml="http://www.w3.org/1999/xhtml to some elements (P H1).

Check synchronization of HashMaps.

"relate" Module/Structure Editor: 
- Add Categories (placeholder for menu entries with no document) using quotes to distinguish from UNIDs.  
- Search other Revisions for Title when no "live" Revision or "live" Title is blank.  
- Add "Copy Resource and all descendants" action.
- Add export/import to assist copying amongst Structures.
- Filter Resources on Types.


=============================
==== ToDo List from 2006 ====
=============================

=== 1.2.x Conversion
Session Module: login.xsp -> NullPointerException

=== Admin Screens
Admin screen: Navigation between User/Group maintenance and Site maintenance.

Admin screen: Language chooser
Since all code is based on current language, may need method to have Admin menus in different language than Resource displayed.  Probably add langauge as parameter:
http:server/pub/admin/en/docid_xx.html

=== File Resource
New XML should reference old file?  Need another file to register all uses of revision binary
Or make copy? (waste space, but safer when deleting revisions)

=== Search
Doctype Configuration should define Body.
Title is assumed from Revision Title?  Or allow override?
Multiple Languages?  Or separate indexes for each language?
Filter by type?  doctype?  IndexPart?
URLs: Use a Structure?  All flat (UNIDs)?  Choice?  (I dislike UNIDs in URLs, but a Structure limits the results to what it contains.)

=======================
====  Enhancements ====
=======================
[This section lists new abilities not required to complete 1.2 functionality.]

cocoon: protocol does not follow Module inheritance for missing files. Example: /pub/home/parameters should use /pub/xhtml/parameters if modules/home/module.xmap is missing.  Needing module.xmap defeats purpose of inheritance.  (module: protocol follows inheritance so resource-exists works as test for Module.)

Identifier must not contain period, underscore, or exclamation mark.  Allow spaces? Caps?
Default publication includes an ID with an underscore.  Remove during migration?  
Current code allows for underscores in ID as long as portion after underscore is not two characters.

New Translation: Warn if no language chosen but other fields changed for new translation.

Check {pub} directory for publication.xml.
Module to clean migrated publications: copy content, modules, security. For content, fix type and remove doctype. Move publication.xml to {pub}.

Admin screens: Resource: Change ID - Must Update structures and run Indexer.

Move CreateResourceTransformer and CreateRevisionTransformer to content package with implementation code in content.flat.

Admin: Revision History -- Use slider at top.  Start at "edit" revision.  WYSIWYG RichText fields (must open in XHTML editor to edit).

publication:name - should return name, currently stored in publication.xml.  Why?  Move to publication.xconf?  Must be available from Publication.java and PublicationModule.java

Resource: Active dates: start, expire. Careful: All children will disappear from Index when parent is deactivated.

Admin screen: User/Group editor

Admin screen: User editor
Change FileUser to allow dynamic fields.  Show all fields.  Pub can configure list of fields with default values.

Editor: Save checks for static links and replaces with RESOURCE link tag.  Create new Resource type=link for external links if they do not exist.  Need syntax for embedded links.  <RESOURCE structure="live" unid="####"/>.  Structure needed to create human-readable URLs.  HTMLSerializer should replace with Anchor tag containing Title.  
Replace with HTML for editing, then replace with RESOURCE link tag during save.  

Editor: Create reusable CSS classes?  Create "style" with settings of current location.  Maintenance?  For one RichText field, all RichText fields of the same type, for whole Publication, or Lenya server?  Will be easier when CSS are Resources.

Editor: Fix tables.  Is there a better plugin?

JCR/Jackrabbit datastore.

== FlatIndexPart
Parse using / forcing begining, * for any element, and // for any number of elements 
Example: token = "/xml" must be root
Example: token = "/*/*" must be second level
Example: token = "//xml/file" must be file under xml, but xml can be at any level.

== Indexer
Indexer should only update dependent Indexes when a Structure is saved.

Optimize Indexer to only run for language changed.

If exists and needs updating, check update freq.  If cache-and-update (assume true), start new thread for update.
Match identical indexconfs, same filters.  ?superset include unless different value for same name.  Could cause issues if poor code copies extra attributes.

=== 1.3.1
build/lenya directory should be self-contained runnable.
Separate Cocoon building from Lenya build process so Cocoon download and build is optional.    
Correct ant target files.  (Eclipse dislikes undeclared dependencies.)