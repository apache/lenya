<?xml version="1.0"?>

<project default="main" basedir=".">



<target name="main" description="main" depends="init">
  <echo>INFO: home.dir=${home.dir}</echo>
  <echo>INFO: lenya.dir=${lenya.dir}</echo>
</target>




<target name="init">
  <echo message="INFO: Init"/>

  <property file="search.properties"/>

  <property name="lenya.dir" value="${home.dir}/src/cocoon-lenya"/>
  
  <!-- Dummy arguments -->
  <property name="crawler.xconf" value="src/webapp/lenya/pubs/oscom/config/search/crawler.xconf"/>
  <property name="lucene.xconf" value="src/webapp/lenya/pubs/oscom/content/lucene.xconf"/>
  <property name="htdocs.dump.dir" value="src/webapp/lenya/pubs/oscom/work/search/lucene"/>
  <property name="index.dir" value="src/webapp/lenya/pubs/oscom/work/search/lucene/index/live/index"/>
  <property name="search.term" value="Lenya"/>
  <!-- /Dummy arguments -->

  <property name="lenya.dir.web-inf" value="${lenya.dir}/build/lenya/webapp/WEB-INF"/>

  <path id="class.path">
    <pathelement path="${lenya.dir.web-inf}/classes"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xercesImpl-2.6.1.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xml-apis.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xalan-2.5.2.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/log4j-1.2.7.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/excalibur-io-1.1.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/lucene-1.3.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/websphinx.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xml-commons-resolver-1.1.jar"/>
  </path>
</target>

<target name="crawl" description="Crawl and dump hypertext documents" depends="init">
  <echo>INFO: Crawl and dump hypertext documents(${crawler.xconf})</echo>

  <java classname="org.apache.lenya.search.crawler.CrawlerConfiguration">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>


  <java classname="org.apache.lenya.search.crawler.IterativeHTMLCrawler">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>
</target>






<target name="index" description="Index hypertext documents" depends="init">
  <echo>INFO: Index hypertext documents</echo>

  <exec executable="${lenya.dir}/src/webapp/lenya/bin/crawl_and_index.sh">
    <arg value="index"/>
    <arg value="${lucene.xconf}"/>
  </exec>

<!-- FIXME: Linkage problem -->
<!--
  <java classname="org.apache.lenya.lucene.IndexConfiguration">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>

  <java classname="org.apache.lenya.lucene.index.Index">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>
-->

<!--
  <java classname="org.apache.lenya.lucene.IndexHTML">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>
-->
</target>



<target name="test-index" description="Regression Test of Index" depends="init">
  <echo>INFO: Regression Test of Index</echo>
</target>

<target name="search" description="Search within Index" depends="init">
  <echo>INFO: Search within Index</echo>

  <exec executable="${lenya.dir}/src/webapp/lenya/bin/crawl_and_index.sh">
    <arg value="search"/>
    <arg value="${index.dir}"/>
    <arg value="${search.term}"/>
  </exec>

<!--
  <java classname="org.apache.lenya.lucene.SearchFiles">
    <arg value="${index.dir}"/>
    <arg value="${search.term}"/>
    <classpath refid="class.path"/>
  </java>
-->
</target>

<target name="publish-index" description="Publish Index" depends="init">
  <echo>INFO: Publish Index</echo>
</target>

<target name="xpdf" description="Extract text from PDF with Xpdf" depends="init">
  <echo>INFO: Extract text from PDF with Xpdf (${htdocs.dump.dir})</echo>

  <exec executable="${lenya.dir}/src/webapp/lenya/bin/crawl_and_index.sh">
    <arg value="xpdf"/>
    <arg value="${htdocs.dump.dir}"/>
  </exec>
</target>

<target name="pdfbox" description="Extract text from PDF with PDFBox" depends="init">
  <echo>INFO: Extract text from PDF with PDFBox</echo>

  <echo>FIXME: Not implemented yet</echo>
<!--
PDFBOX=$HOME/src/PDFBox-0.5.5
CLASSPATH=$CLASSPATH:$PDFBOX/classes
##$JAVA -cp $CLASSPATH org.pdfbox.Main $FILE_PDF $FILE_PDF.txt
-->
</target>

<target name="pdfadobe" description="Extract text from PDF via Adobe PDF Conversion webpage" depends="init">
  <echo>INFO: Extract text from PDF via Adobe PDF Conversion webpage</echo>

  <echo>INFO: http://www.adobe.com/products/acrobat/access_simple_form.html</echo>
</target>

<target name="show-config" description="Show configuration" depends="init">
  <echo>INFO: Show configuration</echo>

  <echo>INFO: crawler.xconf</echo>
  <java classname="org.apache.lenya.search.crawler.CrawlerConfiguration">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>

  <echo>INFO: lucene.xconf</echo>
  <java classname="org.apache.lenya.lucene.IndexConfiguration">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>
</target>

</project>
