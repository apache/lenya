<?xml version="1.0"?>

<project default="main" basedir=".">



<target name="main" description="Says Hi" depends="crawl, index">
  <echo>Hello</echo>
</target>




<target name="init">
  <echo message="INFO: Init"/>

  <property name="lenya.dir" value="/home/username/src/cocoon-lenya"/>
  <!--<property name="lenya.dir" value="../../../.."/>-->
  <!--<property name="lenya.dir" value="."/>-->
  
  <!-- Dummy arguments -->
  <property name="crawler.xconf" value="src/webapp/lenya/pubs/oscom/config/search/crawler.xconf"/>
  <property name="lucene.xconf" value="src/webapp/lenya/pubs/oscom/content/lucene.xconf"/>
  <property name="debug" value="false"/>
  <property name="htdocs.dump.dir" value="src/webapp/lenya/pubs/oscom/work/search/lucene"/>
  <!-- /Dummy arguments -->

  <property name="lenya.dir.web-inf" value="${lenya.dir}/build/lenya/webapp/WEB-INF"/>

  <path id="class.path">
    <pathelement path="${lenya.dir.web-inf}/classes"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xercesImpl-2.5.0.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xml-apis.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/xalan-2.5.1.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/log4j-1.2.3.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/excalibur-io-1.1.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/lucene-1.3-dev1.jar"/>
    <pathelement path="${lenya.dir.web-inf}/lib/websphinx.jar"/>
  </path>
</target>

<target name="crawl" description="Crawl and dump hypertext documents" depends="init">
  <echo>INFO: Crawl and dump hypertext documents(${crawler.xconf})</echo>

  <java classname="org.apache.lenya.search.crawler.CrawlerConfiguration">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>


  <java classname="org.apache.lenya.search.crawler.IterativeHTMLCrawler">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>
</target>






<target name="index" description="Index hypertext documents" depends="init">
  <echo>INFO: Index hypertext documents</echo>

  <java classname="org.apache.lenya.lucene.IndexConfiguration">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>

  <exec executable="${lenya.dir}/src/webapp/lenya/bin/crawl_and_index.sh">
    <arg value="index"/>
    <arg value="${lucene.xconf}"/>
    <arg value="${debug}"/>
  </exec>

<!-- FIXME: Linkage problem -->
<!--
  <java classname="org.apache.lenya.lucene.index.Index">
    <arg value="${lucene.xconf}"/>
    <arg value="${debug}"/>
    <classpath refid="class.path"/>
  </java>
-->

<!--
  <java classname="org.apache.lenya.lucene.IndexHTML">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>
-->
</target>



<target name="test-index" description="Regression Test of Index" depends="init">
  <echo>INFO: Regression Test of Index</echo>
</target>

<target name="search" description="Search within Index" depends="init">
  <echo>INFO: Search within Index</echo>
</target>

<target name="publish-index" description="Publish Index" depends="init">
  <echo>INFO: Publish Index</echo>
</target>

<target name="xpdf" description="Extract text from PDF with Xpdf" depends="init">
  <echo>INFO: Extract text from PDF with Xpdf (${htdocs.dump.dir})</echo>

  <exec executable="${lenya.dir}/src/webapp/lenya/bin/crawl_and_index.sh">
    <arg value="xpdf"/>
    <arg value="${htdocs.dump.dir}"/>
  </exec>
</target>

<target name="show-config" description="Show configuration" depends="init">
  <echo>INFO: Show configuration</echo>

  <echo>INFO: crawler.xconf</echo>
  <java classname="org.apache.lenya.search.crawler.CrawlerConfiguration">
    <arg value="${crawler.xconf}"/>
    <classpath refid="class.path"/>
  </java>

  <echo>INFO: lucene.xconf</echo>
  <java classname="org.apache.lenya.lucene.IndexConfiguration">
    <arg value="${lucene.xconf}"/>
    <classpath refid="class.path"/>
  </java>
</target>

</project>
