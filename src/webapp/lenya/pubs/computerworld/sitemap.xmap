<?xml version="1.0"?>
<!-- CVS: $Id: sitemap.xmap,v 1.3 2003/03/04 17:47:01 gregor Exp $ -->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<!-- =========================== Components ================================ -->
	<map:components>
		<map:generators default="file">
			<map:generator name="request" src="org.apache.cocoon.generation.RequestGenerator"/>
		</map:generators>
		<map:transformers default="xslt"/>
		<map:readers default="resource"/>
		<map:serializers default="html"/>
		<map:matchers default="wildcard">
			<map:matcher name="wildcard" logger="sitemap.matcher.wildcard" src="org.apache.cocoon.matching.WildcardURIMatcher"/>
		</map:matchers>
		<map:actions>
			<map:action name="authorizer" src="org.lenya.cms.cocoon.acting.PMLAuthorizerAction" logger="sitemap.action.pml-authorizer">
				<authenticator type="computerworld"/>
				<policies>computerworld/policies/</policies>
				<public>login-screen|do-login|switch-user|logout|.*[.]css|.*[.]jpg|.*[.]gif</public>
			</map:action>
			<map:action name="authenticator" src="org.lenya.cms.cocoon.acting.IMLAuthenticatorAction" logger="sitemap.action.iml-authenticator">
				<type>computerworld</type>
				<passwd>computerworld/passwd/</passwd>
			</map:action>
		</map:actions>
	</map:components>
	<map:resources>
		<map:resource name="login">
			<map:generate type="serverpages" src="../../docs/cms/ac/login.xsp"/>
			<map:transform src="../../stylesheets/cms/Page/ac/login.xsl">
				<map:parameter name="publication_name" value="Computerworld"/>
				<map:parameter name="publication_id" value="computerworld"/>
			</map:transform>
			<map:serialize type="html"/>
			<!--
      <map:serialize type="xml"/>
-->
		</map:resource>
	</map:resources>
	<map:pipelines>
		<!-- Documentation -->
		<map:pipeline>
			<map:match pattern="introduction.html">
				<map:read src="resources/publication/html/documentation/index.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="article.html">
				<map:read src="resources/publication/html/documentation/article.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="section.html">
				<map:read src="resources/publication/html/documentation/section.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="frontpage.html">
				<map:read src="resources/publication/html/documentation/frontpage.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="dossier.html">
				<map:read src="resources/publication/html/documentation/dossier.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="dossiers.html">
				<map:read src="resources/publication/html/documentation/dossiers.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="xmlArchitecture.html">
				<map:read src="resources/publication/html/documentation/xmlArchitecture.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="xsltModularisation.html">
				<map:read src="resources/publication/html/documentation/xsltModularisation.html" mime-type="text/html"/>
			</map:match>
			<map:match pattern="todo.html">
				<map:read src="resources/publication/html/documentation/todo.html" mime-type="text/html"/>
			</map:match>
		</map:pipeline>
		<!-- misc -->
		<map:pipeline>
			<map:match pattern="wyona/css/**.css">
				<map:read mime-type="text/css" src="../../resources/cms/css/{1}.css"/>
			</map:match>
		</map:pipeline>
		<map:pipeline>
			<!-- Bitflux Interface -->
			<map:match pattern="bitflux/**">
				<map:mount uri-prefix="bitflux" src="bitflux.xmap" check-reload="true" reload-method="synchron"/>
			</map:match>
			<map:match pattern="passwd/*.iml">
				<map:generate src="docs/publication/access-control/passwd/{1}.iml"/>
				<map:serialize type="xml"/>
			</map:match>
			<map:match pattern="policies/**">
				<map:mount uri-prefix="policies" src="policies-sitemap.xmap" check-reload="true" reload-method="synchron"/>
			</map:match>
			<map:match pattern="**">
				<map:act type="authorizer">
					<map:match pattern="login-screen">
						<map:call resource="login"/>
					</map:match>
					<map:match pattern="do-login">
						<map:act type="authenticator">
							<map:redirect-to uri="{protected_destination}" session="true"/>
						</map:act>
						<map:redirect-to uri="login-screen?status=failed" session="true"/>
					</map:match>
					<map:match pattern="switch-user">
						<map:generate type="serverpages" src="docs/wyona/cms/ac/switch-user.xsp"/>
						<map:serialize type="xml"/>
					</map:match>
					<map:match pattern="logout">
						<map:generate type="serverpages" src="../../docs/cms/access-control/invalidate.xsp"/>
						<map:transform src="../../stylesheets/cms/Page/ac/logout.xsl">
							<map:parameter name="publication_name" value="Computerworld"/>
						</map:transform>
						<map:serialize/>
					</map:match>
					<!--  ####################################################################### -->
					<!--          Everything below is "protected" by policies-sitemap.xmap        -->
					<!--  ####################################################################### -->
					<!-- Identities requested by IMLAuthenticator -->
					<!--
          <map:match pattern="passwd/*.iml">
            <map:generate src="docs/wyona/cms/ac/passwd/{1}.iml"/>
            <map:serialize type="xml"/>
          </map:match>
-->
					<!-- Policies requested by PMLAuthorizer -->
					<!--
          <map:match pattern="policies/**">
            <map:mount uri-prefix="" src="policies-sitemap.xmap" check-reload="true" reload-method="synchron"/>
          </map:match>
-->
					<!-- The authoring area -->
					<map:match pattern="authoring/**">
						<map:mount uri-prefix="authoring" src="authoring-sitemap.xmap" check-reload="true" reload-method="synchron"/>
					</map:match>
					<!-- Scheduler -->
					<map:match pattern="scheduler/**">
						<map:mount uri-prefix="scheduler" src="scheduler-sitemap.xmap" check-reload="true" reload-method="synchron"/>
					</map:match>
					<map:match pattern="**">
						<map:mount uri-prefix="" src="live-sitemap.xmap" check-reload="true" reload-method="synchron"/>
					</map:match>
				</map:act>
				<map:call resource="login"/>
			</map:match>
			<!--
      <map:match pattern="**">
        <map:mount uri-prefix="" src="live-sitemap.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>
-->
			<map:handle-errors>
				<map:transform src="context://stylesheets/system/error2html.xsl"/>
				<map:serialize status-code="500"/>
			</map:handle-errors>
		</map:pipeline>
	</map:pipelines>
</map:sitemap>
