<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document>
	<header>
		<title>Delete</title>
		<version/>
		<type/>
		<authors>
			<person name="Edith Chevrier" email="edith@apache.org"/>
		</authors>
	</header>

  <body>
	
    <section>
	  <title>Introduction</title>
      <p>The delete operation corresponds to a move operation from the authoring area to the trash</p>
    </section>
	  
    <section>
	  <title>Implementation</title>
      <p>Similar to the operation <link href="move.html">move</link></p>  
    </section>
	  
    <section>
	  <title>Parameters</title>
      <p>Required parameters:</p>
      <ul>
        <li>the area for the source document</li>
        <li>the document id for the source document</li>
        <li>the task id</li>
      </ul>
    </section>

    <section>
	  <title>usecase</title>
      <section>
        <title>Delete screen</title>
        <p>URL :</p>
 	    <source><![CDATA[{document-URL}?lenya.usecase=delete&lenya.step=showscreen]]></source> 
	    <p>usecase sitemap:</p>
        <source><![CDATA[
          <map:match pattern="delete" type="usecase">
            <map:match pattern="showscreen" type="step">
              <map:generate src="content/info/delete.xsp" type="serverpages"/>
              <map:transform src="xslt/info/delete.xsl">
                <map:parameter name="use-request-parameters" value="true"/>
              </map:transform>
              <map:call resource="style-cms-page"/>
            </map:match>
          </map:match>
          ]]></source>
	    <p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    The destination area is set to trash in the stylesheet.
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
      </section>  
      <section>
        <title>Delete confirmation</title>
        <p>URL :</p>
	    <source><![CDATA[{document-URL}?lenya.usecase=delete&lenya.step=delete&...{source parameters}]]></source> 
	    <p>usecase sitemap:</p>
	    <source><![CDATA[
          <map:match pattern="delete" type="usecase">
            <map:match pattern="delete" type="step">
              <map:act type="task">
                <map:redirect-to session="true" uri="{request-param:parenturl}"/>
              </map:act>
            </map:match>
          </map:match>
        ]]></source>
        <p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p> 
      </section>  
    </section>

    <section>
	  <title>Ant Task </title>
	  <p>The ant target <code>deleteDocument</code> is in the publication :</p>
	  <source>{publication}/config/tasks/targets.xml</source>
      <p>and depends on the different targets </p>
      <ul>
        <li><code>firstareaproperties</code>, to set the needed properties dependent of the source area</li>
        <li><code>secareaproperties</code>, to set the needed properties dependent of the destination area</li>
        <li><code>newarchivedocumentid</code>, to compute the unique destination id from the source document id (Same logic like for the archive)</li>
        <li><code>firstdocumentpath</code>, to compute the directory of the contents for the source (Needed for the revisions and the rcml files)</li>
        <li><code>secdocumentpath</code>, to compute the directory of the contents for the destination (Needed for the revisions and the rcml files)</li>
        <li><code>setIdentifier</code>, to save the source document id (in the dc:identifier). Necessary to be able to restore later the document</li>
        <li><code>move</code>, to execute the different move operations</li>
      </ul>
      <p>More about ant task, see the documentation <link href="../tasks/anttask.html">Ant Task</link> and the <link href="../../apidocs/index.html">Javadoc</link></p>
    </section>

  </body>
</document>
