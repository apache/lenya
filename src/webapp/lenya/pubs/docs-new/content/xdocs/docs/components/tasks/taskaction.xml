<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- $Id: taskaction.xml,v 1.2 2004/03/13 12:42:11 gregor Exp $ -->

<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document> 

<header> 
    <title>The TaskAction: Triggering a Task from the Sitemap</title>
    <version>0.1</version> 
    <type>Overview document</type> 
    <authors>
      <person name="Andreas Hartmann" email="andreas@apache.org"/> 
    </authors> 
</header> 
<body> 

<section>
<title>Declaring the Action</title>
<p>
To invoke a task from a sitemap pipeline, you use a <code>TaskAction</code>. The
task ID is handled to the action by a <code>task</code> parameter:
</p>

<source><![CDATA[

<map:components>
  ...
  <map:actions>
    <map:action name="publisher"
                src="org.lenya.cms.cocoon.acting.TaskAction">
      <task id="publish"/>
    </map:action>
  </map:actions>
  ...
</map:components>

]]></source>
<p>
The <code>TaskAction</code> collects the request parameters and forwards them
to the task.
</p>
<source><![CDATA[

<map:match pattern="lenya/publish*">
  <map:act type="publisher">
    <map:redirect-to uri="{parent_uri}" session="true"/>
  </map:act>
  <map:redirect-to uri="publishScreen?status=failed" session="true"/>
</map:match>

]]></source>

<p>
You can also pass the task ID as a <code>task-id</code> parameter directly in the pipeline:
</p>

<source><![CDATA[


<map:actions>
  <map:action name="task" src="org.lenya.cms.cocoon.acting.TaskAction"/>
</map:actions>

...

<map:match pattern="lenya/publish*">
  <map:act type="task">
    <map:parameter name="task-id" value="publish-article"/>
    <map:redirect-to uri="{parent_uri}" session="true"/>
  </map:act>
  <map:redirect-to uri="publishScreen?status=failed" session="true"/>
</map:match>

]]></source>

</section>

<section><title>Scheduling a Task</title>
<p>
See section <strong>Scheduler</strong>.
</p>
</section>

<section><title>Developing Your Own Tasks</title>

<p>
Every task must implement the <code>org.lenya.cms.task.Task</code> interface.
</p>
<p>
The easiest way to develop your own task is to extend the <code>AbstractTask</code> class.
Its <code>parameterize()</code> method simply replaces old parameter values with new
ones. All you have to do is implementing the <code>execute(String contextPath)</code>
method.
</p>
<p>
You may wonder why we pass the <code>contextPath</code> as a method parameter
since we already pass it as a task parameter. This ensures that the task is always
able to access the Lenya CMS directory, even if it is not created by a <code>TaskAction</code>
or a <code>TaskJob</code>. Furthermore, if you enter a task in the <code>jobs.xml</code>
file manually, you won't have to provide a hard-coded <code>servlet-context</code> parameter.
</p>
<p>
<strong>This feature may be subject to changes. If you have any suggestions to improve
the task implementation, just contact me (Andreas Hartmann) at</strong>
<link href="mailto:ah@wyona.org">ah@wyona.org</link>.
</p>
</section>

</body>
</document>