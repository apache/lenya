<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document> 

<header> 
    <title>WebDAV Servers</title>
    <version>0.1</version> 
    <type>Documentation</type> 
    <authors>
      <person name="Michael Wechner" email="michi@apache.org"/> 
    </authors> 
</header> 
<body> 

<section>
<title>Apache 1</title>
<p>
Download the Apache Web Server and WebDAV module source code from the Apache website, e.g. <code>apache_1.3.24.tar.gz</code> and <code>mod_dav-1.0.3-1.3.6.tar.gz</code>.
Configure and compile mod_dav:
</p>
<source>
<![CDATA[
wget http://www.webdav.org/mod_dav/mod_dav-1.0.3-1.3.6.tar.gz
cd /usr/local/src/mod_dav-1.0.3-1.3.6
./configure --with-apache=/usr/local/src/apache_1.3.24
make
make install
cd /usr/local/src/apache_1.3.24
find . -name "*dav*" -print
./configure --prefix=/usr/local/apache --activate-module=src/modules/dav/libdav.a
(./configure --prefix=/usr/local/apache --enable-module=proxy --activate-module=src/modules/dav/libdav.a)
make
su
make install
/usr/local/apache/bin/httpd -l
]]>
</source>

<p>
You need to reconfigure <code>httpd.conf</code>, e.g.:
</p>
<source>
<![CDATA[
DAVLockDB /usr/local/apache/logs/DavLock
<Directory "/usr/local/build/apache/htdocs">
Dav On
]]>
</source>

<p>
To see the files open "Konqueror" and type <code>webdav://127.0.0.1:8080</code>.
</p>

<p>
More info on <code>mod_dav</code> can be found at
</p>
<ul>
<li><link href="http://www.webdav.org/mod_dav/">http://www.webdav.org/mod_dav/</link></li>
<li><link href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Apache-WebDAV-LDAP-HOWTO.html">Apache and DAV with LDAP and SSL</link></li>
</ul>
</section>

<section>
<title>Apache 2</title>
<p>
Download the Apache Web Server source code from the Apache website, e.g. <code>httpd-2.0.46.tar.gz</code>.
The mod_dav module is inlcuded with the Apache 2 distribution.
Configure and compile Apache:
</p>
<source>
<![CDATA[
./configure --prefix=/usr/local/apache2 --with-dav --enable-dav
make 
make install
/usr/local/apache2/bin/httpd -l | grep dav
]]>
</source>

<p>
You need to reconfigure Apache:
</p>
<source>
<![CDATA[
DAVLockDB /usr/local/apache2/logs/DavLock
<Directory "/usr/local/apache2/htdocs">
Dav On
</Directory>
]]>
</source>

<p>
More info on <code>mod_dav</code> can be found at
</p>

<ul>
<li><link href="http://apacheworld.org/ty24/site.chapter13.html">http://apacheworld.org/ty24/site.chapter13.html</link></li>
<li><link href="http://httpd.apache.org/docs-2.0/mod/mod_dav.html">http://httpd.apache.org/docs-2.0/mod/mod_dav.html</link></li>
<li><link href="http://www.informit.com/isapi/product_id~%7BA27264B1-CE7A-47A4-8CC5-DA14003AD454%7D/element_id~%7B35D4A98B-60C6-45BE-853C-239742BA0FD9%7D/st~%7BEA04B5C6-6D59-4670-AC88-4982C49B746D%7D/content/articlex.asp">Apache and DAV</link></li>
</ul>
</section>

<section>
<title>Tomcat</title>
<p>
Point your WebDAV client to <code>http://127.0.0.1:8080/webdav/</code>.
The webdav context is DAV enabled, but has been set up in read-only mode for safety reasons.
It can be put in read-write mode by editing the web application descriptor file <code>/webapps/webdav/WEB-INF/web.xml</code>.
</p>
<source>
<![CDATA[
<!-- Uncomment this to enable read and write access -->
<init-param>
  <param-name>readonly</param-name>
  <param-value>false</param-value>
</init-param>
]]>
</source>
</section>

<section>
<title>Apache Jakarta Slide</title>
<p>
Point your WebDAV client to <code>http://127.0.0.1:8080/slide/</code>.
One needs to configure <code>Domain.xml</code>
</p>
<source>
<![CDATA[
<contentstore classname="slidestore.reference.FileContentStore">
  <parameter name="rootpath">/usr/local/jakarta-tomcat-4.1.21-LE-jdk14/webapps/lenya/lenya/pubs/notimes/content/authoring/articles</parameter>
  ...
]]>
</source>
</section>

<!--
<section>
<title>Zope</title>
<p>
<source>
<![CDATA[
...
]]>
</source>
</p>
</section>
-->

<section>
<title>Monitoring the WebDAV exchange</title>
<source>
<![CDATA[
cd /usr/local/axis-1_1RC2
java -cp lib/axis.jar org.apache.axis.utils.tcpmon

Enter "Listen Port# 3333" for instance

Select "Act as a... Listener"

Enter "Target Hostname 195.226.6.70" for instance
Enter "Target Port# 8080" for instance

Click "Add" and a new tab saying "3333" should show up

Click on this new tab to view the requests and responses

Enter within your browser "http://127.0.0.1:3333/lenya/index.html"
]]>
</source>
</section>

<section>
<title>PROPFIND</title>
<p>
The WebDAV client will first send a PROPFIND with Depth = 0. Depending on the response (collection or resource)
the WebDAV client will send another PROPFIND with Depth = 1 (collection) or a GET (resource).
</p>

<p>
Collection:
</p>

<source>
<![CDATA[
Request
=======

PROPFIND /lenya/blog/authoring/entries/2003/08/24/peanuts/ HTTP/1.1
Pragma: no-cache
Cache-control: no-cache
Accept: text/*, image/jpeg, image/png, image/*, */*
Accept-Encoding: x-gzip, gzip, identity
Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5
Accept-Language: en
Host: 127.0.0.1
Depth: 0



Response
========

HTTP/1.1 207 Multi-Status
X-Cocoon-Version: 2.1
Set-Cookie: JSESSIONID=320E3B1395B867B5BC42B5FC93457C36; Path=/lenya
Content-Type: text/xml
Transfer-Encoding: chunked
Date: Mon, 25 Aug 2003 14:27:12 GMT
Server: Apache Coyote/1.0


<?xml version="1.0" encoding="UTF-8"?>
<D:multistatus xmlns:D="DAV:">

<D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/">
<D:href>/lenya/blog/authoring/entries/2003/08/24/peanuts/</D:href>
<D:propstat>
<D:prop>
<lp1:resourcetype><D:collection/></lp1:resourcetype>
<D:getcontenttype>httpd/unix-directory</D:getcontenttype>
</D:prop>
<D:status>HTTP/1.1 200 OK</D:status>
</D:propstat>
</D:response>

</D:multistatus>



Request
=======

PROPFIND /lenya/blog/authoring/entries/2003/08/24/peanuts/ HTTP/1.1
Pragma: no-cache
Cache-control: no-cache
Accept: text/*, image/jpeg, image/png, image/*, */*
Accept-Encoding: x-gzip, gzip, identity
Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5
Accept-Language: en
Host: 127.0.0.1
Depth: 1



Response
========

HTTP/1.1 207 Multi-Status
X-Cocoon-Version: 2.1
Set-Cookie: JSESSIONID=5A87A774B7B29D04DEDBDECC54477E5B; Path=/lenya
Content-Type: text/xml
Transfer-Encoding: chunked
Date: Mon, 25 Aug 2003 14:27:12 GMT
Server: Apache Coyote/1.0


<?xml version="1.0" encoding="UTF-8"?>
<D:multistatus xmlns:D="DAV:">

<D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/">
<D:href>/lenya/blog/webdav/entries/2003/08/24/peanuts/index.html</D:href>
<D:propstat>
<D:prop>
<lp1:resourcetype/>
<D:getcontenttype>text/html</D:getcontenttype>
</D:prop>
<D:status>HTTP/1.1 200 OK</D:status>
</D:propstat>
</D:response>

<D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/">
<D:href>/lenya/blog/webdav/entries/2003/08/24/peanuts/charlie.xml</D:href>
<D:propstat>
<D:prop>
<lp1:resourcetype/>
<lp1:creationdate>2003-07-21T13:04:23Z</lp1:creationdate>
<lp1:getcontentlength>3845</lp1:getcontentlength>
<D:getcontenttype>text/xml</D:getcontenttype>
</D:prop>
<D:status>HTTP/1.1 200 OK</D:status>
</D:propstat>
</D:response>

</D:multistatus>
]]>
</source>
</section>

<section>
<title>PUT</title>
<p>
The WebDAV client will send a PUT in order to copy a document onto the server.
</p>

<source>
<![CDATA[
Request
=======

PUT /lenya/blog/webdav/entries/2003/08/29/levi/index.xml HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4b) Gecko/20030507
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,image/jpeg,image/gif;q=0.2,*/*;q=0.1
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Content-Type: text/xml
Content-Length: 1641
Cookie: JSESSIONID=1CF7F4C27B737E3603FFC2D4D4C137CE


<?xml version="1.0" encoding="UTF-8"?>
<echo:entry xmlns:echo="http://example.com/newformat#" xmlns:ent="http://www.purl.org/NET/ENT/1.0/" version="1.0">
    <echo:title>Lenya</echo:title>

    <echo:created>2003-08-29T01:46:45</echo:created>
    <echo:issued>2003-08-29T01:46:45</echo:issued>
    <echo:modified>2003-08-29T01:46:45</echo:modified>

    <echo:content mode="escaped" type="text/plain" lang="en-us">
      Plain Text
    </echo:content>

    <ent:topic id="introductory">Hello</ent:topic>
</echo:entry>



Response
========

HTTP/1.1 204 No Content
Date: Mon, 18 Aug 2003 14:22:47 GMT
Server: Apache/2.0.46 (Unix) DAV/2
Content-Length: 0
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Type: text/xml
]]>
</source>
</section>


</body>
</document>
