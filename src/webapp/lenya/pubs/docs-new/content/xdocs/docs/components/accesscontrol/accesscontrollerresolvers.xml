<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document>
	<header>
		<title>Access Controller Resolvers</title>
		<version/>
		<type/>
		<authors>
			<person name="Andreas Hartmann" email="andreas@apache.org"/>
		</authors>
	</header>

  <body>
	
<section>
	<title>Introduction</title>
	<p>
	In Lenya, the <em>AccessController</em> is chosen dynamically,
	depending on the requested URL.
	An <em>AccessControllerResolver</em> resolves the appropriate
	<em>AccessController</em> for a URL.</p>
</section>

<section>
	<title>Defining the Roles in lenya.roles</title>
	
	<p>To obtain an <em>AccessControllerResolver</em>, the <em>AccessControllerResolverSelector</em> is
		used. A component which wants to obtain an <em>AccessController</em> asks the
		selector for the <em>ComposableAccessControllerResolver</em>.
		The <em>ComposableAccessControllerResolver</em> itself uses the
		selector to obtain its child <em>AccessControllerResolver</em>s.
		</p>
	
	<source><![CDATA[<role name="org.apache.lenya.cms.ac2.AccessControllerResolverSelector"
    shorthand="access-controller-resolvers"
    default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector">
  <hint shorthand="configurable"
      class="org.apache.lenya.cms.ac2.ConfigurableAccessControllerResolver"/>
  <hint shorthand="publication"
      class="org.apache.lenya.cms.ac2.PublicationAccessControllerResolver"/>
  <hint shorthand="composable"
      class="org.apache.lenya.cms.ac2.ComposableAccessControllerResolver"/>
</role>]]></source>
	
</section>

<section>
	<title>Declaring the Access Controller Resolvers in cocoon.xconf</title>
	
	<source><![CDATA[<access-controller-resolvers>
  <component-instance logger="lenya.ac.accesscontrollerresolver.publication"
    class="org.apache.lenya.cms.ac2.PublicationAccessControllerResolver"
    name="publication">
  </component-instance>
  <component-instance logger="lenya.ac.accesscontrollerresolver.global"
    class="org.apache.lenya.cms.ac2.ConfigurableAccessControllerResolver"
    name="global">
    <access-controller type="global"/>
  </component-instance>
  <component-instance logger="lenya.ac.accesscontrollerresolver.composable"
    class="org.apache.lenya.cms.ac2.ComposableAccessControllerResolver"
    name="composable">
    <resolver type="publication"/>
    <resolver type="global"/>
  </component-instance>
</access-controller-resolvers>]]></source>
	
</section>

<section>
	<title>Publication Access Controller Resolver</title>
	<p>The <em>PublicationAccessControllerResolver</em> looks for a <code>config/ac.xconf</code>
    file inside the publication. If you want to use multiple <em>AccessController</em>s
    within your Lenya installation, just declare them in the <code>
    cocoon-xconf.xsl</code> file and choose the type in the <code>config/ac.xconf</code> file.
    The <code>type</code> attribute selects an <em>AccessController</em>
    from the definitions in <code>cocoon.xconf</code>.
  </p>
  <p>
		You have to configure the complete <em>AccessController</em> in this file. For instance,
		if you want to use a <em>BypassableAccessController</em> together with
		a certain set of components, you declare it as follows:</p>
	<source><![CDATA[<?xml version="1.0"?>
<access-controller type="bypassable">
  
  <accreditable-manager type="file">
    <parameter name="directory"
        value="context:///lenya/pubs/mypub/config/ac/passwd"/>
  </accreditable-manager>
  
  <policy-manager type="document">
    <policy-manager type="file">
      <parameter name="directory"
          value="context:///lenya/pubs/mypub/config/ac/policies"/>
    </policy-manager>
  </policy-manager>
  
  <authorizer type="policy"/>
  
  <authorizer type="usecase">
    <parameter name="configuration"
        value="context:///lenya/pubs/default/config/ac/usecase-policies.xml"/>
  </authorizer>
  
  <authorizer type="workflow"/>
  
</access-controller>
]]></source>
</section>

<section>
	<title>Configurable Access Controller Resolver</title>
	<p>The <em>ConfigurableAccessControllerResolver</em> can be configured with an
		<em>AccessController</em> directly inside <code>cocoon.xconf</code>:</p>
	<source><![CDATA[<component-instance logger="lenya.ac.accesscontrollerresolver"
    class="org.apache.lenya.cms.ac2.ConfigurableAccessControllerResolver"
    name="global">
  <access-controller type="global"/>
</component-instance>]]> </source>
</section>

<section>
	<title>Composable Access Controller Resolver</title>
	<p>The <em>ComposableAccessControllerResolver</em> is configured with a list of
		<em>AccessControllerResolver</em>s. Each one of these resolvers is invoked until one
		is successful. If no resolver finds an <em>AccessController</em>, the
		<em>ComposableAccessControllerResolver</em> returns <code>null</code>.</p>
		
	<source><![CDATA[<component-instance logger="lenya.ac.accesscontrollerresolver"
    class="org.apache.lenya.cms.ac2.ComposableAccessControllerResolver"
    name="composable">
  <resolver type="publication"/>
  <resolver type="global"/>
</component-instance>]]></source>
</section>

  </body>
</document>
