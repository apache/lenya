<?xml version="1.0"?>

<!-- CVS: $Id: sitemap.xmap,v 1.8 2003/08/19 13:21:41 michi Exp $ -->

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

  <map:components/>

  <map:views/>

  <map:resources/>

  <map:pipelines>
  
    <!-- Redirects -->
    <map:pipeline>
      <map:match pattern="">
        <map:redirect-to uri="introduction.html"/>
      </map:match>
      <map:match pattern="index.html">
        <map:redirect-to uri="introduction.html"/>
      </map:match>
      <map:match pattern="*/">
        <map:redirect-to uri="feeds/all/index.html"/>
      </map:match>
    </map:pipeline>

    <!-- Entries -->
    <map:pipeline>
      <map:match pattern="*/entries/*/*/*/*/index.xml">
        <map:aggregate element="feed">
          <map:part src="content/{1}/feeds/all/index.xml"/>
          <map:part src="content/{1}/entries/{2}/{3}/{4}/{5}/index.xml"/>
        </map:aggregate>
        <map:transform src="xslt/entry/aggregate.xsl"/>
        <map:serialize type="xml"/>
      </map:match>
      <map:match pattern="*/entries/*/*/*/*/index.html">
        <map:aggregate element="lenya">
          <map:part src="cocoon:/{1}/menubar/entry.xml"/>
          <map:part src="cocoon:/{1}/entries/{2}/{3}/{4}/{5}/index.xml" element="cmsbody"/>
        </map:aggregate>
        <map:transform src="xslt/entry/main-{1}.xsl"/>
        <map:serialize type="html"/>
      </map:match>
      <map:handle-errors type="500">
        <!-- FIXME: can also contain other errors than "not published yet" -->
        <map:transform src="../../xslt/exception/not_published_yet.xsl"/>
        <map:serialize type="html"/>
      </map:handle-errors>
    </map:pipeline>

    <!-- BX Editor: Entries -->
    <map:pipeline>
      <map:match pattern="*/entries/*/*/*/*/index-bxeng.html">
        <map:read src="resources/misc/bxeng/entry.html" mime-type="text/html"/>
<!--
        <map:read src="../../resources/misc/bxeng/index.html" mime-type="text/html"/>
-->
<!-- FIXME: Ctrl + i (Info): Render mode: Standards compliance mode
        <map:generate src="../../resources/misc/bxeng/index.html"/>
        <map:transform src="">
          <map:parameter name="namespaces" value=""/>
          <map:parameter name="configfile" value=""/>
        </map:transform>
        <map:serialize type="html"/>
-->
      </map:match>
      <map:match pattern="*/entries/*/*/*/*/config-bxeng.xml">
        <map:generate src="../../resources/misc/bxeng/inc/config.xml"/>
<!--
        <map:transform src="">
          <map:parameter name="xml" value=""/>
          <map:parameter name="xslt" value=""/>
        </map:transform>
-->
        <map:serialize type="xml"/>
      </map:match>
      <!-- GET and PUT -->
      <map:match pattern="*/entries/*/*/*/*/index-bxeng.xml">
        <map:generate src="content/{1}/entries/{2}/{3}/{4}/{5}/index.xml"/>
        <map:serialize type="xml"/>
      </map:match>
      <map:match pattern="*/entries/*/*/*/*/entry-bxeng.xsl">
        <map:generate src="xslt/entry/bxeng.xsl"/>
        <map:serialize type="xml"/>
      </map:match>
      <map:handle-errors type="500">
        <map:serialize type="xml"/>
      </map:handle-errors>
    </map:pipeline>
    <!-- /BX Editor: Entries -->

    <!-- Feeds -->
    <map:pipeline>
      <map:match pattern="*/feeds/*/index.xml">
        <map:generate type="directory" src="content/{1}/entries">
          <map:parameter name="depth" value="4"/>
          <map:parameter name="reverse" value="true"/>
        </map:generate>
        <map:transform src="xslt/feed/xinclude.xsl">
          <map:parameter name="feedid" value="{2}"/>
        </map:transform>
        <map:transform type="xlink">
          <map:parameter name="href" value="content/{1}/dummy.xml"/>
        </map:transform>
        <map:serialize type="xml"/>
      </map:match>
      <map:match pattern="*/feeds/*/index.html">
        <map:aggregate element="lenya">
          <map:part src="cocoon:/{1}/menubar/feed.xml"/>
          <map:part src="cocoon:/{1}/feeds/{2}/index.xml" element="cmsbody"/>
        </map:aggregate>
        <map:transform src="xslt/feed/main-{1}.xsl"/>
        <map:serialize type="html"/>
      </map:match>
      <map:handle-errors type="500">
        <!-- FIXME: can also contain other errors than "not published yet" -->
        <map:transform src="../../xslt/exception/not_published_yet.xsl"/>
        <map:serialize type="html"/>
      </map:handle-errors>
    </map:pipeline>

    <!-- Menubars -->
    <map:pipeline>
      <map:match pattern="authoring/menubar/entry.xml">
        <map:generate type="serverpages" src="config/menus/entry.xsp"/>
        <map:transform type="usecasemenu"/>
        <map:serialize type="xml"/>
      </map:match>
      <map:match pattern="authoring/menubar/feed.xml">
        <map:generate type="serverpages" src="config/menus/feed.xsp"/>
        <map:transform type="usecasemenu"/>
        <map:serialize type="xml"/>
      </map:match>
      <map:match pattern="live/menubar/*.xml">
        <map:generate type="serverpages" src="../../content/menus/live.xsp"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>
  </map:pipelines>
</map:sitemap>
