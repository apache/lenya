<html>
<body>
<h1>Access Controller: Authorization and Authentication</h1>
Author: Michael Wechner (michael.wechner@wyona.org)
<br>Created: 2001.11.30
<br>Version: 2002.01.22
<h2>Contents</h2>
<ol>
 <li>Cocoon2
  <ol>
   <li>sitemap.xmap</li>
   <li>Remarks</li>
  </ol>
 </li>
 <li>Authorization
  <ol>
   <li>Abstract Authorizer</li>
   <li>PML (Policy Markup Language) Authorizer</li>
   <li>XACML Authorizer</li>
  </ol>
 </li>
 <li>Authentication
  <ol>
   <li>Abstract Authenticator</li>
   <li>Abstract Username-Password Authenticator</li>
   <li>IML (Identity Markup Language) Authenticator</li>
   <li>RDB Authenticator</li>
   <li>LDAP Authenticator</li>
  </ol>
 </li>
 <li>Related Resources</li>
</ol>
<h2>Cocoon2</h2>
<h3>sitemap.xmap</h3>
<pre>
&lt;map:pipelines&gt;
  &lt;map:pipeline&gt;
    &lt;map:match pattern="**"&gt;
      &lt;map:act type="authorizer"&gt;
        &lt;map:parameter name="log" value="off"/> &lt;!-- URI history per client --&gt;
        &lt;map:parameter name="public" value="identify;authenticate"/>
        &lt;map:parameter name="concrete-authorizer" value="org.lenya.cms.ac.PMLAuthorizer"/>
        &lt;!--&lt;map:parameter name="concrete-authorizer" value="org.oasis-open.xacml.Authorizer"/>--&gt;

        &lt;map:match pattern="identify"&gt;
          &lt;map:generate/&gt;
          &lt;map:transform src="stylesheets/login-screen.xsl"/&gt;
          &lt;map:serialize/&gt;
        &lt;/map:match"&gt;

        &lt;map:match pattern="authenticate"&gt;
          &lt;map:act type="authenticator"&gt;
            &lt;map:parameter name="log" value="on"/>
            &lt;map:parameter name="concrete-authenticator" value="org.lenya.cms.ac.IMLAuthenticator"/>
            &lt;!--&lt;map:parameter name="concrete-authenticator" value="org.lenya.cms.ac.LDAPAuthenticator"/>--&gt;

            &lt;map:redirect-to uri="{protected_destination}" session="true"/>
          &lt;/map:act&gt;
          &lt;map:redirect-to uri="identify" session="true"/>
        &lt;/map:match"&gt;

        &lt;!-- you finally made it --&gt;
        &lt;map:match pattern="**"&gt;
          &lt;map:read src="resources/html/permission-granted.html" mime-type="text/html"/&gt;
        &lt;/map:match"&gt;

      &lt;/map:act&gt;
      &lt;map:redirect-to uri="identify" session="true"/>
    &lt;/map:match&gt;
  &lt;/map:pipeline&gt;
&lt;/map:pipelines&gt;
</pre>

<h3>Remarks:</h3>
<ul>
 <li>Every request is sent through the "authorizer" action. If the access is denied, then the client is redirected to the "login screen" (identify). Else the request will be matched within the action.</li>
 <li>The "login screen" (identify) is asking for the username and password. By clicking on "login", an HTTP-POST request will be sent to "authenticate".</li>
 <li>If the authentication fails, then the client will be redirected back to the "login screen". Else the client will be redirected to the "original requested destination" specified by the parameter "protected_destination".</li>
 <li>The parameter "protected_destination" is passed from the action "authenticator" to the sitemap by an "action map". The action "authenticator" is receiving the parameter "protected_destination" by reading it from the session. The action "authorizer" is appending the parameter "protected_destination" to the session when the access to the destination (resource) is denied by the concrete authorizer.</li>
</ul>

<h2>Authorizer</h2>
<p>
The authorizer should be exchangeable.
</p>

<h3>PML (Policy Markup Language) Authorizer</h3>
Example PML-Document "levi.iml.pml":
<pre>
&lt;?xml version"1.0"?&gt;
&lt;policy&gt;
  &lt;object match="/"&gt;
    &lt;subjects&gt;
      &lt;machine ip="127.0.0.1"&gt;
        &lt;actions&gt;
          &lt;read/&gt;
        &lt;/actions&gt;
      &lt;/machine&gt;

      &lt;user id="levi"&gt;
        &lt;actions&gt;
          &lt;read/&gt;
        &lt;/actions&gt;
      &lt;/user&gt;

      &lt;group id="useradministrator"&gt;
        &lt;actions&gt;
          &lt;read/&gt;
          &lt;write/&gt;
        &lt;/actions&gt;
      &lt;/group&gt;
    &lt;/subjects&gt;
  &lt;/object&gt;

  &lt;object match="/identity/password"&gt;
    &lt;subjects&gt;
      &lt;user id="levi"&gt;
        &lt;actions&gt;
          &lt;write/&gt;
        &lt;/actions&gt;
      &lt;/user&gt;
    &lt;/subjects&gt;
  &lt;/object&gt;
&lt;/policy&gt;
</pre>

<h2>Authenticator</h2>
<p>
The authenticator should be exchangeable.
<br>Example 1: org.lenya.cms.ac.IMLAuthenticator (donald.iml)
<br>Example 2: org.lenya.cms.ac.LDAPAuthenticator (LDAP on central server)
</p>

<p>
The authenticator should be able to negotiate the encryption method with the requestor.
</p>

<p>
The authenticator should be able to communicate with the authorizer.
This is for instance necessary in the case of conditional authorization:
<br>Example: For the user "levi" all requests shall be logged by the authorizer.
For the user "anonymous" only "permission denied requests" shall be logged.
</p>

<h3>IML (Identitity Markup Language) Authenticator</h3>
Example IML-Document "levi.iml":
<pre>
&lt;?xml version"1.0"?&gt;
&lt;identity&gt;
  &lt;password type="md5"&gt;sdsdsds6868fy8678sd68&lt;/password&gt;
  &lt;comment&gt;Levi Brucker&lt;/comment&gt;
  &lt;groups&gt;
    &lt;group&gt;editor&lt;/group&gt;
  &lt;/groups&gt;
  &lt;expire&gt;
    &lt;year&gt;2001&lt;/year&gt;
  &lt;/expire&gt;
&lt;/identity&gt;
</pre>

<h2>Related Resources</h2>
<a href="http://www.oasis-open.org/committees/xacml/" target="_blank">XACML</a><br />
<a href="http://www.openhealth.org/editor/XMLAccessControl.htm" target="_blank">XML Access Control</a>
</body>
</html>
