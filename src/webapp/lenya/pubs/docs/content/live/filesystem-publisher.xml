<?xml version="1.0" encoding="UTF-8"?>

<document> 
  <header> 
	 <title>Filesystem Publisher</title>
	 <version>0.3</version> 
	 <type>Overview document</type> 
	 <authors>
           <person name="Michael Wechner" email="michael.wechner@wyona.org"/> 
           <person name="Marc von Wattenwyl" email="begomarc@freesurf.ch"/>
	 </authors> 
  </header> 
  <body> 
   	<s1 title="Filesystem Publisher"> 

   		<s2 title="Introduction"> 
    		<p>
		You can use this publisher when you run everything on one
		machine. Everything means the administrator's view, the editor's view
		and the reader's view. In a more "productive" environment it is recommended
		to run the administrator's and editor's view on one machine (intranet) and
		the reader's view on another machine (DMZ). In this case you have to use a
		more advanced publisher, which is able to replicate the data by scp, rysnc (ssh)
		or for instance http-upload.
    		</p>
   		</s2>

   		<s2 title="Customizing the Menu">
     		<p>
		Normally the "Menus" can be found at docs/publication/menus
		</p>
   		</s2>
                                                                                                                                            
   		<s2 title="Sitemap"> 
     		<p>
     		</p>  
     		<ol>
       		<li>reference to the action:
         	<p>
           	<source>
		<![CDATA[
<map:actions>
  <map:action name="publisher" src="org.wyona.cms.cocoon.acting.PublisherAction">
    <authoring href="docs/publication/authoring/"/>
    <live href="docs/publication/live/"/>
    <tree-authoring href="docs/publication/authoring/tree.xml"/>
    <tree-live href="docs/publication/live/tree.xml"/>
  </map:action>
</map:actions>
		]]>
           	</source>
         	</p>
       		</li> 
       		<li>"Publish-Screen": generation of a publish-screen with a servepage, docs/wyona/cms/publish/publish-screen.xsp and the stylesheet stylesheets/wyona/cms/publish/main.xsl :
         	<p>
           	<source>
		<![CDATA[
     <map:match pattern="authoring/wyona/publishScreen*">
       <map:generate type="serverpages" src="../../docs/cms/publishing/publish-screen.xsp"/>
       <map:transform src="../../stylesheets/cms/Page/publishing/main.xsl"/>
       <map:serialize type="html"/>
     </map:match>                                                                                                                           
		]]>
           	</source>                                                                                                                        
         	</p>
       		</li>
       		<li>call of the publish action
         	<p>
           	<source>
		<![CDATA[
     </map:match>
     <map:match pattern="authoring/wyona/publish*">
       <map:act type="publisher">
         <map:redirect-to uri="{parent_uri}" session="true"/>
       </map:act>
       <map:redirect-to uri="publishScreen?status=failed" session="true"/>
     </map:match>
		]]>
           	</source>
         	</p>
       		</li>
     		</ol> 
   		</s2>
   
   		<s2 title="Customizing the Publish Screen">
     		<p>
		Copy the generic XSLT: ../../stylesheets/cms/Page/Publish/main.xsl " 
		into the publication's stylesheet directory "stylesheets/cms/Page/Publish/....xsl ". 
		Don't forget to change the sitemap appropriately. 
     		</p>
   		</s2>
                                                                                                                                            
   		<s2 title="Configuration"> 
     		<p>
		The filesystem publisher has to know the filesystem path of the authoring area and
		the live area. These two paths are set within the sitemap:
     		</p>
     		<source>
		<![CDATA[
<map:actions>
  <map:action name="" src="">
    <authoring href="docs/publication/authoring/"/>
    <live href="docs/publication/live/"/>
    <tree-authoring href="docs/publication/authoring/tree.xml"/>
    <tree-live href="docs/publication/live/tree.xml"/>
  </map:action>
</map:actions>
		]]>
     		</source>
   		<p>
		NOTE: "authoring" and "live" are required parameters, "tree-authoring" and "tree-live" are not required parameters.
   		</p>
   		</s2>

   		<s2 title="Publisher-Action">
     		<p>
      		Finally the Java Class  org.wyona.cms.cocoon.acting.PublisherAction has to be extended.
     		</p>
   		</s2>
                                                                                                                                            
   	</s1>
  </body>
</document>
