<?xml version="1.0"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">
<document> 
  <header> 
    <title>Page Envelope</title>
    <version major="0" minor="1">Initial version</version>
    <authors>
      <person name="Christian Egli" email="christian.egli@wyona.org"/>
      <person name="Gregor J. Rothfuss" email="gregor.rothfuss@wyona.org"/>
    </authors> 
    <notice></notice> 
    <abstract>Proposal for a standard Page envelope which carries all
      the crucial information to be handed down the pipeline and to
      the client.</abstract> 
  </header> 
  <body> 

    <section>
      <title>Introduction</title>

      <p>The Lenya CMS needs to pass arguments (user, time, context,
	etc.) to the subcomponents in the sitemap or to futher
	invocations of itself in one session. Currently there is a mix
	of multiple mechanisms to achieve this. We want to standardize
	this across Lenya.</p>

      <p>One possible solution is to use a so-called "Page Envelope"
      which wraps all XML documents with some meta information that
      contains a standard set of arguments which are then passed to
      the subcomponents through the Cocoon pipelines and could
      possibly be attached to the session to keep this information
      across client round trips.</p>
    </section>

    <section>
      <title>Proposal</title>
      <p>A possible solution could look as follows:</p>
      <source>
&lt;lenya:envelope&gt;
  &lt;lenya:head&gt;
    &lt;lenya:user&gt;foo&lt;/lenya:user&gt;
    &lt;lenya:date&gt;2003-2-11&lt;/lenya:date&gt;
    &lt;lenya:publication&gt;sample&lt;/lenya:publication&gt;
      .
      .
      .
    &lt;xul:menubar id="sample-menubar"&gt;
      .
      .
      .
    &lt;/xul:menubar&gt;
  &lt;/lenya:head&gt;
  &lt;lenya:body&gt;
    +--------------------------+
    |                  	       |
    |   Document       	       |
    |   Content       	       |
    |                  	       |
    +--------------------------+
  &lt;/lenya:body&gt;
&lt;/lenya&gt;
</source>
    </section>

    <section>
      <title>Current Parameters</title>
      <p>Currently, the following variables are defined within Lenya (see &lt;xsp-lenya:util/&gt;):</p>
      <ul>
	<li>context</li>
	<li>request_uri</li>
    <li>sitemap_uri</li>
    <li>current_username</li>
    <li>no_username_yet</li>
    <li>no_session_yet</li>
    <li>server_time</li>
    <li>context_prefix</li>
    <li>referer</li>  
    <li>no_referer</li>   
           </ul>
    </section>

    <section>
      <title>TODO</title>
      <p>The proposal is currently not much more than an idea. It
      needs to be properly thought out in regards to the following
      problems:</p>
      <ul>
	<li>The idea works ok as long as the Page Envelope is handed
	down one pipeline. What happens with call-resource
	invocations?</li>
	<li>What happens with client roundtrips? How is the Page
	Envelope made persistent? Does it need to be?</li>
      </ul>
    </section>

  </body> 
  <footer> 
    <legal>Â© 200 wyona.org</legal> 
  </footer>
</document>
