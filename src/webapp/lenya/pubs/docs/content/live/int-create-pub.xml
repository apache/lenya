<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document>
  <header>
    <title>Creating a new Publication</title>
    <version/>
    <type/>
    <authors>
      <person name="Michael Wechner" email="michael.wechner@lenya.org"/>
      <person name="Juergen Bigalke" email="juergen.bigalke@lenya.org"/>
    </authors>
  </header>
  <body>
<section><title>Creating a new Publication</title>
<section><title>Introduction</title>
<p>
At the moment there seem to be two possibilities to
use Lenya. You can either copy a sample publication from
the Lenya distribution which has a similar information
architecture as the one you have in mind for yourself, or
you might have an existing Cocoon based publication, which
you want to make content manageable, which means documents respectively
pages shall basically be editable and publishable.
</p>
</section>
</section>

<section><title>Customizing a sample publication</title>
<section><title>Sample publications</title>
<p>
The following sample publications currently exist:</p>
<ol>
  <li>UNIPUBLIC (University of Zurich)</li>
  <li>Department of Materials Science (Swiss Federal Institute of Technology)</li>
</ol>
</section>
<section><title>Copy sample publication</title>
<p>
</p>
<p>
In following let <strong>ethz-mat</strong> be the source and <strong>MY-PUB</strong> the name of the new publication
</p>
<ol>
<li>Copy: cp -r lenya/pubs/ethz-mat lenya/pubs/MY-PUB</li>
<li>Rename the ethz/mat subdirectories for your purpose<br/>
     for instance: ethz-mat/docs/ethz/mat ==&gt; MY-PUB/docs/standard/t01 <br/>
     and: ethz-mat/stylesheets/ethz/mat ==&gt; MY-PUB/stylesheets/standard/t01
</li>
<li>
Configure MY-PUB/sitemap.xmap<br/>
Just replace ethz-mat by MY-PUB and ethz/mat by standard/t01
<code><![CDATA[

<map:components>
 ...
 <map:actions>
   <map:action name="authorizer" src="org.lenya.cms.cocoon.acting.PMLAuthorizerAction"
                                               logger="sitemap.action.pml-authorizer">
      <authenticator type="MY-PUB"/>
      <policies>MY-PUB/policies/</policies>
      <public>login-screen|do-login|switch-user|logout|.*[.]css|.*[.]jpg|.*[.]gif</public>
   </map:action>
   <map:action name="authenticator" src="org.lenya.cms.cocoon.acting.IMLAuthenticatorAction"
                                                  logger="sitemap.action.iml-authenticator">
      <type>MY-PUB</type>
      <passwd>MY-PUB/passwd/</passwd>
   </map:action>
 </map:actions>
</map:components>
...
<map:resources>
  <map:resource name="login">
    <map:generate type="serverpages" src="../../content/ac/login.xsp"/>
    <map:transform src="../../xslt/ac/login.xsl">
      <map:parameter name="publication_name" value="MY-PUB"/>
      <map:parameter name="publication_id" value="MY-PUB"/>
      <map:parameter name="lenya_path" value="lenya/pubs/MY-PUB/docs/standard/t01/" />
    </map:transform>
    <map:serialize type="html"/>
  </map:resource>
</map:resources>

]]></code>
<code><![CDATA[

<map:match pattern="logout">
  <map:generate type="serverpages" src="../../content/ac/invalidate.xsp"/>
  <map:transform src="../../xslt/ac/logout.xsl">
    <map:parameter name="publication_name" value="MY-PUB"/>
  </map:transform>
  <map:serialize/>
</map:match>

]]></code>
</li>
<li>
Set Name of Publication: lenya/pubs/MY-PUB/stylesheets/lenya/conf/conf.xsl
(e.g. 'MY Publication')
<code><![CDATA[

<?xml version="1.0"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:include href="../../../Configuration/read.xsl"/>
 <xsl:variable name="publication">MY Publication</xsl:variable>
 <xsl:variable name="copyright">copyright &#169; 2002 lenya.org</xsl:variable>
</xsl:stylesheet>

]]></code>
</li>
<li>
Moreover, replace ethz-mat by MY-PUB in following files:<br/>
i)   webapp/lenya/content/menus/live.xsp<br/>
ii)  webapp/lenya/pubs/MY-PUB/docs/cms/menus/live.xsp<br/>
iii) webapp/lenya/pubs/MY-PUB/stylesheets/standard/t01/Configuration/read.xsl<br/>
iv)  webapp/lenya/pubs/MY-PUB/stylesheets/Configuration/read.xsl<br/>
v)   webapp/lenya/pubs/MY-PUB/stylesheets/lenya/edit/root.xsl
</li>
</ol>
</section>
<section><title>Adding copied publication to root sitemap</title>
<p>
</p>
<p>
File: webapp/sitemap.xmap
</p>
<source><![CDATA[

<map:match pattern="MY-PUB/**">
   <map:mount uri-prefix="MY-PUB" src="lenya/pubs/MY-PUB/sitemap.xmap"
                                 check-reload="true" reload-method="synchron"/>
</map:match>

]]></source>
</section>
</section>
<section><title>Adding CM functionalities to an existing publication</title>
<section><title>Creating Authoring and Live area</title>
<p>
</p>
<p>
to do
</p>
</section>
</section>
<section><title>Import content</title>
<section><title>Create XSLT from HTML with JTidy</title>
<p>
</p>
<p>
export PATH=/usr/local/jdk1.3.1/bin:$PATH <br/>
java -classpath LENYACMS/build/lenya/classes:LENYACMS/build/lenya/webapp/WEB-INF/lib/jtidy-04aug2000r7-dev.jar org.lenya.util.TidyCommandLine
</p>
</section>
</section>
<section><title>Regard following items</title>
<section><title>Modify EditorMainAction if the html-editor is used</title>
<p>
</p>
<p>
Modify 'lenyaPath'in the java-class org.lenya.cms.cocoon.acting.EditorMainAction<br/>
     for instance: String lenyaPath="lenya/pubs/MY-PUB/docs/standard/t01/";<br/>
     and recompile.
</p>

</section>
</section>
</body>
</document>