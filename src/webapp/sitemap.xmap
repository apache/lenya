<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- CVS: $Id: sitemap.xmap,v 1.41 2003/03/04 18:09:07 gregor Exp $ -->

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
  <!-- =========================== Components ================================ -->

  <map:components>
    <map:generators default="file">
      <map:generator name="file" logger="sitemap.generator.file" label="content,data" src="org.apache.cocoon.generation.FileGenerator" pool-max="32" pool-min="16" pool-grow="4"/>
      <map:generator name="file-nolabel" logger="sitemap.generator.file-nolabel" src="org.apache.cocoon.generation.FileGenerator" pool-max="32" pool-min="16" pool-grow="4"/>
      <map:generator name="directory" logger="sitemap.generator.directory" label="content,data" src="org.apache.cocoon.generation.DirectoryGenerator"/>
      <map:generator name="serverpages" logger="sitemap.generator.serverpages" label="content,data" src="org.apache.cocoon.generation.ServerPagesGenerator"/>
      <map:generator name="request" src="org.apache.cocoon.generation.RequestGenerator"/>
      <map:generator name="stream" src="org.apache.cocoon.generation.StreamGenerator"/>
    </map:generators>
    <map:transformers default="xslt">
      <map:transformer name="xslt" logger="sitemap.transformer.xslt" src="org.apache.cocoon.transformation.TraxTransformer" pool-max="32" pool-min="16" pool-grow="4">
        <use-request-parameters>false</use-request-parameters>
        <use-browser-capabilities-db>false</use-browser-capabilities-db>
        <use-deli>false</use-deli>
      </map:transformer>
      <map:transformer name="log" logger="sitemap.transformer.log" src="org.apache.cocoon.transformation.LogTransformer"/>
      <map:transformer name="xinclude" logger="sitemap.transformer.xinclude" src="org.apache.cocoon.transformation.XIncludeTransformer"/>
      <map:transformer name="cinclude" logger="sitemap.transformer.cinclude" src="org.apache.cocoon.transformation.CIncludeTransformer"/>
      <map:transformer name="writeDOMsession" logger="sitemap.transformer.writeDOMsession" src="org.apache.cocoon.transformation.WriteDOMSessionTransformer"/>
      <map:transformer name="readDOMsession" logger="sitemap.transformer.readDOMsession" src="org.apache.cocoon.transformation.ReadDOMSessionTransformer"/>
      <map:transformer name="xlink" src="org.lenya.cms.cocoon.transformation.IncludeTransformer">
        <publication type=""/>
      </map:transformer>
    </map:transformers>
    <map:readers default="resource">
      <map:reader name="resource" logger="sitemap.reader.resource" src="org.apache.cocoon.reading.ResourceReader"/>
    </map:readers>
    <map:serializers default="html">
      <map:serializer name="xml" mime-type="text/xml" logger="sitemap.serializer.xml" src="org.apache.cocoon.serialization.XMLSerializer" pool-max="32" pool-min="16" pool-grow="4"/>
      <map:serializer name="html" mime-type="text/html" logger="sitemap.serializer.html" src="org.apache.cocoon.serialization.HTMLSerializer">
        <encoding>ISO-8859-1</encoding>
      </map:serializer>
      <map:serializer logger="sitemap.serializer.text" mime-type="text/plain" name="text" src="org.apache.cocoon.serialization.TextSerializer">
        <encoding>ISO-8859-1</encoding>
      </map:serializer>
    </map:serializers>
    <map:matchers default="wildcard">
      <map:matcher name="wildcard" logger="sitemap.matcher.wildcard" src="org.apache.cocoon.matching.WildcardURIMatcher"/>
      <map:matcher name="regexp" logger="sitemap.matcher.regexp" src="org.apache.cocoon.matching.RegexpURIMatcher"/>
      <map:matcher name="request-parameter" logger="sitemap.matcher.request-parameter" src="org.apache.cocoon.matching.RequestParameterMatcher"/>
      <map:matcher name="sessionstate" logger="sitemap.matcher.sessionstate" src="org.apache.cocoon.matching.WildcardSessionAttributeMatcher">
        <attribute-name>org.apache.cocoon.SessionState</attribute-name>
      </map:matcher>
      <map:matcher name="next-page" logger="sitemap.matcher.next-page" src="org.apache.cocoon.matching.WildcardRequestParameterMatcher">
        <parameter-name>next-state</parameter-name>
      </map:matcher>
      <map:matcher name="referer-match" logger="sitemap.matcher.referer-match" src="org.apache.cocoon.matching.WildcardHeaderMatcher">
        <header-name>referer</header-name>
      </map:matcher>
    </map:matchers>
  </map:components>
  <map:views>
    <map:view name="first" from-position="first">
      <map:serialize type="xml"/>
    </map:view>
    <map:view name="xml" from-label="xml">
      <map:serialize type="xml"/>
    </map:view>
  </map:views>
  <map:pipelines>


    <!-- Welcome to Wyona -->
    <map:pipeline>
      <map:match pattern="publications.xml">
        <map:generate type="directory" src="lenya/pubs"/>
        <map:transform src="lenya/stylesheets/cms/Page/util/xinclude.xsl"/>
        <map:transform type="xlink">
          <map:parameter name="href" value="lenya/pubs/dummy.xml"/>
        </map:transform>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="">
        <map:redirect-to uri="index.html"/>
      </map:match>
      <map:match pattern="index.html">
        <map:aggregate element="lenya" label="xml">
          <map:part src="cocoon:/publications.xml"/>
          <map:part src="lenya/docs/cms/introduction.xml"/>
        </map:aggregate>
        <map:transform src="lenya/stylesheets/cms/Page/util/welcome.xsl"/>
        <map:serialize type="html"/>
<!--
        <map:read src="resources/html/index.html" mime-type="text/html"/>
-->
      </map:match>
    </map:pipeline>


    <!-- Search with Lucene -->
    <map:pipeline>
      <map:match pattern="lucene/**">
        <map:mount uri-prefix="lucene" src="lenya/lucene.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>
      <map:match pattern="*/search/lucene">
        <map:generate type="serverpages" src="lenya/docs/cms/search/search-and-results.xsp">
          <map:parameter name="max-hits-per-page" value="3"/>
          <map:parameter name="max-pages" value="7"/>
          <map:parameter name="number-of-pubs" value="1"/>
          <map:parameter name="pub0-id" value="{1}"/>
          <map:parameter name="pub0-name" value="{1}"/>
          <map:parameter name="pub0-index-dir" value="lenya/pubs/{1}/resources/publication/search/lucene/index"/>
          <map:parameter name="pub0-excerpt-dir" value="lenya/pubs/{1}/resources/publication/search/lucene/htdocs_dump"/>
          <map:parameter name="pub0-prefix" value=""/>
        </map:generate>
        <map:transform src="lenya/stylesheets/cms/Page/search/sort.xsl"/>
        <map:transform src="lenya/pubs/{1}/stylesheets/cms/search-and-results.xsl"/>
        <!--
          <map:transform src="lenya/stylesheets/cms/Page/Search/search-and-results.xsl"/>
-->

        <map:serialize type="html"/>
      </map:match>
      <map:handle-errors>
        <map:serialize type="xml"/>
      </map:handle-errors>
    </map:pipeline>
    <!-- /Search with Lucene -->



    <map:pipeline>
      <!-- Editor Xopus -->
      <map:match pattern="xopus/**">
        <map:mount uri-prefix="xopus" src="lenya/xopus.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>


      <!-- Editor Bitflux -->
      <map:match pattern="bitfluxeditor/**">
        <map:mount uri-prefix="bitfluxeditor" src="lenya/bitfluxeditor.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>
    </map:pipeline>


    <map:pipeline>
      <!-- Wyona GUI -->
      <map:match pattern="wyona/**">
        <map:mount uri-prefix="wyona" src="lenya/wyona.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>


      <!-- Publications -->
      <map:match pattern="*/introduction.html">
        <map:generate src="lenya/pubs/{1}/publication.xml" />
        <map:transform src="lenya/stylesheets/cms/Page/util/publication.xsl"/>
        <map:serialize type="html" />
      </map:match>
      <map:match pattern="*/**">
        <map:mount uri-prefix="{1}" src="lenya/pubs/{1}/sitemap.xmap" check-reload="true" reload-method="synchron"/>
      </map:match>
    </map:pipeline>


  </map:pipelines>
</map:sitemap>
