<?xml version="1.0" ?>

<!DOCTYPE testcase [

<!ELEMENT testcase (annotation?,logkit,context?,roles,components)>

<!-- annotation describes the testcase -->
<!ELEMENT annotation (#PCDATA)>

<!-- logkit define the logkit in use -->
<!ELEMENT logkit (factories, targets, categories)>
<!ELEMENT factories (factory+)>

<!ELEMENT factory EMPTY>
<!ATTLIST factory 
  type CDATA #REQUIRED
  class CDATA #REQUIRED
>
<!ELEMENT targets ANY>
<!ELEMENT file ANY>
<!ATTLIST file
  id ID #REQUIRED>
<!ELEMENT filename (#PCDATA)>
<!ELEMENT format (#PCDATA)>
<!ATTLIST format
  type (extended|raw)  "extended"
>
<!ELEMENT categories (category+)>
<!ELEMENT category ANY>
<!ATTLIST category
  name CDATA #REQUIRED
  log-level (DEBUG|INFO|WARN|ERROR) "INFO"
>
<!ELEMENT log-target EMPTY>
<!ATTLIST log-target
  id-ref CDATA #REQUIRED
>

<!-- the context used by the components -->
<!ELEMENT context (entry*)>
<!ELEMENT entry EMPTY>
<!ATTLIST entry
  name CDATA #REQUIRED
  value CDATA #REQUIRED
>

<!-- the roles of the components -->
<!ELEMENT roles (role+)>
<!ELEMENT role (hint*)>
<!ATTLIST role
  name CDATA #IMPLIED
  class CDATA #IMPLIED
  shorthand CDATA #REQUIRED
  default-class CDATA #REQUIRED
>
<!ELEMENT hint EMPTY>
<!ATTLIST hint
  shorthand CDATA #REQUIRED
  class CDATA #REQUIRED
>

<!-- define components element, attributes, and its children -->
<!ELEMENT components (resolver)>
<!ATTLIST components 
  logger CDATA #IMPLIED
>
  
<!ELEMENT resolver (parameter*)>
<!ATTLIST resolver 
  logger CDATA #IMPLIED
>

<!ELEMENT parameter EMPTY>
<!ATTLIST parameter
  name CDATA #REQUIRED
  value CDATA #REQUIRED
>
]>


<testcase>
  <annotation>
    Test Cases: Accreditable Manager Test 
  </annotation>
  <logkit>
    <factories>
      <factory type="stream" class="org.apache.avalon.excalibur.logger.factory.StreamTargetFactory"/>
    </factories>
    <targets>
       <stream id="root">
        <stream>System.out</stream>
        <format type="extended">
          %7.7{priority} %5.5{time}   [%9.9{category}] (%{context}): %{message}\n%{throwable}
        </format>
       </stream>
     </targets>
     <categories>
       <category name="lenya" log-level="DEBUG">
         <log-target id-ref="root"/>
       </category>
     </categories>
  </logkit>
  
  <context>
    <entry name="foo" value="bar"/>
  </context>
  
  <roles>
  
    <role name="org.apache.excalibur.source.SourceFactorySelector"
          shorthand="source-factories"
          default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector">
    </role>
    
    <role name="org.apache.excalibur.source.SourceResolver"
          shorthand="source-resolver"
          default-class="org.apache.excalibur.source.impl.SourceResolverImpl"/>
  
    <role name="org.apache.lenya.cms.ac2.AccreditableManagerSelector"
          shorthand="accreditable-managers"
          default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector">
      <hint shorthand="file" class="org.apache.lenya.cms.ac2.file.FileAccreditableManager"/>
    </role>
    
  <role name="org.apache.lenya.cms.ac2.AuthorizerSelector"
        shorthand="authorizers"
        default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector">
    <hint shorthand="policy" class="org.apache.lenya.cms.ac2.PolicyAuthorizer"/>
    <hint shorthand="workflow" class="org.apache.lenya.cms.ac2.workflow.WorkflowAuthorizer"/>
  </role>
  
  <role name="org.apache.lenya.cms.ac2.PolicyManagerSelector"
        shorthand="policy-managers"
        default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector">
    <hint shorthand="file" class="org.apache.cms.ac2.file.FilePolicyManager"/>
    <hint shorthand="publication-file" class="org.apache.cms.ac2.file.PublicationFilePolicyManager"/>
    <hint shorthand="sitemap" class="org.apache.cms.ac2.sitemap.SitemapPolicyManager"/>
  </role>
  
  <role name="org.apache.lenya.cms.ac2.AccessControllerResolver"
        shorthand="access-controller-resolver"
        default-class="org.apache.lenya.cms.ac2.PublicationAccessControllerResolver"/>

  </roles>

  <components>
  
  <source-factories>
    <component-instance class="org.apache.excalibur.source.impl.ResourceSourceFactory" name="resource"/>
    <component-instance class="org.apache.excalibur.source.impl.URLSourceFactory" name="*"/>
  </source-factories>
  
    <accreditable-managers>
      <component-instance logger="lenya.ac.accreditablemanager"
          class="org.apache.lenya.cms.ac2.file.FileAccreditableManager" name="file">
        <parameter name="directory" value="file:///d:/development/build/tomcat-4.1.24/webapps/lenya/lenya/pubs/test/config/ac/passwd"/>
      </component-instance>
    </accreditable-managers>
    
  <authorizers>
    <component-instance class="org.apache.lenya.cms.ac2.PolicyAuthorizer" logger="lenya.ac.authorizer" name="policy"/>
    <component-instance class="org.apache.lenya.cms.ac2.workflow.WorkflowAuthorizer" logger="lenya.ac.authorizer" name="workflow"/>
  </authorizers>
  
  <policy-managers>
    <component-instance class="org.apache.lenya.cms.ac2.file.FilePolicyManager" logger="lenya.ac.policymanager" name="file">
      <parameter name="directory" value="context:///lenya/config/ac/policies"/>
    </component-instance>
    <component-instance class="org.apache.lenya.cms.ac2.file.PublicationFilePolicyManager" logger="lenya.ac.policymanager" name="publication-file">
      <parameter name="directory" value="context:///"/>
    </component-instance>
    <component-instance class="org.apache.lenya.cms.ac2.sitemap.SitemapPolicyManager" logger="lenya.ac.policymanager" name="sitemap"/>
  </policy-managers>
  
  <component logger="lenya.ac.accesscontroller"
      class="org.apache.lenya.cms.ac2.DefaultAccessController"
      role="org.apache.lenya.cms.ac2.AccessController/global">
    <accreditable-manager type="file"/>
    <policy-manager type="file"/>
    <authorizer type="policy"/>
  </component>
  
  <component logger="lenya.ac.accesscontroller"
      class="org.apache.lenya.cms.ac2.DefaultAccessController"
      role="org.apache.lenya.cms.ac2.AccessController/publication-file">
    <accreditable-manager type="file"/>
    <policy-manager type="publication-file"/>
    <authorizer type="policy"/>
    <authorizer type="workflow"/>
  </component>
  
  <component logger="lenya.ac.accesscontroller"
      class="org.apache.lenya.cms.ac2.DefaultAccessController"
      role="org.apache.lenya.cms.ac2.AccessController/sitemap">
    <accreditable-manager type="file"/>
    <policy-manager type="sitemap"/>
    <authorizer type="policy"/>
    <authorizer type="workflow"/>
  </component>
  
  <component logger="lenya.ac.accesscontrollerresolver"
      class="org.apache.lenya.cms.ac2.PublicationAccessControllerResolver"
      role="org.apache.lenya.cms.ac2.AccessControllerResolver"/>

    
  </components>
  
</testcase>
