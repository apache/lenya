<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- $Id: lucene.xml 55543 2004-10-26 00:14:59Z gregor $ -->

<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">

<document> 

<header> 
    <title>Lucene</title>
    <version>0.1</version> 
    <type>Documentation</type> 
    <authors>
      <person name="Lenya community" email="dev@lenya.apache.org"/>
    </authors> 
</header> 
<body> 

<section>
<title>Generic Search</title>
<p>URL:</p>
<source>
<![CDATA[
/lenya/$PUB_ID/search-$AREA/lucene
]]>
</source>

<p>Indices and Excerpts:</p>
<source>
<![CDATA[
src/webapp/lenya/pubs/$PUB_ID/work/search/index/$AREA/index
src/webapp/lenya/pubs/$PUB_ID/work/search/htdocs_dump/$AREA
]]>
</source>

<p>Configuration:</p>
<source>
<![CDATA[
src/webapp/global-sitemap.xmap
src/webapp/lenya/lucene.xmap
]]>
</source>
</section>

<section>
<title>Customizing/Overwriting Generic Search Interface</title>
<p>XSLT:</p>
<source>
<![CDATA[
src/webapp/lenya/pubs/$PUB_ID/lenya/xslt/search/search-and-results.xsl
]]>
</source>

<p>URL:</p>
<source>
<![CDATA[
/lenya/$PUB_ID/search-$AREA/lucene
]]>
</source>
</section>


<section>
<title>Crawling a website</title>
<p>
Crawl a website by running
</p>
<source>
<![CDATA[
ant -f src/webapp/lenya/bin/crawl_and_index.xml crawl -Dcrawler.xconf=/home/username/src/lenya/src/webapp/lenya/pubs/default/config/search/crawler-live.xconf
]]>
</source>
<p>
whereas the crawler.xconf has the following elements
</p>
<source>
<![CDATA[
<crawler>
  <user-agent>lenya</user-agent>

  <base-url href="http://lenya.apache.org/index.html"/>
  <scope-url href="http://lenya.apache.org/"/>

  <uri-list src="work/search/lucene/uris.txt"/>
  <htdocs-dump-dir src="work/search/lucene/htdocs_dump/cocoon.apache.org"/>

  <!-- <robots src="robots.txt" domain="cocoon.apache.org"/> -->
</crawler>
]]>
</source>
<p>
where the element robots is optional.
</p>
<p>
In case you don't have access to the server and want to disallow certain  URLs from being crawled, then
you can also define a "robots.txt" on the crawler side, e.g.
</p>
<source>
<![CDATA[
# cocoon.apache.org

User-agent: *
Disallow: /there_seems_to_be_a_bug_within_websphinx_Robot_Exclusion.html
#Disallow:

User-agent: lenya
Disallow: /do/not/crawl/this/page.html
]]>
</source>
</section>

<section>
<title>Creating an index from the command line</title>
<source>
<![CDATA[
ant -f src/webapp/lenya/bin/crawl_and_index.xml -Dlucene.xconf=/home/username/src/lenya/src/webapp/lenya/pubs/default/config/search/lucene-live.xconf index
]]>
</source>
<p>
whereas the lucene.xconf has the following elements
</p>
<source>
<![CDATA[
<lucene>
  <update-index type="new"/>
  <!--
  <update-index type="incremental"/>
  -->

  <index-dir src="../../work/search/lucene/index/index"/>
    <htdocs-dump-dir src="../../work/search/lucene/htdocs_dump"/>

    <indexer class="org.apache.lenya.lucene.index.DefaultIndexer"/>
<!--
    <indexer class="org.apache.lenya.lucene.index.ConfigurableIndexer">
      <configuration src="cmfs-luceneDoc.xconf"/>
      <extensions src="xml"/>
    </indexer>
-->
<!--
    <indexer class="org.apache.lenya.lucene.index.ConfigurableIndexer">
      <configuration src="cmfs-luceneDoc.xconf"/>
      <filter class="foo.bar.FileFilter"/>
    </indexer>
-->
</lucene>
]]>
</source>
</section>

<section>
<title>Indexing XML documents</title>

<p>
In order to index XML documents one needs to configure the <code>org.apache.lenya.lucene.index.ConfigurableIndexer</code> (see above).
</p>

<p>
With namespaces:
</p>
<source>
<![CDATA[
<?xml version="1.0"?>

<luc:document xmlns:luc="http://apache.org/cocoon/lenya/lucene/1.0">
  <luc:field name="currwfstate" type="Text" xpath="/wf:history/wf:version[last()]/@state">
    <namespace prefix="wf">http://apache.org/cocoon/lenya/workflow/1.0</namespace>
  </luc:field>
</luc:document>
]]>
</source>

<p>
Concatenating element values and setting default values in case element value doesn't exist:
</p>
<source>
<![CDATA[
<?xml version="1.0"?>

<luc:document xmlns:luc="http://apache.org/cocoon/lenya/lucene/1.0">
  <luc:field name="title" type="Text" xpath="/article/head/title"/>
  <luc:field name="subtitle" type="Text" xpath="/article/head/subtitle"/>
  <luc:field name="lead" type="UnStored" xpath="/article/head/abstract"/>
  <luc:field name="contents" type="UnStored" xpath="/"/>
  <luc:field name="author" type="UnStored"/>
    <namespace prefix="lenya">http://apache.org/cocoon/lenya/page-envelope/1.0</namespace>
    <namespace prefix="dc">http://purl.org/dc/elements/1.1/</namespace>
    <xpath>/*/lenya:meta/dc:contributor</xpath>
  </luc:field>
  <luc:field name="date" type="Text">
    <namespace prefix="lenya">http://apache.org/cocoon/lenya/page-envelope/1.0</namespace>
    <xpath default="1969">/*/lenya:meta/year</xpath><text>.</text><xpath default="02">/*/lenya:meta/month</xpath><text>.</text><xpath default="16">/*/lenya:meta/day</xpath>
  </luc:field>
</luc:document>
]]>
</source>
</section>

<section>
<title>Extract text from a PDF document</title>
<source>
<![CDATA[
ant -f src/webapp/lenya/bin/crawl_and_index.xml -Dhtdocs.dump.dir=/home/username/src/lenya/src/webapp/lenya/pubs/default/work/search/lucene/htdocs_dump xpdf
]]>
</source>
<p>
Also see the targets <code>pdfbox</code> and <code>pdfadobe</code>.
</p>
</section>

</body>
</document>
