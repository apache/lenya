<?xml version="1.0"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- $Id: usecases.xml 55543 2004-10-26 00:14:59Z gregor $ -->

<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">
<document> 
  <header> 
    <title>Usecases</title>
    <version major="0" minor="2">Version 0.2</version>
    <authors>
      <person name="Lenya community" email="lenya-dev@cocoon.apache.org"/>
    </authors> 
    <abstract>Description of the usecase concept and the existing usecases.</abstract> 
  </header> 
  <body> 

    <section>
      <title>Introduction</title>
      <p>
      Usecases are sequences of pages that are orthogonal to the website,
      i.e. they can be executed without leaving the current URI.
      They are mainly used to execute CMS functions, e.g., to publish a page.
      Usecases are specified by
      </p>
      <ul>
      <li>a <strong>name</strong> and</li>
      <li>a set of <strong>steps</strong>.</li>
      </ul>
      <p>
      A usecase is executed using the request parameters <code>lenya.usecase</code> and
      <code>lenya.step</code>.
      </p>
    </section>
    
    <section><title>Matching Usecases</title>
    
    <p>
    To match a usecase in a sitemap, the <code>WildcardRequestParameterMatcher</code>
    is used on the <code>lenya.usecase</code> and <code>lenya.step</code> request
    parameters. The predefined matchers have the types <code>usecase</code> and
    <code>step</code>. A simple example of a usecase pipeline would be:
    </p>
<source>
<![CDATA[<map:match type="usecase" pattern="publish">
      
  <!-- confirmation screen -->
  <map:match type="step" pattern="showscreen">
    <map:generate type="serverpages"
        src="content/publishing/publish-screen.xsp"/>
    <map:transform src="xslt/publishing/publish-screen.xsl"/>
    <map:serialize/>
  </map:match>

  <!-- call publish task -->
  <map:match type="step" pattern="publish">
    <map:act type="task">
      <map:parameter name="publication-id" value="{../../1}"/>
      <map:parameter name="task-id" value="{request-param:task-id}"/>
      <map:redirect-to uri="{request:requestURI}" session="true"/>
    </map:act>
  </map:match>
        
</map:match>]]>
</source>
    
</section>

<section><title>The Usecase Sitemap</title>

  <p>
  The main usecase sitemap supports a set of generic usecases.
  It is located at <code>lenya/usecase.xmap</code>.
  To implement your publication-specific usecases or to override a generic
  usecase, just add a <code>usecase.xmap</code>
  sitemap to your publication directory. The Lenya usecase sitemap looks for it
  and mounts it before the generic usecases are matched.
  </p>

</section>

  <section>
    <title>Overview of use cases</title>
    <p>The following use cases are known:</p>

    <table>
      <tr>
        <th>Use case</th>
        <th><code>lenya.usecase=</code></th>
        <th><code>lenya.step=</code></th>
        <th>Comment</th>
      </tr>
       <tr>
        <td>Reject Approval</td>
        <td>reject</td>
        <td>showscreen</td>
        <td>Confirm to reject a document from approval.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>reject</td>
        <td></td>
      </tr>
       <tr>
        <td>Submit for Approval</td>
        <td>submit</td>
        <td>showscreen</td>
        <td>Confirm to submit a document to approval.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>submit</td>
        <td></td>
      </tr>
       <tr>
        <td>Archive</td>
        <td>archive</td>
        <td>showscreen</td>
        <td>Confirm to archive a document.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>archive</td>
        <td></td>
      </tr>
      <tr>
        <td>Checkin</td>
        <td>checkin</td>
        <td>showscreen</td>
        <td>Confirm the checkin of this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>checkin</td>
        <td></td>
      </tr>
      <tr>
        <td>Checkout</td>
        <td>checkout</td>
        <td>showscreen</td>
        <td>Confirm the checkout of this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>checkout</td>
        <td></td>
      </tr>
       <tr>
        <td>Copy</td>
        <td>copy</td>
        <td>showscreen</td>
        <td>Confirm to copy a document.  (The document is held in a clipboard until it is pasted again)</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>copy</td>
        <td></td>
      </tr>
      <tr>
        <td>Create</td>
        <td>create</td>
        <td>showscreen</td>
        <td>Show a form allowing to specify the parameters for
        creation of a document</td> 
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>create</td>
        <td>Create the document</td>
      </tr>
       <tr>
        <td>Cut</td>
        <td>cut</td>
        <td>showscreen</td>
        <td>Confirm to cut a document.  (The document is held in a clipboard until it is pasted again)</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>cut</td>
        <td></td>
      </tr>
       <tr>
        <td>Deactivate</td>
        <td>deactivate</td>
        <td>showscreen</td>
        <td>Confirm to deactivate a document.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>deactivate</td>
        <td></td>
      </tr>
       <tr>
        <td>Delete</td>
        <td>delete</td>
        <td>showscreen</td>
        <td>Confirm to delete a document.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>delete</td>
        <td></td>
      </tr>
      <tr>
        <td>Logout</td>
        <td>logout</td>
        <td>showscreen</td>
        <td>Confirm the logout</td>
      </tr>
       <tr>
        <td>Paste</td>
        <td>paste</td>
        <td>showscreen</td>
        <td>Confirm to paste a document.  (The document which is held in a clipboard until is pasted)</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>paste</td>
        <td></td>
      </tr>
      <tr>
        <td>Publish</td>
        <td>publish</td>
        <td>showscreen</td>
        <td>Confirm the publication of this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>publish</td>
        <td>Publish this document</td>
      </tr>
      <tr>
        <td>Asset upload</td>
        <td>aset</td>
        <td>showscreen</td>
        <td>Show a form allowing to specify the parameters for
          uploading of an asset</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>upload</td>
        <td>Upload the asset</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>insert</td>
        <td>Insert an already uploaded asset</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>upload-and-insert</td>
        <td>Upload and insert an asset</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>remove</td>
        <td>Remove a previously uploaded asset</td>
      </tr>
       <tr>
        <td>Rename</td>
        <td>rename</td>
        <td>showscreen</td>
        <td>Confirm to rename a document.</td>
      </tr>
       <tr>
        <td></td>
        <td></td>
        <td>rename</td>
        <td></td>
      </tr>
      <tr>
        <td>Rollback</td>
        <td>rollback</td>
        <td>showscreen</td>
        <td>Show a list of all versions of this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>view</td>
        <td>View a particular version of this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>rollback</td>
        <td>Roll back to a particular version of this document</td>
      </tr>
      <tr>
        <td>Schedule</td>
        <td>schedule</td>
        <td>showscreen</td>
        <td>Show a list of all task scheduled for this document</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>add</td>
        <td>Add a new task</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>modify</td>
        <td>Modify an existing task</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>delete</td>
        <td>Delete an existing task</td>
      </tr>
      <tr>
        <td>Edit</td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>Administration</td>
        <td>userAddUser</td>
        <td></td>
        <td>Add a user</td>
      </tr>
      <tr>
        <td></td>
        <td>userDeleteUser</td>
        <td></td>
        <td>Show a form for adding users</td>
      </tr>
      <tr>
        <td></td>
        <td>userChangeProfile</td>
        <td></td>
        <td>Change the profile of a user</td>
      </tr>
      <tr>
        <td></td>
        <td>userChangePasswordUser</td>
        <td></td>
        <td>Change the password as a user</td>
      </tr>
      <tr>
        <td></td>
        <td>userChangePasswordAdmin</td>
        <td></td>
        <td>Change the password as an administrator</td>
      </tr>
      <tr>
        <td></td>
        <td>userChangeGroups</td>
        <td></td>
        <td>Change the group affiliation of a user</td>
      </tr>
      <tr>
        <td></td>
        <td>iprangeAddIPRange</td>
        <td></td>
        <td>Add an IP range</td>
      </tr>
      <tr>
        <td></td>
        <td>iprangeDeleteIPRange</td>
        <td></td>
        <td>Delete an IP range</td>
      </tr>
      <tr>
        <td></td>
        <td>iprangeChangeProfile</td>
        <td></td>
        <td>Change the profile of an IP range</td>
      </tr>
      <tr>
        <td></td>
        <td>iprangeChangeGroups</td>
        <td></td>
        <td>Change the group affiliation of an IP range</td>
      </tr>
      <tr>
        <td></td>
        <td>groupAddGroup</td>
        <td></td>
        <td>Add a group</td>
      </tr>
      <tr>
        <td></td>
        <td>groupDeleteGroup</td>
        <td></td>
        <td>Delete a group</td>
      </tr>
      <tr>
        <td></td>
        <td>groupChangeProfile</td>
        <td></td>
        <td>Change the profile of a group</td>
      </tr>
      <tr>
        <td></td>
        <td>groupChangeMembers</td>
        <td></td>
        <td>Change the members of a group</td>
      </tr>
      <tr>
        <td>View Logs</td>
        <td>view-logs</td>
        <td>overview</td>
        <td>Show the logfile list for this publication</td>
      </tr>
      <tr>
        <td>&#160;</td>
        <td>&#160;</td>
        <td>log</td>
        <td>Show a single logfile</td>
      </tr>
    </table>

    <fixme author="ce">Can the authenticate process done in a
      similar way?</fixme>

  </section>

  <section>
    <title>Use cases</title>

    <section>
      <title>Resource upload</title>

      <p><code>lenya.usecase=upload</code></p>

      <table>
        <tr>
          <th><code>lenya.step=</code></th>
          <th>additional parameters</th>
          <th>sample value</th>
        </tr>
        <tr>
          <td>showscreen</td>
          <td>xpath</td>
          <td>/NewsML/body.content/block[1]/*[1]</td>
        </tr>
        <tr>
          <td></td>
          <td>insertBefore [optional]</td>
          <td>true</td>
        </tr>

        <tr>
          <td>upload</td>
          <td>documentid</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>xpath</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>insertBefore [optional]</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>uploadFile</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>identifier [optional]</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td colspan="2">All Dublin core identifiers are also accepted</td>
        </tr>
      </table>
    </section>

    <section>
      <title>Create</title>

      <p><code>lenya.usecase=create</code></p>

      <table>
        <tr>
          <th><code>lenya.step=</code></th>
          <th>additional parameters</th>
          <th>sample value</th>
        </tr>
        <tr>
          <td>showscreen</td>
          <td>parentid</td>
          <td>/dossiers/2003</td>
        </tr>
        <tr>
          <td></td>
          <td>doctype</td>
          <td>Dossier</td>
        </tr>
        <tr>
          <td>create</td>
          <td>parentid</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>childid</td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td>doctype</td>
          <td></td>
        </tr>
      </table>

    </section>

    <section>
      <title>Rollback</title>

      <p><code>lenya.usecase=rollback</code></p>

      <table>
        <tr>
          <th><code>lenya.step=</code></th>
          <th>additional parameters</th>
          <th>sample value</th>
        </tr>
        <tr>
          <td>showscreen</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>view</td>
          <td>version</td>
          <td></td>
        </tr>
      </table>
    </section>

    <section>
      <title>View Logs</title>

      <p><code>lenya.usecase=view-logs</code></p>

      <table>
        <tr>
          <th><code>lenya.step=</code></th>
          <th>additional parameters</th>
          <th>sample value</th>
        </tr>
        <tr>
          <td>overview</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>log</td>
          <td>logfile</td>
          <td>2003-05-13-18-34-00-314.xml</td>
        </tr>
      </table>
    </section>

    <fixme author="ce">Add remaining use cases</fixme>
  </section>
      
  </body> 
  <footer> 
    <legal>© 200 wyona.org</legal> 
  </footer>
</document>
