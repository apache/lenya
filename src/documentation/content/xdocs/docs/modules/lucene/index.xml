<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 1999-2006 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- $Id: index.xml 55543 2004-10-26 00:14:59Z thorsten $ -->

<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">

<document>
  <header>
    <title>The lucene Module</title>
  </header>
  <body>
    <section>
      <title>Introduction</title>
      <p>
        The <code>lucene</code> module integrates the Lucene search engine.
      </p>
    </section>
    
    <section>
      <title>Configuration</title>
      <p>
        Each publication has a configuration at <code>$PUB_HOME/config/search/lucene_index.xml</code>
        which is being defined by
        <code>org.pache.cocoon.components.search.components.impl.IndexManagerImpl</code>.
      </p>
    </section>
    
    <section>
      <title>Indexing</title>
      <p>
        Indexing is typically triggered by the <code>org.apache.lenya.cms.lucene.IndexUpdaterImpl</code>,
        which attaches itself as a listener to the repository on startup.
      </p>
      <p>
        Indexing can also be executed explicitely by calling the <code>lucene.index</code>
        usecase which is defined
        by <code>config/cocoon-xconf/usecase-lucene.index.xconf</code> and uses as main
        entry point <code>org.apache.lenya.cms.lucene.IndexDocument</code>.
      </p>
      <p>
        In order to make a resource type indexable one needs to add the format luceneIndex to the
        resource type configuration (e.g. <code>src/modules/xhtml/config/cocoon-xconf/resource-type-xhtml.xconf</code>)
        One needs to create or reuse a pipeline for this format within the specified sitemap.
      </p>
    </section>
    
    <section>
      <title>Indexing Issues</title>
      <p>
        When the system is under high load, it can occur that a document is not indexed after a change
        because the indexer is busy. In this case, a notification message is sent to a user which can
        be configured in <code>modules/lucene/sitemap.xmap</code>:
      </p>
      <source xml:space="preserve"><![CDATA[<map:transformer name="index2"
    logger="sitemap.transformer.luceneindextransformer2"
    src="org.apache.cocoon.transformation.LuceneIndexTransformer2">
  <notify user="lenya"/>
</map:transformer>]]></source>
    </section>
    
    <section>
      <title>Searching</title>
      <p>
        To be documented.
      </p>
      
    </section>
  </body>
</document>
