<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 1999-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- $Id: website-update.xml 47579 2004-09-30 12:25:51Z thorsten $ -->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.1//EN" "document-v11.dtd">
<document>
	<header>
		<title>Updating the Lenya Website</title>
		<version/>
		<type/>
	</header>
	<body>
		<section>
		<title>Prerequisites</title>
		<p>Before you try to update the Lenya website, make sure you meet the following requirements:</p>
		<ul>
			<li>You have <link href="http://forrest.apache.org">Apache Forrest</link> installed on your machine. This means you have your environment set up
			in a way that you can call <code>forrest run</code> in any directory.</li>
			<li>You are an active Lenya committer with write access to SVN.</li>
		</ul>
		<p>If you are not a committer but you would like to contribute to the documentation, you're most welcome as well. If case you
		just want to make little additions or corrections to the Lenya documentation or the Lenya website, please follow this
		instructions, but instead of committing please make an <code>svn diff</code> and post it on the developer's mailing list. 
		A committer will happily pick your patch up and apply it.</p>
		
		</section>

		<section>
		<title>Understanding the Apache infrastructure</title>
		<p>The Website at <code>http://lenya.apache.org/</code> is a static site, which is served directly from the directory
		<code>/site</code> in the Apache Lenya SVN repository by a plain Apache httpd server. No Cocoon or even Lenya is 
		involved in this very situation.</p>
		<p>But the content of <code>/site</code> is never touched directly by any human editor. Instead, it is generated
		through Forrest from the input files in the <code>/docu</code> directory of the Lenya SVN repository. A cron job 
		updates the static files in <code>/site</code> every 12 hours to reflect any changes that got checked into to 
		<code>/docu</code>.</p>
		<p>The typical roundtrip process to update the website therefore is:</p>
		<ul>
		<li>Checkout <code>https://svn.apache.org/repos/asf/lenya/docu</code> into a working directory.</li>
		<li>Run <code>forrest</code> locally on your machine. You can browse your checked-out copy of the website at
		<code>http://localhost:8888/</code>.</li>
		<li>Edit the content using your favourite editor. Refer to the Forrest Documentation if necessary.</li>
		<li>Hit the Reload button in your browser and test your changes locally on your machine until they work the way you 
		intended.</li>
		<li>Check in your changes (if you are a committer) or prepare a patch (if you aren't)</li>
		<li>Wait until your changes show up at <code>http://lenya.apache.org/</code>. This will take a maximum of 12 hours.</li>
		</ul>
		<p>See below for more detailed instructions and some more hints.</p>
		</section>

		<section>
			<title>Generating changes.html</title>
			<p>changes.html can be directly generated from the SVN commit logs with the following procedure:</p>
			<ul>
				<li>install <link href="http://saxon.sf.net">Saxon 8</link> (the svn2changes stylesheet requires a XSLT 2.0 processor)</li>
				<li>run <code>svn log -v --xml http://svn.apache.org/repos/asf/lenya > log.xml</code> in the root of the docu branch. This might take a while as the log file is several MB in size.</li>
				<li>run <code>java -jar saxon8.jar -o status.xml log.xml tools/svn2changes.xsl</code>
				</li>
				<li>run <code>forest</code> (You may have to increase <code>forrest.maxmemory</code> in forrest.properties to get around out of memory exceptions.) Forrest will take a LONG TIME to generate changes.html.</li>
			</ul>
			<p>If everything went alright, you will find changes.html, changes.pdf and changes.rss inside your xdocs directory.</p>
		</section>
		<section>
			<title>Updating the Lenya website</title>
			<ul>
				<li>
					<code>svn co https://svn.apache.org/repos/asf/lenya/docu/ lenya.docu</code> ->This is our documentation and website source tree</li>
				
				<li>
					<link href="ext:forrest.install">Install Forrest 0.6</link> (Note that you need to use 0.6, other version do not work)</li>
				<li>
					<code>go to the root of lenya/docu</code>
				</li>
				<li>
					<code>forrest</code> (Note that Forrest may claim that the build failed, most of the time this is only because of entries in brokenlinks that
    can be ignored. If the site looks ok to you, and there were no validation errors, go for it.)</li>
				<li>Create and copy the Javadoc for both branches (<code>build javadocs</code>, Copy from <code>build/webapp/site/apidocs</code> to <code>lenya/site/apidocs/1.2</code> and
    <code>lenya/site/apidocs/1.4</code>)</li>
				<li>Add, remove, commit to <code>lenya/site</code>
				</li>
			</ul>
			<p>There is a cron job on minotaur which will do 'svn update'
every 12 hours (see ~thorsten/bin/mycrontab). If you want to do it manually then ...</p>
			<ul>
				<li>Login to <code>minotaur.apache.org</code>
				</li>
				<li>
					<code>minotaur@apache.org &gt; /x1/home/thorsten/bin/lenya-update.sh</code>
				</li>
			</ul>
		</section>
	</body>
</document>
