<!-- === Test targets =========================================================== -->

  <!-- Runs all tests -->
  <target name="test" depends="junit.tests, anteater.tests" description="Runs all tests"/>

  <!-- Runs JUnit tests -->
  <target name="junit.tests" depends="init">
  <!--<target name="junit.tests" depends="compile">-->
    <mkdir dir="${build.test}"/>

    <!-- Copy test files to build test dir -->
    <copy todir="${build.test}" filtering="on">
      <fileset dir="${src.test}" excludes="**/*.java"/>
    </copy>

    <!-- Compile tests -->
    <javac srcdir="${src.test}"
           destdir="${build.test}"
           debug="{debug}"
           optimize="{optimize}"
           deprecation="{deprecation}"
           target="${target.vm}"
           fork="true">
      <classpath refid="classpath"/>
      <classpath>
        <pathelement path="${build.root}/lenya/webapp/WEB-INF/classes" />
      </classpath>
    </javac>

    <!-- Run tests -->
    
    <!--
    Identity Test
    -->
    <!--
    <java fork="yes" classname="junit.textui.TestRunner">
      <arg value="org.apache.lenya.cms.ac.IdentityTestCase"/>
      <classpath refid="classpath"/>
      <classpath>
        <pathelement location="${build.test}" />
        <pathelement path="${build.root}/lenya/webapp/WEB-INF/classes" />
      </classpath>
    </java>
    -->
    
    <!--
    AntTask Test
    -->
    <java
    	fork="yes"
    	classname="org.apache.lenya.cms.task.AntTaskTest"
    	>
      <jvmarg value="-enableassertions"/>
      <arg value="${install.dir}"/> <!-- servlet context path -->
      <classpath refid="classpath"/>
      <classpath>
        <pathelement location="${build.test}" />
        <pathelement path="${build.root}/lenya/webapp/WEB-INF/classes" />
        <fileset dir="${build.root}/lenya/webapp/WEB-INF/lib">
          <include name="ant**.jar"/>
        </fileset>
      </classpath>
    </java>
    
    <!-- Workflow Test -->
    <java fork="yes" classname="org.apache.lenya.cms.workflow.WorkflowTest">
      <jvmarg value="-enableassertions"/>
      <arg value="default"/> <!-- publication id -->
      <arg value="${install.dir}"/> <!-- servlet context path -->
      <arg value="simple"/> <!-- document type -->
      <classpath refid="classpath"/>
      <classpath>
        <pathelement location="${build.test}" />
        <pathelement path="${build.root}/lenya/webapp/WEB-INF/classes" />
        <fileset dir="${build.root}/lenya/webapp/WEB-INF/lib">
          <include name="ant**.jar"/>
        </fileset>
      </classpath>
    </java>
    
    
  </target>

  <!-- Anteater tests  -->
  <target name="anteater.tests">
    <property name="host" value="localhost"/>
    <property name="port" value="8888"/>
    <property name="base" value="/"/>

    <!-- FIXME: Anteater invocation is platform specific
    <exec executable="cmd">
      <arg line="/C C:\Java\anteater-0.9.15\bin\anteater.bat -f src/test/anteater/all-tests.xml -Dhost=${host} -Dport=${port} -Dbase=${base}"/>
    </exec>
    <exec executable="anteater">
      <arg line="-f src/test/anteater/all-tests.xml -Dhost=${host} -Dport=${port} -Dbase=${base}"/>
    </exec>
    -->
  </target>
