If you want to play with Lenya in Jetty 6.1.6, please take a look at jetty6.xml
and follow the instructions in the comment header.

Running Jetty 6.1.6 is orthogonal to proxy testing; the server configuration
includes both ajp://localhost:8009 and http://localhost:8888, so you can
just drop it in, replacing the old version, without bothering about the
proxy stuff. Please follow up on bug
http://issues.apache.org/bugzilla/show_bug.cgi?id=43729 with success and
problem reports.


*.*


If you want to put the proxying code to test, start Jetty6. Next get an Apache httpd server
installed. Then apply the following tweaks:

1. Install the bogus SSL keys:

   cp *.pem /tmp

2. Install an apache configuration for virtual hosts:

   cp apache_vhosts.conf /etc/apache2/vhosts.d 

   (That's probably distro-specific. Just make sure that the file is being 
   included from your master config file)

3. Append some fake host entries to your local resolver:

   cat hosts_fake >> /etc/hosts

4. Make sure apache2 is configured to run SSL by passing it the -DSSL flag.

5. Restart apache2:

   /etc/init.da/apache2 restart

6. Uncomment the proxy settings in the default publication config:
   (src/pubs/default/config/publication.xml)

7. Uncomment the global proxy settings.
   (src/modules-core/linking/config/cocoon-xconf/global-proxies.xconf)

8. ./build.sh clean && ./build.sh

9. Surf to http://localhost:8888 to check what the proxy does. Then try
   http://www.example.com/lenya/default/authoring/ and 
   http://customer.example.com.

It doesn't quite work as it should (redirects from the Lenya servlet are
wrong), but you get the idea.

The proxy example setting simulates the following situation:
* A customer wants a company hostname and URLs without Lenya-specific
  path components for the live site.
* The server uses name-based virtual hosting with just one IP, i.e.
  there can only be one SSL vhost, which is shared among several
  customers. This implies the need for sub-directories in the proxy
  URL.
* "authoring" should be ssl-protected. There is no need for a
  customer hostname here, since it's not publicly visible.
* Any SSL-protected documents in "live" can be handled by the SSL
  vhost (not using the company hostname is ok in this case).

The desired customer hostname is customer.example.com.
The SSL vhost is called www.example.com.
The Lenya CMS for our customer is reachable as
https://www.example.com/lenya/customer/authoring
The global proxy for non-publication-specific resources shall be
http://www.example.com/lenya.


