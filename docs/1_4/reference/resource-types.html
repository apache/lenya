<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Resource Types</title>
<link type="text/css" href="../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../skin/profile.css" rel="stylesheet">
<script src="../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with ');" size="25" name="q" id="query" type="text" value="Search the site with ">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="../../../index.html">Project</a>
</li>
<li class="current">
<a class="selected" href="../../../docs/index.html">Documentation</a>
</li>
<li>
<a class="unselected" href="../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs">
<a class="selected" href="../../../docs/1_4/index.html">Version 1.4</a><a class="unselected" href="../../../docs/modules/index.html">Modules</a><a class="unselected" href="../../../docs/1_2_x/index.html">Version 1.2</a>
</div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../docs/1_4/index.html">Index</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/faq.html">FAQs</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3', '../../../skin/')" id="menu_1.1.3Title" class="menutitle">Installation</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/installation/source_version.html">Install Instructions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4', '../../../skin/')" id="menu_1.1.4Title" class="menutitle">Concepts</div>
<div id="menu_1.1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/1_4/concepts/publication.html">Publication</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/concepts/urlMapping.html">URL Mapping</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/concepts/authoring_live.html">Authoring and Live mode</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/concepts/wysiwyg.html">WYSIWYG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.5', '../../../skin/')" id="menu_selected_1.1.5Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Technical Reference</div>
<div id="menu_selected_1.1.5" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../docs/1_4/reference/lenya-sitemaps.html">Overview of Lenya Sitemaps</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.2', '../../../skin/')" id="menu_1.1.5.2Title" class="menutitle">Usecase Framework</div>
<div id="menu_1.1.5.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/1_4/reference/usecase-framework/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/usecase-framework/abstractusecase.html">AbstractUsecase</a>
</div>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/publication-templating/index.html">Publication Templating</a>
</div>
<div class="menupage">
<div class="menupagetitle">Resource Types</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Introduction">Introduction</a>
</div>
<div class="menupageitem">
<a title="Choose a Unique Resource Type Name" href="#Choose+a+Unique+Resource+Type+Name">Choose a Unique Res...</a>
</div>
<div class="menupageitem">
<a title="Adding the Resource Type to a Publication" href="#Adding+the+Resource+Type+to+a+Publication">Adding the Resource...</a>
</div>
</div>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/modules/index.html">Modules</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/metadata.html">Meta data</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.7', '../../../skin/')" id="menu_1.1.5.7Title" class="menutitle">Protocols</div>
<div id="menu_1.1.5.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/1_4/reference/protocols/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/protocols/lenya.html">lenya:</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/protocols/lenyadoc.html">lenyadoc:</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/protocols/site.html">error:site:</a>
</div>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/link-management.html">Link Management</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="../../../docs/1_4/reference/repository/index.html">Repository</a>
</div>
</div>
<div class="menuitem">
<a href="../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2">
<a href="http://apachecon.com/"><img border="0" title="ApacheCon EU 2006" alt="ApacheCon EU 2006 - logo" src="http://www.eu.apachecon.com/konferenzen/apachecon06/images/header-left.gif" style="width: 150px;height: 50px;"></a>
</div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="resource-types.pdf"><img alt="PDF -icon" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Resource Types</h1>
	  

<a name="N1000D"></a><a name="Introduction"></a>
<h2 class="h3">Introduction</h2>
<div class="section">
<p>
	A resource type defines a certain XML source format, together with processing options.
	It typically consists of
	</p>
<ul>
	  
<li>an XML structure definition (e.g., Relax NG)</li>
	  
<li>some presentation pipelines,</li>
	  
<li>some presentation XSLT stylesheets,</li>
	  
<li>usecases to manipulate documents.</li>
	
</ul>
<p>
	  All of these can be shared between several resource types.
	</p>
<p>
	  The information describing a resource type is managed by a
	  <a href="http://lenya.apache.org/apidocs/1.4/org/apache/lenya/cms/publication/ResourceType.html"><span class="codefrag">ResourceType</span></a>
	  service. The default implementation is 
	  <a href="http://lenya.apache.org/apidocs/1.4/org/apache/lenya/cms/publication/ResourceTypeImpl.html"><span class="codefrag">ResourceTypeImpl</span></a>.
	  It implements <span class="codefrag">ThreadSafe</span>, which ensures that only a single instance of every resource type is created.
	  It is not possible to declare multiple resource types with the same name. 
	</p>
</div>


<a name="N10039"></a><a name="Choose+a+Unique+Resource+Type+Name"></a>
<h2 class="h3">Choose a Unique Resource Type Name</h2>
<div class="section">
<p>
    You should choose a reasonable name for your resource type.
  </p>
<div class="note">
<div class="label">Note</div>
<div class="content">
    In the examples, we use the name <em>profile</em> (page with information about a person).
  </div>
</div>
</div>
	  

<a name="N10048"></a><a name="Adding+the+Resource+Type+to+a+Publication"></a>
<h2 class="h3">Adding the Resource Type to a Publication</h2>
<div class="section">
<p>
    The resource types used by a publication are declared in <span class="codefrag">publication.xconf</span>,
    including the assignment of a workflow schema to a resource type:
  </p>
<pre class="code">&lt;publication&gt;
  ...
  &lt;resource-type name="xhtml" workflow="workflow.xml"/&gt;
  &lt;resource-type name="homepage" workflow="workflow.xml"/&gt;
  &lt;resource-type name="links" workflow="workflow.xml"/&gt;
  &lt;resource-type name="profile" workflow="workflow.xml"/&gt;
  ...
&lt;/publication&gt;
</pre>
<p>
    You can add references to any resource types configured in
    <span class="codefrag">&lt;lenya-webapp&gt;/WEB-INF/cocoon.xconf</span> (see below),
    containing
  </p>
<ul>
    
<li>resource types provided by modules,</li>
    
<li>resource types of template publications, and</li>
    
<li>resource types of the publication itself.</li>
  
</ul>
<p>
    Adding a custom resource type to your publication includes the following steps:
  </p>
<a name="N1006D"></a><a name="Providing+a+Sample+XML+Document"></a>
<h3 class="h4">Providing a Sample XML Document</h3>
<p>
      If you want to enable users to create new resources belonging to
      your resource type, it is useful to provide a sample XML document.
      If you want to use the <span class="codefrag">DefaultBranchCreator</span> that ships
      with Lenya, you have to add the sample document because it is used
      as a template for creating new resources.
    </p>
<p>
      The sample document is typically placed in
      <span class="codefrag">&lt;publication&gt;/lenya/resources/samples/</span>.
      You can choose an arbitrary filename, but it is recommended to
      use the resource type name (e.g., <span class="codefrag">profile.xml</span>).
    </p>
<a name="N10082"></a><a name="Providing+an+XML+Structure+Definition"></a>
<h3 class="h4">Providing an XML Structure Definition</h3>
<p>
      This step is only needed if you want to edit resources with Lenya
      or validate them after they have been imported or manipulated.
      The type of the structure definition
      (<a href="http://www.w3.org/XML/Schema">XML Schema</a>,
      <a href="http://www.relaxng.org/">Relax NG</a>, ...)
      depends on the editor or validator you want to use. For instance,
      the <a href="http://www.bitfluxeditor.org/">BXE</a> WYSIWYG
      editor requires a Relax NG document.
    </p>
<p>The structure definition document is typically placed in the directory
      <span class="codefrag">&lt;publication&gt;/lenya/resources/schemas/</span>. The name
      of the file is arbitrary, but it is recommended to use the
      resource type name (e.g., <span class="codefrag">profile.rng</span>).
    </p>
<a name="N100A0"></a><a name="Creating+a+Workflow+Schema"></a>
<h3 class="h4">Creating a Workflow Schema</h3>
<p>
      If your resources should have a workflow, you have to add a workflow
      schema for your resource type as described in
      <a href="../../../docs/1_2_x/components/workflow/configuration.html">Workflow Configuration</a>.
      A workflow schema can be shared between multiple resource types.
      The workflow schema is assigned to a resource type in <span class="codefrag">publication.xconf</span>
      (see section <em>Adding Resource Types to a Publication</em>).
    </p>
<a name="N100B3"></a><a name="The+Resource+Type+Definition"></a>
<h3 class="h4">The Resource Type Definition</h3>
<p>
    To declare a custom resource type and assign the creator, schema etc. to it,
	  add the component instance to an XPatch file (e.g.,
	  <span class="codefrag">&lt;publication&gt;/config/cocoon-xconf/resourcetype-profile.xconf</span>):
    </p>
<pre class="code">&lt;xconf xpath="/cocoon/resource-types"
       unless="/cocoon/resource-types/component-instance[@name = 'profile']"&gt;

  &lt;component-instance name="profile"
                      logger="lenya.resourcetypes.profile"
                      class="org.apache.lenya.cms.publication.ResourceTypeImpl"&gt;
    &lt;schema src="fallback://lenya/resources/schemas/profile.rng"
            language="http://relaxng.org/ns/structure/0.9"/&gt;
    &lt;creator src="org.apache.lenya.cms.authoring.DefaultBranchCreator"&gt;
      &lt;sample-name&gt;fallback://lenya/resources/samples/profile.xml&lt;/sample-name&gt;
    &lt;/creator&gt;
    &lt;link-attribute xpath="//*[namespace-uri() = 'http://foo.bar.org/profile']/@href"/&gt;
    &lt;format name="xhtml" uri="cocoon://modules/profile/profile.xml"/&gt;
  &lt;/component-instance&gt;

&lt;/xconf&gt;</pre>
<p>
      This XPatch file will be used when the publication is deployed (e.g., when you issue
      a <span class="codefrag">./build</span> command). Its contents will be patched into
      <span class="codefrag">&lt;lenya-webapp&gt;/WEB-INF/cocoon.xconf</span>.
    </p>
<a name="N100CC"></a><a name="Define+a+Custom+Menubar"></a>
<h3 class="h4">Define a Custom Menubar</h3>
<p>
      If you want to use a custom menubar for your resource type,
      follow the guidelines on the page
      <a href="../../../docs/1_2_x/components/layout/lenya-menubar.html">The Lenya Menubar</a>.
      Typically, a menubar is shared between multiple resource types.
      Small customizations can be achieved with Java code in the menubar XSP.
    </p>
<p>
      To let the user create new resources using the <span class="codefrag">DefaultBranchCreator</span>,
      you have to add the following menu item:
    </p>
<pre class="code">
  &lt;item uc:usecase="site.create" href="?doctype=profile"&gt;&lt;i18n:text&gt;New Profile Document&lt;/i18n:text&gt;&lt;/item&gt;
</pre>
<a name="N100E3"></a><a name="Formats"></a>
<h3 class="h4">Formats</h3>
<p>
      A resource type provides a set of <em>formats</em> to provide different ways of presenting content documents.
      The formats are defined in the resource type declaration:
    </p>
<pre class="code">
  &lt;format name="xhtml" uri="cocoon://modules/profile/profile.xml"/&gt;
</pre>
<p>
      The <span class="codefrag">uri</span> attribute of the <span class="codefrag">format</span> element may refer to an arbitrary URL,
      which is typically a request into the module itself. This URI is matched inside the module
      sitemap (in our case, <span class="codefrag">modules/profile/sitemap.xmap</span>). Typically, an XSLT is applied
      to the content document to transform it into another format (XHTML, XSL-FO, ...):
    </p>
<pre class="code">
  &lt;!-- apply a format --&gt;
  &lt;map:match pattern="*.xml"&gt;
    &lt;map:generate src="lenya://lenya/pubs/{page-envelope:publication-id}/ \
      content/{page-envelope:area}/{page-envelope:document-path}"/&gt;
    &lt;map:transform src="fallback://lenya/modules/profile/xslt/profile2xhtml.xsl"&gt;
      &lt;map:parameter name="rendertype" value="{request-param:rendertype}"/&gt;
      &lt;map:parameter name="nodeid" value="{page-envelope:document-name}"/&gt;
      &lt;map:parameter name="language" value="{page-envelope:document-language}"/&gt;
    &lt;/map:transform&gt;
    &lt;map:serialize type="xml"/&gt;
  &lt;/map:match&gt;
</pre>
<p>
      To request a formatted document, use the <span class="codefrag">format-...</span> attribute of the
      <span class="codefrag">resource-type</span> input module:
    </p>
<pre class="code">
  &lt;!-- aggregate navigation components and XHTML-formatted content --&gt;
  &lt;map:aggregate element="cmsbody"&gt;
    &lt;map:part src="cocoon://modules/sitetree/{2}/{3}/breadcrumb/{5}.xml"/&gt;
    &lt;map:part src="cocoon://modules/sitetree/{2}/{3}/tabs/{5}.xml"/&gt;
    &lt;map:part src="cocoon://modules/sitetree/{2}/{3}/menu/{5}.xml"/&gt;
    &lt;map:part src="cocoon://modules/sitetree/{2}/{3}/search/{5}.xml"/&gt;
    &lt;map:part src="{resource-type:format-xhtml}"/&gt;
  &lt;/map:aggregate&gt;

</pre>
<a name="N10111"></a><a name="Presentation"></a>
<h3 class="h4">Presentation</h3>
<p>
      To make your resources available as HTTP pages, you have to add the
      appropriate pipelines and XSLT stylesheets. In general, there are no
      restrictions.
    </p>
<p>
      If you derive your publication from the default publication,
      the pipelines have to be placed in
      <span class="codefrag">&lt;publication&gt;/doctypes.xmap</span>. The stylesheets are located in
      <span class="codefrag">&lt;publication&gt;/xslt/</span> and are named <span class="codefrag">&lt;resource-type&gt;2xhtml.xsl</span>
      (e.g., <span class="codefrag">profile2xhtml.xsl</span>). The stylesheet is supposed to generate
      a valid XHTML fragment (in the XHTML namespace) with <span class="codefrag">&lt;div id="body"&gt;</span>
      as the document element.
    </p>
</div>

	
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2005 <a href="http://www.apache.org/licenses/LICENSE-2.0">The Apache Software Foundation.</a>
</div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A0docs/1_4/reference/resource-types.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
