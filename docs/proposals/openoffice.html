<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>OpenOffice Documents with Lenya</title>
<link type="text/css" href="../../skin/page.css" rel="stylesheet">
</head>
<body text="#000000" bgcolor="#FFFFFF">
<!--================= start Banner ==================-->
<table summary="header with logos" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<!--================= start Group Logo ==================-->
<td valign="bottom" bgcolor="#FFFFFF">
<div class="headerlogo">
<a href="http://cocoon.apache.org"><img border="0" class="logoImage" alt="Apache Cocoon" src="../../images/cocoon-project-logo-big.png"></a>
</div>
<span class="textheader">Apache Cocoon</span>
<!--================= start Tabs ==================-->
<div class="tab">
<table summary="tab bar" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="10" valign="bottom">
<div class="tab-separator">
<img alt="" width="10" src="../../skin/images/spacer.gif"></div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../project/index.html"><font face="Arial, Helvetica, Sans-serif">Project Information</font></a>
</div>
</div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../installation/index.html"><font face="Arial, Helvetica, Sans-serif">Installation</font></a>
</div>
</div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td style="background-image: url(../../skin/images/tab-left-selected.png)" valign="top" width="5"><img alt="" src="../../skin/images/tab-corner-left-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-selected">
<a href="../index.html"><font color="#000000">Documentation</font></a>
</div>
</td><td style="background-image: url(../../skin/images/tab-right-selected.png)" valign="top" width="5"><img alt="" src="../../skin/images/tab-corner-right-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../community/index.html"><font face="Arial, Helvetica, Sans-serif">Community</font></a>
</div>
</div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<!--================= end Tabs ==================-->
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td width="100%" valign="bottom" align="right" bgcolor="#FFFFFF">
<div style="padding: 10px" class="headerlogo">
<a href="http://cocoon.apache.org/lenya"><img border="0" class="logoImage" alt="Lenya" src="../../images/apache-lenya-light.png"></a>
</div>
<div class="tab-separator"></div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</table>
<!--================= end Banner ==================-->
<div class="tab-bar">
<img alt="" height="5" src="../../skin/images/spacer.gif"></div>
<!--================= start Menu, NavBar, Content ==================-->
<table summary="page content" bgcolor="#ffffff" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table summary="menu" border="0" cellspacing="0" cellpadding="0">
<tr>
<!--================= start left top NavBar ==================-->
<!--================= end left top NavBar ==================-->
<td valign="top">
<div class="tab-subbar">
<img width="10" height="5" alt="" src="../../skin/images/spacer.gif"></div>
</td><td valign="top">
<!--================= start Menu items ==================-->
<div class="menu">
<div class="menutitle"></div>
<div class="menuitemgroup">
<div class="menutitle">Proposals / Requests for Comment (RFC)</div>
<div class="menuitemgroup">
<div class="menuitem">
<a href="siteTree.html">Site tree</a>
</div>
<div class="menupage">
<div class="menupagetitle">OpenOffice</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Goals">Goals</a>
</div>
<div class="menupageitem">
<a href="#Prerequisites">Prerequisites</a>
</div>
<div class="menupageitem">
<a href="#Pipelines">Pipelines</a>
</div>
<div class="menupageitem">
<a href="#Problems">Problems</a>
</div>
<div class="menupageitem">
<a href="#To+do%27s">To do's</a>
</div>
</div>
</div>
</div>
</div>
</div>
<!--================= end Menu items ==================-->
</td><td valign="top">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<tr>
<td></td><td height="5"><img alt="" width="150" height="1" src="../../skin/images/spacer.gif"></td><td></td>
</tr>
</table>
</td><td valign="top" width="100%">
<table summary="content" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top" colspan="3">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<!--================= start Content==================-->
<tr>
<td align="left" width="10"><img width="10" height="1" alt="" src="../../skin/images/spacer.gif"></td><td align="left" width="100%">
<div class="content">
<table cellspacing="0" cellpadding="0" class="title">
<tr>
<td valign="middle">
<h1>OpenOffice Documents with Lenya</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="openoffice.pdf"><img alt="PDF" src="../../skin/images/pdfdoc.gif" border="0"><br>
          PDF</a></td>
</tr>
</table> 

    
<a name="N101CF"></a><a name="Goals"></a>
<h3>Goals</h3>
<div style="margin-left: 0 ; border: 2px">
<p>This document describes the integration of Openoffice with Lenya
	CMS. The integration is guided by the following goals:</p>
<ul>
	
<li>Use OpenOffice as a content editor for static web
	pages</li>

	
<li>Migrate OpenOffice document to a custom xml format</li>
      
</ul>
</div>

    
<a name="N101E2"></a><a name="Prerequisites"></a>
<h3>Prerequisites</h3>
<div style="margin-left: 0 ; border: 2px">
<p>In order to seamlessly integrate Openoffice into the
publication process of Lenya/Cocoon the following prerequisites need
to be met:</p>
<a name="N101EB"></a><a name="OpenOffice+DTD"></a>
<h4>OpenOffice DTD</h4>
<div style="margin-left: 0 ; border: 2px">
<p>The DTDs for the OpenOffice documents has to be available
on the system.</p>
<p>It's best to get them directly from your OpenOffice
installation. They are located in the share directory of your
installation. Copy the dtd's into your Lenya installation, e.g. as
follows:</p>
<pre class="code">cp ~/Office/share/dtd/* ~/build/jakarta-tomcat-4.1.18-LE-jdk14/webapps/lenya/lenya/resources/dtd/openoffice/</pre>
<div class="frame fixme">
<div class="label">Fixme (
               ce

               )</div>
<div class="content">The DTDs should probably go into
	/usr/share/sgml/openoffice/*</div>
</div>
<div class="frame note">
<div class="label">Note</div>
<div class="content">There's a bug in the xml parser. As a workaround we uncomment
	  all the <span class="codefrag">draw:text-box</span> stuff.</div>
</div>
</div>
<a name="N10207"></a><a name="XML+Catalog"></a>
<h4>XML Catalog</h4>
<div style="margin-left: 0 ; border: 2px">
<p>In order for Lenya/Cocoon to find the DTDs you need to setup an XML
catalog as follows:</p>
<pre class="code">
xmlcatalog --noout --create openoffice.cat
xmlcatalog --noout --add "public" \
  "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" 
  "file:///home/slide/build/jakarta-tomcat-4.1.18-LE-jdk14/webapps/lenya/lenya/resources/dtd/openoffice/officedocument/1_0/office.dtd" \
  openoffice.cat
	</pre>
<p>Alternatively you can simply use the attached catalog.</p>
<p>Store this newly created catalog and edit CatalogManager.properties to
make sure Cocoon finds this catalog and hence the OpenOffice DTDs.</p>
<p>Add the location of the OpenOffice catalog to Cocoon's
CatalogManager.properties (which can be found in
<span class="codefrag">~/build/jakarta-tomcat-4.1.18-LE-jdk14/webapps/lenya/WEB-INF/classes/CatalogManager.properties</span>)
by adding the following lines to this file:</p>
<pre class="code">
#catalogs=/path/to/local/catalog
catalogs=/home/slide/build/jakarta-tomcat-4.1.18-LE-jdk14/webapps/lenya/lenya/resources/dtd/openoffice/catalog.xml
	</pre>
</div>
<a name="N10227"></a><a name="OpenOffice2HTML+XSTL"></a>
<h4>OpenOffice2HTML XSTL</h4>
<div style="margin-left: 0 ; border: 2px">
<p>In order to render the OpenOffice xml as html we need XSLT stylesheets
to provide the necessary transformations.</p>
<p>A very good XSLT which is fairly complete can be fetched
	  from zope.org (<a href="http://www.zope.org/Members/philikon/ZooDocument">http://www.zope.org/Members/philikon/ZooDocument</a>).</p>
</div>
<a name="N10238"></a><a name="Slide"></a>
<h4>Slide</h4>
<div style="margin-left: 0 ; border: 2px">
<p>Slide is an Apache project which offers amongst other things a a
WebDAV access module (implemented as a servlet). This will allow us to
deploy the OpenOffice documents directly via WebDAV.</p>
<p>For a very basic installation the following changes need to be applied
to a file named Domain.xml in the Slide webapp directory:</p>
<ul>
	  
<li>Change permissions</li>
	  
<li>ContentStore: set to parent dir of OpenOffice dir</li>
	  
<li>Replace folder "files" by OpenOffice dir name</li>
	
</ul>
<p>The following patch will apply all changes you need:</p>
<pre class="code">
diff -u Domain.xml.orig Domain.xml
--- Domain.xml.orig	Thu Nov  1 15:47:52 2001
+++ Domain.xml		Thu Mar 20 16:44:09 2003
@@ -44,7 +44,7 @@
           &lt;reference store="nodestore" /&gt;
         &lt;/revisiondescriptorstore&gt;
         &lt;contentstore classname="slidestore.reference.FileContentStore"&gt;
-          &lt;parameter name="rootpath"&gt;contentstore&lt;/parameter&gt;
+          &lt;parameter name="rootpath"&gt;/home/slide/build/jakarta-tomcat-4.1.18-LE-jdk14/webapps/lenya/lenya/pubs/computerworld/content/authoring&lt;/parameter&gt;
           &lt;parameter name="version"&gt;false&lt;/parameter&gt;
           &lt;parameter name="resetBeforeStarting"&gt;true&lt;/parameter&gt;
         &lt;/contentstore&gt;
@@ -136,7 +136,7 @@
       &lt;!-- Paths configuration --&gt;
       &lt;userspath&gt;/users&lt;/userspath&gt;
       &lt;guestpath&gt;guest&lt;/guestpath&gt;
-      &lt;filespath&gt;/files&lt;/filespath&gt;
+      &lt;filespath&gt;/openoffice&lt;/filespath&gt;
       &lt;parameter name="dav"&gt;true&lt;/parameter&gt;
       &lt;parameter name="standalone"&gt;true&lt;/parameter&gt;
 
@@ -245,13 +245,12 @@
           
         &lt;/objectnode&gt;
         
-        &lt;objectnode classname="org.apache.slide.structure.SubjectNode" 
-         uri="/files"&gt;
+        &lt;objectnode classname="org.apache.slide.structure.SubjectNode" uri="/openoffice"&gt;
 
           &lt;!-- ### Give read/write/manage permission to guest ### 
                Uncomment the following line to give permission to do
                all actions on /files to guest (unauthenticated users) --&gt;
-          &lt;!-- &lt;permission action="/actions" subject="/users/guest"/&gt; --&gt;
+          &lt;permission action="/actions" subject="/users/guest"/&gt;
 
           &lt;permission action="/actions/manage" subject="/users/john"/&gt;
           &lt;permission action="/actions/write" subject="+/users/groupA"/&gt;
	</pre>
</div>
</div>

    
<a name="N1025A"></a><a name="Pipelines"></a>
<h3>Pipelines</h3>
<div style="margin-left: 0 ; border: 2px">
<p>In order for Lenya/Cocoon to be able to read the content of the
OpenOffice document, a set of pipelines need to be set up.</p>
<a name="N10263"></a><a name="Read+the+zip%2Fjar+file"></a>
<h4>Read the zip/jar file</h4>
<div style="margin-left: 0 ; border: 2px">
<p>To read the OpenOffice documents we need to setup a simple reader
	  which as follows:</p>
<pre class="code">
&lt;map:match pattern="**.sxw"&gt;
  &lt;map:read src="content/{1}.sxw"/&gt;
&lt;/map:match&gt;
	</pre>
</div>
<a name="N10272"></a><a name="Unpack+zip+file+and+transform+the+OO+xml+to+xhtml"></a>
<h4>Unpack zip file and transform the OO xml to xhtml</h4>
<div style="margin-left: 0 ; border: 2px">
<p>OpenOffice documents are actually a zip file containing xml files for
content and style plus other additional files such as jpg etc.</p>
<p>Zip is the same file format as jar. JDK supports jar unpacking
natively with the jar protocol. The pipeline to read a jar file looks
as follows:</p>
<pre class="code">
&lt;map:match pattern="**.oo"&gt;
  &lt;map:generate src="jar:http://localhost:38080/lenya/computerworld/authoring/{1}.sxw!/content.xml"/&gt;
  &lt;map:transform src="../../xslt/openoffice/ooo2html.xsl"/&gt;
  &lt;map:serialize/&gt;
&lt;/map:match&gt;
	</pre>
</div>
<a name="N10284"></a><a name="Aggregate+with+navigation"></a>
<h4>Aggregate with navigation</h4>
<div style="margin-left: 0 ; border: 2px">
<p>Additionaly we want to embed the OpenOffice document in the usual
navigation, header and footer. The following is fairly specific to the
Computerworld publication but can easily be adapted:</p>
<pre class="code">
&lt;map:match pattern="**.html"&gt;
  &lt;map:aggregate element="lenya"&gt;
    &lt;map:part src="cocoon:/menus/static/{1}.html"/&gt;
    &lt;map:part element="cmsbody" src="content/authoring/wrapper.html"/&gt;
    &lt;map:part src="cocoon:/{1}.oo" element="wrapper"/&gt;
    &lt;map:part src="content/authoring/small-preview.xml"/&gt;
    &lt;map:part src="content/authoring/sitetree.xml"/&gt;
    &lt;map:part src="cocoon:/today"/&gt;
  &lt;/map:aggregate&gt;

  &lt;map:transform src="xslt/authoring/wrapper.xsl"&gt;
    &lt;map:parameter name="id" value="/{1}"/&gt;
    &lt;map:parameter name="authoring" value="true"/&gt;
  &lt;/map:transform&gt;
  &lt;map:transform src="xslt/authoring/images.xsl"/&gt;
  &lt;map:serialize type="html"/&gt;
&lt;/map:match&gt;
	</pre>
</div>
</div>

    
<a name="N10294"></a><a name="Problems"></a>
<h3>Problems</h3>
<div style="margin-left: 0 ; border: 2px">
<ul>
	
<li>Caching prevents an update OO file (zip file) from being
	displayed.</li>

	
<li>If you restart tomcat (slide) you lose the NodeContentStore so that
  WebDAV loses the nodes (documents and folders).</li>

	
<li>xml parser cannot handle openoffice dtd's due to a parser bug</li>
      
</ul>
</div>

    
<a name="N102A7"></a><a name="To+do%27s"></a>
<h3>To do's</h3>
<div style="margin-left: 0 ; border: 2px">
<ul>
	
<li>Set permissions in tomcat/slide: authorization and autorisation</li>
	
<li>Complete and improve OpenOffice2Html xslt (images, tables, etc.)</li>
	
<li> Add pipelines for other files in zip like images</li>
	
<li> Integration slide and lenya</li>
      
</ul>
</div>
    
  
</div>
</td><td width="10"><img width="10" height="1" alt="" src="../../skin/images/spacer.gif"></td>
</tr>
<!--================= end Content==================-->
</table>
</td>
</tr>
<tr>
<td>
<br>
<br>
</td>
</tr>
</table>
<!--================= end Menu, NavBar, Content ==================-->
<!--================= start Footer ==================-->
<div class="footer">
<table summary="footer" cellspacing="0" cellpadding="0" width="100%" border="0">
<tr>
<td colspan="2" height="1"><img height="1" width="1" alt="" src="../../skin/images/spacer.gif"><a href="../../skin/images/label.gif"></a><a href="../../skin/images/page.gif"></a><a href="../../skin/images/chapter.gif"></a><a href="../../skin/images/chapter_open.gif"></a><a href="../../skin/images/current.gif"></a></td>
</tr>
<tr>
<td colspan="2" class="copyright" align="center" width="90%"><span class="footnote">Copyright &copy;
                2002-2003&nbsp;The Apache Software Foundation. All rights reserved.
                <br>
<script type="text/javascript" language="JavaScript"><!--
                  document.write(" - "+"Last Published: " + document.lastModified);
                  //  --></script></span></td><td nowrap="nowrap" align="right" class="logos"><a href="http://validator.w3.org/check/referer"><img width="88" height="31" alt="Valid HTML 4.01!" src="../../skin/images/valid-html401.png" class="logoImage" border="0"></a><a href="http://jigsaw.w3.org/css-validator/"><img width="88" height="31" alt="Valid CSS!" src="../../skin/images/vcss.png" class="logoImage" border="0"></a></td>
</tr>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
