<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Link Management</title>
<link type="text/css" href="../../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../../skin/profile.css" rel="stylesheet">
<script src="../../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a><script src="../../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://lenya.apache.org"><img class="logoImage" alt="Lenya" src="../../../../images/apache-lenya-light.png" title="
  	Apache Lenya is a Java-based Open-Source Content Management System.
  	It is based on open standards such as XML and XSLT.
  	One of its core components is Cocoon from the Apache Software Foundation.
  "></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with :');" value="Search the site with :" size="25" name="q" id="query" type="text">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../../../index.html">Project</a>
</li>
<li>
<a class="base-not-selected" href="../../../../installation/index.html">Installation</a>
</li>
<li class="current">
<a class="base-selected" href="../../../../docs/index.html">Documentation</a>
</li>
<li>
<a class="base-not-selected" href="../../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../../skin/images/chapter_open.gif');">Documentation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a title="" href="../../../../docs/index.html">Documentation</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docu.pdf">pdf docu 1.2.x (whole)</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docu.html">html docu 1.2.x (whole)</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4', '../../../../skin/')" id="menu_selected_1.1.4Title" class="menutitle" style="background-image: url('../../../../skin/images/chapter_open.gif');">1.2.x</div>
<div id="menu_selected_1.1.4" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_selected_1.1.4.1', '../../../../skin/')" id="menu_selected_1.1.4.1Title" class="menutitle" style="background-image: url('../../../../skin/images/chapter_open.gif');">Components</div>
<div id="menu_selected_1.1.4.1" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_1.1.4.1.1', '../../../../skin/')" id="menu_1.1.4.1.1Title" class="menutitle">Access&nbsp;Control</div>
<div id="menu_1.1.4.1.1" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/terms.html">Basic Terms</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/accesscontrollers.html">Access&nbsp;Controllers</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/accesscontrollerresolvers.html">Access Controller Resolvers</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/authenticators.html">Authenticators</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/authorizers.html">Authorizers</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/policymanagers.html">Policies and Policy&nbsp;Managers</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/accreditablemanagers.html">Accreditable&nbsp;Managers</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/accesscontrol/ssl.html">SSL Encryption</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.2', '../../../../skin/')" id="menu_1.1.4.1.2Title" class="menutitle">Deployment</div>
<div id="menu_1.1.4.1.2" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/deployment/mod_proxy.html">mod_proxy</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.3', '../../../../skin/')" id="menu_1.1.4.1.3Title" class="menutitle">Editors</div>
<div id="menu_1.1.4.1.3" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/editors/htmlform.html">HTML Form Editor</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/editors/1form.html">HTML One Form Editor</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/editors/bxe.html">Bitflux Editor</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/editors/kupu.html">Kupu</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/editors/xopus.html">Xopus</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.4', '../../../../skin/')" id="menu_1.1.4.1.4Title" class="menutitle">Layout</div>
<div id="menu_1.1.4.1.4" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/layout/navigation.html">Navigation</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/layout/xhtml-templating.html">XHTML templating</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/layout/static-resources.html">Serving static resources</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/layout/lenya-menubar.html">Lenya Menubar</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.5', '../../../../skin/')" id="menu_1.1.4.1.5Title" class="menutitle">Publication</div>
<div id="menu_1.1.4.1.5" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/publication/pageenvelopemodule.html">PageEnvelopeModule</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/publication/siteTree.html">Site tree</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.6', '../../../../skin/')" id="menu_1.1.4.1.6Title" class="menutitle">Revision Control</div>
<div id="menu_1.1.4.1.6" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/revisioncontroller.html">Revision Controller</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/rcml.html">RCML</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/checkin.html">Check In</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/checkout.html">Check Out</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/version.html">Revisions</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/revisioncontrol/rollback.html">Rollback</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.7', '../../../../skin/')" id="menu_1.1.4.1.7Title" class="menutitle">Repository</div>
<div id="menu_1.1.4.1.7" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/repository/webdav.html">WebDAV Servers</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.8', '../../../../skin/')" id="menu_1.1.4.1.8Title" class="menutitle">Search</div>
<div id="menu_1.1.4.1.8" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/search/lucene.html">Searching with Lucene</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.9', '../../../../skin/')" id="menu_1.1.4.1.9Title" class="menutitle">URI Handling</div>
<div id="menu_1.1.4.1.9" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/uri-handling/URIParametrizer.html">URI Parametrizer</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/uri-handling/standardURI.html">URI Scheme</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/uri-handling/usecases.html">Usecases</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.10', '../../../../skin/')" id="menu_1.1.4.1.10Title" class="menutitle">Asset Management</div>
<div id="menu_1.1.4.1.10" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/asset-management/management.html">Asset Management</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4.1.11', '../../../../skin/')" id="menu_selected_1.1.4.1.11Title" class="menutitle" style="background-image: url('../../../../skin/images/chapter_open.gif');">Link Management</div>
<div id="menu_selected_1.1.4.1.11" class="selectedmenuitemgroup" style="display: block;">
<div class="menupage">
<div class="menupagetitle">Link Management</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.12', '../../../../skin/')" id="menu_1.1.4.1.12Title" class="menutitle">Meta Data</div>
<div id="menu_1.1.4.1.12" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/metadata/metadata.html">Meta Data Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.13', '../../../../skin/')" id="menu_1.1.4.1.13Title" class="menutitle">Multilingual Documents</div>
<div id="menu_1.1.4.1.13" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/multilingual/multilingual.html">Multilingual Document Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.14', '../../../../skin/')" id="menu_1.1.4.1.14Title" class="menutitle">Tasks</div>
<div id="menu_1.1.4.1.14" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/concept.html">The Task Concept</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/defining.html">Defining Tasks</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/taskaction.html">The TaskAction</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/scheduling.html">Scheduling a Task</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.14.5', '../../../../skin/')" id="menu_1.1.4.1.14.5Title" class="menutitle">Included tasks</div>
<div id="menu_1.1.4.1.14.5" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/anttask.html">AntTask</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/publisher.html">DefaultFilePublisher</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/exporter.html">StaticHTMLExporter</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/mailtask.html">MailTask</a>
</div>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/tasks/development.html">Developing Tasks</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.15', '../../../../skin/')" id="menu_1.1.4.1.15Title" class="menutitle">Workflow</div>
<div id="menu_1.1.4.1.15" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/workflow/terms.html">Terms</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/workflow/state-machine.html">The State Machine</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/workflow/configuration.html">Configuration</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/workflow/implementation.html">Implementation</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.16', '../../../../skin/')" id="menu_1.1.4.1.16Title" class="menutitle">Site Management</div>
<div id="menu_1.1.4.1.16" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/archive.html">Archive</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/copy.html">Copy</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/deactivate.html">Deactivate</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/delete.html">Delete</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/deletetrash.html">Delete the trash</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/move.html">Move</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/moveupdown.html">Move Up/Down</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/rename.html">Rename</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/components/sitemanagement/restore.html">Restore</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.2', '../../../../skin/')" id="menu_1.1.4.2Title" class="menutitle">Specifications</div>
<div id="menu_1.1.4.2" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/specs/namespaces.html">Namespaces</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.3', '../../../../skin/')" id="menu_1.1.4.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.1.4.3" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/misc/coding-guidelines.html">Coding Guidelines</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/misc/unittests.html">Unit Tests</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.2.x/misc/xinclude-processor.html">XInclude Processor</a>
</div>
</div>
<div class="menuitem">
<a title="" href="../../../../apidocs/index.html">API (Javadoc)</a>
</div>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/1.4/index.html">1.4</a>
</div>
<div class="menuitem">
<a title="" href="../../../../docs/2.1/index.html">2</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div id="skinconf-txtlink"></div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="link-management.pdf"><img alt="PDF -icon" src="../../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Link Management</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introduction">Introduction</a>
<ul class="minitoc">
<li>
<a href="#A+document+is+not+yet+live">A document is not yet live</a>
</li>
<li>
<a href="#A+document+is+withdrawn+from+live">A document is withdrawn from live</a>
</li>
<li>
<a href="#A+document-id+changes">A document-id changes</a>
</li>
<li>
<a href="#Rewrite+internal+links+in+live">Rewrite internal links in live</a>
</li>
</ul>
</li>
<li>
<a href="#Implementation">Implementation</a>
<ul class="minitoc">
<li>
<a href="#A+document+is+not+yet+live-N10074">A document is not yet live</a>
</li>
<li>
<a href="#A+document+is+withdrawn+from+live-N1008D">A document is withdrawn from live</a>
</li>
<li>
<a href="#A+document-id+changes-N100A6">A document-id changes</a>
</li>
<li>
<a href="#Rewrite+internal+links+in+live-N100B6">Rewrite internal links in live</a>
</li>
</ul>
</li>
<li>
<a href="#Involved+classes%2C+XSPs+and+XSLTs">Involved classes, XSPs and XSLTs</a>
</li>
</ul>
</div>
    
    
<a name="N10019"></a><a name="Introduction"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>Link Managements deals with internal links, i.e. documents
      that refer to other documents within the same publication. These
      links might have to be changed.</p>
<ol>
	
<li>if a document not yet live,</li>
	
<li>if it is withdrawn from live or </li>
	
<li>if its document-id has changed because it is moved to a
        different location within the site tree.</li>
	
<li>references in authoring have to link to documents in
	<span class="codefrag">authoring</span>, however once they are published they
	need to refer to documents in <span class="codefrag">live</span>
</li>
      
</ol>
<p>These four cases have to be dealt with seperately.</p>
<a name="N10039"></a><a name="A+document+is+not+yet+live"></a>
<h3 class="underlined_5">A document is not yet live</h3>
<p>This case can happen if the user tries to publish a
	document which has a reference to another document which has
	not been published yet. The reference will be stale as the
	refered document is not in the live area yet. A warning will
	be issued during the publishing process.</p>
<a name="N10043"></a><a name="A+document+is+withdrawn+from+live"></a>
<h3 class="underlined_5">A document is withdrawn from live</h3>
<p>If a document which is has references to it is withdrawn
	from the live area the references will be stale, as the
	refered document is no longer available in the live area. A
	warning will be issued during the deactivation process.</p>
<a name="N1004D"></a><a name="A+document-id+changes"></a>
<h3 class="underlined_5">A document-id changes</h3>
<p>If a document is moved within the site tree such that it
	changes its document-id (e.g. cut a document and paste it
	somewhere else in the hierarchy in the site area) then all
	references to this document have to be changed. This is done
	transparently in the course of the paste.</p>
<a name="N10057"></a><a name="Rewrite+internal+links+in+live"></a>
<h3 class="underlined_5">Rewrite internal links in live</h3>
<p>Internal links refer to documents in authoring as long as
	they are not published. However as soon as they are published,
	i.e. reside in the live area their references have to go to
	documents in the live area. A transformer takes care of
	rewriting the internal links.</p>
</div>

    
<a name="N10062"></a><a name="Implementation"></a>
<h2 class="underlined_10">Implementation</h2>
<div class="section">
<p>The implementation is pretty
      straight-forward and is mostly handled in XSPs and associated
      helper classes. The heavy lifting us done is the class
      <span class="codefrag">Grep</span> and the helper class
      <span class="codefrag">DocumentReferencesHelper</span>. The <span class="codefrag">Grep</span>
      class can traverse the repository and find references to the
      current document or can also find references from the current
      document to other documents. A transformer
      (SimpleLinkRewritingTransformer) is used to rewrite the internal
      links in the live area.</p>
<a name="N10074"></a><a name="A+document+is+not+yet+live-N10074"></a>
<h3 class="underlined_5">A document is not yet live</h3>
<p>This is implemented as an extension to the publish xsp. It
	  queries the <span class="codefrag">DocumentReferencesHelper</span> (using the
	  <span class="codefrag">getInternalReferences</span> method) to ask if there
	  are references from the current document to other documents
	  which have not been published yet. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#findPattern</span> method to search the current
	  document for patterns of a reference. The pattern is defined
	  in <span class="codefrag">DocumentReferencesHelper#getInternalLinkPattern</span>.</p>
<a name="N1008D"></a><a name="A+document+is+withdrawn+from+live-N1008D"></a>
<h3 class="underlined_5">A document is withdrawn from live</h3>
<p>This is implemented as an extension to the deactivate
	  xsp. It queries the <span class="codefrag">DocumentReferencesHelper</span>
	  (using the <span class="codefrag">getReferences</span> method) to ask if any
	  other documents refer to the current document. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#find</span> method to search the repository for
	  documents which contain a patterns of a reference. The
	  pattern is defined in
	  <span class="codefrag">DocumentReferencesHelper#getReferencesSearchString()</span>.</p>
<a name="N100A6"></a><a name="A+document-id+changes-N100A6"></a>
<h3 class="underlined_5">A document-id changes</h3>
<p>This is implemented with an ant task
	  (<span class="codefrag">org.apache.lenya.cms.ant.LinkRewriteTask</span>)
	  which traverses the repository and pipes all documents
	  through an XSLT stylesheet
	  (<span class="codefrag">src/webapp/lenya/xslt/util/linkRewrite.xsl</span>) to
	  modify all references to the document that changed its
	  document-id.
	</p>
<a name="N100B6"></a><a name="Rewrite+internal+links+in+live-N100B6"></a>
<h3 class="underlined_5">Rewrite internal links in live</h3>
<p>The
	  <span class="codefrag">org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</span>
	  transformer takes care of rewriting internal links to ensure
	  they refer to the appropriate area.
	</p>
</div>

    
<a name="N100C4"></a><a name="Involved+classes%2C+XSPs+and+XSLTs"></a>
<h2 class="underlined_10">Involved classes, XSPs and XSLTs</h2>
<div class="section">
<p>The following classes, XSPs and XSLTs are involved in link
      management:</p>
<dl>
	
<dt>org.apache.lenya.cms.publication.xsp.DocumentReferencesHelper</dt>
	
<dd>A helper class for the publish and deactivate
	xsps. Defines the regular expressions for internal links. Has
	methods to deteremine all references from the current document
	to other documents (<span class="codefrag">getInternalReferences</span>) and to
	determine all references from other documents to the current
	document (<span class="codefrag">getReferences</span>).</dd>
	
<dt>org.apache.lenya.search.Grep</dt>
	
<dd>User by <span class="codefrag">DocumentReferencesHelper</span> to search
	for patterns in a file or in a directory tree.</dd> 
	
<dt>org.apache.lenya.cms.ant.LinkRewriteTask</dt>
	
<dd>An ant task that upon change of a document-id pipes all
	documents of the repository through a XSLT stylesheet which
	rewrites internal links that were refering to the old
	document-id to refere to the new one.</dd> 
	
<dt>org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</dt>
	
<dd>A transformer that rewrites internal links for the
	appropriate area.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">move-and-rewrite</span> target which
	handles the link rewriting in the case of a paste, i.e. when a
	document-id has changed.</dd>  
	
<dt>src/webapp/lenya/xslt/util/linkRewrite.xsl</dt>
	
<dd>The XSLT transformation used by
	<span class="codefrag">LinkRewriteTask</span> to actually rewrite the internal links.</dd>
	
<dt>src/webapp/lenya/content/publishing/screen.xsp, src/webapp/lenya/xslt/publishing/publish-screen.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case the current document contains references to
	documents which have not been published yet.</dd>
	
<dt>src/webapp/lenya/content/info/deactivate.xsp, src/webapp/lenya/xslt/info/deactivate.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case there are links to the current document
	which is about to be deactivated.</dd>
      
</dl>
</div>
  
<p align="right">
<font size="-2">by&nbsp;Lenya community</font>
</p>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
 Copyright &copy; 2002-2004 The Apache Software Foundation.</div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A0docs/1.2.x/components/link-management/link-management.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
