<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Link Management</title>
<link type="text/css" href="../../../skin/page.css" rel="stylesheet">
<link type="text/css" href="../../../skin/forrest.css" rel="stylesheet">
<link rel="shortcut icon" href="../../../">
<script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script><script src="../../../skin/menu.js" language="javascript" type="text/javascript"></script>
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="header">
<tr>
<td>
<div class="headerlogo">
<a href="http://cocoon.apache.org"><img class="logoImage" alt="Apache Cocoon" src="../../../images/cocoon-project-logo-big.png"></a>
</div>
</td><td valign="bottom" colspan="3" align="right">
<div class="headerlogo right">
<a href="http://cocoon.apache.org/lenya"><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png"></a>
</div>
</td>
</tr>
<tr>
<td class="tabstrip" colspan="4">
<table border="0" cellpadding="0" cellspacing="0" class="tab">
<tr>
<td class="tab pre-separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="../../../index.html">Project</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td><td class="tab separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="../../../installation/index.html">Installation</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td><td class="tab separator"></td><td class="tab selected top-left TSTL"></td><td class="tab selected"><a class="base-selected" href="../../../docs/index.html">Documentation</a></td><td class="tab selected top-right TSTR"></td><td class="tab separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="../../../community/index.html">Community</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="level2tabstrip" colspan="2"></td><td class="datenote level2tabstrip" colspan="2">
<div class="published">
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
</td>
</tr>
</table>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table class="menuarea" cellspacing="0" cellpadding="0">
<tr>
<td width="6px" valign="top">
<table border="0" cellpadding="0" cellspacing="0" class="leftpagemargin">
<tr>
<td class="subborder trail">&nbsp;</td>
</tr>
</table>
</td><td class="dialog">
<div class="menu">
<div onclick="SwitchMenu('menu_selected_1.1')" id="menu_selected_1.1Title" class="menutitle">Documentation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup">
<div class="menuitem">
<a href="../../../docs/index.html">Documentation</a>
</div>
<div class="menuitem">
<a href="../../../docu.pdf">pdf docu (whole)</a>
</div>
<div class="menuitem">
<a href="../../../docu.html">html docu (whole)</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4')" id="menu_selected_1.1.4Title" class="menutitle">Integrator/Dev Guide</div>
<div id="menu_selected_1.1.4" class="selectedmenuitemgroup">
<div onclick="SwitchMenu('menu_selected_1.1.4.1')" id="menu_selected_1.1.4.1Title" class="menutitle">Components</div>
<div id="menu_selected_1.1.4.1" class="selectedmenuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/index.html">Components</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.2')" id="menu_1.1.4.1.2Title" class="menutitle">Access&nbsp;Control</div>
<div id="menu_1.1.4.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/terms.html">Basic Terms</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/accesscontrollers.html">Access&nbsp;Controllers</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/accesscontrollerresolvers.html">Access Controller Resolvers</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/authenticators.html">Authenticators</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/authorizers.html">Authorizers</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/policymanagers.html">Policies and Policy&nbsp;Managers</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/accreditablemanagers.html">Accreditable&nbsp;Managers</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/ssl.html">SSL Encryption</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/accesscontrol/faq.html">FAQ</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.3')" id="menu_1.1.4.1.3Title" class="menutitle">Deployment</div>
<div id="menu_1.1.4.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/deployment/mod_proxy.html">mod_proxy</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.4')" id="menu_1.1.4.1.4Title" class="menutitle">Editors</div>
<div id="menu_1.1.4.1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/editors/htmlform.html">HTML Form Editor</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/editors/1form.html">HTML One Form Editor</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/editors/bxeng.html">Bitflux Editor</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/editors/kupu.html">Kupu</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/editors/xopus.html">Xopus</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.5')" id="menu_1.1.4.1.5Title" class="menutitle">Layout</div>
<div id="menu_1.1.4.1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/layout/navigation.html">Navigation</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/layout/xhtml-templating.html">XHTML templating</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/layout/static-resources.html">Serving static resources</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/layout/lenya-menubar.html">Lenya Menubar</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.6')" id="menu_1.1.4.1.6Title" class="menutitle">Publication</div>
<div id="menu_1.1.4.1.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/publication/pageenvelopemodule.html">PageEnvelopeModule</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/publication/siteTree.html">Site tree</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.7')" id="menu_1.1.4.1.7Title" class="menutitle">Revision Control</div>
<div id="menu_1.1.4.1.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/revisioncontroller.html">Revision Controller</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/rcml.html">RCML</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/checkin.html">Check In</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/checkout.html">Check Out</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/version.html">Revisions</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/revisioncontrol/rollback.html">Rollback</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.8')" id="menu_1.1.4.1.8Title" class="menutitle">Repository</div>
<div id="menu_1.1.4.1.8" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/repository/webdav.html">WebDAV Servers</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.9')" id="menu_1.1.4.1.9Title" class="menutitle">Search</div>
<div id="menu_1.1.4.1.9" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/search/lucene.html">Searching with Lucene</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.10')" id="menu_1.1.4.1.10Title" class="menutitle">URI Handling</div>
<div id="menu_1.1.4.1.10" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/uri-handling/URIParametrizer.html">URI Parametrizer</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/uri-handling/standardURI.html">URI Scheme</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/uri-handling/usecases.html">Usecases</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.11')" id="menu_1.1.4.1.11Title" class="menutitle">Asset Management</div>
<div id="menu_1.1.4.1.11" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/asset-management/management.html">Asset Management</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4.1.12')" id="menu_selected_1.1.4.1.12Title" class="menutitle">Link Management</div>
<div id="menu_selected_1.1.4.1.12" class="selectedmenuitemgroup">
<div class="menupage">
<div class="menupagetitle">Link Management</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.13')" id="menu_1.1.4.1.13Title" class="menutitle">Meta Data</div>
<div id="menu_1.1.4.1.13" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/metadata/metadata.html">Meta Data Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.14')" id="menu_1.1.4.1.14Title" class="menutitle">Multilingual Documents</div>
<div id="menu_1.1.4.1.14" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/multilingual/multilingual.html">Multilingual Document Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.15')" id="menu_1.1.4.1.15Title" class="menutitle">Tasks</div>
<div id="menu_1.1.4.1.15" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/tasks/concept.html">The Task Concept</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/defining.html">Defining Tasks</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/taskaction.html">The TaskAction</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/scheduling.html">Scheduling a Task</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.15.5')" id="menu_1.1.4.1.15.5Title" class="menutitle">Included tasks</div>
<div id="menu_1.1.4.1.15.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/tasks/anttask.html">AntTask</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/publisher.html">DefaultFilePublisher</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/exporter.html">StaticHTMLExporter</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/mailtask.html">MailTask</a>
</div>
</div>
<div class="menuitem">
<a href="../../../docs/components/tasks/development.html">Developing Tasks</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.16')" id="menu_1.1.4.1.16Title" class="menutitle">Workflow</div>
<div id="menu_1.1.4.1.16" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/workflow/terms.html">Terms</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/workflow/state-machine.html">The State Machine</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/workflow/configuration.html">Configuration</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/workflow/implementation.html">Implementation</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.17')" id="menu_1.1.4.1.17Title" class="menutitle">Site Management</div>
<div id="menu_1.1.4.1.17" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/archive.html">Archive</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/copy.html">Copy</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/deactivate.html">Deactivate</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/delete.html">Delete</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/deletetrash.html">Delete the trash</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/move.html">Move</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/moveupdown.html">Move Up/Down</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/rename.html">Rename</a>
</div>
<div class="menuitem">
<a href="../../../docs/components/sitemanagement/restore.html">Restore</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.2')" id="menu_1.1.4.2Title" class="menutitle">Specifications</div>
<div id="menu_1.1.4.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/specs/namespaces.html">Namespaces</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.3')" id="menu_1.1.4.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.1.4.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../docs/misc/coding-guidelines.html">Coding Guidelines</a>
</div>
<div class="menuitem">
<a href="../../../docs/misc/unittests.html">Unit Tests</a>
</div>
<div class="menuitem">
<a href="../../../docs/misc/xinclude-processor.html">XInclude Processor</a>
</div>
</div>
<div class="menuitem">
<a href="../../../apidocs/index.html">API (Javadoc)</a>
</div>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td></td><td>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="border bottom-left"></td><td class="border bottomborder"></td><td class="border bottom-right"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="2" height="10"></td>
</tr>
</table>
</td><td width="100%" valign="top">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="subborder trail">
	         &nbsp;<a href="http://www.apache.org/">apache</a> &gt; <a href="http://cocoon.apache.org/">cocoon</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>&nbsp;
          </td><td nowrap="true" align="right" class="subborder trail"></td>
</tr>
<tr>
<td colspan="2" align="left">
<div class="content">
<table class="title">
<tr>
<td valign="middle">
<h1>Link Management</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="link-management.pdf"><img alt="PDF" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a></td>
</tr>
</table>
<ul class="minitoc">
<li>
<a href="#Introduction">Introduction</a>
<ul class="minitoc">
<li>
<a href="#A+document+is+not+yet+live">A document is not yet live</a>
</li>
<li>
<a href="#A+document+is+withdrawn+from+live">A document is withdrawn from live</a>
</li>
<li>
<a href="#A+document-id+changes">A document-id changes</a>
</li>
<li>
<a href="#Rewrite+internal+links+in+live">Rewrite internal links in live</a>
</li>
</ul>
</li>
<li>
<a href="#Implementation">Implementation</a>
<ul class="minitoc">
<li>
<a href="#A+document+is+not+yet+live-N10074">A document is not yet live</a>
</li>
<li>
<a href="#A+document+is+withdrawn+from+live-N1008D">A document is withdrawn from live</a>
</li>
<li>
<a href="#A+document-id+changes-N100A6">A document-id changes</a>
</li>
<li>
<a href="#Rewrite+internal+links+in+live-N100B6">Rewrite internal links in live</a>
</li>
</ul>
</li>
<li>
<a href="#Involved+classes%2C+XSPs+and+XSLTs">Involved classes, XSPs and XSLTs</a>
</li>
</ul>
    
    
<a name="N10019"></a><a name="Introduction"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h3">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h3>Introduction</h3>
</td><td></td>
</tr>
<tr class="heading ">
<td class="bottom-left"></td><td class="bottomborder"></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<div class="section">
      

      
<p>Link Managements deals with internal links, i.e. documents
      that refer to other documents within the same publication. These
      links might have to be changed.</p>
      
<ol>
	
<li>if a document not yet live,</li>
	
<li>if it is withdrawn from live or </li>
	
<li>if its document-id has changed because it is moved to a
        different location within the site tree.</li>
	
<li>references in authoring have to link to documents in
	<span class="codefrag">authoring</span>, however once they are published they
	need to refer to documents in <span class="codefrag">live</span>
</li>
      
</ol>

      
<p>These four cases have to be dealt with seperately.</p>
      
<a name="N10039"></a><a name="A+document+is+not+yet+live"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document is not yet live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>This case can happen if the user tries to publish a
	document which has a reference to another document which has
	not been published yet. The reference will be stale as the
	refered document is not in the live area yet. A warning will
	be issued during the publishing process.</p>

      
<a name="N10043"></a><a name="A+document+is+withdrawn+from+live"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document is withdrawn from live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>If a document which is has references to it is withdrawn
	from the live area the references will be stale, as the
	refered document is no longer available in the live area. A
	warning will be issued during the deactivation process.</p>

      
<a name="N1004D"></a><a name="A+document-id+changes"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document-id changes</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>If a document is moved within the site tree such that it
	changes its document-id (e.g. cut a document and paste it
	somewhere else in the hierarchy in the site area) then all
	references to this document have to be changed. This is done
	transparently in the course of the paste.</p>

      
<a name="N10057"></a><a name="Rewrite+internal+links+in+live"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>Rewrite internal links in live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>Internal links refer to documents in authoring as long as
	they are not published. However as soon as they are published,
	i.e. reside in the live area their references have to go to
	documents in the live area. A transformer takes care of
	rewriting the internal links.</p>
    
</div>

    
<a name="N10062"></a><a name="Implementation"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h3">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h3>Implementation</h3>
</td><td></td>
</tr>
<tr class="heading ">
<td class="bottom-left"></td><td class="bottomborder"></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<div class="section">
       
<p>The implementation is pretty
      straight-forward and is mostly handled in XSPs and associated
      helper classes. The heavy lifting us done is the class
      <span class="codefrag">Grep</span> and the helper class
      <span class="codefrag">DocumentReferencesHelper</span>. The <span class="codefrag">Grep</span>
      class can traverse the repository and find references to the
      current document or can also find references from the current
      document to other documents. A transformer
      (SimpleLinkRewritingTransformer) is used to rewrite the internal
      links in the live area.</p>

      
<a name="N10074"></a><a name="A+document+is+not+yet+live-N10074"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document is not yet live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>This is implemented as an extension to the publish xsp. It
	  queries the <span class="codefrag">DocumentReferencesHelper</span> (using the
	  <span class="codefrag">getInternalReferences</span> method) to ask if there
	  are references from the current document to other documents
	  which have not been published yet. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#findPattern</span> method to search the current
	  document for patterns of a reference. The pattern is defined
	  in <span class="codefrag">DocumentReferencesHelper#getInternalLinkPattern</span>.</p>

      
<a name="N1008D"></a><a name="A+document+is+withdrawn+from+live-N1008D"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document is withdrawn from live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>This is implemented as an extension to the deactivate
	  xsp. It queries the <span class="codefrag">DocumentReferencesHelper</span>
	  (using the <span class="codefrag">getReferences</span> method) to ask if any
	  other documents refer to the current document. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#find</span> method to search the repository for
	  documents which contain a patterns of a reference. The
	  pattern is defined in
	  <span class="codefrag">DocumentReferencesHelper#getReferencesSearchString()</span>.</p>

      
<a name="N100A6"></a><a name="A+document-id+changes-N100A6"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>A document-id changes</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>This is implemented with an ant task
	  (<span class="codefrag">org.apache.lenya.cms.ant.LinkRewriteTask</span>)
	  which traverses the repository and pipes all documents
	  through an XSLT stylesheet
	  (<span class="codefrag">src/webapp/lenya/xslt/util/linkRewrite.xsl</span>) to
	  modify all references to the document that changed its
	  document-id.
	</p>

      
<a name="N100B6"></a><a name="Rewrite+internal+links+in+live-N100B6"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>Rewrite internal links in live</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>The
	  <span class="codefrag">org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</span>
	  transformer takes care of rewriting internal links to ensure
	  they refer to the appropriate area.
	</p>

    
</div>

    
<a name="N100C4"></a><a name="Involved+classes%2C+XSPs+and+XSLTs"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h3">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h3>Involved classes, XSPs and XSLTs</h3>
</td><td></td>
</tr>
<tr class="heading ">
<td class="bottom-left"></td><td class="bottomborder"></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<div class="section">
      

      
<p>The following classes, XSPs and XSLTs are involved in link
      management:</p>
      
<dl>
	
<dt>org.apache.lenya.cms.publication.xsp.DocumentReferencesHelper</dt>
	
<dd>A helper class for the publish and deactivate
	xsps. Defines the regular expressions for internal links. Has
	methods to deteremine all references from the current document
	to other documents (<span class="codefrag">getInternalReferences</span>) and to
	determine all references from other documents to the current
	document (<span class="codefrag">getReferences</span>).</dd>
	
<dt>org.apache.lenya.search.Grep</dt>
	
<dd>User by <span class="codefrag">DocumentReferencesHelper</span> to search
	for patterns in a file or in a directory tree.</dd> 
	
<dt>org.apache.lenya.cms.ant.LinkRewriteTask</dt>
	
<dd>An ant task that upon change of a document-id pipes all
	documents of the repository through a XSLT stylesheet which
	rewrites internal links that were refering to the old
	document-id to refere to the new one.</dd> 
	
<dt>org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</dt>
	
<dd>A transformer that rewrites internal links for the
	appropriate area.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">move-and-rewrite</span> target which
	handles the link rewriting in the case of a paste, i.e. when a
	document-id has changed.</dd>  
	
<dt>src/webapp/lenya/xslt/util/linkRewrite.xsl</dt>
	
<dd>The XSLT transformation used by
	<span class="codefrag">LinkRewriteTask</span> to actually rewrite the internal links.</dd>
	
<dt>src/webapp/lenya/content/publishing/screen.xsp, src/webapp/lenya/xslt/publishing/publish-screen.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case the current document contains references to
	documents which have not been published yet.</dd>
	
<dt>src/webapp/lenya/content/info/deactivate.xsp, src/webapp/lenya/xslt/info/deactivate.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case there are links to the current document
	which is about to be deactivated.</dd>
      
</dl>
    
</div>
  
<p align="right">
<font size="-2">by&nbsp;Christian Egli</font>
</p>
</div>
</td>
</tr>
</table>
</td>
</tr>
</table>
<table>
<tr>
<td>
<br>
<br>
</td>
</tr>
</table>
<table class="footer">
<tr>
<td colspan="2" align="center" width="90%"><span class="footnote"><a href="http://www.apache.org/licenses/LICENSE-2.0">
                Copyright &copy; 2002-2004&nbsp;
                The Apache Software Foundation.</a>
            All rights reserved.
            <br>
<script type="text/javascript" language="JavaScript"><!--
              document.write(" - "+"Last Published: " + document.lastModified);
              //  --></script></span></td><td nowrap="nowrap" align="right" class="logos"></td>
</tr>
</table>
</body>
</html>
