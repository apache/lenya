<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Workflow Configuration</title>
<link type="text/css" href="../../../skin/page.css" rel="stylesheet">
</head>
<body text="#000000" bgcolor="#FFFFFF">
<!--================= start Banner ==================-->
<table summary="header with logos" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<!--================= start Group Logo ==================-->
<td valign="bottom" bgcolor="#FFFFFF">
<div class="headerlogo">
<a href="http://cocoon.apache.org"><img border="0" class="logoImage" alt="Apache Cocoon" src="../../../images/cocoon-project-logo-big.png"></a>
</div>
<span class="textheader">Apache Cocoon</span>
<!--================= start Tabs ==================-->
<div class="tab">
<table summary="tab bar" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="10" valign="bottom">
<div class="tab-separator">
<img alt="" width="10" src="../../../skin/images/spacer.gif"></div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../project/index.html"><font face="Arial, Helvetica, Sans-serif">Project Information</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../installation/index.html"><font face="Arial, Helvetica, Sans-serif">Installation</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td style="background-image: url(../../../skin/images/tab-left-selected.png)" valign="top" width="5"><img alt="" src="../../../skin/images/tab-corner-left-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-selected">
<a href="../../index.html"><font color="#000000">Documentation</font></a>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right-selected.png)" valign="top" width="5"><img alt="" src="../../../skin/images/tab-corner-right-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../community/index.html"><font face="Arial, Helvetica, Sans-serif">Community</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<!--================= end Tabs ==================-->
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td width="100%" valign="bottom" align="right" bgcolor="#FFFFFF">
<div style="padding: 10px" class="headerlogo">
<a href="http://cocoon.apache.org/lenya"><img border="0" class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png"></a>
</div>
<div class="tab-separator"></div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</table>
<!--================= end Banner ==================-->
<div class="tab-bar">
<img alt="" height="5" src="../../../skin/images/spacer.gif"></div>
<!--================= start Menu, NavBar, Content ==================-->
<table summary="page content" bgcolor="#ffffff" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table summary="menu" border="0" cellspacing="0" cellpadding="0">
<tr>
<!--================= start left top NavBar ==================-->
<!--================= end left top NavBar ==================-->
<td valign="top">
<div class="tab-subbar">
<img width="10" height="5" alt="" src="../../../skin/images/spacer.gif"></div>
</td><td valign="top">
<!--================= start Menu items ==================-->
<div class="menu">
<div class="menutitle"></div>
<div class="menuitemgroup">
<div class="menutitle">Integrator/Dev Guide</div>
<div class="menuitemgroup">
<div class="menutitle">Components</div>
<div class="menuitemgroup">
<div class="menutitle">Workflow</div>
<div class="menuitemgroup">
<div class="menuitem">
<a href="terms.html">Terms</a>
</div>
<div class="menuitem">
<a href="state-machine.html">The State Machine</a>
</div>
<div class="menupage">
<div class="menupagetitle">Configuration</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Workflow+Schemas">Workflow Schemas</a>
</div>
<div class="menupageitem">
<a href="#States">States</a>
</div>
<div class="menupageitem">
<a href="#Variables">Variables</a>
</div>
<div class="menupageitem">
<a href="#Transitions">Transitions</a>
</div>
<div class="menupageitem">
<a href="#Variable+Assignments">Variable Assignments</a>
</div>
<div class="menupageitem">
<a href="#Conditions">Conditions</a>
</div>
<div class="menupageitem">
<a href="#Assigning+Workflow+Schemas+to+Document+Types">Assigning Workflow Schemas to Document Types</a>
</div>
</div>
</div>
<div class="menuitem">
<a href="implementation.html">Implementation</a>
</div>
</div>
</div>
</div>
</div>
</div>
<!--================= end Menu items ==================-->
</td><td valign="top">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<tr>
<td></td><td height="5"><img alt="" width="150" height="1" src="../../../skin/images/spacer.gif"></td><td></td>
</tr>
</table>
</td><td valign="top" width="100%">
<table summary="content" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top" colspan="3">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<!--================= start Content==================-->
<tr>
<td align="left" width="10"><img width="10" height="1" alt="" src="../../../skin/images/spacer.gif"></td><td align="left" width="100%">
<div class="content">
<table cellspacing="0" cellpadding="0" class="title">
<tr>
<td valign="middle">
<h1>Workflow Configuration</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="configuration.pdf"><img alt="PDF" src="../../../skin/images/pdfdoc.gif" border="0"><br>
          PDF</a></td>
</tr>
</table>


<a name="N101CC"></a><a name="Workflow+Schemas"></a>
<h3>Workflow Schemas</h3>
<div style="margin-left: 0 ; border: 2px">
<p>The workflow schema definition files of a publication are located at</p>
<pre class="code">
{publication}/config/workflow/
</pre>
<p>
  A workflow schema definition looks as follows:
</p>
<pre class="code">
&lt;workflow xmlns="http://apache.org/cocoon/lenya/workflow/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://apache.org/cocoon/lenya/workflow/1.0
        ../../../resources/entities/workflow/workflow.xsd"&gt;

  &lt;state id="authoring" initial="true"/&gt;
  &lt;state id="live"/&gt;
  &lt;state id="trash"/&gt;
  &lt;state id="archive"/&gt;

  &lt;variable name="is_live" value="false"/&gt;
  
  &lt;transition source="authoring" destination="authoring"&gt;
    &lt;event id="edit"/&gt;
    &lt;condition class="org.apache.lenya.cms.workflow.RoleCondition"&gt;
      edit, review, organize
    &lt;/condition&gt;
  &lt;/transition&gt;
  
  &lt;transition source="authoring" destination="authoring"&gt;
    &lt;event id="deactivate"/&gt;
    &lt;condition class="org.apache.lenya.workflow.impl.BooleanVariableCondition"&gt;
      is_live = true
    &lt;/condition&gt;
    &lt;condition class="org.apache.lenya.cms.workflow.RoleCondition"&gt;
      review, organize
    &lt;/condition&gt;
    &lt;assign variable="is_live" value="false"/&gt;
  &lt;/transition&gt;
  
  ...
  
&lt;/workflow&gt;  
</pre>
<p>The workflow namespace URI is</p>
<pre class="code">http://apache.org/cocoon/lenya/workflow/1.0</pre>
</div>


<a name="N101EA"></a><a name="States"></a>
<h3>States</h3>
<div style="margin-left: 0 ; border: 2px">
<p>
  All states that are used in the workflow schema have to be declared
  using <span class="codefrag">&lt;state&gt;</span> elements. The initial state is
  marked with the <span class="codefrag">initial="true"</span> attribute.
</p>
</div>


<a name="N101F9"></a><a name="Variables"></a>
<h3>Variables</h3>
<div style="margin-left: 0 ; border: 2px">
<p>
  All used variables have to be declared using <span class="codefrag">&lt;variable&gt;</span>
  elements. The initial value of the variable is assigned using the
  <span class="codefrag">value</span> attribute.
</p>
</div>


<a name="N10208"></a><a name="Transitions"></a>
<h3>Transitions</h3>
<div style="margin-left: 0 ; border: 2px">
<p>
  A transition is declared using the <span class="codefrag">&lt;transition&gt;</span> element.
  The required attributes <span class="codefrag">source</span> and <span class="codefrag">destination</span>
  denote the states that are connected by this transition.
</p>
<p>
  The transition element must contain one <span class="codefrag">&lt;event&gt;</span> element
  with an <span class="codefrag">id</span> attribute. Furthermore, it can contain an
  arbitrary number of <span class="codefrag">&lt;condition&gt;</span> and <span class="codefrag">&lt;assign&gt;</span>
  elements.
</p>
<p>
  A transition element can have a <span class="codefrag">synchronized="true"</span> attribute.
  In this case, if the transition is triggered using a
  <em>SynchronizedWorkflowInstance</em>, it is invoked on all instances.
</p>
</div>


<a name="N10232"></a><a name="Variable+Assignments"></a>
<h3>Variable Assignments</h3>
<div style="margin-left: 0 ; border: 2px">
<p>A variable assignment has the form</p>
<pre class="code">&lt;assign variable="..." value="..."/&gt;</pre>
<p>
  The variable must have been declared in this workflow schema.
  Because only boolean variables are supported, <span class="codefrag">value</span> must
  be either <span class="codefrag">true</span> or <span class="codefrag">false</span>.
</p>
</div>


<a name="N1024C"></a><a name="Conditions"></a>
<h3>Conditions</h3>
<div style="margin-left: 0 ; border: 2px">
<p>A condition has the form</p>
<pre class="code">&lt;condition class="..."&gt;...&lt;/condition&gt;</pre>
<p>The <span class="codefrag">class</span> attribute contains the complete name
(including the package) of the condition class. You can use the
condition classes that ship with Lenya (see below) or implement your
own conditions. All condition classes must implement the
<span class="codefrag">org.apache.lenya.workflow.Condition</span> interface.
The text inside the element is the expression that should
be evaluated. It is passed as an argument to the <span class="codefrag">setExpression()</span>
method.
</p>
<a name="N10265"></a><a name="BooleanVariableCondition"></a>
<h4>BooleanVariableCondition</h4>
<div style="margin-left: 0 ; border: 2px">
<p>The <em>org.apache.lenya.workflow.impl.BooleanVariableCondition</em> requires
an expression of the form</p>
<pre class="code">{variable-name} = {value}</pre>
<p>
<span class="codefrag">{variable-name}</span> is the name of a variable that
was declared in the workflow schema. <span class="codefrag">{value}</span> is either
<span class="codefrag">true</span> or <span class="codefrag">false</span>.</p>
</div>
<a name="N10284"></a><a name="RoleCondition"></a>
<h4>RoleCondition</h4>
<div style="margin-left: 0 ; border: 2px">
<p>The <em>org.apache.lenya.cms.workflow.RoleCondition</em> requires a
comma-separated list of role IDs:
</p>
<pre class="code">{role-id-1}, {role-id-2}, ...</pre>
<p>
  The condition is complied when the current identity has one
  of these roles on the requested URL.
</p>
</div>
</div>


<a name="N10299"></a><a name="Assigning+Workflow+Schemas+to+Document+Types"></a>
<h3>Assigning Workflow Schemas to Document Types</h3>
<div style="margin-left: 0 ; border: 2px">
<p>A workflow schema can be assigned to a document type in</p>
<pre class="code">
{publication}/config/doctypes/doctypes.xconf
</pre>
<pre class="code">&lt;doctypes&gt;
  &lt;doc type="content-page"&gt;
    ...
    &lt;workflow src="workflow.xml"/&gt;
  &lt;/doc&gt;
  ...
&lt;/doctypes&gt;</pre>
</div>


</div>
</td><td width="10"><img width="10" height="1" alt="" src="../../../skin/images/spacer.gif"></td>
</tr>
<!--================= end Content==================-->
</table>
</td>
</tr>
<tr>
<td>
<br>
<br>
</td>
</tr>
</table>
<!--================= end Menu, NavBar, Content ==================-->
<!--================= start Footer ==================-->
<div class="footer">
<table summary="footer" cellspacing="0" cellpadding="0" width="100%" border="0">
<tr>
<td colspan="2" height="1"><img height="1" width="1" alt="" src="../../../skin/images/spacer.gif"><a href="../../../skin/images/label.gif"></a><a href="../../../skin/images/page.gif"></a><a href="../../../skin/images/chapter.gif"></a><a href="../../../skin/images/chapter_open.gif"></a><a href="../../../skin/images/current.gif"></a></td>
</tr>
<tr>
<td colspan="2" class="copyright" align="center" width="90%"><span class="footnote">Copyright &copy;
                2002-2003&nbsp;The Apache Software Foundation. All rights reserved.
                <br>
<script type="text/javascript" language="JavaScript"><!--
                  document.write(" - "+"Last Published: " + document.lastModified);
                  //  --></script></span></td><td nowrap="nowrap" align="right" class="logos"><a href="http://validator.w3.org/check/referer"><img width="88" height="31" alt="Valid HTML 4.01!" src="../../../skin/images/valid-html401.png" class="logoImage" border="0"></a><a href="http://jigsaw.w3.org/css-validator/"><img width="88" height="31" alt="Valid CSS!" src="../../../skin/images/vcss.png" class="logoImage" border="0"></a></td>
</tr>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
