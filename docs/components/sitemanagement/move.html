<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Move a document</title>
<link type="text/css" href="../../../skin/page.css" rel="stylesheet">
</head>
<body text="#000000" bgcolor="#FFFFFF">
<!--================= start Banner ==================-->
<table summary="header with logos" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<!--================= start Group Logo ==================-->
<td valign="bottom" bgcolor="#FFFFFF">
<div class="headerlogo">
<a href="http://cocoon.apache.org"><img border="0" class="logoImage" alt="Apache Cocoon" src="../../../images/cocoon-project-logo-big.png"></a>
</div>
<span class="textheader">Apache Cocoon</span>
<!--================= start Tabs ==================-->
<div class="tab">
<table summary="tab bar" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="10" valign="bottom">
<div class="tab-separator">
<img alt="" width="10" src="../../../skin/images/spacer.gif"></div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../project/index.html"><font face="Arial, Helvetica, Sans-serif">Project Information</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../installation/index.html"><font face="Arial, Helvetica, Sans-serif">Installation</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td><td style="background-image: url(../../../skin/images/tab-left-selected.png)" valign="top" width="5"><img alt="" src="../../../skin/images/tab-corner-left-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-selected">
<a href="../../index.html"><font color="#000000">Documentation</font></a>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right-selected.png)" valign="top" width="5"><img alt="" src="../../../skin/images/tab-corner-right-selected.png"></td><td valign="bottom" class="tab">
<div class="tab-separator">
<table cellspacing="0" cellpadding="0" border="0">
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-left.png"></td><td rowspan="2" valign="bottom" class="tab">
<div class="tab-not-selected-shadow">
<div class="tab-not-selected">
<a href="../../../community/index.html"><font face="Arial, Helvetica, Sans-serif">Community</font></a>
</div>
</div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="top" width="5" height="5"><img alt="" src="../../../skin/images/tab-corner-right.png"></td>
</tr>
<tr>
<td style="background-image: url(../../../skin/images/tab-left.png)" valign="bottom">
<div class="tab-not-selected-shadow-left">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td><td style="background-image: url(../../../skin/images/tab-right.png)" valign="bottom">
<div class="tab-not-selected-shadow-right">
<img alt="" width="4" src="../../../skin/images/spacer.gif"></div>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<!--================= end Tabs ==================-->
</td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td width="100%" valign="bottom" align="right" bgcolor="#FFFFFF">
<div style="padding: 10px" class="headerlogo">
<a href="http://cocoon.apache.org/lenya"><img border="0" class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png"></a>
</div>
<div class="tab-separator"></div>
</td>
<!--================= end Project Logo ==================-->
</tr>
</table>
<!--================= end Banner ==================-->
<div class="tab-bar">
<img alt="" height="5" src="../../../skin/images/spacer.gif"></div>
<!--================= start Menu, NavBar, Content ==================-->
<table summary="page content" bgcolor="#ffffff" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table summary="menu" border="0" cellspacing="0" cellpadding="0">
<tr>
<!--================= start left top NavBar ==================-->
<!--================= end left top NavBar ==================-->
<td valign="top">
<div class="tab-subbar">
<img width="10" height="5" alt="" src="../../../skin/images/spacer.gif"></div>
</td><td valign="top">
<!--================= start Menu items ==================-->
<div class="menu">
<div class="menutitle"></div>
<div class="menuitemgroup">
<div class="menutitle">Integrator/Dev Guide</div>
<div class="menuitemgroup">
<div class="menutitle">Components</div>
<div class="menuitemgroup">
<div class="menutitle">Site Management</div>
<div class="menuitemgroup">
<div class="menuitem">
<a href="archive.html">Archive</a>
</div>
<div class="menuitem">
<a href="copy.html">Copy</a>
</div>
<div class="menuitem">
<a href="deactivate.html">Deactivate</a>
</div>
<div class="menuitem">
<a href="delete.html">Delete</a>
</div>
<div class="menuitem">
<a href="deletetrash.html">Delete the trash</a>
</div>
<div class="menupage">
<div class="menupagetitle">Move</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Introduction">Introduction</a>
</div>
<div class="menupageitem">
<a href="#Implementation">Implementation</a>
</div>
<div class="menupageitem">
<a href="#Parameters">Parameters</a>
</div>
<div class="menupageitem">
<a href="#usecase">usecase</a>
</div>
<div class="menupageitem">
<a href="#Ant+Task+">Ant Task </a>
</div>
</div>
</div>
<div class="menuitem">
<a href="moveupdown.html">Move Up/Down</a>
</div>
<div class="menuitem">
<a href="rename.html">Rename</a>
</div>
<div class="menuitem">
<a href="restore.html">Restore</a>
</div>
</div>
</div>
</div>
</div>
</div>
<!--================= end Menu items ==================-->
</td><td valign="top">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<tr>
<td></td><td height="5"><img alt="" width="150" height="1" src="../../../skin/images/spacer.gif"></td><td></td>
</tr>
</table>
</td><td valign="top" width="100%">
<table summary="content" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top" colspan="3">
<div class="tab-subbar">&nbsp;&nbsp;</div>
</td>
</tr>
<!--================= start Content==================-->
<tr>
<td align="left" width="10"><img width="10" height="1" alt="" src="../../../skin/images/spacer.gif"></td><td align="left" width="100%">
<div class="content">
<table cellspacing="0" cellpadding="0" class="title">
<tr>
<td valign="middle">
<h1>Move a document</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="move.pdf"><img alt="PDF" src="../../../skin/images/pdfdoc.gif" border="0"><br>
          PDF</a></td>
</tr>
</table>
	
    
<a name="N101C9"></a><a name="Introduction"></a>
<h3>Introduction</h3>
<div style="margin-left: 0 ; border: 2px">
<p>The move operation is performed on the subtree corresponding to a given document id and a given area.</p>
<p>We have to :</p>
<ul>
	    
<li>compute a new id (to not overwrite an already existing file)</li>
	    
<li>move the contents (xml file)</li>
	    
<li>move the resources</li>
        
<li>move the policies</li> 
        
<li>move the revisions</li> 
        
<li>move the rcml files</li> 
	    
<li>move the workflow for the new documents</li>
	    
<li>move the node (with the subtree) in the site tree</li>
	  
</ul>
</div>
	  
    
<a name="N101F1"></a><a name="Implementation"></a>
<h3>Implementation</h3>
<div style="margin-left: 0 ; border: 2px">
<p>It is implemented in a sequence of usecases to get all needed parameters, and uses the task concept to execute some ant task</p>
<p>To perform the different operations on the desired subtree, we used the visitor pattern</p>
</div>
	  
    
<a name="N101FE"></a><a name="Parameters"></a>
<h3>Parameters</h3>
<div style="margin-left: 0 ; border: 2px">
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the area for the destination document</li>
        
<li>the document id for the destination document</li>
        
<li>the task id</li>
      
</ul>
</div>

    
<a name="N1021A"></a><a name="usecase"></a>
<h3>usecase</h3>
<div style="margin-left: 0 ; border: 2px">
<p>They are implemented in the usecase sitmap (core)</p>
<a name="N10223"></a><a name="Cut+screen"></a>
<h4>Cut screen</h4>
<div style="margin-left: 0 ; border: 2px">
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=cut&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="cut" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/cut.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/cut.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
</div>
<a name="N1023D"></a><a name="Cut+confirmation"></a>
<h4>Cut confirmation</h4>
<div style="margin-left: 0 ; border: 2px">
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=cut&amp;lenya.step=cut&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="cut" type="usecase"&gt;
            &lt;map:match pattern="cut" type="step"&gt;
              &lt;map:act type="session-propagator"&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value="{request-param:documentid}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstarea" value="{request-param:area}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value="{request-param:documentid}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.action" value="{request-param:action}"/&gt;
                &lt;map:redirect-to uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The source parameters are saved in the session with the org.apache.cocoon.acting.SessionPropagatorAction</p>
<p>The parameter <strong>org.apache.lenya.cms.info.cutdocumentid</strong> is used to change the representation of the cutted node in the info sitetree.</p>
</div>
<a name="N1025D"></a><a name="Paste+screen"></a>
<h4>Paste screen</h4>
<div style="margin-left: 0 ; border: 2px">
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=showscreen</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/paste.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/paste.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the destination are get with the serverpage through the page envelope input module. 
	    Parameters needed by the access controller are also get with this serverpage through the access control input module.
	    The parameters for the source are get from the session with the serverpage .
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
</div>
<a name="N10277"></a><a name="Paste+confirmation"></a>
<h4>Paste confirmation</h4>
<div style="margin-left: 0 ; border: 2px">
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=paste&amp;...{parameters}</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="paste" type="step"&gt;
              &lt;map:select type="request-parameter"&gt;
                &lt;map:parameter name="parameter-name" value="task-id"/&gt;  
                &lt;map:when test="moveDocument"&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value=""/&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:when&gt;
                &lt;map:otherwise&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:otherwise&gt;
              &lt;/map:select&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<p>The parameter <strong>org.apache.lenya.cms.info.cutdocumentid</strong> is set to "", because the cutted node is no more present.</p>
</div>
</div>

    
<a name="N10298"></a><a name="Ant+Task+"></a>
<h3>Ant Task </h3>
<div style="margin-left: 0 ; border: 2px">
<p>The ant target <span class="codefrag">moveDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the source area</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the destination area</li>
        
<li>
<span class="codefrag">newcopydocumentid</span>, to compute the unique destination id</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the source contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory of the destination contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="../tasks/anttask.html">Ant Task</a> and the <a href="../../apidocs/index.html">Javadoc</a>
</p>
</div>

  
</div>
</td><td width="10"><img width="10" height="1" alt="" src="../../../skin/images/spacer.gif"></td>
</tr>
<!--================= end Content==================-->
</table>
</td>
</tr>
<tr>
<td>
<br>
<br>
</td>
</tr>
</table>
<!--================= end Menu, NavBar, Content ==================-->
<!--================= start Footer ==================-->
<div class="footer">
<table summary="footer" cellspacing="0" cellpadding="0" width="100%" border="0">
<tr>
<td colspan="2" height="1"><img height="1" width="1" alt="" src="../../../skin/images/spacer.gif"><a href="../../../skin/images/label.gif"></a><a href="../../../skin/images/page.gif"></a><a href="../../../skin/images/chapter.gif"></a><a href="../../../skin/images/chapter_open.gif"></a><a href="../../../skin/images/current.gif"></a></td>
</tr>
<tr>
<td colspan="2" class="copyright" align="center" width="90%"><span class="footnote">Copyright &copy;
                2002-2003&nbsp;The Apache Software Foundation. All rights reserved.
                <br>
<script type="text/javascript" language="JavaScript"><!--
                  document.write(" - "+"Last Published: " + document.lastModified);
                  //  --></script></span></td><td nowrap="nowrap" align="right" class="logos"><a href="http://validator.w3.org/check/referer"><img width="88" height="31" alt="Valid HTML 4.01!" src="../../../skin/images/valid-html401.png" class="logoImage" border="0"></a><a href="http://jigsaw.w3.org/css-validator/"><img width="88" height="31" alt="Valid CSS!" src="../../../skin/images/vcss.png" class="logoImage" border="0"></a></td>
</tr>
</table>
</div>
<!--================= end Footer ==================-->
</body>
</html>
