
  LENYA        C O N T E N T - M A N A G E M E N T - S Y S T E M
  ==============================================================


  Contents
  --------

  -Prerequisite
  -Installation
  -Notes


  Prerequisite
  ------------

  You need to have an installed Apache Ant 1.4. 
  
  Point your favorite browser to http://jakarta.apache.org/ant and get a 
  version 1.4 or greater distribution and installation instructions there.

  (To view targets: ant -projecthelp)


  Installation
  ------------

  1) Get, install, start, try and stop Tomcat

     [unix]  cd /home/lenya/build
             wget http://jakarta.apache.org/builds/jakarta-tomcat-4.0/nightly/jakarta-tomcat-4.0-20020110.tar.gz 
             (take the apropriate tomcat version, this one might not exist anymore)
             tar -xzf jakarta-tomcat-4.0-20020110.tar.gz
             export JAVA_HOME=/usr/local/jdk1.3.1
             export CATALINA_HOME=/home/lenya/build/jakarta-tomcat-4.0
             /home/lenya/build/jakarta-tomcat-4.0/bin/startup.sh
             lynx http://localhost:8080
             /home/lenya/build/jakarta-tomcat-4.0/bin/shutdown.sh


  2) Get and install Ant

     [unix]  cd /home/lenya/build
             wget http://jakarta.apache.org/builds/jakarta-ant/release/v1.4.1/bin/jakarta-ant-1.4.1-bin.tar.gz
             (take the apropriate ant version, this one might not exist anymore)
             tar -xzf jakarta-ant-1.4.1-bin.tar.gz


  3) Get Lenya

     [unix]  cd /home/lenya/src
             choose 1) or 2)
             1) wget http://www.lenya.org/builds/lenya-2.0/nightly/src/lenya-2.0-src-200201102354.tar.gz
                (take the apropriate lenyacms (src not bin) version, this one might not exist anymore)
                tar -xzf lenya-2.0-src-200201102354.tar.gz
                mv lenya-2.0-src lenyacms 
             2) or get it from the public cvs:
                cvs -d :pserver:anonlenyacms@194.191.122.220:/repository checkout lenyacms
             cd lenyacms
             ls


  4) Get, build and copy Cocoon 
     (OPTIONAL: Just in case you want the most recent Cocoon. If not, then go to 5)

     [unix]  cd /home/lenya/src
             wget http://cvs.apache.org/snapshots/xml-cocoon2/xml-cocoon2_20020110171938.tar.gz
             (take the apropriate cocoon version, this one might not exist anymore)
             tar -xzf xml-cocoon2_20020110171938.tar.gz
             cd xml-cocoon2
             export JAVA_HOME=/usr/local/jdk1.3.1
             ./build.sh -Dinclude.webapp.libs=yes webapp
             cp build/cocoon/cocoon.war ../lenyacms/.


  5) Build Lenya

     [unix]  cd /home/lenya/src/lenyacms
             export JAVA_HOME=/usr/local/jdk1.3.1
             export ANT_HOME=/home/lenya/build/jakarta-ant-1.4.1
             export PATH=/home/lenya/build/jakarta-ant-1.4.1/bin:$PATH
             ant
             ls build/lenya/webapp


  6) Install Lenya for Development

     [unix]  cp build.properties.sample build.properties
             vi build.properties (Set install.dir and cache.dir)
             ant install
             ls install.dir (Check if things actually got copied into "install.dir", where "install.dir" is not the string "install.dir", but the value you have set within build.properties)
             vi /home/lenya/build/jakarta-tomcat-4.0/conf/server.xml
             To allow class reloading, insert the following line:
             <Context path="/lenya" docBase="lenya" debug="0" reloadable="true" crossContext="true"/>


  7) Start Lenya

     [unix]  (/home/lenya/build/jakarta-tomcat-4.0/bin/shutdown.sh)
             ("rm -r /home/lenya/build/jakarta-tomcat-4.0/work/*" OR "ant reset". This is the "cache.dir" directory which can be set within build.properties)
             /home/lenya/build/jakarta-tomcat-4.0/bin/startup.sh
             lynx http://localhost:8080/lenya/


  8) Start Hacking Lenya

     [unix]  cd /home/lenya/src/lenyacms
             ls src/java
             ls src/webapp
             vi src/webapp/WEB-INF/logkit.xconf   (DEBUG, ERROR)
             vi src/webapp/cocoon.xconf   (asynchron, synchron)
             ant install
             tail -f build/webapp/WEB-INF/logs/* | grep Sitemap -B10
             lynx http://localhost:8080/lenya/


  9) Stop Lenya

     [unix]  /home/lenya/build/jakarta-tomcat-4.0/bin/shutdown.sh
             "rm -r /home/lenya/build/jakarta-tomcat-4.0/work/*" OR "ant reset"
             ps aux | grep java | wc ("killall java")


  Notes 
  -----

  1) Overwrite

     Lenya is overwriting some Cocoon files:
     -sitemap.xmap
      The original Cocoon Sitemap is mounted from the Lenya Sitemap
     -cocoon.xconf
      In order to simplify development we use "synchron"
     -logkit.xconf
      We replaced DEBUG by ERROR


  2)  Reconfigure Ports

     1) Tomcat port: TOMCAT/conf/server.xml (default: 8080)
     2) Catalina port: TOMCAT/conf/server.xml (default: 8008)
     3) Tomcat shutdown port: TOMCAT/conf/server.xml (default: 8005)
     4) HypersonicSQL DB port(http://www.hsqldb.org): TOMCAT/webapps/lenya/WEB-INF/cocoon.xconf (default: 9002)
                                                      (In case you work with Cocoon Source: src/java/org/apache/cocoon/components/hsqldb/hsqldb.xconf)

     NOTE: To find out which ports are used:
           /usr/local/bin/nmap localhost -p 1-65535
           (http://www.insecure.org/nmap/index.html)
 
           or

           netstat -nt -l | grep 8080 (Linux)
           netstat -an | grep 8080 (Solaris)
