<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.6">
<meta name="Forrest-skin-name" content="pelt">
<title>Installation of the Source Version</title>
<link type="text/css" href="../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../skin/print.css" rel="stylesheet">
<link type="text/css" href="../skin/profile.css" rel="stylesheet">
<script src="../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://lenya.apache.org"><img class="logoImage" alt="Lenya" src="../images/apache-lenya-light.png" title="
  	Apache Lenya is a Java-based Open-Source Content Management System.
  	It is based on open standards such as XML and XSLT.
  	One of its core components is Cocoon from the Apache Software Foundation.
  "></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with :');" value="Search the site with :" size="25" name="q" id="query" type="text">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../installation/index.html">Installation</a>
</li>
<li>
<a class="base-not-selected" href="../docs/index.html">Documentation</a>
</li>
<li>
<a class="base-not-selected" href="../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../skin/images/chapter_open.gif');">Installation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a title="" href="../installation/index.html">Download</a>
</div>
<div class="menuitem">
<a title="" href="../installation/subversion.html">Subversion Access</a>
</div>
<div class="menupage">
<div class="menupagetitle">Installation Instructions</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div id="skinconf-txtlink"></div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="source_version.pdf"><img alt="PDF -icon" src="../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Installation of the Source Version</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#prerequisites">Prerequisites</a>
</li>
<li>
<a href="#Standalone+Installation+%28using+the+built-in+Jetty%29">Standalone Installation (using the built-in Jetty)</a>
</li>
<li>
<a href="#Installation+with+Apache+Tomcat">Installation with Apache Tomcat</a>
</li>
</ul>
</div>
    
<a name="N1001B"></a><a name="prerequisites"></a>
<h2 class="underlined_10">Prerequisites</h2>
<div class="section">
<p>
        The following list describes the setup that is tested and
        recommended.  Please note that you can use other servlet
        containers as well, but Jetty and Tomcat are the tested ones.
      </p>
<ul>
        
<li>
          
<p>
            
<strong>Java 2 Platform, Standard Edition</strong>
            
<br>
            version: 1.4.2 or newer, 1.5.x not tested.
            <br>
            source: <a href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>
          
</p>
        
</li>

        
<li>
          
<p>
            
<strong>Apache Cocoon</strong>
            
<br>
            version: 2.1.5.1
            <br>
            source: <a href="http://cocoon.apache.org/mirror.cgi">http://cocoon.apache.org/mirror.cgi</a>
          
</p>

          
<p>
            Note that Cocoon is needed when building the source
            version of Lenya, but the resulting Lenya webapp is
            completely self contained and therefore it does not need
            the Cocoon webapp to be installed. See the <a href="http://wiki.apache.org/cocoon-lenya/FAQ">FAQ</a>
            for details of configuration changes required when running
            multiple Cocoon based applications.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>(optional) Apache Tomcat</strong> for JDK 1.4
            <br>
            version: 5.0.28 or newer, 5.5.x not tested.
            <br>
            source: <a href="http://jakarta.apache.org/site/binindex.cgi">http://jakarta.apache.org/site/binindex.cgi</a>
          
</p>

          
<p>
            Note that Lenya ships with <a href="http://jetty.mortbay.org/jetty/">Jetty</a> and
            therefore does not need a servlet container to be installed.
          </p>
        
</li>
      
</ul>
</div>


    
<a name="N10069"></a><a name="Standalone+Installation+%28using+the+built-in+Jetty%29"></a>
<h2 class="underlined_10">Standalone Installation (using the built-in Jetty)</h2>
<div class="section">
<ol>
        
<li>
          
<p>
            
<strong>Get the Java SDK</strong> (see <a href="#prerequisites">Prerequisites</a>)
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Get Apache Cocoon</strong> (see <a href="#prerequisites">Prerequisites</a>)
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Get Apache Lenya</strong> (see <a href="../installation/index.html">Download Lenya</a>)
          </p>
        
</li>

        
<li>
          
<p>
            Extract the downloaded Lenya archive to the
            <span class="codefrag">lenya-1.2.x</span> directory as described below. If
            you use Subversion, create your Lenya checkout inside the
            <span class="codefrag">src</span> directory as described below.  It is
            recommended to use the following directory structure for an
            easier build experience.
          </p>

          
<pre class="code">
            your_home/ (or c:\ on Windows, NOT My Documents)
              `-- src/
                   |-- lenya-1.2.x/            $LENYA_HOME
                   `-- cocoon/                 $COCOON_HOME
                        `-- build/
                             `-- webapp/       $COCOON_WEBAPP
          </pre>
        
</li>

        
<li>
          
<p>
            
<strong>Copy the Cocoon build properties supplied by Lenya</strong>
          
</p>

          
<p>
            Copy the files
          </p>

          
<ul>
            
<li>
<span class="codefrag">local.build.properties</span>
</li>
            
<li>
<span class="codefrag">local.blocks.properties</span>
</li>
          
</ul>

          
<p>
            from <span class="codefrag">$LENYA_HOME/src/cocoon/</span> to
            <span class="codefrag">$COCOON_HOME</span>.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Compile Cocoon</strong>
          
</p>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $COCOON_HOME &gt; build.bat
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $COCOON_HOME &gt; ./build.sh -Dinclude.webapp.libs=yes webapp
          </pre>
        
</li>

        
<li>
          
<p>
            
<strong>Configure Lenya</strong>
          
</p>

          
<p>
            If your Cocoon source tree is set up as described above, you
            can skip this step.  If your Cocoon source tree is not at
            <span class="codefrag">../cocoon</span> relative to Lenya, you need
            to edit your build properties. To do this, copy
            <span class="codefrag">$LENYA_HOME/build.properties</span> to
            <span class="codefrag">$LENYA_HOME/local.build.properties</span>.
          </p>

          
<p>
            Edit <span class="codefrag">local.build.properties</span>. For the described
            configuration the following settings will work (<strong>MS
            Windows:</strong> Don't use backslashes "<span class="codefrag">\</span>" for
            directory separation.)
          </p>

          
<ul>
            
<li>
<span class="codefrag">cocoon.src.dir=$COCOON_HOME</span>
</li>
            
<li>
<span class="codefrag">tomcat.home.dir=$TOMCAT_HOME</span>
</li>
          
</ul>
        
</li>

        
<li>
          
<p>
            
<strong>Build Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">build.bat</span> or <span class="codefrag">build.sh</span> in
            your Lenya source directory, depending on your platform.
          </p>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; build.bat
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; ./build.sh
          </pre>
        
</li>

        
<li>
          
<p>
            
<strong>Start Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">lenya.bat</span> or <span class="codefrag">lenya.sh
            servlet</span> in your Lenya source directory, depending on
            your platform.  Make sure that you have the environment
            variable <span class="codefrag">JAVA_HOME</span> defined to point to the
            location of the Java SDK you installed (see <a href="#prerequisites">Prerequisites</a>).
          </p>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; lenya.bat
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; ./lenya.sh servlet
          </pre>
        
</li>

        
<li>
          
<p>
            
<strong>Test the installation</strong>
          
</p>

          
<p>
            
<a href="http://localhost:8888">http://localhost:8888/</a>
          
</p>
        
</li>
      
</ol>
</div>

    
<a name="N10176"></a><a name="Installation+with+Apache+Tomcat"></a>
<h2 class="underlined_10">Installation with Apache Tomcat</h2>
<div class="section">
<p>
        Installing Lenya with Tomcat is mostly the same
        procedure. Follow Steps 1-6, then do the steps below.
      </p>
<ol>
        
<li>
          
<p>
            
<strong>get Apache Tomcat</strong> (see <a href="#prerequisites">Prerequisites</a>)
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Install Apache Tomcat</strong>
          
</p>

          
<p>
            See <a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/setup.html">Tomcat
            5.0 Setup</a>
          
</p>

          
<p>
            
<strong>MS Windows:</strong>

            
<br>

            Basically this is setting the <span class="codefrag">JAVA_HOME</span>
            environment variable and running the Tomcat
            installer. Decide to run Tomcat as a Windows
            NT/2000/XP-Service.
          </p>

          
<div class="frame warning">
<div class="label">Warning</div>
<div class="content">
            Make sure you do not install at a location with spaces in
            the path.
          </div>
</div>
        
</li>

        
<li>
          
<p>
            
<strong>Configure Lenya</strong>
          
</p>

          
<p>
            To install Lenya with Tomcat, you need to edit your build
            properties. To do this, copy
            <span class="codefrag">$LENYA_HOME/build.properties</span> to
            <span class="codefrag">$LENYA_HOME/local.build.properties</span>.
          </p>

          
<p>
            Edit <span class="codefrag">local.build.properties</span>. For the described
            configuration the following settings will work (<strong>MS
            Windows:</strong> Don't use backslashes "<span class="codefrag">\</span>" for
            directory separation.) It is important that
            <span class="codefrag">tomcat.home.dir</span> is an absolute path. Replace
            <span class="codefrag">$TOMCAT_HOME</span> by your Tomcat installation
            directory.  If your Cocoon source directory is not at
            <span class="codefrag">../cocoon-2.1.5.1</span> relative to Lenya, then change
            the <span class="codefrag">cocoon.webapp.dir</span> and
            <span class="codefrag">cocoon.src.dir</span> properties.
          </p>

          
<ul>
            
<li>
<span class="codefrag">cocoon.src.dir=$COCOON_HOME</span>
</li>
            
<li>
<span class="codefrag">tomcat.home.dir=$TOMCAT_HOME</span>
</li>
          
</ul>
        
</li>

        
<li>
          
<p>
            
<strong>Build Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">ant install</span> in your Lenya source directory.
          </p>
        
</li>

      
<li>
        
<p>
          
<strong>Checked versions of endorsed libraries</strong>
        
</p>
    
        
<p>
          Lenya and Tomcat will inter-operate correctly only if the proper
          versions of the Xalan and Xerces libraries are used consistently
          throughout the deployment.  Unfortunately this can be difficult
          to get to work correctly since both of these libraries are
          shipped with Java 2 SDK, Tomcat, Cocoon and Lenya.
        </p>
    
        
<p>
          The following libraries must be placed in the endorsed library
          directory for your deployment.
        </p>
    
        
<ul>
          
<li>
<span class="codefrag">jakarta-bcel-20040329.jar</span>
</li>
          
<li>
<span class="codefrag">jakarta-regexp-1.3.jar</span>
</li>
          
<li>
<span class="codefrag">xalan-2.6.0.jar</span>
</li>
          
<li>
<span class="codefrag">xercesImpl-2.6.2.jar</span>
</li>
          
<li>
<span class="codefrag">xml-apis.jar</span>
</li>
        
</ul>
    
        
<p>
          They are placed by the build process in the directory specified
          by <span class="codefrag">tomcat.endorsed.dir</span> in
          <span class="codefrag">build.properties</span>.  You should validate that these
          files are indeed in the proper location for your deployment.
          You must then validate that no other instances of these
          libraries exist in any of the following directories:
        </p>
    
        
<ul>
          
<li>
            The Java 2 SDK endorsed standards directories.  This is
            usually <span class="codefrag">${JAVA_HOME}/lib/endorsed/</span>.
          </li>
    
          
<li>
            Any other location in your Tomcat deployment.  Specifically,
            check <span class="codefrag">shared/lib/</span>, <span class="codefrag">common/lib/</span> and
            <span class="codefrag">server/lib/</span>.
          </li>
    
          
<li>
            Any other location in your Lenya deployment.  Specifically,
            check <span class="codefrag">webapps/lenya/WEB-INF/lib/</span>.
          </li>
        
</ul>
    
        
<p>
          A common symptom of incorrect library version are blank pages
          after starting Lenya.  Try carefully checking the location and
          version numbers of each of the libraries.
        </p>
    
        
<p>
          References:
        </p>
    
        
<ul>
          
<li>
            
<a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html">
              Tomcat Class Loader HOWTO (http://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html)
            </a>
          
</li>
    
          
<li>
            
<a href="http://java.sun.com/j2se/1.4.2/docs/guide/standards/index.html">
              Java 2 Endorsed Standards Override Mechanism
              (http://java.sun.com/j2se/1.4.2/docs/guide/standards/index.html)
            </a>
          
</li>
        
</ul>
      
</li>

        
<li>
          
<p>
            
<strong>Restart Tomcat</strong>
          
</p>

          
<p>
            Restart Tomcat to load the Lenya webapp.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Test the installation</strong>
          
</p>

          
<p>
            
<a href="http://localhost:8080/lenya">http://localhost:8080/lenya/</a>
          
</p>
        
</li>
      
</ol>
</div>
  
<p align="right">
<font size="-2">by&nbsp;Lenya community</font>
</p>
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
 Copyright &copy; 2002-2004 The Apache Software Foundation.</div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A0installation/source_version.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
