<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Lenya: Whole documentation</title>
<link type="text/css" href="skin/page.css" rel="stylesheet">
<link type="text/css" href="skin/forrest.css" rel="stylesheet">
<link rel="shortcut icon" href="">
<script src="skin/fontsize.js" language="javascript" type="text/javascript"></script><script src="skin/menu.js" language="javascript" type="text/javascript"></script>
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="header">
<tr>
<td>
<div class="headerlogo">
<a href="http://cocoon.apache.org"><img class="logoImage" alt="Apache Cocoon" src="images/cocoon-project-logo-big.png"></a>
</div>
</td><td valign="bottom" colspan="3" align="right">
<div class="headerlogo right">
<a href="http://cocoon.apache.org/lenya"><img class="logoImage" alt="Lenya" src="images/apache-lenya-light.png"></a>
</div>
</td>
</tr>
<tr>
<td class="tabstrip" colspan="4">
<table border="0" cellpadding="0" cellspacing="0" class="tab">
<tr>
<td class="tab pre-separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="index.html">Project</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td><td class="tab separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="installation/index.html">Installation</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td><td class="tab separator"></td><td class="tab selected top-left TSTL"></td><td class="tab selected"><a class="base-selected" href="docs/index.html">Documentation</a></td><td class="tab selected top-right TSTR"></td><td class="tab separator"></td><td>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="tab unselected top-left TUTL"></td><td class="tab unselected corner"><a class="base-not-selected" href="community/index.html">Community</a></td><td class="tab unselected top-right TUTR"></td>
</tr>
<tr>
<td class="spacer" colspan="3"></td>
</tr>
</table>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="level2tabstrip" colspan="2"></td><td class="datenote level2tabstrip" colspan="2">
<div class="published">
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
</td>
</tr>
</table>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table class="menuarea" cellspacing="0" cellpadding="0">
<tr>
<td width="6px" valign="top">
<table border="0" cellpadding="0" cellspacing="0" class="leftpagemargin">
<tr>
<td class="subborder trail">&nbsp;</td>
</tr>
</table>
</td><td class="dialog">
<div class="menu">
<div onclick="SwitchMenu('menu_selected_1.1')" id="menu_selected_1.1Title" class="menutitle">Documentation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup">
<div class="menuitem">
<a href="docs/index.html">Documentation</a>
</div>
<div class="menuitem">
<a href="docu.pdf">pdf docu (whole)</a>
</div>
<div class="menupage">
<div class="menupagetitle">html docu (whole)</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4')" id="menu_1.1.4Title" class="menutitle">Integrator/Dev Guide</div>
<div id="menu_1.1.4" class="menuitemgroup">
<div onclick="SwitchMenu('menu_1.1.4.1')" id="menu_1.1.4.1Title" class="menutitle">Components</div>
<div id="menu_1.1.4.1" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/index.html">Components</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.2')" id="menu_1.1.4.1.2Title" class="menutitle">Access&nbsp;Control</div>
<div id="menu_1.1.4.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/accesscontrol/terms.html">Basic Terms</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/accesscontrollers.html">Access&nbsp;Controllers</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/accesscontrollerresolvers.html">Access Controller Resolvers</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/authenticators.html">Authenticators</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/authorizers.html">Authorizers</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/policymanagers.html">Policies and Policy&nbsp;Managers</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/accreditablemanagers.html">Accreditable&nbsp;Managers</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/ssl.html">SSL Encryption</a>
</div>
<div class="menuitem">
<a href="docs/components/accesscontrol/faq.html">FAQ</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.3')" id="menu_1.1.4.1.3Title" class="menutitle">Deployment</div>
<div id="menu_1.1.4.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/deployment/mod_proxy.html">mod_proxy</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.4')" id="menu_1.1.4.1.4Title" class="menutitle">Editors</div>
<div id="menu_1.1.4.1.4" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/editors/htmlform.html">HTML Form Editor</a>
</div>
<div class="menuitem">
<a href="docs/components/editors/1form.html">HTML One Form Editor</a>
</div>
<div class="menuitem">
<a href="docs/components/editors/bxeng.html">Bitflux Editor</a>
</div>
<div class="menuitem">
<a href="docs/components/editors/kupu.html">Kupu</a>
</div>
<div class="menuitem">
<a href="docs/components/editors/xopus.html">Xopus</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.5')" id="menu_1.1.4.1.5Title" class="menutitle">Layout</div>
<div id="menu_1.1.4.1.5" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/layout/navigation.html">Navigation</a>
</div>
<div class="menuitem">
<a href="docs/components/layout/xhtml-templating.html">XHTML templating</a>
</div>
<div class="menuitem">
<a href="docs/components/layout/static-resources.html">Serving static resources</a>
</div>
<div class="menuitem">
<a href="docs/components/layout/lenya-menubar.html">Lenya Menubar</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.6')" id="menu_1.1.4.1.6Title" class="menutitle">Publication</div>
<div id="menu_1.1.4.1.6" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/publication/pageenvelopemodule.html">PageEnvelopeModule</a>
</div>
<div class="menuitem">
<a href="docs/components/publication/siteTree.html">Site tree</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.7')" id="menu_1.1.4.1.7Title" class="menutitle">Revision Control</div>
<div id="menu_1.1.4.1.7" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/revisioncontrol/revisioncontroller.html">Revision Controller</a>
</div>
<div class="menuitem">
<a href="docs/components/revisioncontrol/rcml.html">RCML</a>
</div>
<div class="menuitem">
<a href="docs/components/revisioncontrol/checkin.html">Check In</a>
</div>
<div class="menuitem">
<a href="docs/components/revisioncontrol/checkout.html">Check Out</a>
</div>
<div class="menuitem">
<a href="docs/components/revisioncontrol/version.html">Revisions</a>
</div>
<div class="menuitem">
<a href="docs/components/revisioncontrol/rollback.html">Rollback</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.8')" id="menu_1.1.4.1.8Title" class="menutitle">Repository</div>
<div id="menu_1.1.4.1.8" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/repository/webdav.html">WebDAV Servers</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.9')" id="menu_1.1.4.1.9Title" class="menutitle">Search</div>
<div id="menu_1.1.4.1.9" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/search/lucene.html">Searching with Lucene</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.10')" id="menu_1.1.4.1.10Title" class="menutitle">URI Handling</div>
<div id="menu_1.1.4.1.10" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/uri-handling/URIParametrizer.html">URI Parametrizer</a>
</div>
<div class="menuitem">
<a href="docs/components/uri-handling/standardURI.html">URI Scheme</a>
</div>
<div class="menuitem">
<a href="docs/components/uri-handling/usecases.html">Usecases</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.11')" id="menu_1.1.4.1.11Title" class="menutitle">Asset Management</div>
<div id="menu_1.1.4.1.11" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/asset-management/management.html">Asset Management</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.12')" id="menu_1.1.4.1.12Title" class="menutitle">Link Management</div>
<div id="menu_1.1.4.1.12" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/link-management/link-management.html">Link Management</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.13')" id="menu_1.1.4.1.13Title" class="menutitle">Meta Data</div>
<div id="menu_1.1.4.1.13" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/metadata/metadata.html">Meta Data Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.14')" id="menu_1.1.4.1.14Title" class="menutitle">Multilingual Documents</div>
<div id="menu_1.1.4.1.14" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/multilingual/multilingual.html">Multilingual Document Handling</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.15')" id="menu_1.1.4.1.15Title" class="menutitle">Tasks</div>
<div id="menu_1.1.4.1.15" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/tasks/concept.html">The Task Concept</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/defining.html">Defining Tasks</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/taskaction.html">The TaskAction</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/scheduling.html">Scheduling a Task</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.15.5')" id="menu_1.1.4.1.15.5Title" class="menutitle">Included tasks</div>
<div id="menu_1.1.4.1.15.5" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/tasks/anttask.html">AntTask</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/publisher.html">DefaultFilePublisher</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/exporter.html">StaticHTMLExporter</a>
</div>
<div class="menuitem">
<a href="docs/components/tasks/mailtask.html">MailTask</a>
</div>
</div>
<div class="menuitem">
<a href="docs/components/tasks/development.html">Developing Tasks</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.16')" id="menu_1.1.4.1.16Title" class="menutitle">Workflow</div>
<div id="menu_1.1.4.1.16" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/workflow/terms.html">Terms</a>
</div>
<div class="menuitem">
<a href="docs/components/workflow/state-machine.html">The State Machine</a>
</div>
<div class="menuitem">
<a href="docs/components/workflow/configuration.html">Configuration</a>
</div>
<div class="menuitem">
<a href="docs/components/workflow/implementation.html">Implementation</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.1.17')" id="menu_1.1.4.1.17Title" class="menutitle">Site Management</div>
<div id="menu_1.1.4.1.17" class="menuitemgroup">
<div class="menuitem">
<a href="docs/components/sitemanagement/archive.html">Archive</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/copy.html">Copy</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/deactivate.html">Deactivate</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/delete.html">Delete</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/deletetrash.html">Delete the trash</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/move.html">Move</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/moveupdown.html">Move Up/Down</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/rename.html">Rename</a>
</div>
<div class="menuitem">
<a href="docs/components/sitemanagement/restore.html">Restore</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.2')" id="menu_1.1.4.2Title" class="menutitle">Specifications</div>
<div id="menu_1.1.4.2" class="menuitemgroup">
<div class="menuitem">
<a href="docs/specs/namespaces.html">Namespaces</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.3')" id="menu_1.1.4.3Title" class="menutitle">Miscellaneous</div>
<div id="menu_1.1.4.3" class="menuitemgroup">
<div class="menuitem">
<a href="docs/misc/coding-guidelines.html">Coding Guidelines</a>
</div>
<div class="menuitem">
<a href="docs/misc/unittests.html">Unit Tests</a>
</div>
<div class="menuitem">
<a href="docs/misc/xinclude-processor.html">XInclude Processor</a>
</div>
</div>
<div class="menuitem">
<a href="apidocs/index.html">API (Javadoc)</a>
</div>
</div>
</div>
</div>
</td>
</tr>
<tr>
<td></td><td>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="border bottom-left"></td><td class="border bottomborder"></td><td class="border bottom-right"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="2" height="10"></td>
</tr>
</table>
</td><td width="100%" valign="top">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td class="subborder trail">
	         &nbsp;<a href="http://www.apache.org/">apache</a> &gt; <a href="http://cocoon.apache.org/">cocoon</a><script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>&nbsp;
          </td><td nowrap="true" align="right" class="subborder trail"></td>
</tr>
<tr>
<td colspan="2" align="left">
<div class="content">
<table class="title">
<tr>
<td valign="middle">
<h1>Lenya: Whole documentation</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="docu.pdf"><img alt="PDF" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a></td>
</tr>
</table>
<ul class="minitoc">
<li>
<a href="#Documentation">Documentation</a>
<ul class="minitoc">
<li>
<a href="#docs/index.html">Apache Lenya Documentation</a>
</li>
<li>
<a href="#Integrator%2FDev+Guide">Integrator/Dev Guide</a>
<ul class="minitoc">
<li>
<a href="#Components">Components</a>
<ul class="minitoc">
<li>
<a href="#docs/components/index.html">Hello Forrest</a>
</li>
<li>
<a href="#Access%A0Control">Access&nbsp;Control</a>
</li>
<li>
<a href="#Deployment">Deployment</a>
</li>
<li>
<a href="#Editors">Editors</a>
</li>
<li>
<a href="#Layout">Layout</a>
</li>
<li>
<a href="#Publication">Publication</a>
</li>
<li>
<a href="#Revision+Control">Revision Control</a>
</li>
<li>
<a href="#Repository">Repository</a>
</li>
<li>
<a href="#Search">Search</a>
</li>
<li>
<a href="#URI+Handling">URI Handling</a>
</li>
<li>
<a href="#Asset+Management">Asset Management</a>
</li>
<li>
<a href="#Link+Management">Link Management</a>
</li>
<li>
<a href="#Meta+Data">Meta Data</a>
</li>
<li>
<a href="#Multilingual+Documents">Multilingual Documents</a>
</li>
<li>
<a href="#Tasks">Tasks</a>
</li>
<li>
<a href="#Workflow">Workflow</a>
</li>
<li>
<a href="#Site+Management">Site Management</a>
</li>
</ul>
</li>
<li>
<a href="#Specifications">Specifications</a>
<ul class="minitoc">
<li>
<a href="#docs/specs/namespaces.html">Namespaces</a>
</li>
</ul>
</li>
<li>
<a href="#Miscellaneous">Miscellaneous</a>
<ul class="minitoc">
<li>
<a href="#docs/misc/coding-guidelines.html">Apache Lenya Coding Guidelines</a>
</li>
<li>
<a href="#docs/misc/unittests.html">Writing Unit Tests</a>
</li>
<li>
<a href="#docs/misc/xinclude-processor.html">XInclude Processor</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<a name="N10007"></a><a name="Documentation"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h3">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h3>Documentation</h3>
</td><td></td>
</tr>
<tr class="heading ">
<td class="bottom-left"></td><td class="bottomborder"></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<div class="section">
<a name="N1000B"></a><a name="docs/index.html"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>Apache Lenya Documentation</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<p>In getting started with Lenya, one must learn not only a number of concepts, but a number of 
details as well. The Components section will explain the building blocks that make up Lenya, such as the sitemap, publications, and tasks.</p>
<p>
More documentation (work in progress) can be found at the <a class="external" href="http://wiki.cocoondev.org/Wiki.jsp?page=Lenya">Cocoon Wiki</a>.
</p>
<a name="N1001D"></a><a name="Integrator%2FDev+Guide"></a>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="h4">
<tbody>
<tr>
<td height="10" width="9"></td><td>
<h4>Integrator/Dev Guide</h4>
</td><td></td>
</tr>
<tr class="subheading">
<td class="bottom-left"></td><td></td><td class="bottom-right"></td>
</tr>
</tbody>
</table>
<a name="N10021"></a><a name="Components"></a>
<h4>Components</h4>
<a name="N10026"></a><a name="docs/components/index.html"></a>
<h5>Hello Forrest</h5>
<a name="N1002E"></a><a name="Forrest+as+a+Lenya+Publication"></a>
<h5>Forrest as a Lenya Publication</h5>
<p>Thanks to Gregor, Andreas and Christian we now have Forrest as a Lenya publication.</p>
<p>Click on the menu "File" and then click on the item "Edit with Xopus2" to edit this page.</p>
<a name="N1003B"></a><a name="Access%A0Control"></a>
<h5>Access&nbsp;Control</h5>
<a name="N10040"></a><a name="docs/components/accesscontrol/terms.html"></a>
<h5>Basic Terms</h5>
<a name="N10048"></a><a name="Role"></a>
<h5>Role</h5>
<p>
<em>Role</em>s are the connection between access control and CMS functionality. On
		the access control side, you assign <em>Role</em>s to users, IP address ranges and
		groups at certain URL spaces. On the CMS side, you define which <em>Role</em>s are
		needed to execute certain usecases and workflow transitions. If the client has a certain
		<em>Role</em>, this means he is allowed to do something.</p>
<p>Each <em>Role</em> has a unique name. Role names can be arbitrary strings. Examples are</p>
<ul>
		
<li>author</li>
		
<li>reviewer</li>
		
<li>admin</li>
	
</ul>
<p>Another common approach and useful is to use verbs as role names:</p>
<ul>
		
<li>edit</li>
		
<li>review</li>
		
<li>administrate</li>
	
</ul>
<a name="N1007E"></a><a name="Identifiable"></a>
<h5>Identifiable</h5>
<p>An <em>Identifiable</em> is a characteristic of the client that can be identified.
		Every <em>Identifiable</em> is <em>Accreditable</em>. Lenya currently supports the following
		<em>Identifiable</em>s:</p>
<ul>
		
<li>users</li>
		
<li>machines</li>
		
<li>the world (this idenitifiable is assigned to every client that tries to
			access the system)</li>
	
</ul>
<a name="N100A0"></a><a name="Identity"></a>
<h5>Identity</h5>
<p>An <em>Identity</em> is the collection of all <em>Identifiable</em>s
	  that have access to the
		system in the current session. The <em>Identity</em> always contains the world and
		the machine that produced the request. If you logged in, the user is also
		contained in the <em>Identity</em>.</p>
<p>For instance, if you log in from the machine 192.168.0.16 as the user john,
		the <em>Identity</em> of the client contains</p>
<ul>
    
<li>the machine 192.168.0.16,</li>
    
<li>the user john, and</li>
    
<li>the world.</li>
  
</ul>
<a name="N100C7"></a><a name="Accreditable"></a>
<h5>Accreditable</h5>
<p>An <em>Accreditable</em> can be accredited with <em>Role</em>s in <em>Policies</em>.
	Lenya currently supports the following <em>Accreditable</em>s:</p>
<ul>
		
<li>users</li>
		
<li>machines (accredition not implemented, use IP ranges instead)</li>
		
<li>IP address ranges</li>
		
<li>the world</li>
		
<li>groups</li>
	
</ul>
<a name="N100EE"></a><a name="Credential"></a>
<h5>Credential</h5>
<p>A <em>Credential</em> assigns a set of <em>Role</em>s to an <em>Accreditable</em>, e.g.:</p>
<ul>
		
<li>
<span class="codefrag">news_editors: editor, reviewer</span>
<br> means "The group 
			<span class="codefrag">news_editors</span> has the <em>Role</em>s <span class="codefrag">editor</span> and <span class="codefrag">
			reviewer</span>."</li>
	
</ul>
<a name="N10116"></a><a name="Policy"></a>
<h5>Policy</h5>
<p>A <em>Policy</em> defines a set of <em>Credential</em>s for a certain URL. It has the
		responsibility to return all <em>Role</em>s of an <em>Accreditable</em> at a certain URL.</p>
<p>If for instance the <em>Policy</em> for the URL /tv/news contains the <em>Credential</em>s</p>
<ul>
		
<li>
			
<span class="codefrag">news_editors: editor, reviewer</span>
		
</li>
		
<li>
			
<span class="codefrag">john: admin</span>
		
</li>
		
<li>
			
<span class="codefrag">192.168.0.72: visitor</span>
		
</li>
	
</ul>
<p>and user <span class="codefrag">john</span> belongs to the group <span class="codefrag">news_editors</span> 
		and has logged in from the machine <span class="codefrag">192.168.0.72</span>, the <em>Policy</em>
		returns the <em>Role</em>s <span class="codefrag">editor, reviewer, admin, visitor</span> for the
		<em>Accreditable</em> <span class="codefrag">john</span>.</p>
<p>A <em>Policy</em> may not contain invalid <em>Accreditable</em>s.
	  E.g., if a user is deleted
		and another user with the same ID is created, he may not get the same
		privileges as the former one.</p>
<a name="N1016F"></a><a name="docs/components/accesscontrol/accesscontrollers.html"></a>
<h5>Access Controllers</h5>
<a name="N10177"></a><a name="Introduction"></a>
<h5>Introduction</h5>
<p>An <em>AccessController</em> has the responsibility to authenticate
	  clients and to authorize requests.</p>
<a name="N10184"></a><a name="Defining+the+Role+in+lenya.roles"></a>
<h5>Defining the Role in lenya.roles</h5>
<pre class="code">&lt;role name="org.apache.lenya.ac.AccessController"
    shorthand="access-controller"
    default-class="org.apache.lenya.ac.impl.BypassableAccessController"/&gt;</pre>
<a name="N1018F"></a><a name="Declaring+an+AccessController+in+cocoon.xconf"></a>
<h5>Declaring an AccessController in cocoon.xconf</h5>
<p>
		Each <em>AccessController</em> component needs a type that is attached to the
		<span class="codefrag">role</span> attribute, separated with a slash (/). This allows you to choose an
		<em>AccessController</em> in your publication in combination with the
		Publication<a href="#accesscontrollerresolvers.html">AccessControllerResolver</a>.
		The following example shows the declaration of an <em>AccessController</em> with
		the type <em>bypassable</em>:
	</p>
<pre class="code">&lt;component logger="lenya.ac.accesscontroller.bypassable"
    class="org.apache.lenya.ac.impl.BypassableAccessController"
    role="org.apache.lenya.ac.AccessController/bypassable"&gt;
    ...
&lt;/component&gt;</pre>
<a name="N101B0"></a><a name="Default+Access+Controller"></a>
<h5>Default Access Controller</h5>
<p>The <em>DefaultAccessController</em> combines an
			<a href="#authenticators.html">Authenticator</a>, a set of
			<a href="#authorizers.html">Authorizers</a>, an
			<a href="#accreditablemanagers.html">AccreditableManager</a> and a
			<a href="#policymanagers.html">PolicyManager</a> to perform these tasks.</p>
<pre class="code">&lt;component logger="lenya.ac.accesscontroller.default"
    class="org.apache.lenya.ac.impl.DefaultAccessController"
    role="org.apache.lenya.ac.AccessController/default"/&gt;</pre>
<a name="N101D1"></a><a name="Bypassable+Access+Controller"></a>
<h5>Bypassable Access Controller</h5>
<p>The <em>BypassableAccessController</em> is a <em>DefaultAccessController</em> that can be
		bypassed for certain URL patterns. For URLs that match those patterns
		(regular expressions), access is granted for free.</p>
<p>
				The <em>BypassableAccessController</em>
				allows the definition of a regular expression for the public URL
				patterns:
			</p>
<pre class="code">&lt;component logger="lenya.ac.accesscontroller.bypassable"
    class="org.apache.lenya.ac.impl.BypassableAccessController"
    role="org.apache.lenya.ac.AccessController/bypassable"&gt;
  &lt;public&gt;.*[.]css|.*[.]jpg|.*[.]gif&lt;/public&gt;
&lt;/component&gt;</pre>
<a name="N101EC"></a><a name="docs/components/accesscontrol/accesscontrollerresolvers.html"></a>
<h5>Access Controller Resolvers</h5>
<a name="N101F4"></a><a name="Introduction-N101F4"></a>
<h5>Introduction</h5>
<p>
	In Lenya, the <em>AccessController</em> is chosen dynamically,
	depending on the requested URL.
	An <em>AccessControllerResolver</em> resolves the appropriate
	<em>AccessController</em> for a URL.</p>
<a name="N10207"></a><a name="Defining+the+Roles+in+lenya.roles"></a>
<h5>Defining the Roles in lenya.roles</h5>
<p>To obtain an <em>AccessControllerResolver</em>, the <em>AccessControllerResolverSelector</em> is
		used. A component which wants to obtain an <em>AccessController</em> asks the
		selector for the <em>ComposableAccessControllerResolver</em>.
		The <em>ComposableAccessControllerResolver</em> itself uses the
		selector to obtain its child <em>AccessControllerResolver</em>s.
		</p>
<pre class="code">&lt;role name="org.apache.lenya.ac.AccessControllerResolverSelector"
    shorthand="access-controller-resolvers"
    default-class="org.apache.avalon.excalibur.component.ExcaliburComponentSelector"&gt;
  &lt;hint shorthand="configurable"
      class="org.apache.lenya.ac.impl.ConfigurableAccessControllerResolver"/&gt;
  &lt;hint shorthand="publication"
      class="org.apache.lenya.cms.ac.PublicationAccessControllerResolver"/&gt;
  &lt;hint shorthand="composable"
      class="org.apache.lenya.ac.impl.ComposableAccessControllerResolver"/&gt;
&lt;/role&gt;</pre>
<a name="N10227"></a><a name="Declaring+the+Access+Controller+Resolvers+in+cocoon.xconf"></a>
<h5>Declaring the Access Controller Resolvers in cocoon.xconf</h5>
<pre class="code">&lt;access-controller-resolvers&gt;
  &lt;component-instance logger="lenya.ac.accesscontrollerresolver.publication"
    class="org.apache.lenya.cms.ac.PublicationAccessControllerResolver"
    name="publication"&gt;
  &lt;/component-instance&gt;
  &lt;component-instance logger="lenya.ac.accesscontrollerresolver.global"
    class="org.apache.lenya.ac.impl.ConfigurableAccessControllerResolver"
    name="global"&gt;
    &lt;access-controller type="global"/&gt;
  &lt;/component-instance&gt;
  &lt;component-instance logger="lenya.ac.accesscontrollerresolver.composable"
    class="org.apache.lenya.ac.impl.ComposableAccessControllerResolver"
    name="composable"&gt;
    &lt;resolver type="publication"/&gt;
    &lt;resolver type="global"/&gt;
  &lt;/component-instance&gt;
&lt;/access-controller-resolvers&gt;</pre>
<a name="N10232"></a><a name="Publication+Access+Controller+Resolver"></a>
<h5>Publication Access Controller Resolver</h5>
<p>The <em>PublicationAccessControllerResolver</em> looks for a <span class="codefrag">config/ac.xconf</span>
    file inside the publication. If you want to use multiple <em>AccessController</em>s
    within your Lenya installation, just declare them in the <span class="codefrag">
    cocoon-xconf.xsl</span> file and choose the type in the <span class="codefrag">config/ac.xconf</span> file.
    The <span class="codefrag">type</span> attribute selects an <em>AccessController</em>
    from the definitions in <span class="codefrag">cocoon.xconf</span>.
  </p>
<p>
		You have to configure the complete <em>AccessController</em> in this file. For instance,
		if you want to use a <em>BypassableAccessController</em> together with
		a certain set of components, you declare it as follows:</p>
<pre class="code">&lt;?xml version="1.0"?&gt;
&lt;access-controller type="bypassable"&gt;
  
  &lt;accreditable-manager type="file"&gt;
    &lt;parameter name="directory"
        value="context:///lenya/pubs/mypub/config/ac/passwd"/&gt;
  &lt;/accreditable-manager&gt;
  
  &lt;policy-manager type="document"&gt;
    &lt;policy-manager type="file"&gt;
      &lt;parameter name="directory"
          value="context:///lenya/pubs/mypub/config/ac/policies"/&gt;
    &lt;/policy-manager&gt;
  &lt;/policy-manager&gt;
  
  &lt;authorizer type="policy"/&gt;
  
  &lt;authorizer type="usecase"&gt;
    &lt;parameter name="configuration"
        value="context:///lenya/pubs/default/config/ac/usecase-policies.xml"/&gt;
  &lt;/authorizer&gt;
  
  &lt;authorizer type="workflow"/&gt;
  
&lt;/access-controller&gt;
</pre>
<a name="N10261"></a><a name="Configurable+Access+Controller+Resolver"></a>
<h5>Configurable Access Controller Resolver</h5>
<p>The <em>ConfigurableAccessControllerResolver</em> can be configured with an
		<em>AccessController</em> directly inside <span class="codefrag">cocoon.xconf</span>:</p>
<pre class="code">&lt;component-instance logger="lenya.ac.accesscontrollerresolver"
    class="org.apache.lenya.ac.impl.ConfigurableAccessControllerResolver"
    name="global"&gt;
  &lt;access-controller type="global"/&gt;
&lt;/component-instance&gt; </pre>
<a name="N10278"></a><a name="Composable+Access+Controller+Resolver"></a>
<h5>Composable Access Controller Resolver</h5>
<p>The <em>ComposableAccessControllerResolver</em> is configured with a list of
		<em>AccessControllerResolver</em>s. Each one of these resolvers is invoked until one
		is successful. If no resolver finds an <em>AccessController</em>, the
		<em>ComposableAccessControllerResolver</em> returns <span class="codefrag">null</span>.</p>
<pre class="code">&lt;component-instance logger="lenya.ac.accesscontrollerresolver"
    class="org.apache.lenya.ac.impl.ComposableAccessControllerResolver"
    name="composable"&gt;
  &lt;resolver type="publication"/&gt;
  &lt;resolver type="global"/&gt;
&lt;/component-instance&gt;</pre>
<a name="N10296"></a><a name="docs/components/accesscontrol/authenticators.html"></a>
<h5>Authenticators</h5>
<a name="N1029E"></a><a name="Introduction-N1029E"></a>
<h5>Introduction</h5>
<p>
	An authenticator is used to identify a client.
	It is supposed to setup the <em>Identity</em> object which is attached
	to the session.
	</p>
<a name="N102AB"></a><a name="Declaring+the+Roles+in+lenya.roles"></a>
<h5>Declaring the Roles in lenya.roles</h5>
<pre class="code">&lt;role name="org.apache.lenya.ac.Authenticator"
    shorthand="authenticator"
    default-class="org.apache.lenya.ac.impl.UserAuthenticator"/&gt;</pre>
<a name="N102B6"></a><a name="The+UserAuthenticator"></a>
<h5>The UserAuthenticator</h5>
<p>The <em>UserAuthenticator</em> uses the request parameters</p>
<ul>
			
<li>
<span class="codefrag">username</span> and</li>
			
<li>
<span class="codefrag">password</span>
</li>
		
</ul>
<p>to authenticate or reject a user. It is configured in <span class="codefrag">cocoon.xconf</span>
		as follows:</p>
<pre class="code">&lt;component logger="lenya.ac.authenticator"
    class="org.apache.lenya.ac.impl.UserAuthenticator"
    role="org.apache.lenya.ac.Authenticator"/&gt;</pre>
<p>
      When a valid username/password combination is entered, the previous
      user is removed from the session <em>Identity</em> object
      and the current user is added.
    </p>
<a name="N102E0"></a><a name="docs/components/accesscontrol/authorizers.html"></a>
<h5>Authorizers</h5>
<a name="N102E8"></a><a name="Introduction-N102E8"></a>
<h5>Introduction</h5>
<p>An <em>Authorizer</em> checks if an <em>Identity</em> is authorized
	to invoke a certain request.
	</p>
<p>
	The <em>DelegatingAuthorizerAction</em> tries to
	resolve an <em>AccessController</em> for the URL. If an <em>AccessController</em>
	could be resolved, its <span class="codefrag">authorize(Request)</span> method is used to authorize the request.
	If no <span class="codefrag">AccessController</span> could be found, the access to the request
	is granted for free.</p>
<p>
	  The <em>DefaultAccessController</em> delegates the authorization to its
	  <em>Authorizer</em>s. Only when all <em>Authorizer</em>s return <span class="codefrag">true</span>,
	  the request is authorized.
	</p>
<a name="N10319"></a><a name="PolicyAuthorizer"></a>
<h5>PolicyAuthorizer</h5>
<p>A <em>PolicyAuthorizer</em> uses <em>Policies</em> for authorizing. It returns <span class="codefrag">true</span>,
		when the current <em>Identity</em> has at least one <em>Role</em> for the requested URL.</p>
<a name="N10332"></a><a name="UsecaseAuthorizer"></a>
<h5>UsecaseAuthorizer</h5>
<p>This <em>Authorizer</em> looks for the <span class="codefrag">lenya.usecase</span> request
			parameter and checks the usecase policy file for the <em>Role</em>s that are
			allowed to execute this usecase. The location of this file is defined
			using the <span class="codefrag">configuration</span> parameter which points to a URL:</p>
<pre class="code">&lt;authorizer type="usecase"&gt;
  &lt;parameter name="configuration"
      value="context:///lenya/pubs/mypub/config/ac/usecase-policies.xml"/&gt;
&lt;/authorizer&gt;</pre>
<p>The usecase policy file might look as follows:</p>
<pre class="code">&lt;?xml version="1.0"?&gt;
&lt;usecases xmlns="http://apache.org/cocoon/lenya/ac/1.0"&gt;
  &lt;usecase id="create"&gt;
    &lt;role id="editor"/&gt;
  &lt;/usecase&gt;
  &lt;usecase id="rename"&gt;
    &lt;role id="editor"/&gt;
  &lt;/usecase&gt;
&lt;/usecases&gt;</pre>
<a name="N10353"></a><a name="WorkflowAuthorizer"></a>
<h5>WorkflowAuthorizer</h5>
<p>The <em>WorkflowAuthorizer</em> is responsible for protecting workflow
			transitions. Therefore it</p>
<ul>
			
<li>looks for the <span class="codefrag">lenya.event</span> request parameter,</li>
			
<li>determines the current state of the workflow instance, and</li>
			
<li>checks if the event may be invoked by one of the current <em>Role</em>s in this
				state.</li>
		
</ul>
<p>The <em>WorkflowAuthorizer</em> has no configuration options:</p>
<pre class="code">&lt;authorizer type="workflow"/&gt;</pre>
<a name="N1037D"></a><a name="docs/components/accesscontrol/policymanagers.html"></a>
<h5>Policies and Policy Managers</h5>
<a name="N10385"></a><a name="Policies"></a>
<h5>Policies</h5>
<p>
  A <span class="codefrag">Policy</span> assigns <span class="codefrag">Role</span>s to <span class="codefrag">Accreditable</span>s.
</p>
<p>
  There is a common policy definition XML schema which is handled by the
  <span class="codefrag">PolicyBuilder</span>. It can be used together with the
  <span class="codefrag">FilePolicyManager</span> and the <span class="codefrag">SitemapPolicyManager</span>.
</p>
<p>Here is an example of a policy definition:</p>
<pre class="code">
&lt;policy xmlns="http://apache.org/cocoon/lenya/ac/1.0"&gt;

  &lt;user id="lenya"&gt;
    &lt;role id="editor"/&gt;
    &lt;role id="reviewer"/&gt;
  &lt;/group&gt;

  &lt;group id="reviewer"&gt;
    &lt;role id="reviewer"/&gt;
  &lt;/group&gt;
  
  &lt;ip-range id="localhost"&gt;
    &lt;role id="editor"/&gt;
  &lt;/ip-range&gt;
  
  &lt;world&gt;
    &lt;role id="visitor"/&gt;
  &lt;/world&gt;

&lt;/policy&gt; 
</pre>
<a name="N103AA"></a><a name="Policy+Managers"></a>
<h5>Policy Managers</h5>
<p>A <em>PolicyManager</em> is used to resolve the policy for a certain URL.
	Lenya ships with the following <em>PolicyManager</em>s:</p>
<a name="N103BA"></a><a name="Inheriting+Policy+Manager"></a>
<h5>Inheriting Policy Manager</h5>
<p>This is an abstract base class. It merges the policies
		  of all steps in the URL. For each
			URL, a <em>url policy</em> and a <em>subtree policy</em> can be defined.
			The <em>InheritingPolicyManager</em> adds the credentials of</p>
<ul>
			
<li>the subtree policies for all parent directories of the requested page,</li>
			
<li>the subtree policy of the requested page, and</li>
			
<li>the url policy of the requested page.</li>
		
</ul>
<p>For instance, if the URL is <span class="codefrag">/lenya/news/index.html</span>, the
			following policies are merged:</p>
<ul>
			
<li>subtree policy of <span class="codefrag">/</span>
</li>
			
<li>subtree policy of <span class="codefrag">/lenya</span>
</li>
			
<li>subtree policy of <span class="codefrag">/lenya/news</span>
</li>
			
<li>subtree policy of <span class="codefrag">/lenya/news/index.html</span>
</li>
			
<li>url policy of <span class="codefrag">/lenya/news/index.html</span>
</li>
		
</ul>
<a name="N103FB"></a><a name="File+Policy+Manager"></a>
<h5>File Policy Manager</h5>
<p>The <em>FilePolicyManager</em> is an <em>InheritingPolicyManager</em>.
		The policies are defined by policy files that are arranged as a
		directory tree that reflects the URI space, e.g.:
			</p>
<pre class="code">/subtree-policy.acml
/lenya/subtree-policy.acml
/lenya/news/index.html/subtree-policy.acml
/lenya/news/index.html/url-policy.acml</pre>
<p>If a certain policy file does not exist (like /lenya/news in the above example), an empty policy is used instead.</p>
<p>The <em>FilePolicyManager</em> needs a <span class="codefrag">directory</span> parameter
			which contains a URL pointing to the policies directory:</p>
<pre class="code">&lt;policy-manager type="file"&gt;
  &lt;parameter name="directory"
      value="context:///lenya/pubs/mypub/config/ac/policies"/&gt;
&lt;/policy-manager&gt;</pre>
<a name="N1041F"></a><a name="Document+Policy+Manager+Wrapper"></a>
<h5>Document Policy Manager Wrapper</h5>
<p>This <em>InheritingPolicyManager</em> subclass is used together with another
  		<em>InheritingPolicyManager.</em>
		  It is able to apply a single policy to all versions of a document
		  (languages, print version, ...). E.&nbsp;g., if you define
		</p>
<ul>
<li>
<span class="codefrag">/foo/bar/subtree-policy.xml</span>
</li>
</ul>
<p>
		  and you use the <em>DefaultDocumentBuilder</em>,
		  this policy is applied to the URLs
		</p>
<ul>
		  
<li>
<span class="codefrag">/foo/bar.html</span>
</li>
		  
<li>
<span class="codefrag">/foo/bar_de.html</span>
</li>
		  
<li>
<span class="codefrag">/foo/bar_en.print.html</span>
</li>
		  
<li>...</li>
		
</ul>
<p>To configure the <em>DefaultDocumentBuilder</em>, just put the
		declaration of the wrapped <em>PolicyManager</em> inside the
		<em>DefaultDocumentBuilder</em> declaration:</p>
<pre class="code">&lt;policy-manager type="document"&gt;
  &lt;policy-manager type="file"&gt;
    &lt;parameter name="directory"
        value="context:///lenya/pubs/mypub/config/ac/policies"/&gt;
  &lt;/policy-manager&gt;
&lt;/policy-manager&gt;</pre>
<a name="N1045C"></a><a name="Sitemap+Policy+Manager"></a>
<h5>Sitemap Policy Manager</h5>
<p>The <em>SitemapPolicyManager</em> uses the policy sitemap to resolve the policy
			for a certain URL. For this purpose it sends a request of the form
    </p>
<pre class="code">cocoon://{publication-id}/policies{url}.acml

Example:
cocoon://mypub/policies/authoring/foo/bar_de.html.acml
</pre>
<p>
			which is processed by <span class="codefrag">global-sitemap.xmap</span> and forwarded
			to <span class="codefrag">lenya/pubs/{publication-id}/policies-sitemap.xmap</span>.
			The request is supposed to return a valid policy XML document.
	</p>
<p>The configuration of the <em>SitemapPolicyManager</em> is very simple:</p>
<pre class="code">&lt;policy-manager type="sitemap"/&gt;</pre>
<a name="N10481"></a><a name="docs/components/accesscontrol/accreditablemanagers.html"></a>
<h5>Accreditable Managers</h5>
<a name="N10489"></a><a name="Introduction-N10489"></a>
<h5>Introduction</h5>
<p>
			An <em>AccreditableManager</em> combines a <em>UserManager</em>,
			a <em>GroupManager</em>, an <em>IPRangeManager</em> and a <em>RoleManager</em>.</p>
<a name="N104A2"></a><a name="UserManager"></a>
<h5>UserManager</h5>
<p>A UserManager manages users.</p>
<a name="N104AC"></a><a name="GroupManager"></a>
<h5>GroupManager</h5>
<p>A GroupManager manages groups.</p>
<a name="N104B6"></a><a name="IPRangeManager"></a>
<h5>IPRangeManager</h5>
<p>A IPRangeManager manages IP address rangess.</p>
<a name="N104C0"></a><a name="RoleManager"></a>
<h5>RoleManager</h5>
<p>A RoleManager manages <em>Role</em>s.</p>
<a name="N104CE"></a><a name="docs/components/accesscontrol/ssl.html"></a>
<h5>SSL Encryption</h5>
<a name="N104D6"></a><a name="Introduction-N104D6"></a>
<h5>Introduction</h5>
<p>Pages or subtrees within Lenya can be protected by <em>SSL Encryption</em>. This allows you to protect 
	    these parts of your site that need it. Note that <em>SSL Encryption</em> is independent of 
	    <em>Authorization</em>. This means that you may have SSL-encrypted pages with or without access control.
	</p>
<p>In a typical setup, you would have Apache HTTPd handle the SSL encryption and forward requests to Tomcat
	    as appropriate. This allows considerable flexibility with your setup, as you can make your SSL-encrypted
	    pages appear at a different location than the rest of your content. The setup here will explain you
	    how to achieve this.
	</p>
<a name="N104EC"></a><a name="Enabling+SSL+Encryption"></a>
<h5>Enabling SSL Encryption</h5>
<p>To enable <em>SSL Encryption</em> for a subtree or a page, go to the <em>AC Live</em> 
		    or <em>AC Authoring</em> tabs in the Site area, and check the box that says <em>SSL Encryption</em>.</p>
<a name="N10503"></a><a name="docs/components/accesscontrol/faq.html"></a>
<h5>Access Control FAQ</h5>
<a name="N1050A"></a><a name="docs/components/accesscontrol/faq.html#Questions"></a>
<h5>Questions</h5>
<a name="N1050E"></a><a name="docs/components/accesscontrol/faq.html#part-N1000E"></a>
<h5>1. Customizing Access Control</h5>
<a name="N10512"></a><a name="docs/components/accesscontrol/faq.html#faq-N10012"></a>
<h5>1.1. How can I store my users in a database?</h5>
<p>You have to implement a <em>UserManager</em> wich accesses the
database to obtain the user information. Additionally, you have to
implement an <em>AccreditableManager</em> which uses this <em>UserManager</em>.
This <em>AccreditableManager</em> has to be declared in <span class="codefrag">cocoon.xconf</span>
and assigned to your <em>AccessController</em> in <span class="codefrag">lenya/pubs/mypub/config/ac/ac.xconf</span>.
</p>
<a name="N10531"></a><a name="Deployment"></a>
<h5>Deployment</h5>
<a name="N10536"></a><a name="docs/components/deployment/mod_proxy.html"></a>
<h5>Reverse Proxying Apache Lenya</h5>
<a name="N1053E"></a><a name="Apache+2%3A+Enabling"></a>
<h5>Apache 2: Enabling</h5>
<p>
To enable mod_proxy for Apache 2: 
</p>
<pre class="code">

./configure --prefix=/usr/local/httpd-2.0.48 --enable-proxy
make
make install
/usr/local/httpd-2.0.48/bin/httpd -l

</pre>
<a name="N1054E"></a><a name="Apache+1%3A+Enabling"></a>
<h5>Apache 1: Enabling</h5>
<p>
To enable mod_proxy for Apache 1: 
</p>
<pre class="code">

./configure --prefix=/usr/local/apache_1.3.27 --enable-module=proxy
make
make install
/usr/local/apache_1.3.27/bin/httpd -l

</pre>
<a name="N1055C"></a><a name="Configuration"></a>
<h5>Configuration</h5>
<p>In order to run a Lenya site dynamically, add the following to your Apache httpd.conf file 
after making sure that you have the mod_proxy module installed:</p>
<pre class="code">

&lt;VirtualHost 192.168.1.13&gt;
    ServerName 192.168.1.13
    ServerAdmin lenya@cocoon.apache.org
    DocumentRoot /home/lenya/build/apache_1.3.24/htdocs
    ProxyPass          / http://192.168.1.13:8080/lenya/blog/live/
    ProxyPassReverse   / http://192.168.1.13:8080/lenya/blog/live/
    ErrorLog logs/blog-error_log
    CustomLog logs/blog-access_log common
&lt;/VirtualHost&gt;

</pre>
<a name="N1056A"></a><a name="Related+Links"></a>
<h5>Related Links</h5>
<p>

<a class="external" href="http://wiki.apache.org/cocoon/ApacheModProxy">http://wiki.apache.org/cocoon/ApacheModProxy</a>

</p>
<a name="N1057A"></a><a name="Editors"></a>
<h5>Editors</h5>
<a name="N1057F"></a><a name="docs/components/editors/htmlform.html"></a>
<h5>Forms Editor</h5>
<a name="N10587"></a><a name="XUpdate"></a>
<h5>XUpdate</h5>
<p>The Forms Editor is using the <a class="external" href="http://xmldb.org/xupdate/xupdate-wd.html">XUpdate specification</a> from the xmldb group to update elements and attributes. 
You can test-drive the XUpdate engine in Lenya by doing the following:</p>
<pre class="code">

java -classpath lib/xmldb-common-2003-09-02.jar:lib/xmldb-xupdate-2003-09-02.jar:lib/log4j-1.2.8.jar:build/lenya/webapp/WEB-INF/lib/xercesImpl-2.4.0.jar:build/lenya/webapp/WEB-INF/lib/xalan-2.5.1.jar org.xmldb.xupdate.lexus.XUpdateQueryImpl xupdate.xml entry.xml

</pre>
<a name="N10599"></a><a name="Customization"></a>
<h5>Customization</h5>
<p>Customization of the Forms Editor is done with stylesheets. You need to have one stylesheet for each doctype. The
stylesheet goes into <span class="codefrag">lenya/xslt/formeditor/mydoctype.xsl</span>. A simple stylesheet may look like</p>
<pre class="code">

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
                                                                
&lt;xsl:stylesheet version="1.0"  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;

&lt;xsl:import href="../../../../../xslt/authoring/edit/form.xsl"/&gt;

&lt;xsl:template match="sidebar"&gt;
 &lt;xsl:apply-templates select="block"/&gt;

  &lt;node name="Add Block"&gt;
    &lt;action&gt;&lt;insert name="&amp;lt;xupdate:append select=&amp;quot;/sidebar&amp;quot;&amp;gt;&amp;lt;xupdate:element name=&amp;quot;block&amp;quot;&amp;gt;&amp;lt;title&amp;gt;New title&amp;lt;/title&amp;gt;&amp;lt;content&amp;gt;New content&amp;lt;/content&amp;gt;&amp;lt;/xupdate:element&amp;gt;&amp;lt;/xupdate:append&amp;gt;"/&gt;&lt;/action&gt;
  &lt;/node&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="block"&gt;
  &lt;node name="Add Block"&gt;
    &lt;action&gt;&lt;insert name="&amp;lt;xupdate:insert-before select=&amp;quot;/sidebar/block[@tagID='{@tagID}']&amp;quot;&amp;gt;&amp;lt;xupdate:element name=&amp;quot;block&amp;quot;&amp;gt;&amp;lt;title&amp;gt;New title&amp;lt;/title&amp;gt;&amp;lt;content&amp;gt;New content&amp;lt;/content&amp;gt;&amp;lt;/xupdate:element&amp;gt;&amp;lt;/xupdate:insert-before&amp;gt;"/&gt;&lt;/action&gt;
  &lt;/node&gt;
  &lt;node name="Delete Block"&gt;
    &lt;action&gt;&lt;delete name="&amp;lt;xupdate:remove select=&amp;quot;/sidebar/block[@tagID='{@tagID}']&amp;quot;/&amp;gt;"/&gt;&lt;/action&gt;
  &lt;/node&gt;
  &lt;node name="Title" select="/sidebar/block/title[@tagID='{title/@tagID}']"&gt;
    &lt;content type="plain"&gt;&lt;input type="text" name="&amp;lt;xupdate:update select=&amp;quot;/sidebar/block/title[@tagID='{title/@tagID}']&amp;quot;&amp;gt;" size="40"&gt;&lt;xsl:attribute name="value"&gt;&lt;xsl:value-of select="title"/&gt;&lt;/xsl:attribute&gt;&lt;/input&gt;&lt;/content&gt;
  &lt;/node&gt;
  &lt;node name="Content" select="/sidebar/block/content[@tagID='{content/@tagID}']"&gt;
    &lt;content type="mixed"&gt;
      &lt;textarea name="&amp;lt;xupdate:update select=&amp;quot;/sidebar/block/content[@tagID='{content/@tagID}']&amp;quot;&amp;gt;" cols="40" rows="3"&gt;
        &lt;xsl:copy-of select="content/node()"/&gt;
      &lt;/textarea&gt;
    &lt;/content&gt;
 &lt;/node&gt; 
&lt;/xsl:template&gt;
 
&lt;/xsl:stylesheet&gt;

</pre>
<a name="N105A9"></a><a name="Editing+attributes"></a>
<h5>Editing attributes</h5>
<p>To add editing of attributes, you need to change the XPath and XUpdate statements to select the attribute:</p>
<pre class="code">

&lt;xsl:template match="xhtml:table"&gt;
  &lt;node name="Background Color" select="/*/xhtml:table[@tagID='{@tagID}']/@class"&gt;
    &lt;content&gt;
      &lt;textarea name="&amp;lt;xupdate:update select=&amp;quot;/*/xhtml:table[@tagID='{@tagID}']/@class&amp;quot;&amp;gt;" cols="40" rows="2"&gt;
        &lt;xsl:value-of select="@class"/&gt;
      &lt;/textarea&gt;
    &lt;/content&gt;
  &lt;/node&gt;
&lt;/xsl:template&gt;

</pre>
<a name="N105B8"></a><a name="docs/components/editors/1form.html"></a>
<h5>HTML One Form Editor</h5>
<a name="N105C0"></a><a name="Integration"></a>
<h5>Integration</h5>
<p>In order to make an XML document editable by the One Form Editor, one needs to add a menu item as follows:</p>
<pre class="code">

  &lt;menus&gt;
    &lt;menu name="File" label="File"&gt;
      &lt;block&gt;
        &lt;item uc:usecase="1formedit" href="?lenya.step=open"&gt;Edit&amp;#160;with&amp;#160;one&amp;#160;Form&lt;/item&gt;
        ...

</pre>
<p>
Note that the filesystem path is generated by the path mapper which is configured within <span class="codefrag">pub-id/config/publication.xconf</span>.
</p>
<p>
In order to get the redirect right after closing and saving the document, one might need to add a <span class="codefrag">redirect-to</span> entry to the publication specific sitemap.
</p>
<a name="N105DA"></a><a name="Configuration-N105DA"></a>
<h5>Configuration</h5>
<p>
The One Form Editor can be configured within the generic Lenya usecase sitemap <span class="codefrag">lenya/usecase.xmap</span>.
</p>
<a name="N105E7"></a><a name="Validation"></a>
<h5>Validation</h5>
<p>
Upon saving, the form content is validated against the appropriate Relax NG schema using the <span class="codefrag">ValidateAction</span>

</p>
<a name="N105F5"></a><a name="docs/components/editors/bxeng.html"></a>
<h5>Bitflux Editor</h5>
<a name="N105FD"></a><a name="Configuration-N105FD"></a>
<h5>Configuration</h5>
<p>Required and Optional parameters</p>
<ul>

<li>BX_xmlfile: Actual Content (XML)</li>

<li>BX_xslfile (or BX_xhtmlfile): Global Formatting (XSLT (or XHTML))</li>

<li>css: Content Formatting (CSS)</li>

<li>BX_exitdestination: Link (HTML)</li>

<li>BX_validationfile: Schema (RNG)</li>

</ul>
<a name="N10619"></a><a name="Namespace+declaration"></a>
<h5>Namespace declaration</h5>
<p>resources/misc/bxeng/*-namespaces.xml</p>
<a name="N10624"></a><a name="docs/components/editors/kupu.html"></a>
<h5>Kupu</h5>
<a name="N1062C"></a><a name="Download"></a>
<h5>Download</h5>
<p>Information about Kupu development is available at the <a class="external" href="http://kupu.oscom.org/devel/">Kupu site</a>.</p>
<a name="N1063B"></a><a name="docs/components/editors/xopus.html"></a>
<h5>Xopus</h5>
<a name="N10643"></a><a name="Demo"></a>
<h5>Demo</h5>
<p>Try Xopus at:</p>
<pre class="code">

http://www.xopus.com/demo/index.html

</pre>
<a name="N10651"></a><a name="Configuration-N10651"></a>
<h5>Configuration</h5>
<p>Lenya needs to know the prefix of Xopus:</p>
<pre class="code">

src/webapp/lenya/usecase.xmap
src/webapp/lenya/resources/misc/xopus/index.html

</pre>
<a name="N1065F"></a><a name="Saving+via+POST"></a>
<h5>Saving via POST</h5>
<p>To enable saving via POST, one needs to modify <span class="codefrag">$XOPUS/xopusPlugins/datadriver.js</span> as follows</p>
<pre class="code">

    // Save data START
    alert('Save XML via POST');
    var result = Application.sendXML(doc, 'POST', name);

    switch (result.status)
    {
      case 200:
        //OK
        var resultXML = result.responseXML;
        alert('XML saved');
        return;
      case -1:
        alert('Error while saving ' + name + ':\n\n' + result.responseText);
        break;
      default:
        alert('Server responded not ok while saving ' + name + ':\n\nstatus:' + result.status + '\nmessage: ' + resul
t.responseText);
    }
    // Save data END

</pre>
<p>
whereas the text of the alerts might be replaced by something else.
</p>
<a name="N10673"></a><a name="Exit+Xopus"></a>
<h5>Exit Xopus</h5>
<p>To exit Xopus one needs to modify <span class="codefrag">$XOPUS/xopusPlugins/cmsdriver.js</span> as follows</p>
<pre class="code">

  getExitURL: function(path)
  {
    exitURL = path.substring(0, path.indexOf('?'));
    alert('Exit to: ' + exitURL);
    return exitURL;
  },

</pre>
<p>
whereas the text of the alert might be replaced by something else.
</p>
<a name="N10687"></a><a name="Making+a+page+editable+with+Xopus%3A+Schemas%2C+Views+%28XSLT%29+and+Menus"></a>
<h5>Making a page editable with Xopus: Schemas, Views (XSLT) and Menus</h5>
<p>Xopus needs an XML Schema for validation and an XSLT to view the document. The Schemas and XSLTs need to be located at:</p>
<pre class="code">

$PUBLICATION/config/doctypes/schemas/$DOCTYPE.xsd
$PUBLICATION/lenya/xslt/xopus/$DOCTYPE.xsl

</pre>
<p>
whereas one might want to use <a class="external" href="http://www.thaiopensource.com/relaxng/trang.html">Trang</a> to generate XML Schemas.
</p>
<p>
Editing with Xopus is implemented as a usecase. One can add a menu item as follows:
</p>
<pre class="code">

&lt;item uc:usecase="xopus" href="?lenya.step=open&amp;amp;doctype=$DOCTYPE"&gt;Edit&amp;#160;with&amp;#160;Xopus&lt;/item&gt;

</pre>
<a name="N106A5"></a><a name="Layout"></a>
<h5>Layout</h5>
<a name="N106AA"></a><a name="docs/components/layout/navigation.html"></a>
<h5>The Navigation Framework</h5>
<a name="N106B2"></a><a name="Introduction-N106B2"></a>
<h5>Introduction</h5>
<p>
    To goal of the navigation framework is to
  </p>
<ul>
    
<li>
      simplify and standardize the generation of navigation
      widgets like menubars, tabs, breadcrumb paths.
    </li>
  
</ul>
<p>With the approach that is presented here it shall be possible to
  </p>
<ul>
    
<li>
      use pre-defined XHTML navigation components and present them
      with a custom CSS,
    </li>
    
<li>
      override these components in a publication whereby the logic
      can be reused, and
    </li>
    
<li>
      create and integrate new publication-specific navigation components
      using the same scheme.
    </li>
  
</ul>
<a name="N106D1"></a><a name="Architecture"></a>
<h5>Architecture</h5>
<p>
    The navigation framework consists of the following components:
  </p>
<dl>
    
<dt>
<span class="codefrag">/lenya/navigation.xmap</span>
</dt>
    
<dd>The sitemap where the navigation components are loaded.<br>
<br>
</dd>
    
<dt>
<span class="codefrag">/lenya/xslt/navigation/*.xsl</span>
</dt>
    
<dd>The default navigation components that are shipped with Lenya.<br>
<br>
</dd>
    
<dt>
<span class="codefrag">/lenya/pubs/lenya/xslt/navigation/*.xsl</span>
</dt>
    
<dd>Custom navigation components of the publication.<br>
<br>
</dd>
  
</dl>
<a name="N106F9"></a><a name="Using+the+Navigation+Framework"></a>
<h5>Using the Navigation Framework</h5>
<a name="N106FF"></a><a name="Loading+a+Navigation+Component"></a>
<h5>Loading a Navigation Component</h5>
<p>
      You can load a navigation component from the following URI:
    </p>
<pre class="code">
cocoon://navigation/&lt;pub-id&gt;/&lt;component&gt;/&lt;path&gt;.xml
</pre>
<p>
The URI steps are:
</p>
<dl>
  
<dt>
<span class="codefrag">&lt;pub-id&gt;</span>
</dt>
  
<dd>The publicaton ID.</dd>
  
<dt>
<span class="codefrag">&lt;component&gt;</span>
</dt>
  
<dd>The navigation component to load (tabs, menu, etc.).</dd>
  
<dt>
<span class="codefrag">&lt;path&gt;</span>
</dt>
  
<dd>The navigation path. It is a concatenation of the <span class="codefrag">href</span>
    attributes of the sitetree nodes that lead to the current node,
    e.g. <span class="codefrag">demo/oscom.html</span> for the sitetree
    fragment
  </dd>

</dl>
<pre class="code">
&lt;site xmlns="http://apache.org/cocoon/lenya/sitetree/1.0"&gt;
  &lt;node href="demo/" label="Demo"&gt;
    &lt;node href="oscom.html" label="OSCOM"/&gt;
    ...
  &lt;/node&gt;
  ...
&lt;/site&gt;
</pre>
<a name="N10731"></a><a name="Aggregating+the+Navigation+Components"></a>
<h5>Aggregating the Navigation Components</h5>
<p>
    The basic principle is shown in the following figure:
  </p>
<p>
  
<img alt="" src="../../images/live/navigation.png">
  </p>
<p>
    In the publication sitemap (<span class="codefrag">lenya/pubs/&lt;pub-id&gt;/sitemap.xmap</span>)
    the navigation components are aggregated. Here you decide which components
    you want to use:
  </p>
<pre class="code">
    &lt;map:pipeline&gt;
      &lt;map:match pattern="navigation/**.html"&gt;
(1)       &lt;map:aggregate element="page" prefix="page"
              ns="http://apache.org/cocoon/lenya/cms-page/1.0"&gt;
              
(2)         &lt;map:part src="cocoon://navigation/
                {publication-id}/breadcrumb/{../1}.html.xml"/&gt;
                
(3)         &lt;map:part src="cocoon://navigation/
                {publication-id}/tabs/{../1}.html.xml"/&gt;
                
(4)         &lt;map:part src="cocoon://navigation/
               {publication-id}/menu/{../1}.html.xml"/&gt;
               
          &lt;/map:aggregate&gt;
          
(5)       &lt;map:transform src="xslt/page2xhtml.xsl"&gt;
(6)          &lt;map:parameter name="root"
                 value="{context}/{publication-id}/"/&gt;
          &lt;/map:transform&gt;
        
(7)     &lt;map:serialize type="xhtml"/&gt;

      &lt;/map:match&gt;
    &lt;/map:pipeline&gt;
</pre>
<ol>
  
<li>
    The navigation elements are aggregated together with other document parts.
  </li>
  
<li>
    Load the breadcrumb XHTML fragment.
  </li>
  
<li>
    Load the tabs XHTML fragment.
  </li>
  
<li>
    Load the menu XHTML fragment.
  </li>
  
<li>
    Create the XHTML page.
  </li>
  
<li>
    The stylesheet can use this parameter to generate absolute URLs.
  </li>
  
<li>
    Finally, serialize the page as XHTML.
  </li>

</ol>
<a name="N10764"></a><a name="Developing+Navigation+Components"></a>
<h5>Developing Navigation Components</h5>
<p>
    The following contracts define the development of navigation components:
  </p>
<ul>
    
<li>A navigation component is an XSLT stylesheet that is located at<br>
<br>
    
<dl>
      
<dt>
<span class="codefrag">lenya/xslt/navigation/&lt;component&gt;.xsl</span>
</dt>
      
<dd>for default components and<br>
<br>
</dd>
      
<dt>
<span class="codefrag">lenya/pubs/&lt;publication-id&gt;/lenya/xslt/&lt;component&gt;.xsl</span>
</dt>
      
<dd>for default components.<br>
<br>
</dd>
    
</dl>
    
</li>
    
<li>
      The default components produce an XHTML fragment with the
      top level element &lt;div class="&lt;component&gt;"/&gt;.
    </li>
  
</ul>
<a name="N10790"></a><a name="docs/components/layout/xhtml-templating.html"></a>
<h5>XHTML templating</h5>
<a name="N10798"></a><a name="The+XHTML+Templating+Concept"></a>
<h5>The XHTML Templating Concept</h5>
<p>There are various approaches to templating within a Lenya
publication. The XHTML approach is effective under the following
conditions:
</p>
<ul>
  
<li>Designers want to edit the layout with their conventional tools.</li> 

<li>The page layout contains large parts of static HTML.</li>

<li>Pages are typically composed of simple elements.</li>

</ul>
<p>
If these conditions are met, it is possible to define the overall
layout of a page in a XHTML document, using tools like Dreamweaver.
Special placeholders need to be inserted to indicate where Lenya
elements should later be substituted. This can be done by inserting
&lt;div id="navigation" /&gt; as the placeholder for the navigation, for
instance, or &lt;div id="cmsbody" /&gt; for the body part of a page.
</p>
<p>
If these XHTML documents are finished, they can then be called
from Lenya, and the placeholders be substituted with CMS content.
Schematically, this process looks as follows:
</p>
<p>1)</p>
<p>XML document (article)    -&gt;</p>
<p>XML document (navigation) -&gt;  Aggregation to one XML document</p>
<p>XHTML template            -&gt;</p>
<p>2)</p>
<p>aggregated XML document   -&gt;  Processing with XSLT</p>
<p>
Step 2) identifies the various placeholders ( &lt;div id="navigation" /&gt;
and &lt;div id="cmsbody" /&gt; in this example) and applies XSL transformations
to substitute the placeholders with the transformed contents of
(navigation, article) respectively.
</p>
<p>
What are the advantages of this approach?</p>
<ul>
  
<li>less XSLT is required, making it easier to delegate design work</li>

<li>XSLT are easier to understand, as they only affect a small part
  of a page</li>

</ul>
<p>What are the pitfalls of this approach?</p>
<ul>
  
<li>it may not be appropriate to put the content (here: article) into
  the XHTML format</li>

<li>template reuse may be hampered</li>

</ul>
<a name="N107DF"></a><a name="docs/components/layout/static-resources.html"></a>
<h5>Serving Static Resources</h5>
<a name="N107E7"></a><a name="Serving+Static+Resources"></a>
<h5>Serving Static Resources</h5>
<p>Lenya now serves static resources out of the box. Publications can either
use these predefined mappings, or provide their own. The following MIME types
are handled:
</p>
<ul>
  
<li>CSS</li> 

<li>Javascript</li>

<li>Images (GIF, JPEG and PNG)</li>

<li>PDF</li>

<li>Shockwave Flash (*.swf)</li>

</ul>
<p>
To use the built-in matching, these resources need to be stored in the
appropriate directories within a publication, and called with the proper
URLs.
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">

<tr>
<td colspan="1" rowspan="1">MIME Type</td><td colspan="1" rowspan="1">Prefix</td><td colspan="1" rowspan="1">Directory</td>
</tr>

<tr>
<td colspan="1" rowspan="1">CSS</td><td colspan="1" rowspan="1">css/</td><td colspan="1" rowspan="1">resources/css/</td>
</tr>

<tr>
<td colspan="1" rowspan="1">Javascript</td><td colspan="1" rowspan="1">javascript/</td><td colspan="1" rowspan="1">resources/javascript/</td>
</tr>

<tr>
<td colspan="1" rowspan="1">Images</td><td colspan="1" rowspan="1">images/</td><td colspan="1" rowspan="1">resources/images/</td>
</tr>

<tr>
<td colspan="1" rowspan="1">PDF</td><td colspan="1" rowspan="1">pdf/</td><td colspan="1" rowspan="1">resources/pdf/</td>
</tr>

<tr>
<td colspan="1" rowspan="1">Flash</td><td colspan="1" rowspan="1">flash/</td><td colspan="1" rowspan="1">resources/flash/</td>
</tr>

</table>
<p>An image would thus be called with &lt;img src="images/logo.gif" /&gt;
You dont have to worry about absolute vs relative image paths as long
as you use URLs that follow this pattern.</p>
<a name="N10860"></a><a name="docs/components/layout/lenya-menubar.html"></a>
<h5>The Lenya Menubar</h5>
<a name="N10868"></a><a name="Defining+the+Menubar"></a>
<h5>Defining the Menubar</h5>
<a name="N1086D"></a><a name="The+XML+Structure"></a>
<h5>The XML Structure</h5>
<p>
  A menubar declaration contains the definition of several menus.
  Each menu consists of a set of blocks containing items.
  The structure of a menu declaration looks as follows:
</p>
<pre class="code">&lt;menu xmlns="http://apache.org/cocoon/lenya/menubar/1.0"&gt;

  &lt;menus&gt;
    
    &lt;menu label="File" name="File"&gt;
      &lt;block&gt;
        &lt;item href="..."&gt;New Document&lt;/item&gt;
        &lt;item href="..."&gt;New Language Version&lt;/item&gt;
        ...
      &lt;/block&gt;
      ...
    &lt;/menu&gt;
    
    ...

  &lt;/menus&gt;

&lt;/menu&gt;</pre>
<a name="N1087A"></a><a name="Showing+Blocks+and+Items+Only+in+Certain+Tabs"></a>
<h5>Showing Blocks and Items Only in Certain Tabs</h5>
<p>
  When you use the same menu declaration for different tabs,
  it might be wished that a menu item shouldn't appear in all
  these tabs. For instance, the <em>Edit</em> menu item should
  be displayed only in the <em>authoring</em> tab menu.
</p>
<p>
  To disable a menu item or block, you add an attribute with
  the name of the tab (<em>authoring</em>, <em>info</em>)
  and the value <span class="codefrag">false</span>:
</p>
<pre class="code">&lt;item info="false"&gt;...&lt;/item&gt;

&lt;block authoring="false"&gt;
  ...
&lt;/block&gt;
</pre>
<a name="N10899"></a><a name="Specifying+Usecases+and+Workflow+Events"></a>
<h5>Specifying Usecases and Workflow Events</h5>
<p>
  When a menu item calls a usecase or triggers a workflow transition,
  and the corresponding action is not allowed, the <span class="codefrag">href</span>
  attribute of the item is removed before the menu is rendered to
  disable the item. For this purpose, the <span class="codefrag">&lt;item&gt;</span>
  element supports the attributes
</p>
<ul>
  
<li>
<span class="codefrag">wf:event</span>,</li>
  
<li>
<span class="codefrag">uc:usecase</span>, and</li>
  
<li>
<span class="codefrag">uc:step</span>.</li>

</ul>
<p>
  If the attributes are provided, they are translated into the
  appropriate request parameters:
</p>
<ul>
  
<li>
<span class="codefrag">wf:event -&gt; lenya.event</span>
</li>
  
<li>
<span class="codefrag">uc:usecase -&gt; lenya.usecase</span>
</li>
  
<li>
<span class="codefrag">uc:step -&gt; lenya.step</span>
</li>

</ul>
<p>
  The attributes are used in the following way:
</p>
<pre class="code">&lt;menu
    xmlns="http://apache.org/cocoon/lenya/menubar/1.0"
    xmlns:uc="http://apache.org/cocoon/lenya/usecase/1.0"
    xmlns:wf="http://apache.org/cocoon/lenya/workflow/1.0"&gt;

  ...

  &lt;item wf:event="edit"
        uc:usecase="edit-forms"
        uc:step="open" href="?..."&gt;Edit with Forms&lt;/item&gt;
  
  ...

&lt;/menu&gt;</pre>
<p>
  The resulting request would be
</p>
<pre class="code">?lenya.event=edit&amp;lenya.usecase=edit-forms&amp;lenya.step=open&amp;...</pre>
<p>
  If a user is not allowed to invoke the event <span class="codefrag">edit</span>
  or to execute the usecase <span class="codefrag">edit-forms</span>, the menu
  item will be disabled.
</p>
<a name="N108E4"></a><a name="Applying+the+Menubar+-+Meta+Stylesheet+Approach"></a>
<h5>Applying the Menubar - Meta Stylesheet Approach</h5>
<p>
In this approach, the publication simply builds its XHTML
page without any additional XML. The Lenya menubar is added using
a meta stylesheet in the last transformation step.
You find more information on meta stylesheets on the page
<a class="external" href="http://wiki.cocoondev.org/Wiki.jsp?page=MetaStylesheets">MetaStylesheets</a>
in the cocoondev wiki.
</p>
<a name="N108F0"></a><a name="The+Big+Picture+%28literally%29"></a>
<h5>The Big Picture (literally)</h5>
<p>

<img alt="Lenya page processing" src="images/live/lenya-page-processing.png">
</p>
<p>
In the left column you see the XML flow within the publication sitemaps,
  the right column shows the flow within the core sitemaps.
</p>
<a name="N108FF"></a><a name="Creating+the+Menu+XHTML"></a>
<h5>Creating the Menu XHTML</h5>
<ul>
  
<li>The actual menu XML is fetched from the sitemap <span class="codefrag">menus.xmap</span>
  within the publication directory.</li>
  
<li>The XML is processed using the UsecaseMenuTransformer and the
  WorkflowMenuTransformer.</li>
  
<li>The stylesheet <span class="codefrag">lenya/xslt/menu/menu2xhtml.xsl</span> transforms
  the menu XML into XHTML.</li>
  
<li>Finally, this XHTML is transformed into a meta stylesheet by
  <span class="codefrag">lenya/xslt/menu/menu2xslt.xsl</span>.</li>

</ul>
<a name="N1091D"></a><a name="Requesting+and+Applying+the+Menubar"></a>
<h5>Requesting and Applying the Menubar</h5>
<ul>
  
<li>The XHTML page is generated without any additional XML.</li>
  
<li>Afterwards, the menubar meta stylesheet is requested using
  a <span class="codefrag">cocoon://lenya-page/...</span> internal request.</li>
  
<li>This request is matched in <span class="codefrag">global-sitemap.xmap</span>.</li>
  
<li>The menubar meta stylesheet is applied to the XHTML page.
  It inserts the menubar at the top of the HTML body, adds some
  additional CSS file entries and modifies the HTML title.</li>

</ul>
<a name="N10939"></a><a name="Configuring+the+Publication"></a>
<h5>Configuring the Publication</h5>
<a name="N1093E"></a><a name="Requesting+the+lenya-page+Meta+Stylesheet"></a>
<h5>Requesting the lenya-page Meta Stylesheet</h5>
<p>The lenya-page meta stylesheet request looks as follows:</p>
<pre class="code">
&lt;map:generate src="cocoon:/page/..."/&gt;
&lt;map:transform src="cocoon://lenya-page/{page-envelope:publication-id}/[menu-url]"/&gt;
&lt;map:serialize type="html"/&gt;
</pre>
<ul>
  
<li>The <span class="codefrag">lenya-page</span> part is used to match the request in <span class="codefrag">global-sitemap.xmap</span>.</li>
  
<li>The <span class="codefrag">{page-envelope:publication-id}</span> part is used to evaluate which
  publication the request came from.</li>
  
<li>The <span class="codefrag">[menu-url]</span> part is used to get the menu from <span class="codefrag">menus.xmap</span>.
  Here you have to add all information you need to select the appropriate menubar.</li>

</ul>
<a name="N10966"></a><a name="Creating+the+Menu+XML"></a>
<h5>Creating the Menu XML</h5>
<p>Usually, this is done using an XSP page.</p>
<p>The Lenya menubar namespace is</p>
<pre class="code">http://apache.org/cocoon/lenya/menubar/1.0</pre>
<a name="N10976"></a><a name="Supplying+Menus+in+menus.xmap"></a>
<h5>Supplying Menus in menus.xmap</h5>
<p>When the lenya-page meta stylesheet is generated in the core,
the actual menu XML is fetched using a request to the sitemap
<span class="codefrag">menus.xmap</span> in the publication directory.
The <span class="codefrag">[menu-url]</span> part from the lenya-page request is
matched in this sitemap.</p>
<p>
This simple <span class="codefrag">menus.xmap</span> pipeline uses different
menus for authoring and live:
</p>
<pre class="code">
&lt;map:pipeline&gt;
  
  &lt;map:match pattern="live/**"&gt;
    &lt;map:generate type="serverpages"
        src="../../content/menus/live.xsp"/&gt;
    &lt;map:serialize type="xml"/&gt;
  &lt;/map:match&gt;
  
  &lt;map:match pattern="*/**"&gt;
    &lt;map:generate type="serverpages"
        src="config/menus/generic.xsp"/&gt;
    &lt;map:serialize type="xml"/&gt;
  &lt;/map:match&gt;
  
&lt;/map:pipeline&gt;
</pre>
<p>You can as well use the document type or the current URL to
select a menu.</p>
<p>Examples for lenya-page requests:</p>
<p>Using the area:</p>
<pre class="code">cocoon://lenya-page/{page-envelope:publication-id}/{page-envelope:area}</pre>
<p>Using the document type:</p>
<pre class="code">cocoon://lenya-page/{page-envelope:publication-id}/{page-envelope:document-type}</pre>
<p>Using the document URL:</p>
<pre class="code">cocoon://lenya-page/{page-envelope:publication-id}/{page-envelope:document-url}</pre>
<a name="N109AB"></a><a name="Creating+a+Customized+Menu"></a>
<h5>Creating a Customized Menu</h5>
<p>
  It is also possible to get the menu XML before it is transformed
  to XHTML using a request to the core. For this purpose, the prefix
  <span class="codefrag">menu-xml</span> is used instead of <span class="codefrag">lenya-page</span>.
  This way, you can aggregate the menu XML together with other page parts
  and include it somewhere inside the XML page.
</p>
<pre class="code">&lt;map:aggregate element="lenya" label="aggregation"&gt;
  &lt;map:part src="cocoon:/lenyabody/{1}/{2}.xml"/&gt;
  &lt;map:part src="cocoon://menu-xml/{page-envelope:publication-id}/{1}.xml"/&gt;
&lt;/map:aggregate&gt;</pre>
<a name="N109BF"></a><a name="Applying+the+Menubar+-+Classic+Approach"></a>
<h5>Applying the Menubar - Classic Approach</h5>
<div class="frame note">
<div class="label">Note</div>
<div class="content">This approach is deprecated.</div>
</div>
<a name="N109C7"></a><a name="XSLT"></a>
<h5>XSLT</h5>
<p>
By editing <span class="codefrag">src/webapp/lenya/xslt/menu/menu.xsl</span> one can change the look and feel of the Lenya menu bar.
This XSLT template is being included by <span class="codefrag">src/webapp/lenya/xslt/menu/root.xsl</span>.
</p>
<a name="N109DA"></a><a name="Publication"></a>
<h5>Publication</h5>
<a name="N109DF"></a><a name="docs/components/publication/pageenvelopemodule.html"></a>
<h5>The PageEnvelopeModule</h5>
<a name="N109E7"></a><a name="Overview"></a>
<h5>Overview</h5>
<p>
The <span class="codefrag">PageEnvelopeModule</span> is an <span class="codefrag">InputModule</span>
that provides access to the <span class="codefrag">PageEnvelope</span> parameters. For
documentation on input modules see section <a href="http://cocoon.apache.org/2.1/userdocs/concepts/modules.html">Modules</a>
of the Cocoon documentation.
</p>
<a name="N109FD"></a><a name="Module+Parameters"></a>
<h5>Module Parameters</h5>
<dl>
  
<dt>publication-id</dt>
  
<dd>The current publication ID.</dd>
  
<dt>context-prefix</dt>
  
<dd>The context prefix of the web application, e.g. <span class="codefrag">/lenya</span>.</dd>
  
<dt>area</dt>
  
<dd>The CMS area, <span class="codefrag">authoring</span> or <span class="codefrag">live</span>.</dd>
  
<dt>publication</dt>
  
<dd>The current publication</dd>
  
<dt>document-id</dt>
  
<dd>The document ID, i.e. the path of the document in the sitetree.</dd>
  
<dt>document-name</dt>
  
<dd>The document name, i.e. the very last part of the document ID.</dd>
  
<dt>document-url</dt>
  
<dd>The URL of the document within the area, e.g., <span class="codefrag">/news/index.html</span>
</dd>
  
<dt>document-path</dt>
  
<dd>The file path where this document is physically located in the
  file system.</dd>
  
<dt>document-language</dt>
  
<dd>The language of this document.</dd>
  
<dt>document-type</dt>
  
<dd>The document type.</dd>

</dl>
<a name="N10A4D"></a><a name="Sitemap+usage"></a>
<h5>Sitemap usage</h5>
<pre class="code">
&lt;map:parameter name="document-id" value="{page-envelope:document-id}"/&gt;
</pre>
<a name="N10A57"></a><a name="XSP+usage"></a>
<h5>XSP usage</h5>
<pre class="code">
&lt;xsp:page
       language="java"
       xmlns:xsp="http://apache.org/xsp"
       xmlns:input="http://apache.org/cocoon/xsp/input/1.0"&gt;

&lt;usecase:url&gt;
  &lt;input:get-attribute
      module="page-envelope" as="string" name="document-url"/&gt;
&lt;/usecase:url&gt;
  
&lt;/xsp:page&gt;       

</pre>
<a name="N10A62"></a><a name="docs/components/publication/siteTree.html"></a>
<h5>Site Tree</h5>
<a name="N10A6A"></a><a name="Motivation"></a>
<h5>Motivation</h5>
<p>Currently there is no standard way to manage the navigation
in Lenya. Previous attempts have shown their own merits and
drawbacks. A general and standard approach is needed.</p>
<a name="N10A74"></a><a name="Rationale"></a>
<h5>Rationale</h5>
<p>The basic problems we're trying to solve are as follows:</p>
<ol>
	
<li>Maintain the navigation in an easy format independent of
	the actual storage of the documents.</li> 
	
<li>Enable moving of documents.</li>
	
<li>Enable querying of doctype independent of request URI.</li>
      
</ol>
<a name="N10A89"></a><a name="Navigation"></a>
<h5>Navigation</h5>
<p>There are a couple of known implementations to choose from:</p>
<ul>
	  
<li>The existing Lenya tree.xml</li> 
	  
<li>The Forrest site.xml.</li>
	  
<li>The hashmap way: A sitetree.xml and purlspace.xml combination
   where the purlspace.xml contains all existing documents and
   sitetree.xml contains the navigation hierarchy.</li>
	
</ul>
<a name="N10A9F"></a><a name="Moving+Of+Documents"></a>
<h5>Moving Of Documents</h5>
<p>The Forrest site.xml solves this quite elegantly: Due to the use of
XPath and some ambiguity the documents can be found almost
independent of their actual location</p>
<p>With the existing Lenya or the hashmap solution changing of document
location requires editing of the tree.xml or the purlspace.xml
respectively.</p>
<a name="N10AAC"></a><a name="Doctype+Querying"></a>
<h5>Doctype Querying</h5>
<p>For question 3 there are a couple of known approaches:</p>
<a name="N10AB5"></a><a name="Hashmap"></a>
<h5>Hashmap</h5>
<p>This method uses an action which contains for each
   request URI a mapping to attributes such as doctype, srcfile, xslt,
   etc.</p>
<a name="N10ABF"></a><a name="Forrest+SourceTypeAction"></a>
<h5>Forrest SourceTypeAction</h5>
<p>Forrest contains an action which for a given request
   opens the source file and determines its doctype based on the dtd
   declaration.</p>
<a name="N10AC9"></a><a name="URIParametrizer"></a>
<h5>URIParametrizer</h5>
<p>The URIParametrizer is a black box (probably an action)
   which internally issues cocoon requests to different sitemaps which
   return different attributes (doctype, etc.) for a given request
   URI.</p>
<p>This amounts to a combination of the hashmap solution
   with the basic cocoon concepts: The request URIs aren't matched
   against a hashmap but are handled by a sitemap instead. The sitemap
   contains normal pipelines and matchers which match on the
   request. As a catch-all there is still the possibility of using a
   hashmap for URIs that didn't match any pipelines.</p>
<p>Finally a new (internal) request is generated using the
   parameter values. This request is handled by a normal cocoon
   sitemap as if the original request had contained these
   parameters.</p>
<div align="center">
<img class="figure" alt="" src="docs/components/publication/URIParametrizer.png"></div>
<a name="N10ADE"></a><a name="The+Sitetree+Schema"></a>
<h5>The Sitetree Schema</h5>
<p>The proposed sitetree schema looks as follows:</p>
<pre class="code">
&lt;?xml version="1.0"?&gt;

&lt;xs:schema
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://apache.org/cocoon/lenya/sitetree/1.0"
    xmlns="http://apache.org/cocoon/lenya/sitetree/1.0"
    elementFormDefault="qualified"&gt;
    
  &lt;xs:element name="site"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref="node"
            minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
  
  &lt;xs:element name="node"&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref="node"
            minOccurs="0" maxOccurs="unbounded"/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name="href" type="xs:string"/&gt;
      &lt;xs:attribute name="label" type="xs:string"/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
    
&lt;/xs:schema&gt;
</pre>
<p>
        An example <span class="codefrag">sitetree.xml</span> could look like follows:
      </p>
<pre class="code">
&lt;site
    xmlns="http://apache.org/cocoon/lenya/sitetree/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation=
        "http://apache.org/cocoon/lenya/sitetree/1.0
        ../../../../resources/entities/sitetree.xsd"&gt;
    
  &lt;node href="index.html" label="Home"/&gt;
  
  &lt;node href="demo/" label="Demo"&gt;
    &lt;node href="unipublic.html" label="Unipublic"/&gt;
    &lt;node href="news.html" label="Wyona News and Comments"/&gt;
    &lt;node href="oscom.html" label="OSCOM"/&gt;
  &lt;/node&gt;
  
  &lt;node href="download/" label="Download"&gt;
    &lt;node href="source.html" label="Source Version"/&gt;
    &lt;node href="binary.html" label="Binary Version"/&gt;
  &lt;/node&gt;
  
  &lt;node href="documentation/" label="Documentation"/&gt;

&lt;/site&gt;
</pre>
<a name="N10AF6"></a><a name="Backwards+Compatibility"></a>
<h5>Backwards Compatibility</h5>
<p>There has not been a previous implementation, so this is a non-issue.</p>
<a name="N10B00"></a><a name="Roadmap"></a>
<h5>Roadmap</h5>
<ul>
	
<li>Decide which solution to choose</li>
      
</ul>
<a name="N10B0D"></a><a name="Reference+Implementation"></a>
<h5>Reference Implementation</h5>
<p>None</p>
<a name="N10B19"></a><a name="Revision+Control"></a>
<h5>Revision Control</h5>
<a name="N10B1E"></a><a name="docs/components/revisioncontrol/revisioncontroller.html"></a>
<h5>Revision Controller</h5>
<a name="N10B26"></a><a name="Introduction-N10B26"></a>
<h5>Introduction</h5>
<p>The Revision Controller controls the different reserved
      check-in and check-out of documents, the backup versions and the
      rollback. It is filesystem oriented</p>
<a name="N10B30"></a><a name="Check-in+%2F+Check-out"></a>
<h5>Check-in / Check-out</h5>
<p>The 
      <a href="#checkin.html">check-in</a>
      and 
      <a href="#checkout.html">check-out</a>
      are reserved: a checked out document cannot be checked out by
      another user.</p>
<p>A user "System" exists, who can force internally a checkin</p>
<p>The different check-in/check-out states (the checkin/out,
      the time, the user's identity) of a document are stored in an
      xml file with a own markup language: the 
      <a href="#rcml.html">RCML-file.</a>
</p>
<a name="N10B4B"></a><a name="Versions"></a>
<h5>Versions</h5>
<p>When a document is checked in, the old version of the
      document is copied ( 
      <a href="#version.html">backup</a>
      )</p>
<a name="N10B59"></a><a name="Rollback"></a>
<h5>Rollback</h5>
<p>It is also possible to retrieve an old version with the 
      <a href="#rollback.html">rollback</a>
      
</p>
<a name="N10B67"></a><a name="Package"></a>
<h5>Package</h5>
<pre class="code">org.apache.lenya.cms.rc</pre>
<a name="N10B73"></a><a name="docs/components/revisioncontrol/rcml.html"></a>
<h5>Revision Controller Markup Language (RCML)</h5>
<a name="N10B7B"></a><a name="Location"></a>
<h5>Location</h5>
<p>The RCML-file are located in a rcml directory</p>
<pre class="code">
        {publication}/content/rcml/
      </pre>
<p> which can be configured in </p>
<pre class="code">
        cocoon-lenya/src/webapp/lenya/config/rc/revision-controller.xconf
      </pre>
<p>For a document with an xml file {publication}/content/authoring/{filename}, the rcml file is </p>
<pre class="code">
        {publication}/{rcml-directory}/content/authoring/{filename}.rcml
      </pre>
<a name="N10B97"></a><a name="Markup+Language"></a>
<h5>Markup Language</h5>
<p>A rcml-file is typically</p>
<pre class="code">
        &lt;?xml version="1.0" encoding="utf-8"?&gt; 
          &lt;XPSRevisionControl&gt;
            &lt;CheckIn&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102128815&lt;/Time&gt;&lt;/CheckIn&gt;
            &lt;CheckOut&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102128780&lt;/Time&gt;&lt;/CheckOut&gt;
            &lt;CheckIn&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102125300&lt;/Time&gt;&lt;/CheckIn&gt;
            &lt;CheckOut&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102121346&lt;/Time&gt;&lt;/CheckOut&gt;
            &lt;CheckIn&gt;&lt;Identity&gt;roger&lt;/Identity&gt;&lt;Time&gt;1023102110381&lt;/Time&gt;&lt;/CheckIn&gt;
            &lt;CheckOut&gt;&lt;Identity&gt;roger&lt;/Identity&gt;&lt;Time&gt;1023102110349&lt;/Time&gt;&lt;/CheckOut&gt;
            &lt;CheckIn&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102073728&lt;/Time&gt;&lt;/CheckIn&gt;
            &lt;CheckOut&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102012990&lt;/Time&gt;&lt;/CheckOut&gt; 
            &lt;CheckOut&gt;&lt;Identity&gt;lenya&lt;/Identity&gt;&lt;Time&gt;1023102010354&lt;/Time&gt;&lt;/CheckOut&gt; 
            &lt;CheckIn&gt;&lt;Identity&gt;System&lt;/Identity&gt;&lt;Time&gt;1022569908000&lt;/Time&gt;&lt;/CheckIn&gt;
          &lt;/XPSRevisionControl&gt; 
      </pre>
<a name="N10BA5"></a><a name="Size"></a>
<h5>Size</h5>
<p>The size of the rcml file is limited to the value (2 * maximalNumberOfEntries) + 1,
       where maximalNumberOfEntries is in org.apache.lenya.cms.rc.RCML hard coded (value 10)</p>
<a name="N10BB0"></a><a name="docs/components/revisioncontrol/checkin.html"></a>
<h5>Reserved Checkin</h5>
<a name="N10BB8"></a><a name="Revision+Controller"></a>
<h5>Revision Controller</h5>
<p>To check in a file call:</p>
<pre class="code">org.apache.lenya.cms.rc.RevisionController.reservedCheckIn(
    String destination, String identity, boolean backup)</pre>
<p>where the destination is the path of the file from the publication,
	     the identity is the identity of the user 
	     and backup is a boolean.</p>
<p>This method is called from the ReservedCheckinAction.</p>
<p>Rem: if no backup (and no rollback is needed) set in the ReservedCheckinAction the backup boolean to false.</p>
<a name="N10BCF"></a><a name="The+ReservedCheckinAction"></a>
<h5>The ReservedCheckinAction</h5>
<p>To invoke a reserved check-in from a sitemap pipeline, you use The ReservedCheckinAction.</p>
<pre class="code">
      &lt;map:components&gt;
        ...
        &lt;map:actions&gt;
      	  &lt;map:action name="reserved-checkin"
      	      src="org.apache.lenya.cms.cocoon.acting.ReservedCheckinAction"
      	      logger="sitemap.action.reserved-checkin"/&gt;
        &lt;/map:actions&gt;
        ...
      &lt;/map:components&gt;
      </pre>
<pre class="code">
            &lt;map:act type="reserved-checkin"&gt;
              &lt;map:generate src="../../content/rc/{exception}.xsp"
                  type="serverpages"&gt;
                &lt;map:parameter name="user" value="{user}"/&gt;
                &lt;map:parameter name="filename" value="{filename}"/&gt;
                &lt;map:parameter name="checkType" value="{checkType}"/&gt;
                &lt;map:parameter name="date" value="{date}"/&gt;
              &lt;/map:generate&gt;
              &lt;map:transform src="xslt/rc/rco-exception.xsl"/&gt;
              &lt;map:serialize/&gt;
            &lt;/map:act&gt;
      </pre>
<a name="N10BE1"></a><a name="URL"></a>
<h5>URL</h5>
<p>The call</p>
<pre class="code">{document-URL}?lenya.usecase=checkin&amp;lenya.step=checkin</pre>
<p>invokes a check-in of the document</p>
<a name="N10BF2"></a><a name="fileReservedCheckInException"></a>
<h5>fileReservedCheckInException</h5>
<p>When the file cannot be checked in because another user has already checked it out,
	  a fileReservedCheckInException is thrown:</p>
<pre class="code">
	  File Reserved Checkin Exception
      File not checked in yet

      The resource has already been checked out:
      User:	roger
      Date:	Wed Oct 22 14:31:05 CEST 2003
      Filename:	/content/authoring/index/index_de.xml
	  </pre>
<p>The serverpage</p>
<pre class="code">cocoon-lenya/src/webapp/lenya/content/rc/fileReservedCheckInException.xsp</pre>
<p>generates the xml which will be transformed with </p>
<pre class="code">cocoon-lenya/src/webapp/lenya/xslt/rc/rco-exception.xsl</pre>
<a name="N10C0E"></a><a name="Exception"></a>
<h5>Exception</h5>
<p>The errors are catched as generic Exception</p>
<pre class="code">
      Generic Exception

      Check the log files :-)
      Filename:	/content/authoring/malaVida/index_de.xml	  </pre>
<p>The serverpage</p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/content/rc/exception.xsp</pre>
<p>generates the xml which will be transformed with </p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/xslt/rc/rco-exception.xsl</pre>
<a name="N10C2B"></a><a name="docs/components/revisioncontrol/checkout.html"></a>
<h5>Reserved Checkout</h5>
<a name="N10C33"></a><a name="Revision+Controller-N10C33"></a>
<h5>Revision Controller</h5>
<p>To check out a file call the method :</p>
<pre class="code">org.apache.lenya.cms.rc.RevisionController.reservedCheckOut(String source, String identity)</pre>
<p>where the source is the path of the file from the publication and the identity is the identity of the user.</p>
<p>This method is called from the ReservedCheckoutAction.</p>
<a name="N10C47"></a><a name="The+ReservedCheckoutAction"></a>
<h5>The ReservedCheckoutAction</h5>
<p>To invoke a reserved check out from a sitemap pipeline, you use The ReservedCheckoutAction.</p>
<pre class="code">

      &lt;map:components&gt;
        ...
        &lt;map:actions&gt;
      	  &lt;map:action name="reserved-checkout" src="org.apache.lenya.cms.cocoon.acting.ReservedCheckoutAction" logger="sitemap.action.reserved-checkout"/&gt;
        &lt;/map:actions&gt;
        ...
      &lt;/map:components&gt;

      </pre>
<pre class="code">
            &lt;map:act type="reserved-checkout"&gt;
              &lt;map:generate src="content/rc/{exception}.xsp" type="serverpages"&gt;
                &lt;map:parameter name="user" value="{user}"/&gt;
                &lt;map:parameter name="filename" value="{filename}"/&gt;
                &lt;map:parameter name="date" value="{date}"/&gt;
              &lt;/map:generate&gt;
              &lt;map:transform src="xslt/rc/rco-exception.xsl"/&gt;
              &lt;map:serialize/&gt;
            &lt;/map:act&gt;
      </pre>
<a name="N10C59"></a><a name="URL-N10C59"></a>
<h5>URL</h5>
<p>The call</p>
<pre class="code">{document-URL}?lenya.usecase=checkout&amp;lenya usecase.step=checkout</pre>
<p>invokes a check-out of the document</p>
<a name="N10C6A"></a><a name="The+ReservedCheckoutTestAction"></a>
<h5>The ReservedCheckoutTestAction</h5>
<p>The ReservedCheckoutTestAction checks out a document only if this isn't already checked out</p>
<pre class="code">

      &lt;map:components&gt;
        ...
        &lt;map:actions&gt;
  	      &lt;map:action name="reserved-checkout-test" src="org.apache.lenya.cms.cocoon.acting.ReservedCheckoutTestAction" logger="sitemap.action.reserved-checkout-test"/&gt;
        &lt;/map:actions&gt;
        ...
      &lt;/map:components&gt;

      </pre>
<pre class="code">
	        &lt;map:act type="reserved-checkout-test"&gt;
    	      &lt;map:generate type="serverpages" src="../../content/rc/{exception}.xsp"&gt;
        	    &lt;map:parameter name="user" value="{user}"/&gt;
            	&lt;map:parameter name="filename" value="{filename}"/&gt;
	            &lt;map:parameter name="date" value="{date}"/&gt;
    	      &lt;/map:generate&gt;
        	  &lt;map:transform src="../../xslt/rc/rco-exception.xsl"/&gt;
    	      &lt;map:serialize/&gt;
        	&lt;/map:act&gt;
      </pre>
<a name="N10C7C"></a><a name="FileReservedCheckOutException"></a>
<h5>FileReservedCheckOutException</h5>
<p>When the file cannot be checked out because another user has already checked it out,
	  a fileReservedCheckOutException is thrown:</p>
<pre class="code">
      File Reserved Checkout Exception
      
      Could not check out the file

      Reason : The resource has already been checked out by another user
      User:	lenya
      Date:	Wed Oct 22 12:02:28 CEST 2003
      Filename:	/content/authoring/index/index_de.xml
	  </pre>
<p>The serverpage</p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/content/rc/fileReservedCheckOutException.xsp</pre>
<p>generates the xml which will be transformed with </p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/xslt/rc/rco-exception.xsl</pre>
<a name="N10C98"></a><a name="Exception-N10C98"></a>
<h5>Exception</h5>
<p>The errors are catched as generic Exception</p>
<pre class="code">
      Generic Exception

      Check the log files :-)
      Filename:	/content/authoring/malaVida/index_de.xml	  </pre>
<p>The serverpage</p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/content/rc/exception.xsp</pre>
<p>generates the xml which will be transformed with </p>
<pre class="code"> cocoon-lenya/src/webapp/lenya/xslt/rc/rco-exception.xsl</pre>
<a name="N10CB5"></a><a name="docs/components/revisioncontrol/version.html"></a>
<h5>Revision</h5>
<a name="N10CBD"></a><a name="Location-N10CBD"></a>
<h5>Location</h5>
<p>The backup files are located in a rcback directory</p>
<pre class="code">
        {publication}/content/rcbak/
      </pre>
<p> which can be configured in </p>
<pre class="code">
        cocoon-lenya/src/webapp/lenya/config/rc/revision-controller.xconf
      </pre>
<p>For a document with an xml file {publication}/content/authoring/{filename}, the backup files are </p>
<pre class="code">
        {publication}/{rcback-directory}/content/authoring/{filename}.timestamp
      </pre>
<a name="N10CD9"></a><a name="Revision+Screen"></a>
<h5>Revision Screen</h5>
<p>To get the revision screen, use the serverpage</p>
<pre class="code">cocoon-lenya/src/webapp/lenya/content/rc/versions-screen.xsp</pre>
<p>Sitemap :</p>
<pre class="code">
            &lt;map:generate src="content/rc/versions-screen.xsp" type="serverpages"/&gt;
            &lt;map:transform src="xslt/rc/rollback.xsl"/&gt;
            &lt;map:serialize/&gt;
      </pre>
<a name="N10CEE"></a><a name="View+of+an+old+version"></a>
<h5>View of an old version</h5>
<p>To get the view of a backup version, use the serverpage</p>
<pre class="code">cocoon-lenya/src/webapp/lenya/content/rc/view.xsp</pre>
<p>It needs  the check-in time as request parameter</p>
<p>Sitemap in the publication :</p>
<pre class="code">
          &lt;map:generate type="serverpages" src="../../content/rc/view.xsp"&gt;
          &lt;/map:generate&gt;
          &lt;map:transform src="xslt/toDoc.xsl"/&gt;
          &lt;map:transform src="xslt/{../2}2xhtml.xsl"/&gt;
          &lt;map:serialize type="xml"/&gt;
      </pre>
<a name="N10D06"></a><a name="URL-N10D06"></a>
<h5>URL</h5>
<p>The call of the URL </p>
<pre class="code">{document-URL}?lenya.usecase=rollback&amp;lenya usecase.step=view&amp;rollbackTime={time-point}</pre>
<p>shows the version corresponding to the time {time-point}</p>
<a name="N10D17"></a><a name="Disable+the+backup+"></a>
<h5>Disable the backup </h5>
<p>To disable the backup set in the ReservedCheckinAction the backup boolean of getRC().reservedCheckIn(String destination, String identity, boolean backup) to false.</p>
<a name="N10D22"></a><a name="docs/components/revisioncontrol/rollback.html"></a>
<h5>Rollback</h5>
<a name="N10D2A"></a><a name="Revision+Controller-N10D2A"></a>
<h5>Revision Controller</h5>
<p>To rollback a file call</p>
<pre class="code">org.apache.lenya.cms.rc.RevisionController.rollback(String destination, String identity, boolean backupFlag, long time)</pre>
<p>where destination is the path of the file from the publication,identity is the identity of the user,
	   backupFlag is a boolean to choose if you want a backup of the current version, and time is the time of
	    the version to roll back to.
      </p>
<a name="N10D3B"></a><a name="The+RollbackAction"></a>
<h5>The RollbackAction</h5>
<p>To invoke a rollback from a sitemap pipeline, you use The RollbackAction.</p>
<p>The check-in time is needed as request parameter</p>
<pre class="code">

      &lt;map:components&gt;
        ...
        &lt;map:actions&gt;
  	      &lt;map:action name="rollback" src="org.apache.lenya.cms.cocoon.acting.RollbackAction"/&gt;
        &lt;/map:actions&gt;
        ...
      &lt;/map:components&gt;

      </pre>
<pre class="code">
            &lt;map:act type="rollback"&gt;
              &lt;map:redirect-to session="true" uri="{location}"/&gt;
            &lt;/map:act&gt;
      </pre>
<a name="N10D50"></a><a name="URL-N10D50"></a>
<h5>URL</h5>
<p>The call of the URL </p>
<pre class="code">{document-URL}?lenya.usecase=rollback&amp;lenya usecase.step=rollback&amp;rollbackTime={time-point}</pre>
<p>invokes the rollbak to the version corresponding to the time {time-point}</p>
<a name="N10D63"></a><a name="Repository"></a>
<h5>Repository</h5>
<a name="N10D68"></a><a name="docs/components/repository/webdav.html"></a>
<h5>WebDAV Servers</h5>
<a name="N10D70"></a><a name="Apache+1"></a>
<h5>Apache 1</h5>
<p>
Download the Apache Web Server and WebDAV module source code from the Apache website, e.g. <span class="codefrag">apache_1.3.24.tar.gz</span> and <span class="codefrag">mod_dav-1.0.3-1.3.6.tar.gz</span>.
Configure and compile mod_dav:
</p>
<pre class="code">

wget http://www.webdav.org/mod_dav/mod_dav-1.0.3-1.3.6.tar.gz
cd /usr/local/src/mod_dav-1.0.3-1.3.6
./configure --with-apache=/usr/local/src/apache_1.3.24
make
make install
cd /usr/local/src/apache_1.3.24
find . -name "*dav*" -print
./configure --prefix=/usr/local/apache --activate-module=src/modules/dav/libdav.a
(./configure --prefix=/usr/local/apache --enable-module=proxy --activate-module=src/modules/dav/libdav.a)
make
su
make install
/usr/local/apache/bin/httpd -l

</pre>
<p>
You need to reconfigure <span class="codefrag">httpd.conf</span>, e.g.:
</p>
<pre class="code">

DAVLockDB /usr/local/apache/logs/DavLock
&lt;Directory "/usr/local/build/apache/htdocs"&gt;
Dav On

</pre>
<p>
To see the files open "Konqueror" and type <span class="codefrag">webdav://127.0.0.1:8080</span>.
</p>
<p>
More info on <span class="codefrag">mod_dav</span> can be found at
</p>
<ul>

<li>
<a class="external" href="http://www.webdav.org/mod_dav/">http://www.webdav.org/mod_dav/</a>
</li>

<li>
<a class="external" href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/Apache-WebDAV-LDAP-HOWTO.html">Apache and DAV with LDAP and SSL</a>
</li>

</ul>
<a name="N10DA7"></a><a name="Apache+2"></a>
<h5>Apache 2</h5>
<p>
Download the Apache Web Server source code from the Apache website, e.g. <span class="codefrag">httpd-2.0.46.tar.gz</span>.
The mod_dav module is inlcuded with the Apache 2 distribution.
Configure and compile Apache:
</p>
<pre class="code">

./configure --prefix=/usr/local/apache2 --with-dav --enable-dav
make 
make install
/usr/local/apache2/bin/httpd -l | grep dav

</pre>
<p>
You need to reconfigure Apache:
</p>
<pre class="code">

DAVLockDB /usr/local/apache2/logs/DavLock
&lt;Directory "/usr/local/apache2/htdocs"&gt;
Dav On
&lt;/Directory&gt;

</pre>
<p>
More info on <span class="codefrag">mod_dav</span> can be found at
</p>
<ul>

<li>
<a class="external" href="http://apacheworld.org/ty24/site.chapter13.html">http://apacheworld.org/ty24/site.chapter13.html</a>
</li>

<li>
<a class="external" href="http://httpd.apache.org/docs-2.0/mod/mod_dav.html">http://httpd.apache.org/docs-2.0/mod/mod_dav.html</a>
</li>

<li>
<a class="external" href="http://www.informit.com/isapi/product_id~%7BA27264B1-CE7A-47A4-8CC5-DA14003AD454%7D/element_id~%7B35D4A98B-60C6-45BE-853C-239742BA0FD9%7D/st~%7BEA04B5C6-6D59-4670-AC88-4982C49B746D%7D/content/articlex.asp">Apache and DAV</a>
</li>

</ul>
<a name="N10DD7"></a><a name="Tomcat"></a>
<h5>Tomcat</h5>
<p>
Point your WebDAV client to <span class="codefrag">http://127.0.0.1:8080/webdav/</span>.
The webdav context is DAV enabled, but has been set up in read-only mode for safety reasons.
It can be put in read-write mode by editing the web application descriptor file <span class="codefrag">/webapps/webdav/WEB-INF/web.xml</span>.
</p>
<pre class="code">

&lt;!-- Uncomment this to enable read and write access --&gt;
&lt;init-param&gt;
  &lt;param-name&gt;readonly&lt;/param-name&gt;
  &lt;param-value&gt;false&lt;/param-value&gt;
&lt;/init-param&gt;

</pre>
<a name="N10DEB"></a><a name="Apache+Jakarta+Slide"></a>
<h5>Apache Jakarta Slide</h5>
<p>
Point your WebDAV client to <span class="codefrag">http://127.0.0.1:8080/slide/</span>.
One needs to configure <span class="codefrag">Domain.xml</span>

</p>
<pre class="code">

&lt;contentstore classname="slidestore.reference.FileContentStore"&gt;
  &lt;parameter name="rootpath"&gt;/usr/local/jakarta-tomcat-4.1.21-LE-jdk14/webapps/lenya/lenya/pubs/notimes/content/authoring/articles&lt;/parameter&gt;
  ...

</pre>
<a name="N10E01"></a><a name="Monitoring+the+WebDAV+exchange"></a>
<h5>Monitoring the WebDAV exchange</h5>
<pre class="code">

cd /usr/local/axis-1_1RC2
java -cp lib/axis.jar org.apache.axis.utils.tcpmon

Enter "Listen Port# 3333" for instance

Select "Act as a... Listener"

Enter "Target Hostname 195.226.6.70" for instance
Enter "Target Port# 8080" for instance

Click "Add" and a new tab saying "3333" should show up

Click on this new tab to view the requests and responses

Enter within your browser "http://127.0.0.1:3333/lenya/index.html"

</pre>
<a name="N10E0C"></a><a name="PROPFIND"></a>
<h5>PROPFIND</h5>
<p>
The WebDAV client will first send a PROPFIND with Depth = 0. Depending on the response (collection or resource)
the WebDAV client will send another PROPFIND with Depth = 1 (collection) or a GET (resource).
</p>
<p>
Collection:
</p>
<pre class="code">

Request
=======

PROPFIND /lenya/blog/authoring/entries/2003/08/24/peanuts/ HTTP/1.1
Pragma: no-cache
Cache-control: no-cache
Accept: text/*, image/jpeg, image/png, image/*, */*
Accept-Encoding: x-gzip, gzip, identity
Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5
Accept-Language: en
Host: 127.0.0.1
Depth: 0



Response
========

HTTP/1.1 207 Multi-Status
X-Cocoon-Version: 2.1
Set-Cookie: JSESSIONID=320E3B1395B867B5BC42B5FC93457C36; Path=/lenya
Content-Type: text/xml
Transfer-Encoding: chunked
Date: Mon, 25 Aug 2003 14:27:12 GMT
Server: Apache Coyote/1.0


&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;

&lt;D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/"&gt;
&lt;D:href&gt;/lenya/blog/authoring/entries/2003/08/24/peanuts/&lt;/D:href&gt;
&lt;D:propstat&gt;
&lt;D:prop&gt;
&lt;lp1:resourcetype&gt;&lt;D:collection/&gt;&lt;/lp1:resourcetype&gt;
&lt;D:getcontenttype&gt;httpd/unix-directory&lt;/D:getcontenttype&gt;
&lt;/D:prop&gt;
&lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
&lt;/D:propstat&gt;
&lt;/D:response&gt;

&lt;/D:multistatus&gt;



Request
=======

PROPFIND /lenya/blog/authoring/entries/2003/08/24/peanuts/ HTTP/1.1
Pragma: no-cache
Cache-control: no-cache
Accept: text/*, image/jpeg, image/png, image/*, */*
Accept-Encoding: x-gzip, gzip, identity
Accept-Charset: iso-8859-1, utf-8;q=0.5, *;q=0.5
Accept-Language: en
Host: 127.0.0.1
Depth: 1



Response
========

HTTP/1.1 207 Multi-Status
X-Cocoon-Version: 2.1
Set-Cookie: JSESSIONID=5A87A774B7B29D04DEDBDECC54477E5B; Path=/lenya
Content-Type: text/xml
Transfer-Encoding: chunked
Date: Mon, 25 Aug 2003 14:27:12 GMT
Server: Apache Coyote/1.0


&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;

&lt;D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/"&gt;
&lt;D:href&gt;/lenya/blog/webdav/entries/2003/08/24/peanuts/index.html&lt;/D:href&gt;
&lt;D:propstat&gt;
&lt;D:prop&gt;
&lt;lp1:resourcetype/&gt;
&lt;D:getcontenttype&gt;text/html&lt;/D:getcontenttype&gt;
&lt;/D:prop&gt;
&lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
&lt;/D:propstat&gt;
&lt;/D:response&gt;

&lt;D:response xmlns:lp1="DAV:" xmlns:lp2="http://apache.org/dav/props/"&gt;
&lt;D:href&gt;/lenya/blog/webdav/entries/2003/08/24/peanuts/charlie.xml&lt;/D:href&gt;
&lt;D:propstat&gt;
&lt;D:prop&gt;
&lt;lp1:resourcetype/&gt;
&lt;lp1:creationdate&gt;2003-07-21T13:04:23Z&lt;/lp1:creationdate&gt;
&lt;lp1:getcontentlength&gt;3845&lt;/lp1:getcontentlength&gt;
&lt;D:getcontenttype&gt;text/xml&lt;/D:getcontenttype&gt;
&lt;/D:prop&gt;
&lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
&lt;/D:propstat&gt;
&lt;/D:response&gt;

&lt;/D:multistatus&gt;

</pre>
<a name="N10E1D"></a><a name="PUT"></a>
<h5>PUT</h5>
<p>
The WebDAV client will send a PUT in order to copy a document onto the server.
</p>
<pre class="code">

Request
=======

PUT /lenya/blog/webdav/entries/2003/08/29/levi/index.xml HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.4b) Gecko/20030507
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,image/jpeg,image/gif;q=0.2,*/*;q=0.1
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Content-Type: text/xml
Content-Length: 1641
Cookie: JSESSIONID=1CF7F4C27B737E3603FFC2D4D4C137CE


&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;echo:entry xmlns:echo="http://example.com/newformat#" xmlns:ent="http://www.purl.org/NET/ENT/1.0/" version="1.0"&gt;
    &lt;echo:title&gt;Lenya&lt;/echo:title&gt;

    &lt;echo:created&gt;2003-08-29T01:46:45&lt;/echo:created&gt;
    &lt;echo:issued&gt;2003-08-29T01:46:45&lt;/echo:issued&gt;
    &lt;echo:modified&gt;2003-08-29T01:46:45&lt;/echo:modified&gt;

    &lt;echo:content mode="escaped" type="text/plain" lang="en-us"&gt;
      Plain Text
    &lt;/echo:content&gt;

    &lt;ent:topic id="introductory"&gt;Hello&lt;/ent:topic&gt;
&lt;/echo:entry&gt;



Response
========

HTTP/1.1 204 No Content
Date: Mon, 18 Aug 2003 14:22:47 GMT
Server: Apache/2.0.46 (Unix) DAV/2
Content-Length: 0
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Type: text/xml

</pre>
<a name="N10E2D"></a><a name="Search"></a>
<h5>Search</h5>
<a name="N10E32"></a><a name="docs/components/search/lucene.html"></a>
<h5>Lucene</h5>
<a name="N10E3A"></a><a name="Generic+Search"></a>
<h5>Generic Search</h5>
<p>URL:</p>
<pre class="code">

/lenya/$PUB_ID/search-$AREA/lucene

</pre>
<p>Indices and Excerpts:</p>
<pre class="code">

src/webapp/lenya/pubs/$PUB_ID/work/search/index/$AREA/index
src/webapp/lenya/pubs/$PUB_ID/work/search/htdocs_dump/$AREA

</pre>
<p>Configuration:</p>
<pre class="code">

src/webapp/global-sitemap.xmap

</pre>
<a name="N10E56"></a><a name="Customizing%2FOverwriting+Generic+Search+Interface"></a>
<h5>Customizing/Overwriting Generic Search Interface</h5>
<p>XSLT:</p>
<pre class="code">

src/webapp/lenya/pubs/$PUB_ID/lenya/xslt/search/search-and-results.xsl

</pre>
<p>URL:</p>
<pre class="code">

/lenya/$PUB_ID/search-$AREA/lucene

</pre>
<a name="N10E6B"></a><a name="Crawling+a+website"></a>
<h5>Crawling a website</h5>
<p>
Crawl a website by running
</p>
<pre class="code">

ant -f src/webapp/lenya/bin/crawl_and_index.xml crawl -Dcrawler.xconf=/home/username/src/cocoon-lenya/src/webapp/lenya/pubs/default/config/search/crawler-live.xconf

</pre>
<p>
whereas the crawler.xconf has the following elements
</p>
<pre class="code">

&lt;crawler&gt;
  &lt;user-agent&gt;lenya&lt;/user-agent&gt;

  &lt;base-url href="http://cocoon.apache.org/lenya/index.html"/&gt;
  &lt;scope-url href="http://cocoon.apache.org/lenya/"/&gt;

  &lt;uri-list src="work/search/lucene/uris.txt"/&gt;
  &lt;htdocs-dump-dir src="work/search/lucene/htdocs_dump/cocoon.apache.org"/&gt;

  &lt;!-- &lt;robots src="robots.txt" domain="cocoon.apache.org"/&gt; --&gt;
&lt;/crawler&gt;

</pre>
<p>
where the element robots is optional.
</p>
<p>
In case you don't have access to the server and want to disallow certain  URLs from being crawled, then
you can also define a "robots.txt" on the crawler side, e.g.
</p>
<pre class="code">

# cocoon.apache.org

User-agent: *
Disallow: /there_seems_to_be_a_bug_within_websphinx_Robot_Exclusion.html
#Disallow:

User-agent: lenya
Disallow: /do/not/crawl/this/page.html

</pre>
<a name="N10E8A"></a><a name="Creating+an+index+from+the+command+line"></a>
<h5>Creating an index from the command line</h5>
<pre class="code">

ant -f src/webapp/lenya/bin/crawl_and_index.xml -Dlucene.xconf=/home/username/src/cocoon-lenya/src/webapp/lenya/pubs/default/config/search/lucene-live.xconf index

</pre>
<p>
whereas the lucene.xconf has the following elements
</p>
<pre class="code">

&lt;lucene&gt;
  &lt;update-index type="new"/&gt;
  &lt;!--
  &lt;update-index type="incremental"/&gt;
  --&gt;

  &lt;index-dir src="../../work/search/lucene/index/index"/&gt;
    &lt;htdocs-dump-dir src="../../work/search/lucene/htdocs_dump"/&gt;

    &lt;indexer class="org.apache.lenya.lucene.index.DefaultIndexer"/&gt;
&lt;!--
    &lt;indexer class="org.apache.lenya.lucene.index.ConfigurableIndexer"&gt;
      &lt;configuration src="cmfs-luceneDoc.xconf"/&gt;
      &lt;extensions src="xml"/&gt;
    &lt;/indexer&gt;
--&gt;
&lt;!--
    &lt;indexer class="org.apache.lenya.lucene.index.ConfigurableIndexer"&gt;
      &lt;configuration src="cmfs-luceneDoc.xconf"/&gt;
      &lt;filter class="foo.bar.FileFilter"/&gt;
    &lt;/indexer&gt;
--&gt;
&lt;/lucene&gt;

</pre>
<a name="N10E9C"></a><a name="Indexing+XML+documents"></a>
<h5>Indexing XML documents</h5>
<p>
In order to index XML documents one needs to configure the <span class="codefrag">org.apache.lenya.lucene.index.ConfigurableIndexer</span> (see above).
</p>
<p>
With namespaces:
</p>
<pre class="code">

&lt;?xml version="1.0"?&gt;

&lt;luc:document xmlns:luc="http://apache.org/cocoon/lenya/lucene/1.0"&gt;
  &lt;luc:field name="currwfstate" type="Text" xpath="/wf:history/wf:version[last()]/@state"&gt;
    &lt;namespace prefix="wf"&gt;http://apache.org/cocoon/lenya/workflow/1.0&lt;/namespace&gt;
  &lt;/luc:field&gt;
&lt;/luc:document&gt;

</pre>
<p>
Concatenating element values and setting default values in case element value doesn't exist:
</p>
<pre class="code">

&lt;?xml version="1.0"?&gt;

&lt;luc:document xmlns:luc="http://apache.org/cocoon/lenya/lucene/1.0"&gt;
  &lt;luc:field name="title" type="Text" xpath="/article/head/title"/&gt;
  &lt;luc:field name="subtitle" type="Text" xpath="/article/head/subtitle"/&gt;
  &lt;luc:field name="lead" type="UnStored" xpath="/article/head/abstract"/&gt;
  &lt;luc:field name="contents" type="UnStored" xpath="/"/&gt;
  &lt;luc:field name="author" type="UnStored"/&gt;
    &lt;namespace prefix="lenya"&gt;http://apache.org/cocoon/lenya/page-envelope/1.0&lt;/namespace&gt;
    &lt;namespace prefix="dc"&gt;http://purl.org/dc/elements/1.1/&lt;/namespace&gt;
    &lt;xpath&gt;/*/lenya:meta/dc:contributor&lt;/xpath&gt;
  &lt;/luc:field&gt;
  &lt;luc:field name="date" type="Text"&gt;
    &lt;namespace prefix="lenya"&gt;http://apache.org/cocoon/lenya/page-envelope/1.0&lt;/namespace&gt;
    &lt;xpath default="1969"&gt;/*/lenya:meta/year&lt;/xpath&gt;&lt;text&gt;.&lt;/text&gt;&lt;xpath default="02"&gt;/*/lenya:meta/month&lt;/xpath&gt;&lt;text&gt;.&lt;/text&gt;&lt;xpath default="16"&gt;/*/lenya:meta/day&lt;/xpath&gt;
  &lt;/luc:field&gt;
&lt;/luc:document&gt;

</pre>
<a name="N10EB7"></a><a name="Extract+text+from+a+PDF+document"></a>
<h5>Extract text from a PDF document</h5>
<pre class="code">

ant -f src/webapp/lenya/bin/crawl_and_index.xml -Dhtdocs.dump.dir=/home/username/src/cocoon-lenya/src/webapp/lenya/pubs/default/work/search/lucene/htdocs_dump xpdf

</pre>
<p>
Also see the targets <span class="codefrag">pdfbox</span> and <span class="codefrag">pdfadobe</span>.
</p>
<a name="N10ECD"></a><a name="URI+Handling"></a>
<h5>URI Handling</h5>
<a name="N10ED2"></a><a name="docs/components/uri-handling/URIParametrizer.html"></a>
<h5>URI Parametrizer</h5>
<a name="N10EDA"></a><a name="Motivation-N10EDA"></a>
<h5>Motivation</h5>
<p>The problem of <a href="#../publication/siteTree.html">determining the doctype</a>
      independent of request URI needs a flexible and yet simple
      solution. This is where the URI Parametrizer comes to the
      rescue.</p>
<a name="N10EE8"></a><a name="Rationale-N10EE8"></a>
<h5>Rationale</h5>
<p>The URI Parametrizer is an action which given an arbitrary
      URI return a configurable number of parameters which it infers
      from this URI. Typical parameters include source document type,
      navigation location, etc. The action itself delegates to task of
      determining the parameters to the Cocoon sitemap, i.e. the
      parameters are determinined using the normal sitemap pipeline
      matching mechanism.</p>
<a name="N10EF1"></a><a name="Overview-N10EF1"></a>
<h5>Overview</h5>
<p>The flow of information is outlined in the following
	diagram:</p>
<div align="center">
<img class="figure" alt="" src="docs/components/uri-handling/images/live/URIParametrizer.png"></div>
<a name="N10EFE"></a><a name="Interfaces"></a>
<h5>Interfaces</h5>
<p>The URIParametrizerAction expects an arbitrary number of
	parameters. Each parameter contains a key value pair which
	denotes the name of the parameter and the source. A typical
	example is as follows:</p>
<pre class="code">
&lt;map:act type="uriparametrizer"&gt;
  &lt;map:parameter name="doctype"
	  value="cocoon://uri-parameter/{publication-id}/doctype"/&gt;
  &lt;map:parameter name="path"
	  value="cocoon://uri-parameter/{publication-id}/path"/&gt;
  &lt;map:generate src="cocoon:/{doctype}/{path}"/&gt;
&lt;/map:act&gt;
</pre>
<p>The <span class="codefrag">uri-parameter</span> prefix is a standard prefix
	which invokes a pipeline in the root sitemap which mounts a
	subsitemap in your publication with the name
	<span class="codefrag">parameter-{parameterName}.xmap</span>.</p>
<p>The action basically just issues a request back to cocoon
	for each parameter. It uses the URI given in the value
	attribute where it also adds the original request URI. So for
	a given request URI <span class="codefrag">foo.html</span> and the parameters
	given above the action basically issues to requests using the
	<span class="codefrag">cocoon:</span> protocol:</p>
<pre class="code">
cocoon://uri-parameter/{publication-id}/doctype/foo.html
cocoon://uri-parameter/{publication-id}/path/foo.html</pre>
<p>The matcher for uri-parameter in the root sitemap then
	tries to mount the sitemaps
	<span class="codefrag">parameter-doctype.xmap</span> and
	<span class="codefrag">parameter-path.xmap</span> in the publication. Then the
	reuest is matched against the parameter sitemap. Here's a very
	simple example of a parameter sitemap:</p>
<pre class="code">
&lt;?xml version="1.0"?&gt;

&lt;map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0"&gt;

  &lt;map:components&gt;
    &lt;map:generators default="file"/&gt;
    &lt;map:transformers default="xslt"/&gt;
    &lt;map:readers default="resource"/&gt;
    &lt;map:serializers default="html"/&gt;
    &lt;map:matchers default="wildcard"/&gt;
    &lt;map:actions/&gt;
  &lt;/map:components&gt;

  &lt;map:views/&gt;

  &lt;map:resources/&gt;

  &lt;map:pipelines&gt;

    &lt;map:pipeline&gt;
      
      &lt;map:match pattern="**"&gt;
	&lt;map:generate type="serverpages" src="content/parameters/doctype.xsp"&gt;
          &lt;map:parameter name="value" value="{1}"/&gt;
        &lt;/map:generate&gt;
	&lt;map:serialize type="xml"/&gt;
      &lt;/map:match&gt;
      
    &lt;/map:pipeline&gt;

  &lt;/map:pipelines&gt;
&lt;/map:sitemap&gt;</pre>
<p>A more serious example could possibly include matchers
	using the SourceTypeAction from the Forrest Project or a
	HashMapAction as outlined in the <a href="#../publication/siteTree.html">SiteTree proposal</a>.</p>
<p>After a match has been found the pipeline in the parameter
	sitemap returns an XML snippet in the following form:</p>
<pre class="code">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;

&lt;parameter xmlns="http://apache.org/cocoon/lenya/uri-parameters/1.0"&gt;article&lt;/parameter&gt;
</pre>
<p>This xml is consequently parsed by the action and returned
	as a HashMap. Inside the action the parameters will be
	available under the names as they were specified in the
	parameters to the action.</p>
<p>The fact that the actual determination is delegated back to
      the sitemap allows for a combination of the <a href="#../publication/siteTree.html">original proposals</a> where
      solutions such as Hashmap and SourceTypeAction were
      outlined.</p>
<a name="N10F49"></a><a name="docs/components/uri-handling/standardURI.html"></a>
<h5>URI Scheme</h5>
<a name="N10F51"></a><a name="Introduction-N10F51"></a>
<h5>Introduction</h5>
<p>We want to standardize CMS functionality across different
      publications so that we can consolidate them in a standard root
      sitemap.</p>
<p>In order to achieve this one precondition is to standardize
      on the URIs how the CMS functionality is invoked.</p>
<p>There are different ways to achieve this. We either reserve
      part of the URI space (e.g. /lenya/foo) or we reserve part of
      the request parameter space (e.g. /foo?lenya=bar)</p>
<a name="N10F60"></a><a name="Dynamic+URIs"></a>
<h5>Dynamic URIs</h5>
<p>We decided to go mostly for the second solution so that we
	  can leave the URI space as required by the publication and use
	  request parameters to invoke CMS actions.</p>
<p>We define two standard request parameters which we use to
	  invoke all CMS actions in a standard way:</p>
<dl>
	  
<dt>
<span class="codefrag">lenya.usecase</span>
</dt>
	  
<dd>The name of the use case, e.g. "publish"</dd>
	  
<dt>
<span class="codefrag">lenya.step</span>
</dt>
	  
<dd>Each use case can have multiple steps,
	    e.g. "showscreen"</dd> 
	
</dl>
<p>
        For further information about usecases, see section <a href="#usecases.html">Usecases</a>.
        </p>
<a name="N10F85"></a><a name="Static+URIs"></a>
<h5>Static URIs</h5>
<p>There are also some static URIs that are needed for the Lenya
	  CMS. They are mostly internal pipelines for resources such as
	  the menu, css or support files for Xopus and Bitflux
	  editors.</p>
<p>There is currently no consistent standard as to under which
	  URI space these resources should be located. Some are
	  residing in <span class="codefrag">/xopus/**</span> or
	  <span class="codefrag">/bitflux/**</span> and others are in
	  <span class="codefrag">/lenya/**</span>.</p>
<a name="N10F9C"></a><a name="docs/components/uri-handling/standardURI.html#uri_definition"></a>
<h5>URI definition</h5>
<p>Given the URI
      <span class="codefrag">/lenya/computerworld/authoring/news/foo.html</span> we
      define the following parts:</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
	
<tr>
	  
<th colspan="1" rowspan="1">URI fragment</th>
	  <th colspan="1" rowspan="1">Name</th>
	
</tr>
	
<tr>
	  
<td colspan="1" rowspan="1">lenya</td>
	  <td colspan="1" rowspan="1"><span class="codefrag">context-prefix</span></td>
	
</tr>
	
<tr>
	  
<td colspan="1" rowspan="1">computerworld</td>
	  <td colspan="1" rowspan="1"><span class="codefrag">publication-id</span></td>
	
</tr>
	
<tr>
	  
<td colspan="1" rowspan="1">authoring</td>
	  <td colspan="1" rowspan="1"><span class="codefrag">area</span></td>
	
</tr>
	
<tr>
	  
<td colspan="1" rowspan="1">news/foo</td>
	  <td colspan="1" rowspan="1"><span class="codefrag">document-id</span></td>
	
</tr>
      
</table>
<a name="N10FF1"></a><a name="Static+URIs-N10FF1"></a>
<h5>Static URIs</h5>
<p>Currently different fragments of the URI space are reserved
	(e.g. <span class="codefrag">/xopus/**</span>, <span class="codefrag">/bitflux/**</span> and
	everything under <span class="codefrag">/lenya/**</span> that hasn't been
	defined previously).</p>
<div class="frame fixme">
<div class="label">Fixme (ce)</div>
<div class="content">The reserved URI space needs to be
      consolidated and standardized.</div>
</div>
<a name="N11008"></a><a name="Dynamic+URIs-N11008"></a>
<h5>Dynamic URIs</h5>
<p>The dynamic URIs that are used for usecases are explained in the
        section <a href="#usecases.html">Usecases</a>.
        </p>
<a name="N11017"></a><a name="docs/components/uri-handling/usecases.html"></a>
<h5>Usecases</h5>
<a name="N1101F"></a><a name="Introduction-N1101F"></a>
<h5>Introduction</h5>
<p>
      Usecases are sequences of pages that are orthogonal to the website,
      i.e. they can be executed without leaving the current URI.
      They are mainly used to execute CMS functions, e.g., to publish a page.
      Usecases are specified by
      </p>
<ul>
      
<li>a <strong>name</strong> and</li>
      
<li>a set of <strong>steps</strong>.</li>
      
</ul>
<p>
      A usecase is executed using the request parameters <span class="codefrag">lenya.usecase</span> and
      <span class="codefrag">lenya.step</span>.
      </p>
<a name="N11041"></a><a name="Matching+Usecases"></a>
<h5>Matching Usecases</h5>
<p>
    To match a usecase in a sitemap, the <span class="codefrag">WildcardRequestParameterMatcher</span>
    is used on the <span class="codefrag">lenya.usecase</span> and <span class="codefrag">lenya.step</span> request
    parameters. The predefined matchers have the types <span class="codefrag">usecase</span> and
    <span class="codefrag">step</span>. A simple example of a usecase pipeline would be:
    </p>
<pre class="code">
&lt;map:match type="usecase" pattern="publish"&gt;
      
  &lt;!-- confirmation screen --&gt;
  &lt;map:match type="step" pattern="showscreen"&gt;
    &lt;map:generate type="serverpages"
        src="content/publishing/publish-screen.xsp"/&gt;
    &lt;map:transform src="xslt/publishing/publish-screen.xsl"/&gt;
    &lt;map:serialize/&gt;
  &lt;/map:match&gt;

  &lt;!-- call publish task --&gt;
  &lt;map:match type="step" pattern="publish"&gt;
    &lt;map:act type="task"&gt;
      &lt;map:parameter name="publication-id" value="{../../1}"/&gt;
      &lt;map:parameter name="task-id" value="{request-param:task-id}"/&gt;
      &lt;map:redirect-to uri="{request:requestURI}" session="true"/&gt;
    &lt;/map:act&gt;
  &lt;/map:match&gt;
        
&lt;/map:match&gt;
</pre>
<a name="N1105D"></a><a name="The+Usecase+Sitemap"></a>
<h5>The Usecase Sitemap</h5>
<p>
  The main usecase sitemap supports a set of generic usecases.
  It is located at <span class="codefrag">lenya/usecase.xmap</span>.
  To implement your publication-specific usecases or to override a generic
  usecase, just add a <span class="codefrag">usecase.xmap</span>
  sitemap to your publication directory. The Lenya usecase sitemap looks for it
  and mounts it before the generic usecases are matched.
  </p>
<a name="N1106C"></a><a name="Overview+of+use+cases"></a>
<h5>Overview of use cases</h5>
<p>The following use cases are known:</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
      
<tr>
        
<th colspan="1" rowspan="1">Use case</th>
        <th colspan="1" rowspan="1"><span class="codefrag">lenya.usecase=</span></th>
        <th colspan="1" rowspan="1"><span class="codefrag">lenya.step=</span></th>
        <th colspan="1" rowspan="1">Comment</th>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Reject Approval</td>
        <td colspan="1" rowspan="1">reject</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to reject a document from approval.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">reject</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Submit for Approval</td>
        <td colspan="1" rowspan="1">submit</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to submit a document to approval.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">submit</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Archive</td>
        <td colspan="1" rowspan="1">archive</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to archive a document.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">archive</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Checkin</td>
        <td colspan="1" rowspan="1">checkin</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm the checkin of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">checkin</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Checkout</td>
        <td colspan="1" rowspan="1">checkout</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm the checkout of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">checkout</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Copy</td>
        <td colspan="1" rowspan="1">copy</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to copy a document.  (The document is held in a clipboard until it is pasted again)</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">copy</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Create</td>
        <td colspan="1" rowspan="1">create</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Show a form allowing to specify the parameters for
        creation of a document</td> 
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">create</td>
        <td colspan="1" rowspan="1">Create the document</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Cut</td>
        <td colspan="1" rowspan="1">cut</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to cut a document.  (The document is held in a clipboard until it is pasted again)</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">cut</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Deactivate</td>
        <td colspan="1" rowspan="1">deactivate</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to deactivate a document.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">deactivate</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Delete</td>
        <td colspan="1" rowspan="1">delete</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to delete a document.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">delete</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Logout</td>
        <td colspan="1" rowspan="1">logout</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm the logout</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Paste</td>
        <td colspan="1" rowspan="1">paste</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to paste a document.  (The document which is held in a clipboard until is pasted)</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">paste</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Publish</td>
        <td colspan="1" rowspan="1">publish</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm the publication of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">publish</td>
        <td colspan="1" rowspan="1">Publish this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Asset upload</td>
        <td colspan="1" rowspan="1">aset</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Show a form allowing to specify the parameters for
          uploading of an asset</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">upload</td>
        <td colspan="1" rowspan="1">Upload the asset</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">insert</td>
        <td colspan="1" rowspan="1">Insert an already uploaded asset</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">upload-and-insert</td>
        <td colspan="1" rowspan="1">Upload and insert an asset</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">remove</td>
        <td colspan="1" rowspan="1">Remove a previously uploaded asset</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1">Rename</td>
        <td colspan="1" rowspan="1">rename</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Confirm to rename a document.</td>
      
</tr>
       
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">rename</td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Rollback</td>
        <td colspan="1" rowspan="1">rollback</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Show a list of all versions of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">view</td>
        <td colspan="1" rowspan="1">View a particular version of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">rollback</td>
        <td colspan="1" rowspan="1">Roll back to a particular version of this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Schedule</td>
        <td colspan="1" rowspan="1">schedule</td>
        <td colspan="1" rowspan="1">showscreen</td>
        <td colspan="1" rowspan="1">Show a list of all task scheduled for this document</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">add</td>
        <td colspan="1" rowspan="1">Add a new task</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">modify</td>
        <td colspan="1" rowspan="1">Modify an existing task</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">delete</td>
        <td colspan="1" rowspan="1">Delete an existing task</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Edit</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1"></td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">Administration</td>
        <td colspan="1" rowspan="1">userAddUser</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Add a user</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">userDeleteUser</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Show a form for adding users</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">userChangeProfile</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the profile of a user</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">userChangePasswordUser</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the password as a user</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">userChangePasswordAdmin</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the password as an administrator</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">userChangeGroups</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the group affiliation of a user</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">iprangeAddIPRange</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Add an IP range</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">iprangeDeleteIPRange</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Delete an IP range</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">iprangeChangeProfile</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the profile of an IP range</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">iprangeChangeGroups</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the group affiliation of an IP range</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">groupAddGroup</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Add a group</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">groupDeleteGroup</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Delete a group</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">groupChangeProfile</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the profile of a group</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">groupChangeMembers</td>
        <td colspan="1" rowspan="1"></td>
        <td colspan="1" rowspan="1">Change the members of a group</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">View Logs</td>
        <td colspan="1" rowspan="1">view-logs</td>
        <td colspan="1" rowspan="1">overview</td>
        <td colspan="1" rowspan="1">Show the logfile list for this publication</td>
      
</tr>
      
<tr>
        
<td colspan="1" rowspan="1">&nbsp;</td>
        <td colspan="1" rowspan="1">&nbsp;</td>
        <td colspan="1" rowspan="1">log</td>
        <td colspan="1" rowspan="1">Show a single logfile</td>
      
</tr>
    
</table>
<div class="frame fixme">
<div class="label">Fixme (ce)</div>
<div class="content">Can the authenticate process done in a
      similar way?</div>
</div>
<a name="N11549"></a><a name="Use+cases"></a>
<h5>Use cases</h5>
<a name="N1154F"></a><a name="Resource+upload"></a>
<h5>Resource upload</h5>
<p>
<span class="codefrag">lenya.usecase=upload</span>
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
          
<th colspan="1" rowspan="1"><span class="codefrag">lenya.step=</span></th>
          <th colspan="1" rowspan="1">additional parameters</th>
          <th colspan="1" rowspan="1">sample value</th>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">showscreen</td>
          <td colspan="1" rowspan="1">xpath</td>
          <td colspan="1" rowspan="1">/NewsML/body.content/block[1]/*[1]</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">insertBefore [optional]</td>
          <td colspan="1" rowspan="1">true</td>
        
</tr>

        
<tr>
          
<td colspan="1" rowspan="1">upload</td>
          <td colspan="1" rowspan="1">documentid</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">xpath</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">insertBefore [optional]</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">uploadFile</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">identifier [optional]</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="2" rowspan="1">All Dublin core identifiers are also accepted</td>
        
</tr>
      
</table>
<a name="N115F0"></a><a name="Create"></a>
<h5>Create</h5>
<p>
<span class="codefrag">lenya.usecase=create</span>
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
          
<th colspan="1" rowspan="1"><span class="codefrag">lenya.step=</span></th>
          <th colspan="1" rowspan="1">additional parameters</th>
          <th colspan="1" rowspan="1">sample value</th>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">showscreen</td>
          <td colspan="1" rowspan="1">parentid</td>
          <td colspan="1" rowspan="1">/dossiers/2003</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">doctype</td>
          <td colspan="1" rowspan="1">Dossier</td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">create</td>
          <td colspan="1" rowspan="1">parentid</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">childid</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1">doctype</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
      
</table>
<a name="N11665"></a><a name="Rollback-N11665"></a>
<h5>Rollback</h5>
<p>
<span class="codefrag">lenya.usecase=rollback</span>
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
          
<th colspan="1" rowspan="1"><span class="codefrag">lenya.step=</span></th>
          <th colspan="1" rowspan="1">additional parameters</th>
          <th colspan="1" rowspan="1">sample value</th>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">showscreen</td>
          <td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">view</td>
          <td colspan="1" rowspan="1">version</td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
      
</table>
<a name="N116A7"></a><a name="View+Logs"></a>
<h5>View Logs</h5>
<p>
<span class="codefrag">lenya.usecase=view-logs</span>
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
          
<th colspan="1" rowspan="1"><span class="codefrag">lenya.step=</span></th>
          <th colspan="1" rowspan="1">additional parameters</th>
          <th colspan="1" rowspan="1">sample value</th>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">overview</td>
          <td colspan="1" rowspan="1"></td>
          <td colspan="1" rowspan="1"></td>
        
</tr>
        
<tr>
          
<td colspan="1" rowspan="1">log</td>
          <td colspan="1" rowspan="1">logfile</td>
          <td colspan="1" rowspan="1">2003-05-13-18-34-00-314.xml</td>
        
</tr>
      
</table>
<div class="frame fixme">
<div class="label">Fixme (ce)</div>
<div class="content">Add remaining use cases</div>
</div>
<a name="N116F1"></a><a name="Asset+Management"></a>
<h5>Asset Management</h5>
<a name="N116F6"></a><a name="docs/components/asset-management/management.html"></a>
<h5>Asset Management</h5>
<a name="N116FE"></a><a name="Introduction-N116FE"></a>
<h5>Introduction</h5>
<p>Asset management is the process by which assets, such as pdf
      files or images are uploaded to the server and inserted into a
      document.</p>
<p>Assets can be either inserted directly into a document or can
      be uploaded for later insertion. Direct insertion happens when
      editing the document, upload and removal can be done in the
      asset tab in the site area.</p>
<a name="N1170B"></a><a name="Asset+upload"></a>
<h5>Asset upload</h5>
<p>The upload of assets is done quite simply with a multipart
      request. The Upload screen is generated by an xsp
      (<span class="codefrag">asset.xsp</span>) which handles asset upload, image
      upload, asset insertion and image insertion. This screen then
      generates the multipart request which is eventually handled by
      the <span class="codefrag">AssetUploadAction</span>. This action stores the asset
      in the resources directory and generates a meta file with the
      dublin core meta data that was passed in as request parameter or
      with data that was extracted from the request (mime type,
      size). Where the asset is stored is determined by the
      <span class="codefrag">ResourcesManager</span>.</p>
<a name="N1171E"></a><a name="Asset+insertion+%28via+%22enable+asset+upload%22+screen%29"></a>
<h5>Asset insertion (via "enable asset upload" screen)</h5>
<p>Once the asset is uploaded, a reference to it has to be
      inserted in the original document. Images and "plain" assets are
      handled slighly different but the basic mechanism is the
      same.</p>
<p>The insertion is done via an ant task
      (<span class="codefrag">insert-asset</span>). This task generates a temporary
      XSLT stylesheet using <span class="codefrag">generate-insertAsset-xsl.xsl</span>
      as a meta stylesheet and an XML template which defines the XML
      snippet that will be inserted in the refering document. The path
      to the XML template is passed as a parameter to the ant
      task. Usually these templates are located in
      <span class="codefrag">config/asset</span>. The generated temporary stylesheet is
      then applied to the document where the reference to the asset is
      to be inserted. It will insert the appropriate XML snippet.</p>
<a name="N11734"></a><a name="Asset+insertion+%28via+Bitflux+editor%29"></a>
<h5>Asset insertion (via Bitflux editor)</h5>
<p>Images and assets can also be inserted from within the Bitflux editor.</p>
<p>The insertion is done via a XSLT stylesheet 
      (<span class="codefrag">image.xsl</span> or <span class="codefrag">asset.xsl</span> in <span class="codefrag">xslt/bxeng</span>). 
      These stylesheets create a popup window that let the user select an asset or image
      and insert it into the currently opened document via javascript.</p>
<a name="N1174A"></a><a name="Asset+removal"></a>
<h5>Asset removal</h5>
<p>Assets can be removed in the asset tab in the site area. This
      removes the asset from the resources directory. It does not
      however remove any references to it.</p>
<p>Removal is done with an ant task (<span class="codefrag">remove-asset</span>)
      which simply deletes the asset from the resources directory.</p>
<a name="N1175A"></a><a name="Involved+classes%2C+XSPs+and+XSLTs"></a>
<h5>Involved classes, XSPs and XSLTs</h5>
<p>The following classes, XSPs and XSLTs are involved in the
      asset upload:</p>
<dl>
	
<dt>src/webapp/lenya/content/authoring/asset.xsp, src/webapp/lenya/xslt/authoring/asset.xsl</dt>
	
<dd>Take care of displaying the proper asset upload
	screen. There are different screens for image and asset upload
	and for upload with or without subsequent insertion.</dd> 
	
<dt>org.apache.lenya.cms.cocoon.acting.UploadAction</dt>
	
<dd>Handles the upload request, stores the asset in
	<span class="codefrag">resources/authoring/$document-id/$resource-name</span>,
	and creates a file containing the dublin core meta data for
	the asset.</dd>
	
<dt>$publication-id/config/assets/*</dt>
	
<dd>Define the XML snippets that is to be inserted in lieu of a
	refernce to an asset.</dd>
	
<dt>src/webapp/lenya/xslt/util/generate-insertAsset-xsl.xsl</dt>
	
<dd>The meta stylesheet which generates the XSLT the will
	insert the proper XML snippet to link to the asset in the
	refering document.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">insert-asset</span> target which handles
	asset insertion. Also defines the <span class="codefrag">remove-asset</span>
	target.</dd> 
	
<dt>org.apache.lenya.cms.publication.ResourcesManager</dt>
	
<dd>Manages resources and hides away some of the iplementaion
	details where resources and their meta data is stored.</dd>
      
</dl>
<a name="N11796"></a><a name="Link+Management"></a>
<h5>Link Management</h5>
<a name="N1179B"></a><a name="docs/components/link-management/link-management.html"></a>
<h5>Link Management</h5>
<a name="N117A3"></a><a name="Introduction-N117A3"></a>
<h5>Introduction</h5>
<p>Link Managements deals with internal links, i.e. documents
      that refer to other documents within the same publication. These
      links might have to be changed.</p>
<ol>
	
<li>if a document not yet live,</li>
	
<li>if it is withdrawn from live or </li>
	
<li>if its document-id has changed because it is moved to a
        different location within the site tree.</li>
	
<li>references in authoring have to link to documents in
	<span class="codefrag">authoring</span>, however once they are published they
	need to refer to documents in <span class="codefrag">live</span>
</li>
      
</ol>
<p>These four cases have to be dealt with seperately.</p>
<a name="N117C3"></a><a name="A+document+is+not+yet+live"></a>
<h5>A document is not yet live</h5>
<p>This case can happen if the user tries to publish a
	document which has a reference to another document which has
	not been published yet. The reference will be stale as the
	refered document is not in the live area yet. A warning will
	be issued during the publishing process.</p>
<a name="N117CD"></a><a name="A+document+is+withdrawn+from+live"></a>
<h5>A document is withdrawn from live</h5>
<p>If a document which is has references to it is withdrawn
	from the live area the references will be stale, as the
	refered document is no longer available in the live area. A
	warning will be issued during the deactivation process.</p>
<a name="N117D7"></a><a name="A+document-id+changes"></a>
<h5>A document-id changes</h5>
<p>If a document is moved within the site tree such that it
	changes its document-id (e.g. cut a document and paste it
	somewhere else in the hierarchy in the site area) then all
	references to this document have to be changed. This is done
	transparently in the course of the paste.</p>
<a name="N117E1"></a><a name="Rewrite+internal+links+in+live"></a>
<h5>Rewrite internal links in live</h5>
<p>Internal links refer to documents in authoring as long as
	they are not published. However as soon as they are published,
	i.e. reside in the live area their references have to go to
	documents in the live area. A transformer takes care of
	rewriting the internal links.</p>
<a name="N117EC"></a><a name="Implementation"></a>
<h5>Implementation</h5>
<p>The implementation is pretty
      straight-forward and is mostly handled in XSPs and associated
      helper classes. The heavy lifting us done is the class
      <span class="codefrag">Grep</span> and the helper class
      <span class="codefrag">DocumentReferencesHelper</span>. The <span class="codefrag">Grep</span>
      class can traverse the repository and find references to the
      current document or can also find references from the current
      document to other documents. A transformer
      (SimpleLinkRewritingTransformer) is used to rewrite the internal
      links in the live area.</p>
<a name="N117FE"></a><a name="A+document+is+not+yet+live-N117FE"></a>
<h5>A document is not yet live</h5>
<p>This is implemented as an extension to the publish xsp. It
	  queries the <span class="codefrag">DocumentReferencesHelper</span> (using the
	  <span class="codefrag">getInternalReferences</span> method) to ask if there
	  are references from the current document to other documents
	  which have not been published yet. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#findPattern</span> method to search the current
	  document for patterns of a reference. The pattern is defined
	  in <span class="codefrag">DocumentReferencesHelper#getInternalLinkPattern</span>.</p>
<a name="N11817"></a><a name="A+document+is+withdrawn+from+live-N11817"></a>
<h5>A document is withdrawn from live</h5>
<p>This is implemented as an extension to the deactivate
	  xsp. It queries the <span class="codefrag">DocumentReferencesHelper</span>
	  (using the <span class="codefrag">getReferences</span> method) to ask if any
	  other documents refer to the current document. The
	  <span class="codefrag">DocumentReferencesHelper</span> in turn uses the
	  <span class="codefrag">Grep#find</span> method to search the repository for
	  documents which contain a patterns of a reference. The
	  pattern is defined in
	  <span class="codefrag">DocumentReferencesHelper#getReferencesSearchString()</span>.</p>
<a name="N11830"></a><a name="A+document-id+changes-N11830"></a>
<h5>A document-id changes</h5>
<p>This is implemented with an ant task
	  (<span class="codefrag">org.apache.lenya.cms.ant.LinkRewriteTask</span>)
	  which traverses the repository and pipes all documents
	  through an XSLT stylesheet
	  (<span class="codefrag">src/webapp/lenya/xslt/util/linkRewrite.xsl</span>) to
	  modify all references to the document that changed its
	  document-id.
	</p>
<a name="N11840"></a><a name="Rewrite+internal+links+in+live-N11840"></a>
<h5>Rewrite internal links in live</h5>
<p>The
	  <span class="codefrag">org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</span>
	  transformer takes care of rewriting internal links to ensure
	  they refer to the appropriate area.
	</p>
<a name="N1184E"></a><a name="Involved+classes%2C+XSPs+and+XSLTs-N1184E"></a>
<h5>Involved classes, XSPs and XSLTs</h5>
<p>The following classes, XSPs and XSLTs are involved in link
      management:</p>
<dl>
	
<dt>org.apache.lenya.cms.publication.xsp.DocumentReferencesHelper</dt>
	
<dd>A helper class for the publish and deactivate
	xsps. Defines the regular expressions for internal links. Has
	methods to deteremine all references from the current document
	to other documents (<span class="codefrag">getInternalReferences</span>) and to
	determine all references from other documents to the current
	document (<span class="codefrag">getReferences</span>).</dd>
	
<dt>org.apache.lenya.search.Grep</dt>
	
<dd>User by <span class="codefrag">DocumentReferencesHelper</span> to search
	for patterns in a file or in a directory tree.</dd> 
	
<dt>org.apache.lenya.cms.ant.LinkRewriteTask</dt>
	
<dd>An ant task that upon change of a document-id pipes all
	documents of the repository through a XSLT stylesheet which
	rewrites internal links that were refering to the old
	document-id to refere to the new one.</dd> 
	
<dt>org.apache.lenya.cms.cocoon.transformation.SimpleLinkRewritingTransformer</dt>
	
<dd>A transformer that rewrites internal links for the
	appropriate area.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">move-and-rewrite</span> target which
	handles the link rewriting in the case of a paste, i.e. when a
	document-id has changed.</dd>  
	
<dt>src/webapp/lenya/xslt/util/linkRewrite.xsl</dt>
	
<dd>The XSLT transformation used by
	<span class="codefrag">LinkRewriteTask</span> to actually rewrite the internal links.</dd>
	
<dt>src/webapp/lenya/content/publishing/screen.xsp, src/webapp/lenya/xslt/publishing/publish-screen.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case the current document contains references to
	documents which have not been published yet.</dd>
	
<dt>src/webapp/lenya/content/info/deactivate.xsp, src/webapp/lenya/xslt/info/deactivate.xsl</dt>
	
<dd>Query the <span class="codefrag">DocumentReferencesHelper</span> to display
	a warning in case there are links to the current document
	which is about to be deactivated.</dd>
      
</dl>
<a name="N118A2"></a><a name="Meta+Data"></a>
<h5>Meta Data</h5>
<a name="N118A7"></a><a name="docs/components/metadata/metadata.html"></a>
<h5>Meta Data</h5>
<a name="N118AF"></a><a name="Introduction-N118AF"></a>
<h5>Introduction</h5>
<p>Meta data is kept directly inside the xml document. It is
      based on the <a class="external" href="http://dublincore.org">Dublin Core</a>
      standard.</p>
<p>There are basically three use cases:</p>
<ol>
	
<li>Create Meta Data</li>
	
<li>Display Meta Data</li>
	
<li>Modify Meta Data</li>
      
</ol>
<a name="N118CC"></a><a name="Implementation-N118CC"></a>
<h5>Implementation</h5>
<p></p>
<a name="N118D4"></a><a name="Create+Meta+Data"></a>
<h5>Create Meta Data</h5>
<p>Upon creation of a document a sample is copied from the
	sample doctype directory. This sample already contains some
	sample meta data. The creator then applies an XSLT
	transformation to this sample which adapts the sample values
	to the values suplied in the creator request. This values are
	partially filled in by the user (subject, desciption, etc.)
	and partly by the system (creator, creation data). This is
	done in the <span class="codefrag">create</span> ant task which at the end
	invokes an xslt task which applies the
	<span class="codefrag">addMetaData.xsl</span> stylesheet which adapts the meta
	data according to the request values.</p>
<a name="N118E4"></a><a name="Display+Meta+Data"></a>
<h5>Display Meta Data</h5>
<p>The display of meta data is handled by the <span class="codefrag">meta.xsp</span> xsp.</p>
<a name="N118F1"></a><a name="Modify+Meta+data"></a>
<h5>Modify Meta data</h5>
<p>The modification of meta data is handled in the
	<span class="codefrag">info.xmap</span> sitemap. The matcher makes sure to
	check the document out before the modification and checking it
	back in after the modification. This is done using the
	<span class="codefrag">ReservedCheckoutTestAction</span> and
	<span class="codefrag">ReservedCheckinAction</span>.  If there is an error the
	request is redirected to the meta data screen which displays a
	warning saying that the checkout or checkin failed and who was
	locking the document since what date and time.</p>
<p>Once the document is checked out the madifications are
	applied with the help of an ant task. There is a target named
	<span class="codefrag">save-meta-data</span> which simply invokes the ant task
	<span class="codefrag">WriteDCParametersTask</span>.  This task saves the meta
	data using the <span class="codefrag">DublinCore</span> interface.</p>
<a name="N11911"></a><a name="Involved+classes%2C+XSPs+and+XSLTs-N11911"></a>
<h5>Involved classes, XSPs and XSLTs</h5>
<p>The following classes, XSPs and XSLTs are involved in meta
      data handling:</p>
<dl>
	
<dt>org.apache.lenya.cms.ant.WriteDCParametersTask</dt>
	
<dd>A simple ant task which saves the meta data which is
	  passed as arguments to file using the
	<span class="codefrag">DublinCore</span> class.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">save-meta-data</span> target which
	handles saving of meta data with the help of the
	<span class="codefrag">WriteDCParametersTask</span> ant task. Also defines
	the <span class="codefrag">create</span> target which is used create new
	documents and to change the meta data according to the request
	values from the creation request.</dd>
	
<dt>org.apache.lenya.cms.publication.DublinCore</dt>
	
<dd>A simple interface to save and retrieve dublin core meta
	data.</dd>
	
<dt>org.apache.lenya.cms.cocoon.acting.ReservedCheckoutTestAction</dt>
	
<dd>Action that tests if a document can be checked out and if
	yes does check it out (See <a href="#../revisioncontrol/revisioncontroller.html">Revision Controller</a>).</dd>
	
<dt>org.apache.lenya.cms.cocoon.acting.ReservedCheckinAction</dt>
	
<dd>Action that checks a document in (See <a href="#../revisioncontrol/revisioncontroller.html">Revision Controller</a>).</dd>
	
<dt>src/webapp/lenya/content/info/meta.xsp, src/webapp/lenya/xslt/info/info.xsl</dt>
	
<dd>Handle the display of the meta data in the info area. This
	is also a form which can be used to modify the meta data via a
	POST request.</dd>
	
<dt>src/webapp/lenya/xslt/authoring/addMetaData.xsl</dt>
	
<dd>Simple XSLT stylesheet that modifies the meta data
	according to the input parameters.</dd>
      
</dl>
<a name="N1195E"></a><a name="Multilingual+Documents"></a>
<h5>Multilingual Documents</h5>
<a name="N11963"></a><a name="docs/components/multilingual/multilingual.html"></a>
<h5>Mulitilingual Document handling</h5>
<a name="N1196B"></a><a name="Introduction-N1196B"></a>
<h5>Introduction</h5>
<p>Mulitilingual Document handling deals with documents of
      different languages. This affects virtually every part of Lenya,
      namely many aspects of work flow such as creation, publication,
      deactivation, deletion. It also affects access control, meta
      data, etc.</p>
<p>The multilingual capabilities are not a mandatory feature of
      Lenya. You can easily create monolingual publication by simply
      replacing a few properties in
      <span class="codefrag">publication.xconf</span>.</p>
<p>The multilingual capabilities are deeply ingrained in the
      core of Lenya and as such a conceptual overview has to delve
      into many areas of Lenya. The main parts of the multilingual
      capabilities are as follows:</p>
<dl>
	
<dt>Site tree</dt>
	
<dd>The <a href="#../publication/siteTree.html">site
	tree</a> contains information about documents. It has been
	expanded to also contain information about different language
	versions of the same document. Different language versions of
	the same document share the same
	<span class="codefrag">document-id</span>.</dd>

	
<dt>Default language</dt> 
	
<dd>A publication has a default language. This is the language
	in which the document is created. However it is not
	necessarily the case that there is always a document version
	in the default language as the user is allowed to remove any
	language version even the one for the default language.<br>
	If you specify an URL without a language suffix you are
	redirected to the default language document.</dd>

	
<dt>publication.xconf</dt>
	
<dd>This is where the available languages and the default
	language are specified.</dd>

	
<dt>page-envelope</dt> 
	
<dd>The <a href="#../publication/pageenvelopemodule.html">page
	envelope</a> exports document specific information such as
	document-id via an input module. Naturally language specific
	information for the current document is also available via the
	page envelope.
	</dd>

	
<dt>Redirection</dt>
	
<dd>If you request a document <span class="codefrag">foo.html</span> in a
	multilingual publication you will internally be redirected to
	<span class="codefrag">foo_en.html</span> if "en" is the default language.</dd>

	
<dt>Special cases</dt>
	
<dd>Some special care has to be taken when removing language
	versions. The current implementation does not allow the user
	to remove all language versions of a document. There always
	has to be at least one language version.
	</dd>
      
</dl>
<a name="N119B8"></a><a name="Implementation-N119B8"></a>
<h5>Implementation</h5>
<p></p>
<a name="N119C0"></a><a name="Site+tree"></a>
<h5>Site tree</h5>
<p>The site tree contains nodes for each document. Each node
	can contain multiple <span class="codefrag">label</span> nodes for each
	language version of the document.</p>
<pre class="code">
&lt;node id="doctypes"&gt;
	&lt;label xml:lang="de"&gt;Dokumenttypen&lt;/label&gt;
	&lt;label xml:lang="en"&gt;Document types&lt;/label&gt;
	&lt;node id="1column"&gt;
		&lt;label xml:lang="de"&gt;1 Spalte&lt;/label&gt;
	&lt;/node&gt;
&lt;/node&gt;
</pre>
<p>The classe <span class="codefrag">SiteTree</span> and
	<span class="codefrag">SiteTreeNode</span> provide interfaces to the nodes and
	the corresponding label nodes.</p>
<a name="N119DA"></a><a name="publication.xconf"></a>
<h5>publication.xconf</h5>
<p>The <span class="codefrag">languages</span> node in
	<span class="codefrag">publication.xconf</span> defines the languages that are
	available for this publication and also defines the default language.</p>
<pre class="code">
&lt;languages&gt;
  &lt;language default="true"&gt;de&lt;/language&gt;
  &lt;language&gt;en&lt;/language&gt;
&lt;/languages&gt;
</pre>
<p>This information is available via the
	<span class="codefrag">Publication</span> class
	(<span class="codefrag">getDefaultLanguage()</span> and
	<span class="codefrag">getLanguages()</span> methods).</p>
<a name="N119FA"></a><a name="page-envelope"></a>
<h5>page-envelope</h5>
<p>The <a href="#../publication/pageenvelopemodule.html">page-envelope
	input module</a> exports language related information,
	namely <span class="codefrag">default-language</span>,
	<span class="codefrag">document-label</span>, <span class="codefrag">document-language</span>,
	<span class="codefrag">document-languages</span> and
	<span class="codefrag">document-languages-csv</span>.</p>
<a name="N11A17"></a><a name="Redirection"></a>
<h5>Redirection</h5>
<p>The <span class="codefrag">DefaultDocumentBuilder</span> which implements the
	<span class="codefrag">DocumentBuilder</span> interface, takes care of
	redirecting language agnostic URLs (such as
	<span class="codefrag">foo.html</span>) to language aware links
	(<span class="codefrag">foo_en.html</span>), i.e. language agnostic links are
	redirected to the language aware link with the default language.</p>
<a name="N11A2D"></a><a name="Addition+and+removal"></a>
<h5>Addition and removal</h5>
<p>More language versions are added with the "Create new
	language version" screen. Existing language versions can be
	removed with the "Remove Language" screen. These screens are
	generated by <span class="codefrag">create-language.xsp</span>,
	<span class="codefrag">create-language.xsl</span>, <span class="codefrag">removelabel.xsp</span>
	and <span class="codefrag">removelabel.xsl</span>.</p>
<p>The creation of a new language version is done via the
	<span class="codefrag">create-language</span> target which uses the
	<span class="codefrag">InsertLabelTask</span> ant task to insert a label in the
	site tree.</p>
<p>The removal of a language version is done via the
	<span class="codefrag">remove-language</span> target, which uses the
	<span class="codefrag">RemoveLabelTask</span> ant task (which removes the label
	from the site tree).</p>
<a name="N11A56"></a><a name="Involved+classes%2C+XSPs+and+XSLTs-N11A56"></a>
<h5>Involved classes, XSPs and XSLTs</h5>
<p>The following classes, XSPs and XSLTs are involved in
      multilingual document handling:</p>
<dl>
	
<dt>org.apache.lenya.cms.publication.SiteTree and org.apache.lenya.cms.publication.SiteTreeNode</dt>
	
<dd>These interfaces provide acces to the label nodes.</dd>
	
<dt>org.apache.lenya.cms.publication.Publication</dt>
	
<dd>Provides access to the default language and to all
	available languages.</dd>
	
<dt>org.apache.lenya.cms.publication.PageEnvelope</dt>
	
<dd>Exports language related information such as
	<span class="codefrag">default-language</span>, <span class="codefrag">document-language</span>,
	etc.</dd>
	
<dt>org.apache.lenya.cms.publication.DefaultDocumentBuilder</dt>
	
<dd>Builds a document with the given language. The default
	implementation also takes care of redirecting
	<span class="codefrag">foo.html</span> to <span class="codefrag">foo_en.html</span>.</dd>
<!-- 	FIXME: move this to the core -->
	
<dt>$publication-id/lenya/content/authoring/create-language.xsp,
	$publication-id/lenya/xslt/authoring/create-language.xsl
	</dt>
	
<dd>Generate the "Create new language version" screen.</dd>
	
<dt>src/webapp/lenya/content/authoring/removelabel.xsp, src/webapp/lenya/xslt/authoring/removelabel.xsl
	</dt>
	
<dd>Generate the "Remove Language" screen.</dd>
	
<dt>org.apache.lenya.cms.ant.InsertLabelTask</dt>
	
<dd>Ant task to add a label to the site tree.</dd>
	
<dt>org.apache.lenya.cms.ant.RemoveLabelTask</dt>
	
<dd>Ant task to remove a label from the site tree.</dd>
	
<dt>$publication-id/config/tasks/targets.xml</dt>
	
<dd>Defines the <span class="codefrag">create-language</span> and the
	<span class="codefrag">remove-language</span> target which
	handle the addition and removal of language versions of a document.</dd>  
      
</dl>
<a name="N11AAF"></a><a name="Tasks"></a>
<h5>Tasks</h5>
<a name="N11AB4"></a><a name="docs/components/tasks/concept.html"></a>
<h5>The Task Concept</h5>
<p>
In Lenya CMS, a <strong>task</strong> is used to implement a process
which can be invoked by the user. Tasks are triggered
from the sitemap using a <a href="#taskaction.html"><span class="codefrag">TaskAction</span></a>
or <a href="#scheduling.html">scheduled</a> using a <span class="codefrag">TaskJob</span>.
</p>
<p>
Typical tasks are
</p>
<ul>
  
<li>publishing a page,</li>
  
<li>exporting a page to a live server,</li>
  
<li>manipulating a file,</li>
  
<li>sending an e-mail, or</li>
  
<li>creating a backup of your site.</li>

</ul>
<a name="N11AE4"></a><a name="docs/components/tasks/defining.html"></a>
<h5>Defining Tasks</h5>
<p>
All tasks to be used in a publication must be declared in the file
<span class="codefrag">[publication-directory]/content/tasks.xconf</span>.
A typical task configuration file looks like follows:
</p>
<pre class="code">

&lt;?xml version="1.0"?&gt;
&lt;tasks&gt;

  &lt;!-- publish page --&gt;
  &lt;task id="publish"&gt;
    &lt;label&gt;Publish&lt;/label&gt;
    &lt;task id="publish" class="org.lenya.cms.publishing.DefaultFilePublisher"&gt;
      &lt;parameter name="live-path" value="content/live"/&gt;
      &lt;parameter name="tree-live-path" value="content/live/tree.xml"/&gt;
    &lt;/task&gt;
    &lt;task id="export" class="org.lenya.cms.publishing.StaticHTMLExporter"&gt;
      &lt;parameter name="export-path" value="resources/export/pending"/&gt;
      &lt;parameter name="substitute-regexp" value="s/\/lenya\/your-publication//g"/&gt;
    &lt;/task&gt;
  &lt;/task&gt;
&lt;/tasks&gt;

</pre>
<p>
Every task must have a unique <span class="codefrag">id</span> attribute. This identifier is
used to address the task from the sitemap.
Every top-level task must have a child element <span class="codefrag">&lt;label&gt;</span>. The
content of this element is used, e. g., by the scheduler to let the user choose
a task from a list. The actual implementation of a task is identified using the
<span class="codefrag">class</span> attribute.
</p>
<a name="N11B02"></a><a name="Parameters"></a>
<h5>Parameters</h5>
<p>
Usually, a task needs some parameters to be executed properly.
There are two possibilities to pass parameters to a task:</p>
<ol>
  
<li>
    You can define all parameters or a subset of them in the <span class="codefrag">tasks.xconf</span> file.
  </li>
  
<li>
    The remainig parameters can be handled to the <span class="codefrag">TaskAction</span> or the
    <span class="codefrag">TaskJob</span> that executes the task. Request parameters always have a higher
    priority than parameters from the <span class="codefrag">tasks.xconf</span> file.
  </li>

</ol>
<p>
To simplifiy the passing of parameters to tasks, the <span class="codefrag">TaskAction</span> and
<span class="codefrag">TaskJob</span> objects create some default parameters based on
the request and session objects:</p>
<ul>
  
<li>
    
<span class="codefrag">Task.PARAMETER_SERVLET_CONTEXT</span> - the path of the servlet context<br>
    
<span class="codefrag">/home/user_id/build/jakarta-tomcat/webapps/lenya</span>
  
</li>
  
<li>
    
<span class="codefrag">Task.PARAMETER_SERVER_URI</span> - the server URI<br>
    
<span class="codefrag">http://www.yourhost.com:8080/lenya/publication/index.html</span>
  
</li>
  
<li>
    
<span class="codefrag">Task.PARAMETER_SERVER_PORT</span> - the server port<br>
    
<span class="codefrag">http://www.yourhost.com:8080/lenya/publication/index.html</span>
  
</li>
  
<li>
    
<span class="codefrag">Task.PARAMETER_CONTEXT_PREFIX</span> - the part of the URI that precedes the publication ID<br>
    
<span class="codefrag">http://www.yourhost.com:8080/lenya/publication/index.html</span>
  
</li>
  
<li>
    
<span class="codefrag">Task.PARAMETER_PUBLICATION_ID</span> - the publication ID<br>
    
<span class="codefrag">http://www.yourhost.com:8080/lenya/publication/index.html</span>
  
</li>

</ul>
<a name="N11B63"></a><a name="Task+Sequences"></a>
<h5>Task Sequences</h5>
<p>
Tasks can be nested using so-called <em>task sequences</em>. Sub-tasks of other
tasks don't need to have <span class="codefrag">&lt;label&gt;</span> elements because they can't
be addressed independently. Whenever a task sequence is executed, all sub-tasks
are executed in the same order as they are declared.
</p>
<p>
When you group tasks, the enclosing <span class="codefrag">&lt;task&gt;</span> element does not
need a <span class="codefrag">&lt;class&gt;</span> attribute. If you omit it, the <span class="codefrag">TaskSequence</span>
class is used as default. If you want to implement your own task grouping
mechanism using a subclass of <span class="codefrag">TaskSequence</span>, you can append a
class attribute.
</p>
<p>
All parameters that are passed to a TaskSequence are forwarded to all tasks
in the sequence. By creating a subclass of <span class="codefrag">TaskSequence</span> you could implement
a parameter selection mechanism, e. g. using namespace prefixes.
</p>
<a name="N11B87"></a><a name="Assigning+Tasks+to+Document+Types"></a>
<h5>Assigning Tasks to Document Types</h5>
<p>
Every document type can support a set of tasks. The labels of these tasks
are displayed on the scheduler screen of a document of this type.
To assign a task to a document type, you have to edit the file
<span class="codefrag">[publication-directory]/config/doctypes/doctypes.xconf</span>:
</p>
<pre class="code">

&lt;doctypes&gt;
  &lt;doc type="Simple-Document"&gt;
    &lt;tasks&gt;
      &lt;task id="publish"/&gt;
      &lt;task id="backup"/&gt;
      ...
    &lt;/tasks&gt;
  &lt;/doc&gt;
  ...
&lt;/doctypes&gt;

</pre>
<p>
You can associate every task with an arbitrary number of document types.
</p>
<a name="N11B9B"></a><a name="docs/components/tasks/taskaction.html"></a>
<h5>The TaskAction: Triggering a Task from the Sitemap</h5>
<a name="N11BA3"></a><a name="Declaring+the+Action"></a>
<h5>Declaring the Action</h5>
<p>
To invoke a task from a sitemap pipeline, you use a <span class="codefrag">TaskAction</span>. The
task ID is handled to the action by a <span class="codefrag">task</span> parameter:
</p>
<pre class="code">

&lt;map:components&gt;
  ...
  &lt;map:actions&gt;
    &lt;map:action name="publisher"
                src="org.lenya.cms.cocoon.acting.TaskAction"&gt;
      &lt;task id="publish"/&gt;
    &lt;/map:action&gt;
  &lt;/map:actions&gt;
  ...
&lt;/map:components&gt;

</pre>
<p>
The <span class="codefrag">TaskAction</span> collects the request parameters and forwards them
to the task.
</p>
<pre class="code">

&lt;map:match pattern="lenya/publish*"&gt;
  &lt;map:act type="publisher"&gt;
    &lt;map:redirect-to uri="{parent_uri}" session="true"/&gt;
  &lt;/map:act&gt;
  &lt;map:redirect-to uri="publishScreen?status=failed" session="true"/&gt;
&lt;/map:match&gt;

</pre>
<p>
You can also pass the task ID as a <span class="codefrag">task-id</span> parameter directly in the pipeline:
</p>
<pre class="code">


&lt;map:actions&gt;
  &lt;map:action name="task" src="org.lenya.cms.cocoon.acting.TaskAction"/&gt;
&lt;/map:actions&gt;

...

&lt;map:match pattern="lenya/publish*"&gt;
  &lt;map:act type="task"&gt;
    &lt;map:parameter name="task-id" value="publish-article"/&gt;
    &lt;map:redirect-to uri="{parent_uri}" session="true"/&gt;
  &lt;/map:act&gt;
  &lt;map:redirect-to uri="publishScreen?status=failed" session="true"/&gt;
&lt;/map:match&gt;

</pre>
<a name="N11BCB"></a><a name="Scheduling+a+Task"></a>
<h5>Scheduling a Task</h5>
<p>
See section <strong>Scheduler</strong>.
</p>
<a name="N11BD7"></a><a name="Developing+Your+Own+Tasks"></a>
<h5>Developing Your Own Tasks</h5>
<p>
Every task must implement the <span class="codefrag">org.lenya.cms.task.Task</span> interface.
</p>
<p>
The easiest way to develop your own task is to extend the <span class="codefrag">AbstractTask</span> class.
Its <span class="codefrag">parameterize()</span> method simply replaces old parameter values with new
ones. All you have to do is implementing the <span class="codefrag">execute(String contextPath)</span>
method.
</p>
<p>
You may wonder why we pass the <span class="codefrag">contextPath</span> as a method parameter
since we already pass it as a task parameter. This ensures that the task is always
able to access the Lenya CMS directory, even if it is not created by a <span class="codefrag">TaskAction</span>
or a <span class="codefrag">TaskJob</span>. Furthermore, if you enter a task in the <span class="codefrag">jobs.xml</span>
file manually, you won't have to provide a hard-coded <span class="codefrag">servlet-context</span> parameter.
</p>
<p>

<strong>This feature may be subject to changes. If you have any suggestions to improve
the task implementation, just contact me (Andreas Hartmann) at</strong>
<a class="external" href="#mailto:ah@wyona.org">ah@wyona.org</a>.
</p>
<a name="N11C0C"></a><a name="docs/components/tasks/scheduling.html"></a>
<h5>Scheduling a Task</h5>
<a name="N11C14"></a><a name="Scheduling+a+Task-N11C14"></a>
<h5>Scheduling a Task</h5>
<p>
See section <strong>Scheduler</strong>.
</p>
<a name="N11C21"></a><a name="Included+tasks"></a>
<h5>Included tasks</h5>
<a name="N11C26"></a><a name="docs/components/tasks/anttask.html"></a>
<h5>The AntTask</h5>
<p>
The <span class="codefrag">org.apache.lenya.cms.task.AntTask</span> class can be used to invoke targets
of an Ant project.
</p>
<a name="N11C34"></a><a name="Task+Parameters"></a>
<h5>Task Parameters</h5>
<p>
The task parameters are:
</p>
<ul>
  
<li>
<strong><span class="codefrag">publication-id</span></strong>: The publication ID</li>
  
<li>
<strong><span class="codefrag">buildfile (optional)</span></strong>: The location of the build file
      relative to the publication directory. If this parameter is
      not provided, the file is loaded from the default location (see section <a href="##File+Locations">File Locations</a>).</li>
  
<li>
<strong><span class="codefrag">target (optional)</span></strong>: The build target. If this parameter
      is not provided, the default target is executed.</li>
  
<li>
<strong><span class="codefrag">properties.*</span></strong>: The project properties.</li>
  
<li>
<strong><span class="codefrag">ant.*</span></strong>: The command-line parameters for Ant <strong>(not implemented yet!)</strong>
</li>

</ul>
<a name="N11C65"></a><a name="Logging"></a>
<h5>Logging</h5>
<p>
Every time an <span class="codefrag">AntTask</span> is invoked, a log file is created unsing
the <span class="codefrag">XmlLogger</span>
(<a class="external" href="http://ant.apache.org/manual/listeners.html">manual entry</a>,
<a class="external" href="http://nagoya.apache.org/gump/javadoc/ant/build/javadocs/org/apache/tools/ant/XmlLogger.html">JavaDoc</a>).
For the location of the log files, see section <a href="##File+Locations">File Locations</a>.
The log history can be viewed at the URI
</p>
<pre class="code">
http://.../&lt;publication&gt;/logs/tasks/index.html
</pre>
<a name="N11C85"></a><a name="Writing+AntTask+Buildfiles"></a>
<h5>Writing AntTask Buildfiles</h5>
<p>
Any Ant project file can be used as a buildfile for the <span class="codefrag">AntTask</span>.
There is one implicit property that is always set when an
<span class="codefrag">AntTask</span> is executed:
</p>
<ul>
  
<li>
<strong><span class="codefrag">pub.dir</span></strong>: The absolute path of publication directory.</li>

</ul>
<p>
The runtime properties of the target can be set using task parameters
with the prefix <span class="codefrag">properties</span>, e.&nbsp;g. <span class="codefrag">properties.filename</span>
for a buildfile property named <span class="codefrag">filename</span>.
</p>
<a name="N11CAA"></a><a name="Using+custom+Ant+Tasks"></a>
<h5>Using custom Ant Tasks</h5>
<p>
The implementation of custom Ant tasks is described in the
<a class="external" href="http://ant.apache.org/manual/index.html">Ant User Manual</a>.
If you want to write a general Lenya task, put it into the package
<span class="codefrag">org.lenya.cms.ant</span>. If you want to write a task
that is only suited for your publication, put it in the
<span class="codefrag">&lt;publication&gt;/java/src/</span> directory.
</p>
<a name="N11CBE"></a><a name="File+Locations"></a>
<h5>File Locations</h5>
<p>Default buildfile location:</p>
<pre class="code">&lt;publication&gt;/config/tasks/targets.xml</pre>
<p>Log files:</p>
<pre class="code">&lt;publication&gt;/logs/tasks/*.xml</pre>
<p>Log file presentation stylesheets:</p>
<pre class="code">&lt;webapp&gt;/lenya/xslt/logs/*.xsl</pre>
<a name="N11CDA"></a><a name="Example"></a>
<h5>Example</h5>
<p>
The following buildfile contains the target <span class="codefrag">publish</span>
that can be invoked using the <span class="codefrag">AntTask</span>:
</p>
<pre class="code">
&lt;project name="Example Project" default="publish" basedir="."&gt;

  &lt;!-- implicit properties (set by the AntTask) --&gt;
  &lt;property name="pub.dir" value=""/&gt;

  &lt;!-- publishing properties --&gt;
  &lt;property name="authoring.dir" value="content/authoring"/&gt;
  &lt;property name="live.dir" value="content/live"/&gt;
  &lt;property name="publish.sources" value=""/&gt;

  &lt;target name="publish"&gt;
    &lt;echo&gt;Publish: Copying files from ${authoring.dir} to ${live.dir}&lt;/echo&gt;
    &lt;copy todir="${pub.dir}/${live.dir}"&gt;
      &lt;fileset dir="${pub.dir}/${authoring.dir}"&gt;
        &lt;include name="${publish.sources}"/&gt;
      &lt;/fileset&gt;
    &lt;/copy&gt;
  &lt;/target&gt;

&lt;/project&gt;
</pre>
<p>
You define the task in your <span class="codefrag">tasks.xconf</span> file:
</p>
<pre class="code">
&lt;task id="ant" class="org.lenya.cms.task.AntTask"/&gt;
</pre>
<p>
To invoke the task from your sitemap, you have to define an appropriate
<span class="codefrag">TaskAction</span> instance:
</p>
<pre class="code">
&lt;map:action name="publish"
    src="org.lenya.cms.cocoon.acting.TaskAction"&gt;
  &lt;task id="ant"/&gt;
&lt;/map:action&gt;
</pre>
<p>
You call the action in a pipeline:
</p>
<pre class="code">
&lt;map:match pattern="publish.html"&gt;
  &lt;map:act type="publish"&gt;
    ...
  &lt;/map:act&gt;
&lt;/map:match&gt;
</pre>
<p>And finally, go to your browser and call the URI with the appropriate
parameter(s):</p>
<pre class="code">http://.../publish.html?properties.publish.sources=test.xml</pre>
<a name="N11D11"></a><a name="docs/components/tasks/publisher.html"></a>
<h5>The DefaultFilePublisher Task</h5>
<p>
The DefaultFilePublisher is a task that copies XML source files from
the authoring directory to another location, usually the live directory.
It needs the following parameters:
</p>
<ul>
 
<li>
<strong>publication-id</strong>: the publication identifier</li>
 
<li>
<strong>authoring-path</strong>: the authoring path</li>
 
<li>
<strong>tree-authoring-path</strong>: the location of the <span class="codefrag">tree.xml</span> file</li>
 
<li>
<strong>live-path</strong>: the live path</li>
 
<li>
<strong>tree-live-path</strong>: the location of the <span class="codefrag">tree.xml</span> file</li>
 
<li>
<strong>sources</strong>: a comma-separated list of files to publish</li>

</ul>
<p>
All paths are relative to the publication directory. Usually, the path information is read
from the <span class="codefrag">[publication-directory]/config/publishing/publisher.xconf</span> file:
</p>
<pre class="code">

&lt;publication&gt;
  &lt;authoring&gt;
    &lt;documents href="content/authoring"/&gt;
    &lt;tree href="content/authoring/tree.xml"/&gt;
  &lt;/authoring&gt;
  &lt;live&gt;
    &lt;documents href="content/live"/&gt;
    &lt;tree href="content/live/tree.xml"/&gt;
  &lt;/live&gt;
  ...
&lt;/publication&gt;

</pre>
<p>
You can override the paths in the task configuration file <span class="codefrag">tasks.xconf</span>,
e. g. to use several publishers to publish into different directories:
</p>
<pre class="code">

&lt;tasks&gt;

  &lt;task id="publish-test" class="org.apache.lenya.cms.publishing.DefaultFilePublisher"&gt;
    &lt;label&gt;Publish&lt;/label&gt;
    &lt;parameter name="live-path" value="content/live-test"/&gt;
    &lt;parameter name="tree-live-path" value="content/live-test/tree.xml"/&gt;
  &lt;/task&gt;
  
  &lt;task id="publish-real" class="org.apache.lenya.cms.publishing.DefaultFilePublisher"&gt;
    &lt;label&gt;Publish&lt;/label&gt;
    &lt;parameter name="live-path" value="content/live"/&gt;
    &lt;parameter name="tree-live-path" value="content/live/tree.xml"/&gt;
  &lt;/task&gt;

&lt;/tasks&gt;

</pre>
<p>
The remaining parameters, <span class="codefrag">publication-id</span> and <span class="codefrag">sources</span>, are
passed to the task as request parameters.
</p>
<a name="N11D61"></a><a name="docs/components/tasks/exporter.html"></a>
<h5>The StaticHTMLExporter Task</h5>
<p>
The StaticHTMLExporter is a task that downloads HTML pages from a server and
saves them as HTML files. It needs the following
parameters:
</p>
<ul>
 
<li>
<strong>server-uri</strong>: the server uri, e. g. <span class="codefrag">http://authoring.yourdomain.com</span>
</li>
 
<li>
<strong>server-port</strong>: the server port, e. g. 8080</li>
 
<li>
<strong>publication-id</strong>: the publication id</li>
 
<li>
<strong>export-path-prefix</strong>: the path to save the files to</li>
 
<li>
<strong>uris</strong>: a comma-separated list of uris to download (without server + port)</li>
 
<li>
<strong>substitute-regexp</strong>: a regular expression to substitute a part of the path</li>

</ul>
<p>
Usually, the path information is read
from the <span class="codefrag">[publication-directory]/config/publishing/publisher.xconf</span> file:
</p>
<pre class="code">

&lt;publication&gt;
  ...
  &lt;export&gt;
    &lt;destination href="work/export/pending"/&gt;
    &lt;substitution regexp="s/\/lenya\/unipublic//g"/&gt;
  &lt;/export&gt;
&lt;/publication&gt;

</pre>
<p>
You can override the paths in the task configuration file <span class="codefrag">tasks.xconf</span>,
e. g. to use several publishers to publish into different directories:
</p>
<pre class="code">

&lt;tasks&gt;

  &lt;task id="export-pending" class="org.apache.lenya.cms.publishing.StaticHTMLExporter"&gt;
    &lt;parameter name="export-path" value="work/export/pending"/&gt;
    &lt;parameter name="substitute-regexp" value="s/\/lenya\/your-publication//g"/&gt;
  &lt;/task&gt;

  &lt;task id="export-backup" class="org.apache.lenya.cms.publishing.StaticHTMLExporter"&gt;
    &lt;parameter name="export-path" value="work/backup"/&gt;
    &lt;parameter name="substitute-regexp" value="s/\/lenya\/your-publication//g"/&gt;
  &lt;/task&gt;

&lt;/tasks&gt;

</pre>
<a name="N11DA4"></a><a name="docs/components/tasks/mailtask.html"></a>
<h5>The MailTask</h5>
<p>
A <span class="codefrag">MailTask</span> sends an e-mail. The parameters, such as recipient
address, subject, and body, can either be provided as a task parameter or
extracted from an XML document.
</p>
<a name="N11DB2"></a><a name="Task+Parameters-N11DB2"></a>
<h5>Task Parameters</h5>
<p>
The following parameters must be provided:</p>
<ul>
  
<li>
<strong>server</strong>: the SMTP server URI</li>
  
<li>
<strong>from</strong>: you@yourhost.com</li>
  
<li>
<strong>to</strong>: friend@mail.com</li>
  
<li>
<strong>cc</strong>: other-friends@mail.com</li>
  
<li>
<strong>subject</strong>: Hello World!</li>
  
<li>
<strong>body</strong>: How are you?</li>

</ul>
<a name="N11DDC"></a><a name="Getting+the+mail+data+from+an+XML+source"></a>
<h5>Getting the mail data from an XML source</h5>
<p>
Additionally, you can pass a <span class="codefrag">uri</span> parameter to the <span class="codefrag">MailTask</span>:</p>
<ul>
  
<li>
<strong>uri</strong>: the URI to get the XML file from</li>

</ul>
<p>If this parameter is present, the task tries to fetch an XML document from the URI.
If the parameter <span class="codefrag">uri</span> starts with a <span class="codefrag">http://</span> or <span class="codefrag">ftp://</span>
prefix, the absolute URI is used. If not, the URI is interpreted as relative to the
local publication.</p>
<p>
A complete XML document could look like this:
</p>
<pre class="code">

&lt;mail:mail xmlns:mail="http://apache.org/cocoon/lenya/mail/1.0"&gt;
  &lt;mail:server&gt;mail.yourhost.com&lt;/mail:server&gt;
  &lt;mail:from&gt;you@yourhost.com&lt;/mail:from&gt;
  &lt;mail:to&gt;friend@mail.com&lt;/mail:to&gt;
  &lt;mail:cc&gt;other-friends@mail.com&lt;/mail:cc&gt;
  &lt;mail:subject&gt;Hello Friends!&lt;/mail:subject&gt;
  &lt;mail:body&gt;How are you?&lt;/mail:body&gt;
&lt;/mail:mail&gt;

</pre>
<p>
All child elements of <span class="codefrag">&lt;mail:mail&gt;</span> are optional.
If the <span class="codefrag">uri</span> task parameter is provided, the XML
document is fetched from the URI and the parameters are extracted.
</p>
<p>
Task parameters have a higher priority than elements of the document. This makes it
possible to access one complete XML file from different <span class="codefrag">MailTask</span>s and override
the recepient address or other values.
</p>
<a name="N11E16"></a><a name="Declaring+and+Using+the+MailTask"></a>
<h5>Declaring and Using the MailTask</h5>
<p>
In <span class="codefrag">tasks.xconf</span>, a typical mail task looks like follows:
</p>
<pre class="code">

  &lt;task id="send-newsletter" class="org.lenya.cms.mail.MailTask"&gt;
    &lt;label&gt;Send Newsletter&lt;/label&gt;
    &lt;parameter name="server" value="mail.example.com"/&gt;
    &lt;parameter name="from" value="info@example.com"/&gt;
    &lt;parameter name="to" value="newsletter-subscribers@example.com"/&gt;
    &lt;parameter name="uri" value="/authoring/newsletter/mail.xml"/&gt;
  &lt;/task&gt;

</pre>
<p>
The actual newsletter is received from the URI that is interpreted
relativly to the publication URI. The task can be invoked in a sitemap pipeline:
</p>
<pre class="code">

  &lt;map:action name="task" src="org.lenya.cms.cocoon.acting.TaskAction"/&gt;
  
  ...
  
  &lt;map:match pattern="newsletter/send"&gt;
    &lt;map:act type="task"&gt;
      &lt;map:parameter name="task-id" value="send-newsletter"/&gt;
      &lt;map:redirect-to uri="report-success.html" session="true"/&gt;
    &lt;/map:act&gt;
    &lt;map:redirect-to uri="report-failure.html" session="true"/&gt;
  &lt;/map:match&gt;

</pre>
<a name="N11E2F"></a><a name="docs/components/tasks/development.html"></a>
<h5>Developing Your Own Tasks</h5>
<p>
Every task must implement the <span class="codefrag">org.lenya.cms.task.Task</span> interface.
</p>
<p>
The easiest way to develop your own task is to extend the <span class="codefrag">AbstractTask</span> class.
Its <span class="codefrag">parameterize()</span> method simply replaces old parameter values with new
ones. All you have to do is implementing the <span class="codefrag">execute(String contextPath)</span>
method.
</p>
<p>
You may wonder why we pass the <span class="codefrag">contextPath</span> as a method parameter
since we already pass it as a task parameter. This ensures that the task is always
able to access the Lenya CMS directory, even if it is not created by a <span class="codefrag">TaskAction</span>
or a <span class="codefrag">TaskJob</span>. Furthermore, if you enter a task in the <span class="codefrag">jobs.xml</span>
file manually, you won't have to provide a hard-coded <span class="codefrag">servlet-context</span> parameter.
</p>
<p>

<strong>This feature may be subject to changes. If you have any suggestions to improve
the task implementation, just contact me (Andreas Hartmann) at</strong>
<a class="external" href="#mailto:andreas@apache.org">andreas@apache.org</a>.
</p>
<a name="N11E67"></a><a name="Workflow"></a>
<h5>Workflow</h5>
<a name="N11E6C"></a><a name="docs/components/workflow/terms.html"></a>
<h5>Workflow Terms</h5>
<a name="N11E74"></a><a name="Terms"></a>
<h5>Terms</h5>
<dl>


<dt>Workflow Schema</dt>

<dd>A workflow schema defines a state machine (deterministic finite
automaton - DFA), consisting of 
  <ul>
    
<li>states, including a marked initial state,</li>
    
<li>transitions, and</li>
    
<li>state variables.</li>
  
</ul>

</dd>


<dt>Workflow Instance</dt>

<dd>A workflow instance is an incarnation of a workflow schema.
It consists of
<ul>
  
<li>a current state,</li>
  
<li>a mapping which assigns values to all state variables.</li>

</ul>

</dd>


<dt>Transition</dt>

<dd>A transition describes the switching of a workflow instance
from one state to another. A transition has
<ul>
  
<li>a source state,</li>
  
<li>a destination state,</li>
  
<li>an event,</li>
  
<li>a set of conditions,</li>
  
<li>a set of assignments.</li>

</ul>
Additionally, a transition can be marked as synchronized.
</dd>


<dt>History</dt>

<dd>The history of a workflow instance contains a list of all versions
of the instance. A version contains
<ul>
  
<li>the state,</li>
  
<li>the event that caused the transition (omitted in the first version),</li>
  
<li>a description of the identity that invoked the event (username and IP address)</li>

</ul>

</dd>


<dt>State Variable</dt>

<dd>A workflow schema can contain a set of state variables.
For each instance, the state variables hold certain values.
Values can be assigned during transitions, so a variable can change
its value when a transition fires. Currently, Lenya supports only
boolean state variables.
</dd>


<dt>Condition</dt>

<dd>
A condition can prevent a transition from firing, based on
the current situation.
Examples:
<ul>
  
<li>Does the current user have a certain role on the current URL?
    (<span class="codefrag">RoleCondition</span>, included in Lenya)</li>
  
<li>Does a certain state variable have a certain value
    (e.g., is the document published)?
    (<span class="codefrag">BooleanVariableCondition</span>, included in Lenya)</li>
  
<li>Is the sun shining? (e.g., if the weather report may only
     be published on sunny days)</li>

</ul>

</dd>


<dt>Situation</dt>

<dd>A situation defines the state of the environment
of a workflow instance. Examples are:
<ul>
  
<li>the current user ID</li>
  
<li>the roles of the current user on the current URL</li>

</ul>

</dd>


<dt>Synchronization</dt>

<dd>

<p>A set of workflow instances with the same workflow schema
can be synchronized. If a transition in this schema is marked as
synchronized, it can only be invoked on all instances in the
set at the same time.</p>

<p>When a workflow event is invoked on a set of synchronized
workflow instances, the transition is invoked only if</p>

<ul>
  
<li>all instances are in the source state of the transition, and</li>
  
<li>all conditions of the transition are complied for all
  instances.</li>

</ul>

<p>Then the transition is invoked for all instances in the set.</p>

<p>A common usecase of this concept is the simultaneous publishing
of a set of documents (all language versions of a document,
a section, ...).</p>

</dd>


</dl>
<a name="N11F11"></a><a name="docs/components/workflow/state-machine.html"></a>
<h5>The Workflow State Machine</h5>
<a name="N11F19"></a><a name="Invoking+a+Transition"></a>
<h5>Invoking a Transition</h5>
<p>
When an event <em>e</em> is invoked on a workflow instance <em>I</em>, the following
algorithm is executed:
</p>
<ul>
  
<li>The current state <em>s<sub>current</sub></em> is determined.</li>
  
<li>The transition <em>t</em> from <em>s<sub>current</sub></em> to <em>s<sub>next</sub></em>
      which has the event <em>e</em> is determined.</li>
  
<li>If <em>t</em> is not exactly defined, an exception is thrown.</li>
  
<li>All conditions of <em>t</em> are validated.</li>
  
<li>If all conditions are complied, the transition <em>t</em> fires:
  <ul>
    
<li>All assignments of <em>t</em> are executed.</li>
    
<li>The workflow instance <em>I</em> is advanced to the state <em>s<sub>next</sub></em>.</li>
  
</ul>
  
</li>

</ul>
<a name="N11F6D"></a><a name="docs/components/workflow/configuration.html"></a>
<h5>Workflow Configuration</h5>
<a name="N11F75"></a><a name="Workflow+Schemas"></a>
<h5>Workflow Schemas</h5>
<p>The workflow schema definition files of a publication are located at</p>
<pre class="code">
{publication}/config/workflow/
</pre>
<p>
  A workflow schema definition looks as follows:
</p>
<pre class="code">
&lt;workflow xmlns="http://apache.org/cocoon/lenya/workflow/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://apache.org/cocoon/lenya/workflow/1.0
        ../../../resources/entities/workflow/workflow.xsd"&gt;

  &lt;state id="authoring" initial="true"/&gt;
  &lt;state id="live"/&gt;
  &lt;state id="trash"/&gt;
  &lt;state id="archive"/&gt;

  &lt;variable name="is_live" value="false"/&gt;
  
  &lt;transition source="authoring" destination="authoring"&gt;
    &lt;event id="edit"/&gt;
    &lt;condition class="org.apache.lenya.cms.workflow.RoleCondition"&gt;
      edit, review, organize
    &lt;/condition&gt;
  &lt;/transition&gt;
  
  &lt;transition source="authoring" destination="authoring"&gt;
    &lt;event id="deactivate"/&gt;
    &lt;condition class="org.apache.lenya.workflow.impl.BooleanVariableCondition"&gt;
      is_live = true
    &lt;/condition&gt;
    &lt;condition class="org.apache.lenya.cms.workflow.RoleCondition"&gt;
      review, organize
    &lt;/condition&gt;
    &lt;assign variable="is_live" value="false"/&gt;
  &lt;/transition&gt;
  
  ...
  
&lt;/workflow&gt;  
</pre>
<p>The workflow namespace URI is</p>
<pre class="code">http://apache.org/cocoon/lenya/workflow/1.0</pre>
<a name="N11F90"></a><a name="States"></a>
<h5>States</h5>
<p>
  All states that are used in the workflow schema have to be declared
  using <span class="codefrag">&lt;state&gt;</span> elements. The initial state is
  marked with the <span class="codefrag">initial="true"</span> attribute.
</p>
<a name="N11F9F"></a><a name="Variables"></a>
<h5>Variables</h5>
<p>
  All used variables have to be declared using <span class="codefrag">&lt;variable&gt;</span>
  elements. The initial value of the variable is assigned using the
  <span class="codefrag">value</span> attribute.
</p>
<a name="N11FAE"></a><a name="Transitions"></a>
<h5>Transitions</h5>
<p>
  A transition is declared using the <span class="codefrag">&lt;transition&gt;</span> element.
  The required attributes <span class="codefrag">source</span> and <span class="codefrag">destination</span>
  denote the states that are connected by this transition.
</p>
<p>
  The transition element must contain one <span class="codefrag">&lt;event&gt;</span> element
  with an <span class="codefrag">id</span> attribute. Furthermore, it can contain an
  arbitrary number of <span class="codefrag">&lt;condition&gt;</span> and <span class="codefrag">&lt;assign&gt;</span>
  elements.
</p>
<p>
  A transition element can have a <span class="codefrag">synchronized="true"</span> attribute.
  In this case, if the transition is triggered using a
  <em>SynchronizedWorkflowInstance</em>, it is invoked on all instances.
</p>
<a name="N11FD8"></a><a name="Variable+Assignments"></a>
<h5>Variable Assignments</h5>
<p>A variable assignment has the form</p>
<pre class="code">&lt;assign variable="..." value="..."/&gt;</pre>
<p>
  The variable must have been declared in this workflow schema.
  Because only boolean variables are supported, <span class="codefrag">value</span> must
  be either <span class="codefrag">true</span> or <span class="codefrag">false</span>.
</p>
<a name="N11FF1"></a><a name="Conditions"></a>
<h5>Conditions</h5>
<p>A condition has the form</p>
<pre class="code">&lt;condition class="..."&gt;...&lt;/condition&gt;</pre>
<p>The <span class="codefrag">class</span> attribute contains the complete name
(including the package) of the condition class. You can use the
condition classes that ship with Lenya (see below) or implement your
own conditions. All condition classes must implement the
<span class="codefrag">org.apache.lenya.workflow.Condition</span> interface.
The text inside the element is the expression that should
be evaluated. It is passed as an argument to the <span class="codefrag">setExpression()</span>
method.
</p>
<a name="N12009"></a><a name="BooleanVariableCondition"></a>
<h5>BooleanVariableCondition</h5>
<p>The <em>org.apache.lenya.workflow.impl.BooleanVariableCondition</em> requires
an expression of the form</p>
<pre class="code">{variable-name} = {value}</pre>
<p>
<span class="codefrag">{variable-name}</span> is the name of a variable that
was declared in the workflow schema. <span class="codefrag">{value}</span> is either
<span class="codefrag">true</span> or <span class="codefrag">false</span>.</p>
<a name="N12027"></a><a name="RoleCondition"></a>
<h5>RoleCondition</h5>
<p>The <em>org.apache.lenya.cms.workflow.RoleCondition</em> requires a
comma-separated list of role IDs:
</p>
<pre class="code">{role-id-1}, {role-id-2}, ...</pre>
<p>
  The condition is complied when the current identity has one
  of these roles on the requested URL.
</p>
<a name="N1203B"></a><a name="Assigning+Workflow+Schemas+to+Document+Types"></a>
<h5>Assigning Workflow Schemas to Document Types</h5>
<p>A workflow schema can be assigned to a document type in</p>
<pre class="code">
{publication}/config/doctypes/doctypes.xconf
</pre>
<pre class="code">&lt;doctypes&gt;
  &lt;doc type="content-page"&gt;
    ...
    &lt;workflow src="workflow.xml"/&gt;
  &lt;/doc&gt;
  ...
&lt;/doctypes&gt;</pre>
<a name="N1204D"></a><a name="docs/components/workflow/implementation.html"></a>
<h5>Workflow Implementation</h5>
<a name="N12055"></a><a name="Using+Workflow"></a>
<h5>Using Workflow</h5>
<p>The general workflow interfaces are declared in the package</p>
<pre class="code">org.apache.lenya.workflow</pre>
<p>Workflow objects should only be accessed using these
interfaces.</p>
<p>For the Lenya CMS, the workflow entry point is the class</p>
<pre class="code">org.apache.lenya.cms.workflow.WorkflowFactory</pre>
<div class="frame note">
<div class="label">Note</div>
<div class="content">It should be possible to select the workflow factory dynamically
(this is an enhancement in Bugzilla).</div>
</div>
<p>For further information, consult the Lenya API documentation.</p>
<a name="N12074"></a><a name="Site+Management"></a>
<h5>Site Management</h5>
<a name="N12079"></a><a name="docs/components/sitemanagement/archive.html"></a>
<h5>Archive</h5>
<a name="N12081"></a><a name="Introduction-N12081"></a>
<h5>Introduction</h5>
<p>The archive operation corresponds to a move operation from the authoring area to the archive</p>
<a name="N1208B"></a><a name="Implementation-N1208B"></a>
<h5>Implementation</h5>
<p>Similar to the operation <a href="#move.html">move</a>
</p>
<a name="N12098"></a><a name="Parameters-N12098"></a>
<h5>Parameters</h5>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the task id</li>
      
</ul>
<a name="N120AE"></a><a name="usecase"></a>
<h5>usecase</h5>
<a name="N120B4"></a><a name="Archive+screen"></a>
<h5>Archive screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=archive&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="archive" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/archive.xsp" type="serverpages"/&gt;
               &lt;map:transform src="xslt/info/archive.xsl"&gt;
                &lt;map:parameter name="use-request-parameters" value="true"/&gt;
              &lt;/map:transform&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
          </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    The area for the destination is set to archive in the stylesheet.
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N120CC"></a><a name="Archive+confirmation"></a>
<h5>Archive confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=archive&amp;lenya.step=step&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="archive" type="usecase"&gt;
            &lt;map:match pattern="archive" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request-param:parenturl}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N120E5"></a><a name="Ant+Task+"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">archiveDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the source area</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the destination area</li>
        
<li>
<span class="codefrag">newarchivedocumentid</span>, to compute the unique destination id from the source document id</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the source contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory where are the destination contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">setIdentifier</span>, to save the source document id (in the dc:identifier). Necessary to be able to restore later the document</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N1212A"></a><a name="docs/components/sitemanagement/copy.html"></a>
<h5>Copy</h5>
<a name="N12132"></a><a name="Introduction-N12132"></a>
<h5>Introduction</h5>
<p>The copy operation is performed on the subtree corresponding to a given document id and a given area.</p>
<p>We have to :</p>
<ul>
	    
<li>compute a new id (to not overwrite an already existing file)</li>
	    
<li>copy the contents (xml file)</li>
	    
<li>copy the resources</li>
	    
<li>instantiate the workflow for the new documents</li>
	    
<li>insert a node (with the subtree) in the site tree</li>
	  
</ul>
<a name="N12151"></a><a name="Implementation-N12151"></a>
<h5>Implementation</h5>
<p>It is implemented in a sequence of usecases to get all needed parameters, and use the task concept to execute some ant task</p>
<p>To perform the different operations on the desired subtree, we used the visitor pattern</p>
<a name="N1215E"></a><a name="Parameters-N1215E"></a>
<h5>Parameters</h5>
<p>The parameters are string-value parameters</p>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the area for the destination document</li>
        
<li>the document id for the destination document</li>
        
<li>the user id</li>
        
<li>the ip adress</li>
        
<li>the task id</li>
      
</ul>
<a name="N12183"></a><a name="usecase-N12183"></a>
<h5>usecase</h5>
<p>They are implemented in the usecase sitmap (core)</p>
<a name="N1218C"></a><a name="Copy+screen"></a>
<h5>Copy screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=copy&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="copy" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/copy.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/copy.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N121A4"></a><a name="Copy+confirmation"></a>
<h5>Copy confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=copy&amp;lenya.step=step&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="copy" type="usecase"&gt;
            &lt;map:match pattern="copy" type="step"&gt;
              &lt;map:act type="session-propagator"&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value="{request-param:documentid}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstarea" value="{request-param:area}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.action" value="{request-param:action}"/&gt;
              &lt;/map:act&gt;
              &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The source parameters are saved in the session with the org.apache.cocoon.acting.SessionPropagatorAction</p>
<div class="frame note">
<div class="label">Note</div>
<div class="content">Rem</div>
</div>
<p>The session parameter org.apache.lenya.cms.info.cutdocumentid is needed by the move function. It must be reset to "" else</p>
<a name="N121C1"></a><a name="Paste+screen"></a>
<h5>Paste screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=showscreen</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/paste.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/paste.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the destination are get with the serverpage through the page envelope input module. 
	    Parameters needed by the access controller are also get with this serverpage through the access control input module.
	    The parameters for the source are get from the session with the serverpage .
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N121D9"></a><a name="Paste+confirmation"></a>
<h5>Paste confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=paste&amp;...{parameters}</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="paste" type="step"&gt;
              &lt;map:select type="request-parameter"&gt;
                &lt;map:parameter name="parameter-name" value="task-id"/&gt;  
                &lt;map:when test="moveDocument"&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value=""/&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:when&gt;
                &lt;map:otherwise&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:otherwise&gt;
              &lt;/map:select&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The paste step is also used by the move operation. In this case the parameter org.apache.lenya.cms.info.cutdocumentid must be set to the value of the document id (see <a href="#move.html">Move</a>).
        In case of the copy function the value of org.apache.lenya.cms.info.cutdocumentid in the session must be "".
        The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N121F6"></a><a name="Ant+Task+-N121F6"></a>
<h5>Ant Task </h5>
<p>The ant target is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>The target for copying a document depends on the target newdocumentid, to be sure, that the document id for the destination is unique</p>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N12212"></a><a name="docs/components/sitemanagement/deactivate.html"></a>
<h5>Deactivate a document</h5>
<a name="N1221A"></a><a name="Introduction-N1221A"></a>
<h5>Introduction</h5>
<p>We have to :</p>
<ul>
        
<li>look if there are some live children, if no other language version is live</li> 
	    
<li>delete the live contents (xml file) for the given document id and the given language</li>
	    
<li>delete the live resources for the given document id only if no other language version is live</li>
	    
<li>delete the language from the node corresponding to given the document id or 
	    all the node, if no other language version is live.</li>
	  
</ul>
<a name="N12233"></a><a name="Implementation-N12233"></a>
<h5>Implementation</h5>
<p>It is implemented in a sequence of usecases to get all needed parameters, and uses the task concept to execute some ant task</p>
<a name="N1223D"></a><a name="Parameters-N1223D"></a>
<h5>Parameters</h5>
<p>The parameters are string-value parameters</p>
<p>Required parameters:</p>
<ul>
        
<li>the document id</li>
        
<li>the language</li>
        
<li>the task id</li>
      
</ul>
<a name="N12256"></a><a name="usecase-N12256"></a>
<h5>usecase</h5>
<p>They are implemented in the usecase sitmap (core)</p>
<a name="N1225F"></a><a name="Deactivate+screen"></a>
<h5>Deactivate screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=deactivate&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="deactivate" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/deactivate.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/deactivate.xsl"&gt;
                &lt;map:parameter name="use-request-parameters" value="true"/&gt;
              &lt;/map:transform&gt;
              &lt;map:transform src="cocoon:/notification/{../../1}/deactivate.xsl"/&gt;
              &lt;map:transform src="cocoon://scheduler/{../../1}/{../../2}/{../../3}.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>
        In the serverpage, we get the required parameters and if no other language version is live, we look for the live children.
	    The stylesheet <span class="codefrag">xslt/info/deactivate.xsl</span> builds a form, if the requirement are achieved, else shows a message.</p>
<a name="N1227A"></a><a name="Deactivate+confirmation"></a>
<h5>Deactivate confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=deactivate&amp;lenya.step=deactivate&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="deactivate" type="usecase"&gt;
            &lt;map:match pattern="deactivate" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N12293"></a><a name="Ant+Task+-N12293"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">deactivateDocument</span>is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the target <span class="codefrag">livedocumentpath</span>, to compute the live directory of the contents</p>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N122B5"></a><a name="docs/components/sitemanagement/delete.html"></a>
<h5>Delete</h5>
<a name="N122BD"></a><a name="Introduction-N122BD"></a>
<h5>Introduction</h5>
<p>The delete operation corresponds to a move operation from the authoring area to the trash</p>
<a name="N122C7"></a><a name="Implementation-N122C7"></a>
<h5>Implementation</h5>
<p>Similar to the operation <a href="#move.html">move</a>
</p>
<a name="N122D4"></a><a name="Parameters-N122D4"></a>
<h5>Parameters</h5>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the task id</li>
      
</ul>
<a name="N122EA"></a><a name="usecase-N122EA"></a>
<h5>usecase</h5>
<a name="N122F0"></a><a name="Delete+screen"></a>
<h5>Delete screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=delete&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="delete" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/delete.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/delete.xsl"&gt;
                &lt;map:parameter name="use-request-parameters" value="true"/&gt;
              &lt;/map:transform&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
          </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    The destination area is set to trash in the stylesheet.
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N12308"></a><a name="Delete+confirmation"></a>
<h5>Delete confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=delete&amp;lenya.step=delete&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="delete" type="usecase"&gt;
            &lt;map:match pattern="delete" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request-param:parenturl}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N12321"></a><a name="Ant+Task+-N12321"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">deleteDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the source area</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the destination area</li>
        
<li>
<span class="codefrag">newarchivedocumentid</span>, to compute the unique destination id from the source document id (Same logic like for the archive)</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the contents for the source (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory of the contents for the destination (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">setIdentifier</span>, to save the source document id (in the dc:identifier). Necessary to be able to restore later the document</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N12366"></a><a name="docs/components/sitemanagement/deletetrash.html"></a>
<h5>Delete Trash</h5>
<a name="N1236E"></a><a name="Introduction-N1236E"></a>
<h5>Introduction</h5>
<p>We have to :</p>
<ul>
	    
<li>delete all the files in the trash directory</li>
	    
<li>to reset the trash sitetree</li>
	  
</ul>
<a name="N12381"></a><a name="Parameters-N12381"></a>
<h5>Parameters</h5>
<p>Required parameters:</p>
<ul>
        
<li>the task id </li>
      
</ul>
<a name="N12391"></a><a name="Implementation-N12391"></a>
<h5>Implementation</h5>
<p>It is implemented in a sequence of usecases to get all needed parameters, and uses the task concept to execute some ant task</p>
<a name="N1239B"></a><a name="usecase-N1239B"></a>
<h5>usecase</h5>
<a name="N123A1"></a><a name="Delete+Trash+screen"></a>
<h5>Delete Trash screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=deleteTrash&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
            &lt;map:match pattern="deleteTrash" type="usecase"&gt;
              &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/admin/content/deleteTrash.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/admin/content/deleteTrash.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
          </pre>
<p>The required parameters are get in the serverpage. 
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N123B9"></a><a name="Delete+Trash+confirmation"></a>
<h5>Delete Trash confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=deleteTrash&amp;lenya.step=deleteTrash&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="deleteTrash" type="usecase"&gt;
            &lt;map:match pattern="deleteTrash" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N123D2"></a><a name="Ant+Task+-N123D2"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">deleteTrash</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../../apidocs/index.html">Javadoc</a>
</p>
<a name="N123EE"></a><a name="docs/components/sitemanagement/move.html"></a>
<h5>Move a document</h5>
<a name="N123F6"></a><a name="Introduction-N123F6"></a>
<h5>Introduction</h5>
<p>The move operation is performed on the subtree corresponding to a given document id and a given area.</p>
<p>We have to :</p>
<ul>
	    
<li>compute a new id (to not overwrite an already existing file)</li>
	    
<li>move the contents (xml file)</li>
	    
<li>move the resources</li>
        
<li>move the policies</li> 
        
<li>move the revisions</li> 
        
<li>move the rcml files</li> 
	    
<li>move the workflow for the new documents</li>
	    
<li>move the node (with the subtree) in the site tree</li>
	  
</ul>
<a name="N1241E"></a><a name="Implementation-N1241E"></a>
<h5>Implementation</h5>
<p>It is implemented in a sequence of usecases to get all needed parameters, and uses the task concept to execute some ant task</p>
<p>To perform the different operations on the desired subtree, we used the visitor pattern</p>
<a name="N1242B"></a><a name="Parameters-N1242B"></a>
<h5>Parameters</h5>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the area for the destination document</li>
        
<li>the document id for the destination document</li>
        
<li>the task id</li>
      
</ul>
<a name="N12447"></a><a name="usecase-N12447"></a>
<h5>usecase</h5>
<p>They are implemented in the usecase sitmap (core)</p>
<a name="N12450"></a><a name="Cut+screen"></a>
<h5>Cut screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=cut&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="cut" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/cut.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/cut.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N12468"></a><a name="Cut+confirmation"></a>
<h5>Cut confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=cut&amp;lenya.step=cut&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="cut" type="usecase"&gt;
            &lt;map:match pattern="cut" type="step"&gt;
              &lt;map:act type="session-propagator"&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value="{request-param:documentid}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.firstarea" value="{request-param:area}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value="{request-param:documentid}"/&gt;
                &lt;map:parameter name="org.apache.lenya.cms.info.action" value="{request-param:action}"/&gt;
                &lt;map:redirect-to uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The source parameters are saved in the session with the org.apache.cocoon.acting.SessionPropagatorAction</p>
<p>The parameter <strong>org.apache.lenya.cms.info.cutdocumentid</strong> is used to change the representation of the cutted node in the info sitetree.</p>
<a name="N12486"></a><a name="Paste+screen-N12486"></a>
<h5>Paste screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=showscreen</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/paste.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/paste.xsl"/&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The parameters for the destination are get with the serverpage through the page envelope input module. 
	    Parameters needed by the access controller are also get with this serverpage through the access control input module.
	    The parameters for the source are get from the session with the serverpage .
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N1249E"></a><a name="Paste+confirmation-N1249E"></a>
<h5>Paste confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=paste&amp;lenya.step=paste&amp;...{parameters}</pre>
<p>usecase sitemap (Core):</p>
<pre class="code">
          &lt;map:match pattern="paste" type="usecase"&gt;
            &lt;map:match pattern="paste" type="step"&gt;
              &lt;map:select type="request-parameter"&gt;
                &lt;map:parameter name="parameter-name" value="task-id"/&gt;  
                &lt;map:when test="moveDocument"&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.firstdocid" value=""/&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:when&gt;
                &lt;map:otherwise&gt;
                  &lt;map:act type="session-propagator"&gt;
                    &lt;map:parameter name="org.apache.lenya.cms.info.cutdocumentid" value=""/&gt;
                  &lt;/map:act&gt;
                &lt;/map:otherwise&gt;
              &lt;/map:select&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<p>The parameter <strong>org.apache.lenya.cms.info.cutdocumentid</strong> is set to "", because the cutted node is no more present.</p>
<a name="N124BD"></a><a name="Ant+Task+-N124BD"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">moveDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the source area</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the destination area</li>
        
<li>
<span class="codefrag">newcopydocumentid</span>, to compute the unique destination id</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the source contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory of the destination contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N124FD"></a><a name="docs/components/sitemanagement/moveupdown.html"></a>
<h5>Move up/down</h5>
<a name="N12505"></a><a name="Introduction-N12505"></a>
<h5>Introduction</h5>
<p>To move up or down a node in the sitetree</p>
<a name="N1250F"></a><a name="Implementation-N1250F"></a>
<h5>Implementation</h5>
<p>It uses the task concept to execute some ant task</p>
<a name="N12519"></a><a name="Parameters-N12519"></a>
<h5>Parameters</h5>
<p>The parameters are string-value parameters</p>
<p>Required parameters:</p>
<ul>
        
<li>the document id</li>
        
<li>the direction (up or down)</li>
        
<li>the task id</li>
      
</ul>
<a name="N12532"></a><a name="usecase-N12532"></a>
<h5>usecase</h5>
<p>URL :</p>
<pre class="code">{document-URL}?properties.movenode.direction=up&amp;lenya.usecase=move-node&amp;lenya.step=move-node</pre>
<p>usecase sitemap:</p>
<pre class="code">
        &lt;map:match pattern="move-node" type="usecase"&gt;
          &lt;map:match pattern="move-node" type="step"&gt;
            &lt;map:act type="task"&gt;
              &lt;map:parameter name="task-id" value="movenode"/&gt;
              &lt;map:parameter name="properties.movenode.documentid" value="{page-envelope:document-id}"/&gt;
              &lt;map:redirect-to session="true" uri="{request:requestURI}"/&gt;
            &lt;/map:act&gt;
          &lt;/map:match&gt;
        &lt;/map:match&gt;
        </pre>
<p>The parameter for the direction is a request parameter in the URL (fom the menu). The task id is set in the sitemap and
	     the document id is get through the page envelope. </p>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N1254D"></a><a name="Ant+Task+-N1254D"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">movenode</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../../apidocs/index.html">Javadoc</a>
</p>
<a name="N12569"></a><a name="docs/components/sitemanagement/rename.html"></a>
<h5>Rename</h5>
<a name="N12571"></a><a name="Introduction-N12571"></a>
<h5>Introduction</h5>
<p>The rename operation corresponds to a move operation</p>
<a name="N1257B"></a><a name="Implementation-N1257B"></a>
<h5>Implementation</h5>
<p>Similar to the operation <a href="#move.html">move</a>
</p>
<a name="N12588"></a><a name="Parameters-N12588"></a>
<h5>Parameters</h5>
<p>The parameters are string-value parameters</p>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the area for the destination document</li>
        
<li>the name for the destination document</li>
        
<li>the task id</li>
      
</ul>
<a name="N125A7"></a><a name="usecase-N125A7"></a>
<h5>usecase</h5>
<p>They are implemented in the usecase sitmap (core)</p>
<a name="N125B0"></a><a name="Rename+screen"></a>
<h5>Rename screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=rename&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
            &lt;map:match pattern="rename" type="usecase"&gt;
              &lt;map:match pattern="showscreen" type="step"&gt;
                &lt;map:generate src="content/info/rename.xsp" type="serverpages"/&gt;
                &lt;map:transform src="xslt/info/rename.xsl"/&gt;
                &lt;map:call resource="style-cms-page"/&gt;
              &lt;/map:match&gt;
           &lt;/map:match&gt;
          </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N125C8"></a><a name="Rename+confirmation"></a>
<h5>Rename confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=rename&amp;lenya.step=rename&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="rename" type="usecase"&gt;
            &lt;map:match pattern="rename" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:contextPath}/{../../../1}/{../../../2}/"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N125E1"></a><a name="Ant+Task+-N125E1"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">renameDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>and depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the source area</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the destination area</li>
        
<li>
<span class="codefrag">newnamdocumentid</span>, to compute the unique destination id with the new name</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the source contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory where are the destination contents (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N12621"></a><a name="docs/components/sitemanagement/restore.html"></a>
<h5>Restore</h5>
<a name="N12629"></a><a name="Introduction-N12629"></a>
<h5>Introduction</h5>
<p>The restore operation corresponds to a move operation from an area, trash or archive, to the authoring</p>
<a name="N12633"></a><a name="Implementation-N12633"></a>
<h5>Implementation</h5>
<p>Similar to the operation <a href="#move.html">move</a>
</p>
<a name="N12640"></a><a name="Parameters-N12640"></a>
<h5>Parameters</h5>
<p>Required parameters:</p>
<ul>
        
<li>the area for the source document</li>
        
<li>the document id for the source document</li>
        
<li>the task id</li>
      
</ul>
<a name="N12656"></a><a name="usecase-N12656"></a>
<h5>usecase</h5>
<a name="N1265C"></a><a name="Delete+screen-N1265C"></a>
<h5>Delete screen</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=restore&amp;lenya.step=showscreen</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="restore" type="usecase"&gt;
            &lt;map:match pattern="showscreen" type="step"&gt;
              &lt;map:generate src="content/info/restore.xsp" type="serverpages"/&gt;
              &lt;map:transform src="xslt/info/restore.xsl"&gt;
                &lt;map:parameter name="use-request-parameters" value="true"/&gt;
              &lt;/map:transform&gt;
              &lt;map:call resource="style-cms-page"/&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
          </pre>
<p>The parameters for the source are get with the serverpage through the page envelope input module. 
        The destination document id is computed in the serverpage from the identifier. The destination source is set to area in the stylesheet.
	    A form (build with the xslt transformation) sends then the parameters as request parameters with the new URL.</p>
<a name="N12674"></a><a name="Restore+confirmation"></a>
<h5>Restore confirmation</h5>
<p>URL :</p>
<pre class="code">{document-URL}?lenya.usecase=restore&amp;lenya.step=restore&amp;...{source parameters}</pre>
<p>usecase sitemap:</p>
<pre class="code">
          &lt;map:match pattern="restore" type="usecase"&gt;
            &lt;map:match pattern="restore" type="step"&gt;
              &lt;map:act type="task"&gt;
                &lt;map:redirect-to session="true" uri="{request:contextPath}/{../../../1}/{../../../2}/"/&gt;
              &lt;/map:act&gt;
            &lt;/map:match&gt;
          &lt;/map:match&gt;
        </pre>
<p>The action org.apache.lenya.cms.cocoon.acting.TaskAction calls the execution of the ant task.</p>
<a name="N1268D"></a><a name="Ant+Task+-N1268D"></a>
<h5>Ant Task </h5>
<p>The ant target <span class="codefrag">restoreDocument</span> is in the publication :</p>
<pre class="code">{publication}/config/tasks/targets.xml</pre>
<p>The target for the restore operation depends on the different targets </p>
<ul>
        
<li>
<span class="codefrag">firstareaproperties</span>, to set the needed properties dependent of the area of the source</li>
        
<li>
<span class="codefrag">secareaproperties</span>, to set the needed properties dependent of the area of the destination</li>
        
<li>
<span class="codefrag">newcopydocumentid</span>, to compute the unique destination id (Same logic like for the copy operation).</li>
        
<li>
<span class="codefrag">firstdocumentpath</span>, to compute the directory of the contents for the source (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">secdocumentpath</span>, to compute the directory where are the contents for the destination (Needed for the revisions and the rcml files)</li>
        
<li>
<span class="codefrag">move</span>, to execute the different move operations</li>
      
</ul>
<p>More about ant task, see the documentation <a href="#../tasks/anttask.html">Ant Task</a> and the <a href="#../../apidocs/index.html">Javadoc</a>
</p>
<a name="N126CE"></a><a name="Specifications"></a>
<h4>Specifications</h4>
<a name="N126D3"></a><a name="docs/specs/namespaces.html"></a>
<h5>Namespaces</h5>
<a name="N126DB"></a><a name="Namespaces+Used+in+Lenya"></a>
<h5>Namespaces Used in Lenya</h5>
<p>
All namespace declarations should follow the scheme
</p>
<pre class="code">
http://apache.org/cocoon/lenya/{name}/{version}
</pre>
<dl>


<dt>http://apache.org/cocoon/lenya/sitetree/1.0</dt>

<dd>The sitetree.</dd>


<dt>http://apache.org/cocoon/lenya/cms-page/1.0</dt>

<dd>The layout of a CMS page.</dd>


<dt>http://apache.org/cocoon/lenya/scheduler/1.0</dt>

<dd>Scheduler data.</dd>


</dl>
<a name="N126FE"></a><a name="Miscellaneous"></a>
<h4>Miscellaneous</h4>
<a name="N12703"></a><a name="docs/misc/coding-guidelines.html"></a>
<h5>Apache Lenya Coding Guidelines</h5>
<a name="N1270B"></a><a name="Introduction-N1270B"></a>
<h5>Introduction</h5>
<p>
	We use coding standards to be able to write code easy to
	understand, to maintain, and to enhance.
      </p>
<a name="N12715"></a><a name="Java+Code"></a>
<h5>Java Code</h5>
<p>
	Generally we stick with standards. In the case of coding
	standards we simply use the guidelines from Sun.
      </p>
<p>
	Here are the rules:
      </p>
<ul>
        
<li>Thou shalt only produce code conforming to the Java code
        conventions, as they are set down on the page <a class="external" href="http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html">http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html</a>
        
<p></p>
        
</li>
        
<li>Thou shalt not produce any code containing tab-stops.
        <p></p>
        
</li>
      
</ul>
<a name="N12733"></a><a name="XML+and+XSP"></a>
<h5>XML and XSP</h5>
<p>
	The only restriction we impose on XML, XSLT and XSP code is
	that the indenting is 2 spaces. Again please no tab stops.
      </p>
<a name="N1273E"></a><a name="docs/misc/unittests.html"></a>
<h5>Writing Unit Tests</h5>
<a name="N12746"></a><a name="Introduction-N12746"></a>
<h5>Introduction</h5>
<p>Recommended resources</p>
<ul>
        
<li>
<a class="external" href="http://www.junit.org">JUnit homepage</a>
</li>
        
<li>
<a class="external" href="http://junit.sourceforge.net/doc/cookbook/cookbook.htm">JUnit Cookbook</a> (Eric Gamma, Kent Beck)</li>
        
<li>
<a class="external" href="http://junit.sourceforge.net/doc/cookstour/cookstour.htm">JUnit: A Cook's Tour</a> (Eric Gamma, Kent Beck)</li>
        
<li>
<a class="external" href="http://junit.sourceforge.net/doc/testinfected/testing.htm">JUnitTest Infected: Programmers Love Writing Tests</a>
</li>
      
</ul>
<a name="N12769"></a><a name="Organization"></a>
<h5>Organization</h5>
<ol>
  
<li>Put your test classes in <span class="codefrag">src/test</span>.</li>
  
<li>Add the ant task that executes your test to <span class="codefrag">src/targets/test-build.xml</span>
</li>

</ol>
<a name="N1277D"></a>
<h5></h5>
<a name="N12783"></a><a name="docs/misc/xinclude-processor.html"></a>
<h5>XInclude Processor</h5>
<a name="N1278B"></a><a name="Hello+World"></a>
<h5>Hello World</h5>
<pre class="code">

&lt;hello&gt;
&lt;levi xlink:href="world.xml" xlink:show="embed" xmlns:xlink="http://www.w3.org/1999/xlink"/&gt;
&lt;/hello&gt;

</pre>
<a name="N12796"></a><a name="Hello+World+with+XPointer"></a>
<h5>Hello World with XPointer</h5>
<pre class="code">

&lt;hello&gt;
&lt;levi xlink:href="world.xml#xpointer(/world/countries/country[@id='japan'])xpointer(/world/countries/country[@id='china'])" xlink:show="embed" xmlns:xlink="http://www.w3.org/1999/xlink"/&gt;
&lt;/hello&gt;

</pre>
<a name="N127A1"></a><a name="Hello+World+with+XPointer+and+Namespace"></a>
<h5>Hello World with XPointer and Namespace</h5>
<pre class="code">

&lt;hello&gt;
&lt;levi xlink:href="world.xml#xmlns(solar=http://www.foo.bar/0/solar)xpointer(/solar:world/solar:countries)" xlink:show="embed" xmlns:xlink="http://www.w3.org/1999/xlink"/&gt;
&lt;/hello&gt;

</pre>
</div>
</div>
</td>
</tr>
</table>
</td>
</tr>
</table>
<table>
<tr>
<td>
<br>
<br>
</td>
</tr>
</table>
<table class="footer">
<tr>
<td colspan="2" align="center" width="90%"><span class="footnote"><a href="http://www.apache.org/licenses/LICENSE-2.0">
                Copyright &copy; 2002-2004&nbsp;
                The Apache Software Foundation.</a>
            All rights reserved.
            <br>
<script type="text/javascript" language="JavaScript"><!--
              document.write(" - "+"Last Published: " + document.lastModified);
              //  --></script></span></td><td nowrap="nowrap" align="right" class="logos"></td>
</tr>
</table>
</body>
</html>
