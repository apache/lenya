<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Modules</title>
<link type="text/css" href="../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../skin/profile.css" rel="stylesheet">
<script src="../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with ');" size="25" name="q" id="query" type="text" value="Search the site with ">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../../../1_4/index.html">Version 1.4</a>
</li>
<li>
<a class="base-not-selected" href="../../../1_2_x/index.html">Version 1.2</a>
</li>
<li>
<a class="base-not-selected" href="../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/index.html">Index</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', '../../../skin/')" id="menu_1.1.2Title" class="menutitle">Installation</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/source_version.html">Install Instructions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', '../../../skin/')" id="menu_1.1.3Title" class="menutitle">Concepts</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/concepts/publication.html">Publication</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/authoring_live.html">Authoring and Live mode</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/wysiwyg.html">WYSIWYG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4', '../../../skin/')" id="menu_selected_1.1.4Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Technical Reference</div>
<div id="menu_selected_1.1.4" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/reference/lenya-sitemaps.html">Overview of Lenya Sitemaps</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.2', '../../../skin/')" id="menu_1.1.4.2Title" class="menutitle">Usecase Framework</div>
<div id="menu_1.1.4.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/abstractusecase.html">AbstractUsecase</a>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/publication-templating/index.html">Publication Templating</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/resource-types.html">Resource Types</a>
</div>
<div class="menupage">
<div class="menupagetitle">Modules</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Introduction">Introduction</a>
</div>
<div class="menupageitem">
<a title="Implementing a module" href="#Implementing+a+module">Implementing a modu...</a>
</div>
<div class="menupageitem">
<a title="Implementing Usecases in Modules" href="#Implementing+Usecases+in+Modules">Implementing Usecas...</a>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4.6', '../../../skin/')" id="menu_1.1.4.6Title" class="menutitle">Protocols</div>
<div id="menu_1.1.4.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/protocols/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenya.html">lenya:</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenyadoc.html">lenyadoc:</a>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/repository/index.html">Repository</a>
</div>
</div>
<div class="menuitem">
<a href="../../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit">
<hr>
<a href="http://forrest.apache.org/"><img border="0" title="Built with Apache Forrest" alt="Built with Apache Forrest - logo" src="../../../images/built-with-forrest-button.png" style="width: 88px;height: 31px;"></a>
</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="index.pdf"><img alt="PDF -icon" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Modules</h1>
    
    
<a name="N1000D"></a><a name="Introduction"></a>
<h2 class="h3">Introduction</h2>
<div class="section">
<p>
        Modules are packages providing a certain set of resources or functionality.
      </p>
<p>Examples:</p>
<ul>
        
<li>a resource type (e.g., docbook module)</li>
        
<li>a repository implementation (e.g., jdbc module)</li>
        
<li>a collection of XSLTs (e.g., content2svg module)</li>
      
</ul>
<p>
        Some modules are included in the Lenya distribution:
      </p>
<ul>
        
<li>
<strong>search</strong> - search functionality</li>
        
<li>
<strong>sitetree</strong> - manage documents in a tree-like structure</li>
        
<li>
<strong>jcr</strong> - store content in a <a href="http://www.jcp.org/en/jsr/detail?id=170">JCR</a> repository</li>
        
<li>
<strong>xhtml</strong> - XHTML-based resource type</li>
        
<li>
<strong>links</strong> - resource type to manage link lists</li>
        
<li>
<strong>lenyadoc</strong> - adds the <span class="codefrag">lenyadoc://</span> protocol</li>
      
</ul>
</div>

    
<a name="N10051"></a><a name="Implementing+a+module"></a>
<h2 class="h3">Implementing a module</h2>
<div class="section">
<p>
        All resources of a module are located in a single directory.
        The following is an example directory structure, all files are optional
        and depend on the nature of the module.
      </p>
<pre class="code">
mymodule/
    config/                  configuration files
        components.xconf     patch for cocoon.xconf
    usecases/
        mymodule.jx          usecase view
    java/
        src/                 Java source files
        lib/                 Java libraries
    xslt/                    XSLT stylesheets
    sitemap.xmap             main module sitemap
</pre>
<p>To add a module to your Lenya installation, declare it in <span class="codefrag">local.build.properties</span>:</p>
<pre class="code">
modules.root.dirs=src/modules:src/webapp/lenya/pubs/default/modules:/home/john/modules/mymodule
</pre>
<p>
        When the module is deployed, the following steps are executed:
      </p>
<ul>
        
<li>the module files are copied to <span class="codefrag">context://lenya/modules</span>
</li>
        
<li>Java sources are compiled, libraries are installed</li>
        
<li>
<span class="codefrag">cocoon.xconf</span> is patched</li>
      
</ul>
</div>
    
    
<a name="N1007C"></a><a name="Implementing+Usecases+in+Modules"></a>
<h2 class="h3">Implementing Usecases in Modules</h2>
<div class="section">
<p>
        To declare usecases, add a patch file for <span class="codefrag">cocoon.xconf</span>, for instance <span class="codefrag">module/config/usecases.xconf</span>:
      </p>
<pre class="code">&lt;xconf xpath="/cocoon/usecases"
       unless="/cocoon/usecases/component-instance[@name = 'mymodule.edit']"&gt;
  &lt;component-instance name="mymodule.edit"
                      logger="lenya.usecases.edit
                      class="org.myproject.lenya.mymodule.usecases.Edit"&gt;
    &lt;view template="modules/mymodule/usecases/edit.jx" menu="false"/&gt;
  &lt;/component-instance&gt;
&lt;/xconf&gt;</pre>
<p>
        As you can see in the view declaration, the JX templates are typically stored in the <span class="codefrag">mymodule/usecases</span>
        directory. The Java source files go into the <span class="codefrag">mymodule/java/src</span> directory, they are compiled
        automatically by the Lenya build process.
      </p>
<a name="N10098"></a><a name="Sitemaps+for+Module+Usecases"></a>
<h3 class="h4">Sitemaps for Module Usecases</h3>
<p>
        Module-specific usecase sitemaps must be located at
      </p>
<pre class="code">&lt;module&gt;/usecases/&lt;usecase-name&gt;/usecase.xmap</pre>
<p>
        To make a call into a usecase sitemap, use a request of the following form:
      </p>
<pre class="code">cocoon://core/modules/&lt;module&gt;/usecases/&lt;usecase-name&gt;/&lt;request&gt;</pre>
<p>
        For example, imagine you implement a <span class="codefrag">newsletter</span> module, containing a <span class="codefrag">send</span> usecase.
        The usecase sitemap is located at <span class="codefrag">mymodules/newsletter/usecases/send/usecase.xmap</span>. To request
        the latest newsletter and display it on the confirmation screen using the CInclude approach
        (for more information, see documentation about the usecase framework), you could for instance use
        the URI <span class="codefrag">cocoon://core/modules/newsletter/usecases/send/latestNewsletter.xml</span>:
      </p>
<pre class="code">&lt;page:page
  xmlns:jx="http://apache.org/cocoon/templates/jx/1.0"
  xmlns:page="http://apache.org/cocoon/lenya/cms-page/1.0"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://apache.org/cocoon/i18n/2.1"
  xmlns:cinclude="http://apache.org/cocoon/include/1.0"
  &gt;
  
  &lt;page:body&gt;
    &lt;h1&gt;&lt;i18n:text&gt;Send Newsletter&lt;/i18n:text&gt;&lt;/h1&gt;
    &lt;form&gt;
      ...
      &lt;jx:import uri="templates/messages.jx"/&gt;
      
      &lt;cinclude:includexml&gt;
        &lt;cinclude:src&gt;cocoon://core/modules/newsletter/usecases/send/latestNewsletter.xml&lt;/cinclude:src&gt;
      &lt;/cinclude:includexml&gt;
      
      &lt;input name="submit" type="submit" value="Send Newsletter"/&gt;
    &lt;/form&gt;
  &lt;/page:body&gt;
&lt;/page:page&gt;</pre>
</div>
    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2005 <a href="http://www.apache.org/licenses/LICENSE-2.0">The Apache Software Foundation.</a>
</div>
<div id="logos"></div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A01_4/reference/modules/index.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
