<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Modules</title>
<link type="text/css" href="../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../skin/profile.css" rel="stylesheet">
<script src="../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with ');" size="25" name="q" id="query" type="text" value="Search the site with ">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../../../1_4/index.html">Version 1.4</a>
</li>
<li>
<a class="base-not-selected" href="../../../modules/index.html">Modules</a>
</li>
<li>
<a class="base-not-selected" href="../../../1_2_x/index.html">Version 1.2</a>
</li>
<li>
<a class="base-not-selected" href="../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/index.html">Index</a>
</div>
<div class="menuitem">
<a href="../../../1_4/faq.html">FAQs</a>
</div>
<div onclick="SwitchMenu('menu_1.1.3', '../../../skin/')" id="menu_1.1.3Title" class="menutitle">Installation</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/source_version.html">Install Instructions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4', '../../../skin/')" id="menu_1.1.4Title" class="menutitle">Concepts</div>
<div id="menu_1.1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/concepts/publication.html">Publication</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/urlMapping.html">URL Mapping</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/authoring_live.html">Authoring and Live mode</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/wysiwyg.html">WYSIWYG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.5', '../../../skin/')" id="menu_selected_1.1.5Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Technical Reference</div>
<div id="menu_selected_1.1.5" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/reference/lenya-sitemaps.html">Overview of Lenya Sitemaps</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.2', '../../../skin/')" id="menu_1.1.5.2Title" class="menutitle">Usecase Framework</div>
<div id="menu_1.1.5.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/abstractusecase.html">AbstractUsecase</a>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/publication-templating/index.html">Publication Templating</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/resource-types.html">Resource Types</a>
</div>
<div class="menupage">
<div class="menupagetitle">Modules</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#Introduction">Introduction</a>
</div>
<div class="menupageitem">
<a title="Implementing a module" href="#Implementing+a+module">Implementing a modu...</a>
</div>
<div class="menupageitem">
<a title="The Module Descriptor File" href="#The+Module+Descriptor+File">The Module Descript...</a>
</div>
<div class="menupageitem">
<a title="Implementing Usecases in Modules" href="#Implementing+Usecases+in+Modules">Implementing Usecas...</a>
</div>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/metadata.html">Meta data</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.7', '../../../skin/')" id="menu_1.1.5.7Title" class="menutitle">Protocols</div>
<div id="menu_1.1.5.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/protocols/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenya.html">lenya:</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenyadoc.html">lenyadoc:</a>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/link-management.html">Link Management</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/repository/index.html">Repository</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/tests.html">Writing Tests</a>
</div>
</div>
<div class="menuitem">
<a href="../../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit">
<hr>
<a href="http://forrest.apache.org/"><img border="0" title="Built with Apache Forrest" alt="Built with Apache Forrest - logo" src="../../../images/built-with-forrest-button.png" style="width: 88px;height: 31px;"></a>
</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2">
<a href="http://apachecon.com/"><img border="0" title="ApacheCon EU 2006" alt="ApacheCon EU 2006 - logo" src="http://www.eu.apachecon.com/konferenzen/apachecon06/images/header-left.gif" style="width: 150px;height: 50px;"></a>
</div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="index.pdf"><img alt="PDF -icon" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Modules</h1>
    
    
<a name="N1000D"></a><a name="Introduction"></a>
<h2 class="h3">Introduction</h2>
<div class="section">
<p>
        Modules are packages providing a certain set of resources or functionality.
      </p>
<p>Examples:</p>
<ul>
        
<li>a resource type (e.g., docbook module)</li>
        
<li>a repository implementation (e.g., jdbc module)</li>
        
<li>a collection of XSLTs (e.g., content2svg module)</li>
      
</ul>
<p>
        Some modules are included in the Lenya distribution:
      </p>
<ul>
        
<li>
<strong>lucene</strong> - search functionality</li>
        
<li>
<strong>sitetree</strong> - manage documents in a tree-like structure</li>
        
<li>
<strong>jcr</strong> - store content in a <a href="http://www.jcp.org/en/jsr/detail?id=170">JCR</a> repository</li>
        
<li>
<strong>xhtml</strong> - XHTML-based resource type</li>
        
<li>
<strong>links</strong> - resource type to manage link lists</li>
        
<li>
<strong>lenyadoc</strong> - adds the <span class="codefrag">lenyadoc://</span> protocol</li>
      
</ul>
</div>

    
<a name="N10051"></a><a name="Implementing+a+module"></a>
<h2 class="h3">Implementing a module</h2>
<div class="section">
<p>
        All resources of a module are located in a single directory.
        The following is an example directory structure, all files are optional
        and depend on the nature of the module.
      </p>
<pre class="code">
mymodule/
  config/                    configuration files
    cocoon-xconf/            patches for cocoon.xconf
      components.xconf     
  usecases/
    mymodule.jx              usecase view
  java/
    src/                     Java source files
    lib/                     Java libraries
  xslt/                      XSLT stylesheets
  module.xml                 module descriptor
  sitemap.xmap               main module sitemap
</pre>
<p>To add a module to your Lenya installation, declare it in <span class="codefrag">local.build.properties</span>:</p>
<pre class="code">
modules.root.dirs=src/modules:src/webapp/lenya/pubs/default/modules:/home/john/modules/mymodule
</pre>
<p>
        When the module is deployed, the following steps are executed:
      </p>
<ul>
        
<li>the module files are copied to <span class="codefrag">context://lenya/modules</span>
</li>
        
<li>Java sources are compiled, libraries are installed</li>
        
<li>
<span class="codefrag">cocoon.xconf</span> is patched</li>
      
</ul>
</div>
    
    
<a name="N1007C"></a><a name="The+Module+Descriptor+File"></a>
<h2 class="h3">The Module Descriptor File</h2>
<div class="section">
<p>
        Each module must be described using a <em>module descriptor</em> XML file
        <span class="codefrag">module.xml</span>, located in the root directory of the module.
        The descriptor is validated when the module is deployed, so be careful! :)
      </p>
<p>
        A typical module descriptor looks like this:
      </p>
<pre class="code">&lt;module xmlns="http://apache.org/lenya/module/1.0"&gt;
  &lt;id&gt;org.myproject.lenya.modules.myeditor&lt;/id&gt;
  &lt;depends module="org.apache.lenya.modules.usecase"/&gt;
  &lt;depends module="org.apache.lenya.modules.webdav"/&gt;
  &lt;package&gt;org.myproject.lenya.modules&lt;/package&gt;
  &lt;version&gt;0.1-dev&lt;/version&gt;
  &lt;name&gt;My Own Editor&lt;/name&gt;
  &lt;lenya-version&gt;1.4-dev&lt;/lenya-version&gt;
  &lt;description&gt;
    This is my own editor.
    For more information, visit http://myproject.org/editor.
  &lt;/description&gt;
&lt;/module&gt;</pre>
<p>
        The <span class="codefrag">id</span> must start with the <span class="codefrag">package</span> of the module.
        It is not allowed to deploy two modules with the same ID.
      </p>
<p>If your module uses code from other modules, you have to add 
       a <span class="codefrag">&lt;depends&gt;</span> for each of these modules.</p>
</div>
    
    
<a name="N100A2"></a><a name="Implementing+Usecases+in+Modules"></a>
<h2 class="h3">Implementing Usecases in Modules</h2>
<div class="section">
<a name="N100A8"></a><a name="Declaring+the+Usecase"></a>
<h3 class="h4">Declaring the Usecase</h3>
<p>
        For example, imagine you implement a <span class="codefrag">newsletter</span> module, containing a <span class="codefrag">send</span> usecase.
        To declare usecases, add a patch file for <span class="codefrag">cocoon.xconf</span>, for instance <span class="codefrag">newsletter/config/cocoon-xconf/usecases.xconf</span>:
      </p>
<pre class="code">&lt;xconf xpath="/cocoon/usecases"
       unless="/cocoon/usecases/component-instance[@name = 'newsletter.send']"&gt;
  &lt;component-instance name="newsletter.send"
                      logger="lenya.usecases.newsletter.send"
                      class="org.myproject.lenya.newsletter.usecases.Send"&gt;
    &lt;view template="modules/newsletter/usecases/send.jx" menu="false"/&gt;
  &lt;/component-instance&gt;
&lt;/xconf&gt;</pre>
<p>
        As you can see in the view declaration, the JX templates are typically stored in the <span class="codefrag">&lt;module&gt;/usecases</span>
        directory. The Java source files go into the <span class="codefrag">&lt;module&gt;/java/src</span> directory, they are compiled
        automatically by the Lenya build process.
      </p>
<a name="N100CB"></a><a name="Calling+the+Module+Sitemap"></a>
<h3 class="h4">Calling the Module Sitemap</h3>
<p>
        The following URL syntax is used to make a call to a module sitemap:
      </p>
<pre class="code">cocoon://modules/&lt;module&gt;/**</pre>
<p>
        The module sitemap is located at <span class="codefrag">newsletter/sitemap.xmap</span>. To request
        the latest newsletter and display it on the confirmation screen using the CInclude approach
        (for more information, see documentation about the usecase framework), you could for instance use
        the URI <span class="codefrag">cocoon://modules/newsletter/latestNewsletter.xml</span>:
      </p>
<pre class="code">&lt;page:page
  xmlns:jx="http://apache.org/cocoon/templates/jx/1.0"
  xmlns:page="http://apache.org/cocoon/lenya/cms-page/1.0"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://apache.org/cocoon/i18n/2.1"
  xmlns:cinclude="http://apache.org/cocoon/include/1.0"
  &gt;
  
  &lt;page:body&gt;
    &lt;h1&gt;&lt;i18n:text&gt;Send Newsletter&lt;/i18n:text&gt;&lt;/h1&gt;
    &lt;form&gt;
      ...
      &lt;jx:import uri="templates/messages.jx"/&gt;
      
      &lt;cinclude:includexml&gt;
        &lt;cinclude:src&gt;cocoon://modules/newsletter/latestNewsletter.xml&lt;/cinclude:src&gt;
      &lt;/cinclude:includexml&gt;
      
      &lt;input name="submit" type="submit" value="Send Newsletter"/&gt;
    &lt;/form&gt;
  &lt;/page:body&gt;
&lt;/page:page&gt;</pre>
<p>
        Another useful option is to use a module URL as the usecase view, e.g. to export some XML.
        Note that the attribute <span class="codefrag">uri</span> is used instead of <span class="codefrag">template</span>.
        The usecase class <span class="codefrag">DummyUsecase</span> can be used because no Java code shall be
        executed.
        </p>
<pre class="code">&lt;xconf xpath="/cocoon/usecases"
       unless="/cocoon/usecases/component-instance[@name = 'newsletter.download']"&gt;
  &lt;component-instance name="newsletter.send"
                      logger="lenya.usecases.newsletter.send"
                      class="org.apache.lenya.cms.usecase.DummyUsecase"&gt;
    &lt;view uri="cocoon://modules/newsletter/downloadNewsletter.xml"/&gt;
  &lt;/component-instance&gt;
&lt;/xconf&gt;</pre>
<a name="N100F6"></a><a name="Adding+Menu+Items"></a>
<h3 class="h4">Adding Menu Items</h3>
<p>
      A module can provide menu items which are added to the publication menu.
      To insert the menu items of a module, you have to add the module declaration to <span class="codefrag">publication.xconf</span>:
      </p>
<pre class="code">&lt;publication&gt;
  ...
  &lt;module name="newsletter"/&gt;
  ...
&lt;/publication&gt;</pre>
<p>
        If there is a <span class="codefrag">menus.xmap</span> sitemap in the module's root directory, a
        request of the form <span class="codefrag">&lt;area&gt;.xml</span> is sent into this sitemap.
        The matching pipeline could look like this:
      </p>
<pre class="code">&lt;map:match pattern="**"&gt;
  &lt;map:generate type="serverpages" src="config/menu.xsp"/&gt;
  &lt;map:serialize type="xml"/&gt;
&lt;/map:match&gt;
</pre>
<p>
        The server page <span class="codefrag">&lt;module&gt;/config/menu.xsp</span> delivers a menu XML
        which includes the items to be inserted:
      </p>
<pre class="code">&lt;xsp:page ...&gt;
  &lt;menu&gt;
    &lt;menus&gt;
      &lt;menu i18n:attr="name" name="File"&gt;
        &lt;block admin="false"&gt;
          &lt;item uc:usecase="newsletter.send" href="?"&gt;
            &lt;i18n:text&gt;Send Newsletter&lt;/i18n:text&gt;
          &lt;/item&gt;
        &lt;/block&gt;
      &lt;/menu&gt;
    &lt;/menus&gt;
  &lt;/menu&gt;
&lt;/xsp:page&gt;</pre>
</div>
    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2005 <a href="http://www.apache.org/licenses/LICENSE-2.0">The Apache Software Foundation.</a>
</div>
<div id="logos"></div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A01_4/reference/modules/index.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
