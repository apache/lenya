<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Publication Templating</title>
<link type="text/css" href="../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../skin/profile.css" rel="stylesheet">
<script src="../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with ');" size="25" name="q" id="query" type="text" value="Search the site with ">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../../../1_4/index.html">Version 1.4</a>
</li>
<li>
<a class="base-not-selected" href="../../../1_2_x/index.html">Version 1.2</a>
</li>
<li>
<a class="base-not-selected" href="../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/index.html">Index</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', '../../../skin/')" id="menu_1.1.2Title" class="menutitle">Installation</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menuitem">
<a href="../../../1_4/installation/source_version.html">Install Instructions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', '../../../skin/')" id="menu_1.1.3Title" class="menutitle">Concepts</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/concepts/publication.html">Publication</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/authoring_live.html">Authoring and Live mode</a>
</div>
<div class="menuitem">
<a href="../../../1_4/concepts/wysiwyg.html">WYSIWYG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.4', '../../../skin/')" id="menu_selected_1.1.4Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Technical Reference</div>
<div id="menu_selected_1.1.4" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../../1_4/reference/lenya-sitemaps.html">Overview of Lenya Sitemaps</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.2', '../../../skin/')" id="menu_1.1.4.2Title" class="menutitle">Usecase Framework</div>
<div id="menu_1.1.4.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/usecase-framework/abstractusecase.html">AbstractUsecase</a>
</div>
</div>
<div class="menupage">
<div class="menupagetitle">Publication Templating</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a title="What is Publication Templating?" href="#What+is+Publication+Templating%3F">What is Publication...</a>
</div>
<div class="menupageitem">
<a title="The Concept of Publication Templating" href="#The+Concept+of+Publication+Templating">The Concept of Publ...</a>
</div>
<div class="menupageitem">
<a title="Declaration of a Template" href="#Declaration+of+a+Template">Declaration of a Te...</a>
</div>
<div class="menupageitem">
<a href="#Usage">Usage</a>
</div>
<div class="menupageitem">
<a title="XSLT Include and Import" href="#XSLT+Include+and+Import">XSLT Include and Im...</a>
</div>
<div class="menupageitem">
<a href="#Sitemaps">Sitemaps</a>
</div>
<div class="menupageitem">
<a href="#Usecases">Usecases</a>
</div>
<div class="menupageitem">
<a title="Setting Up a Publication To Support Templating" href="#Setting+Up+a+Publication+To+Support+Templating">Setting Up a Public...</a>
</div>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/resource-types.html">Resource Types</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/modules/index.html">Modules</a>
</div>
<div onclick="SwitchMenu('menu_1.1.4.6', '../../../skin/')" id="menu_1.1.4.6Title" class="menutitle">Protocols</div>
<div id="menu_1.1.4.6" class="menuitemgroup">
<div class="menuitem">
<a href="../../../1_4/reference/protocols/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenya.html">lenya:</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/protocols/lenyadoc.html">lenyadoc:</a>
</div>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="../../../1_4/reference/repository/index.html">Repository</a>
</div>
</div>
<div class="menuitem">
<a href="../../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit">
<hr>
<a href="http://forrest.apache.org/"><img border="0" title="Built with Apache Forrest" alt="Built with Apache Forrest - logo" src="../../../images/built-with-forrest-button.png" style="width: 88px;height: 31px;"></a>
</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="index.pdf"><img alt="PDF -icon" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Publication Templating</h1>
    
    
<a name="N1000D"></a><a name="What+is+Publication+Templating%3F"></a>
<h2 class="h3">What is Publication Templating?</h2>
<div class="section">
<p>
        Imagine you are a company or organisation with some departments which want to edit
        their content using a Lenya-based CMS. All departments use similar publications,
        sharing lots of functionality. The layout is based on a common corporate identity,
        but some departments want to use their own logo or tweak the navigation menu style.
      </p>
<p>
        If all departments develop their own publications, it will be very hard to keep them
        consistent, to add changes to all publications or to update them to a newer Lenya version.
        This can be simplified using publication templates. You define a base (template) publication
        which all others are derived from.         
      </p>
<pre class="code">
                        +----------------------+
                        | Template Publication |
                        +----------------------+
                                    |
           +-----------------+------+---------------------+
           |                 |                            |
   +--------------+  +--------------+             +--------------+
   | Department A |  | Department B |     ...     | Department X |
   +--------------+  +--------------+             +--------------+
</pre>
<p>Multiple layers of templates are supported.</p>
<pre class="code">
                    +--------------------------------+
                    | University Website Publication |
                    +--------------------------------+
                                    |
           +-----------------+------+------------------------+
           |                 |                               |
   +------------+  +--------------------+             +-------------+
   | Uni Zurich |  | Harvard University |     ...     | UC Berkeley |
   +------------+  +--------------------+             +-------------+
                             |
              +----------+---+-----------+
              |          |               |
        +----------+  +-----+       +---------+
        | Business |  | Law |  ...  | Medical |
        +----------+  +-----+       +---------+
</pre>
</div>
    
    
<a name="N10025"></a><a name="The+Concept+of+Publication+Templating"></a>
<h2 class="h3">The Concept of Publication Templating</h2>
<div class="section">
<ul>
        
<li>There is a publication <em>my-pub</em>.</li>
        
<li>It depends on a template which is called <em>template(my-pub)</em>.</li>
        
<li>When a file is requested using the templating mechanism (<span class="codefrag">fallback://xslt/page2xhtml.xsl</span>),
            it is searched in a certain traversing order:
          <ol>
            
<li>
<span class="codefrag">context://lenya/pubs/my-pub/xslt/page2xhtml.xsl</span>
</li>
            
<li>
<span class="codefrag">context://lenya/pubs/template(my-pub)/xslt/page2xhtml.xsl</span>
</li>
            
<li>
<span class="codefrag">context://lenya/pubs/template(template(my-pub))/xslt/page2xhtml.xsl</span>
</li>
            
<li>...</li>
            
<li>
<span class="codefrag">context://xslt/page2xhtml.xsl</span>
</li>
          
</ol>
        
</li>
      
</ul>
<p>
        The publication <em>my-pub</em> is called an <strong>instance</strong> of the publication <em>template(my-pub)</em>.
        Note that, in contrast to the fallback mechanism in Lenya 1.2, the prefix <span class="codefrag">lenya</span> is not used,
        but the path is resolved relatively to the <span class="codefrag">context://</span> root. 
      </p>
</div>
    
    
<a name="N10069"></a><a name="Declaration+of+a+Template"></a>
<h2 class="h3">Declaration of a Template</h2>
<div class="section">
<p>The template of a publication is declared in <span class="codefrag">my-pub/config/publication.xconf</span>:</p>
<pre class="code">&lt;publication&gt;
  ...
  &lt;templates&gt;
    &lt;template id="my-template"/&gt;
  &lt;/templates&gt;
  ...
&lt;/publication&gt;</pre>
</div>
    
    
<a name="N1007A"></a><a name="Usage"></a>
<h2 class="h3">Usage</h2>
<div class="section">
<p>To invoke publication templating, it is necessary to use the <span class="codefrag">fallback://</span>
      protocol for all relevant files. For an XSLT stylesheet, the according pipeline looks as follows:</p>
<pre class="code">&lt;map:transform src="fallback://xslt/doctypes/doctype2xhtml.xsl"&gt;</pre>
</div>
    
    
<a name="N1008B"></a><a name="XSLT+Include+and+Import"></a>
<h2 class="h3">XSLT Include and Import</h2>
<div class="section">
<p>
        To leverage the publication templating concept, it is necessary to apply it to included
        or imported stylesheets as well. Fortunately, we can make use of the <span class="codefrag">fallback://</span>
        protocol in XSLT stylesheets. At the moment, this only works with Xalan which means you
        have to use this one as the default transformer.
      </p>
<pre class="code">&lt;xsl:include href="fallback://header.xsl"/&gt;</pre>
<p>
        To simplify overriding of XSLT stylesheets, it would be useful to import the template
        stylesheet. For this purpose, an additional template source factory could be used, which
        skips the current publication when resolving the file:
      </p>
<pre class="code">&lt;xsl:import href="template://template/xslt/common/header.xsl"/&gt;</pre>
</div>
    
    
<a name="N100A3"></a><a name="Sitemaps"></a>
<h2 class="h3">Sitemaps</h2>
<div class="section">
<p>
        If a sitemap is loaded from a template publication, it is very important that the sitemap
        is completely fallback-enabled. Otherwise, the source resolver will resolve sources relatively
        to the template sitemap instead of using the overridden ones.
      </p>
<p>
        In <span class="codefrag">lenya/global-sitemap.xmap</span>, all publication sitemaps are mounted
        using the fallback module, for instance
      </p>
<pre class="code">&lt;!-- Enter the actual publication --&gt;
&lt;map:match pattern="*/**"&gt;
  &lt;map:mount uri-prefix="{1}" src="{fallback:sitemap.xmap}"/&gt;
&lt;/map:match&gt;</pre>
</div>
    
    
<a name="N100B7"></a><a name="Usecases"></a>
<h2 class="h3">Usecases</h2>
<div class="section">
<p>
        The <a href="../usecase-framework/index.html">usecase framework</a>
        supports publication templating by default.
      </p>
<p>
        If you can't (or don't want to) use the usecase framework, you have to implement
        your own usecase sitemap. The traversing order for usecase sitemaps is
      </p>
<ol>
        
<li>
<span class="codefrag">context://lenya/pubs/my-pub/usecase.xmap</span>
</li>
        
<li>
<span class="codefrag">context://lenya/pubs/template(my-pub)/usecase.xmap</span>
</li>
        
<li>
<span class="codefrag">context://lenya/pubs/template(template(my-pub))/usecase.xmap</span>
</li>
        
<li>...</li>
        
<li>
<span class="codefrag">context://lenya/usecase.xmap</span>
</li>
      
</ol>
<p>
        This behaviour is achieved by the usecase fallback module which is called in <span class="codefrag">global-sitemap.xmap</span>:
      </p>
<pre class="code">&lt;map:match type="usecase" pattern="*"&gt;
  &lt;map:mount src="{usecase-fallback:{1}}" uri-prefix=""/&gt;
&lt;/map:match&gt;</pre>
<p>
        The decision which <span class="codefrag">usecase.xmap</span> to choose is based on the usecase configuration
        in <span class="codefrag">publication.xconf</span>. To declare a usecase to be implemented by a publication,
        add the corresponding entry:
      </p>
<pre class="code">&lt;publication&gt;
  ...
  &lt;usecases&gt;
    &lt;usecase name="create"/&gt;
  &lt;/usecases&gt;
  ...
&lt;/publication&gt;</pre>
</div>
    
    
<a name="N100F5"></a><a name="Setting+Up+a+Publication+To+Support+Templating"></a>
<h2 class="h3">Setting Up a Publication To Support Templating</h2>
<div class="section">
<p>
        The service <span class="codefrag">org.apache.lenya.cms.publication.templating.Instantiator</span> is responsible for
        creating instances of publications which support templating. If your publication shall support
        templating, you have to follow these steps:
      </p>
<a name="N10101"></a><a name="Implement+an"></a>
<h3 class="h4">Implement an Instantiator Class</h3>
<pre class="code">package org.myproject.lenya;

public class MyInstantiator extends AbstractLogEnabled implements Instantiator {

    public void instantiate(Publication template, String newPublicationId, String name)
            throws Exception {
        ...
    }

}</pre>
<a name="N1010F"></a><a name="Add+it+to"></a>
<h3 class="h4">Add it to cocoon.xconf Using a Patch File</h3>
<p>
          For instance <span class="codefrag">my-pub/config/instantiator.xconf</span>:
        </p>
<pre class="code">&lt;xconf xpath="/cocoon/template-instantiators"
       unless="/cocoon/template-instantiators/component-instance[@name = 'default']"&gt;

    &lt;component-instance name="mypub"
                        logger="myproject.publication"
                        class="org.myproject.lenya.MyInstantiator"/&gt;

&lt;/xconf&gt;</pre>
<a name="N10123"></a><a name="Declare+the+Instantiator+in"></a>
<h3 class="h4">Declare the Instantiator in publication.xconf</h3>
<pre class="code">&lt;publication&gt;
  ...
  &lt;template-instantiator name="mypub"/&gt;
  ...
&lt;/publication&gt;</pre>
</div>
    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2005 <a href="http://www.apache.org/licenses/LICENSE-2.0">The Apache Software Foundation.</a>
</div>
<div id="logos"></div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A01_4/reference/publication-templating/index.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
