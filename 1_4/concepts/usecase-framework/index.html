<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.6">
<meta name="Forrest-skin-name" content="pelt">
<title>The Usecase Framework</title>
<link type="text/css" href="../../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../../skin/profile.css" rel="stylesheet">
<script src="../../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://lenya.apache.org"><img class="logoImage" alt="Lenya" src="../../../images/apache-lenya-light.png" title="
  	Apache Lenya is a Java-based Open-Source Content Management System.
  	It is based on open standards such as XML and XSLT.
  	One of its core components is Cocoon from the Apache Software Foundation.
  "></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with :');" value="Search the site with :" size="25" name="q" id="query" type="text">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../../../1_4/index.html">Version 1.4</a>
</li>
<li>
<a class="base-not-selected" href="../../../1_2_x/index.html">Version 1.2</a>
</li>
<li>
<a class="base-not-selected" href="../../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript" language="JavaScript"><!--
              document.write("Published: " + document.lastModified);
              //  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a title="" href="../../../1_4/index.html">Index</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', '../../../skin/')" id="menu_1.1.2Title" class="menutitle">Installation</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a title="" href="../../../1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a title="" href="../../../1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menuitem">
<a title="" href="../../../1_4/installation/source_version.html">Installation Instructions</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', '../../../skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Concepts</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div onclick="SwitchMenu('menu_selected_1.1.3.1', '../../../skin/')" id="menu_selected_1.1.3.1Title" class="menutitle" style="background-image: url('../../../skin/images/chapter_open.gif');">Usecase Framework</div>
<div id="menu_selected_1.1.3.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menupage">
<div class="menupagetitle">Usecase Framework</div>
</div>
</div>
</div>
<div class="menuitem">
<a title="" href="../../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit">
<a href="http://forrest.apache.org/"><img border="0" title="Built with Apache Forrest" alt="Built with Apache Forrest - logo" src="../../../images/built-with-forrest-button.png" style="width: 88px;height: 31px;"></a>
</div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div id="skinconf-txtlink"></div>
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="index.pdf"><img alt="PDF -icon" src="../../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>The Usecase Framework</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Introduction">Introduction</a>
</li>
<li>
<a href="#Directory+Structure">Directory Structure</a>
<ul class="minitoc">
<li>
<a href="#The+Lenya+Core">The Lenya Core</a>
</li>
<li>
<a href="#Your+Publication">Your Publication</a>
</li>
</ul>
</li>
<li>
<a href="#Architecture">Architecture</a>
</li>
<li>
<a href="#The+Contract+Between+Flowscript+And+Usecase+Handler">The Contract Between Flowscript And Usecase Handler</a>
</li>
<li>
<a href="#Implementing+a+Custom+Usecase">Implementing a Custom Usecase</a>
<ul class="minitoc">
<li>
<a href="#Prerequisites">Prerequisites</a>
</li>
<li>
<a href="#Add+a+Menu+Item">Add a Menu Item</a>
</li>
<li>
<a href="#Implement+the+Usecase+Handler+Class">Implement the Usecase Handler Class</a>
</li>
<li>
<a href="#Implement+the+View">Implement the View</a>
</li>
</ul>
</li>
<li>
<a href="#Overriding+Core+Usecases+in+Publications">Overriding Core Usecases in Publications</a>
<ul class="minitoc">
<li>
<a href="#Overriding+Usecase+Handler+Classes">Overriding Usecase Handler Classes</a>
</li>
<li>
<a href="#Overriding+JX+Templates">Overriding JX Templates</a>
</li>
</ul>
</li>
</ul>
</div>
    
    
<a name="N1000D"></a><a name="Introduction"></a>
<h2 class="underlined_10">Introduction</h2>
<div class="section">
<p>
        The <em>usecase framework</em> in Lenya 1.4 is a simple framework to implement usecases using JX templates and Java.
        This approach is an "85% solution". It enables the user to implement a big range of common usecases.
      </p>
<div class="frame note">
<div class="label">Note</div>
<div class="content">
        Some special complex usecases might require a custom flowscript, in this case you can't use this framework.
      </div>
</div>
</div>
    
    
<a name="N1001D"></a><a name="Directory+Structure"></a>
<h2 class="underlined_10">Directory Structure</h2>
<div class="section">
<a name="N10023"></a><a name="The+Lenya+Core"></a>
<h3 class="underlined_5">The Lenya Core</h3>
<pre class="code">
$LENYA_WEBAPP
  /lenya/usecases                     usecase-related files
                 /usecase.xmap        usecase dispatching sitemap
                 /usecases.js         flowscript for usecase control flow
                 /admin               Lenya admin usecases
                       /addUser.jx    JX templates for usecase views
                 ...                  more Lenya core usecases
</pre>
<a name="N1002E"></a><a name="Your+Publication"></a>
<h3 class="underlined_5">Your Publication</h3>
<pre class="code">
$PUB_HOME
  /lenya/usecases                     usecase-related files
                 /editHeadline.jx     JX templates for usecase views
  /java/src/...                       usecase handler classes
</pre>
</div>
    
    
    
<a name="N1003A"></a><a name="Architecture"></a>
<h2 class="underlined_10">Architecture</h2>
<div class="section">
<p>
        A usecase request - denoted by the request parameter <em>lenya.usecase</em> - is dispatched by <span class="codefrag">$LENYA_WEBAPP/lenya/usecases/usecase.xmap</span>.
        All usecases are handled by a single flowscript <span class="codefrag">$LENYA_WEBAPP/lenya/usecases/usecases.js</span>. This keeps javascript maintenance costs at a minimum.
      </p>
<p>
        The flowscript <span class="codefrag">usecases.js</span> determines the usecase handler class using the <span class="codefrag">org.apache.lenya.cms.usecase.UsecaseResolver</span>.
        All business code operations are delegated to the usecase handler class.
      </p>
<div style="text-align: center;">
<img class="figure" alt="Usecase framework architecture" src="../../../images/live/usecase-framework-architecture.png"></div>
</div>
    
    
<a name="N1005A"></a><a name="The+Contract+Between+Flowscript+And+Usecase+Handler"></a>
<h2 class="underlined_10">The Contract Between Flowscript And Usecase Handler</h2>
<div class="section">
<p>
        The usecase handler class has to implement the interface <span class="codefrag">org.apache.lenya.cms.usecase.Usecase</span>.
        The methods of this interface are called in a certain order when the usecase is invoked:
      </p>
<ol>
        
<li>
<span class="codefrag">setup(String sourceUrl, Situation situation);</span> Initializes the handler.</li>
        
<li>
<span class="codefrag">isInteractive()</span> Asks is the usecase is interactive, i.e. if a confirmation screen should be presented to the user.</li>
        
<li>
<span class="codefrag">checkPreconditions()</span> This allows the handler to check if the usecase may be invoked in this situation.</li>
      
</ol>
</div>
    
    
<a name="N10079"></a><a name="Implementing+a+Custom+Usecase"></a>
<h2 class="underlined_10">Implementing a Custom Usecase</h2>
<div class="section">
<a name="N1007F"></a><a name="Prerequisites"></a>
<h3 class="underlined_5">Prerequisites</h3>
<ol>
          
<li>Choose a name to identify the usecase, e.g. editHeadline. It is possible to group usecases
              using "." as delimiter, for instance <em>article.editHeadline</em>.
          </li>
        
</ol>
<a name="N1008F"></a><a name="Add+a+Menu+Item"></a>
<h3 class="underlined_5">Add a Menu Item</h3>
<div class="frame note">
<div class="label">Note</div>
<div class="content">
          This step is necessary if you want to call the usecase from the Lenya menubar.
        </div>
</div>
<ol>
          
<li>Add the corresponding menu item:
            <pre class="code">&lt;item uc:usecase="article.editHeadline"&gt;Edit Headline&lt;/item&gt;</pre>
          
</li>
        
</ol>
<a name="N100A3"></a><a name="Implement+the+Usecase+Handler+Class"></a>
<h3 class="underlined_5">Implement the Usecase Handler Class</h3>
<ol>
          
<li>Choose a name for your business logic class, e.g. <span class="codefrag">org.myproject.lenya.usecases.EditHeadline</span>.</li>
          
<li>The class must implement the interface <span class="codefrag">org.apache.lenya.cms.usecase.Usecase</span>.</li>
          
<li>
            To simplify development, you can extend one of the following classes:
            <ul>
              
<li>
<span class="codefrag">org.apache.lenya.cms.usecase.AbstractUsecase</span>
</li>
              
<li>
<span class="codefrag">org.apache.lenya.cms.usecase.DocumentUsecase</span> (only for usecases invoked on document pages)</li>
              
<li>
<span class="codefrag">org.apache.lenya.cms.usecase.SiteUsecase</span>
</li>
            
</ul>
            They have built-in support for the unit-of-work pattern (which will evolve into
            an ACID transaction someday) as well as functionality specific to the area they are
            supposed to be used with, e.g. the site area.
          </li>
          
<li>
            Add the usecase handler class declaration to an XPatch file, e.g. <span class="codefrag">$PUB_HOME/config/usecases.xconf</span>:
<pre class="code">&lt;xconf xpath="/cocoon/usecases" unless="/cocoon/usecases/component-instance[@name = 'article.editHeadline']"&gt;
    &lt;component-instance name="article.editHeadline"
                        logger="lenya.usecases.editHeadline"
                        class="org.myproject.lenya.usecases.EditHeadline"/&gt;
  &lt;/xconf&gt;</pre>
          
</li>
        
</ol>
<a name="N100D6"></a><a name="Implement+the+View"></a>
<h3 class="underlined_5">Implement the View</h3>
<ol>
          
<li>The view for a usecase is implemented using a JX template.</li>
          
<li>
            The output of the view has to be a Lenya page:
<pre class="code">  &lt;page:page
    xmlns:jx="http://apache.org/cocoon/templates/jx/1.0"
    xmlns:page="http://apache.org/cocoon/lenya/cms-page/1.0"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:i18n="http://apache.org/cocoon/i18n/2.1"    
    &gt;
  
    &lt;page:title&gt;&lt;i18n:text&gt;Edit Headline&lt;/i18n:text&gt;&lt;/page:title&gt;
    &lt;page:body&gt;
    
      &lt;form&gt;
        &lt;input type="hidden" name="lenya.continuation" value="${continuation.id}"/&gt;
        &lt;input type="hidden" name="lenya.usecase" value="${request.getParameter('lenya.usecase')}"/&gt;

        ...

      &lt;/form&gt;

    &lt;/page:body&gt;
  &lt;/page:page&gt;</pre>
          
</li>
          
<li>Take care of adding the hidden <em>lenya.usecase</em> and <em>lenya.continuation</em> fields as shown above.</li>
          
<li>The template has to be located at <span class="codefrag">$PUB_HOME/lenya/usecases/&lt;usecase&gt;.jx</span>
            (replace . with /), for instance
          </li>
        
</ol>
</div>
    
    
<a name="N100FA"></a><a name="Overriding+Core+Usecases+in+Publications"></a>
<h2 class="underlined_10">Overriding Core Usecases in Publications</h2>
<div class="section">
<a name="N10100"></a><a name="Overriding+Usecase+Handler+Classes"></a>
<h3 class="underlined_5">Overriding Usecase Handler Classes</h3>
<p>
          The usecase resolver, which is responsible for obtaining the handler class for a usecase,
          looks first if the current publication overrides the core usecase handler.
          This can be done by declaring a usecase called <span class="codefrag">&lt;pub-id&gt;/&lt;usecase-name&gt;</span>,
          for instance <span class="codefrag">mypub/admin.addUser</span>. To implement a core usecase using a custom
          handler class, you need to
        </p>
<ol>
          
<li>Implement the handler class and put it in <span class="codefrag">$PUB_HOME/java/src</span>.
          In most cases, you will extend the core usecase handler class to inherit the basic functionality.</li>
          
<li>
            Declare it in an <em>xpatch</em> file, for instance <span class="codefrag">$PUB_HOME/config/usecases.xconf</span>:
<pre class="code">&lt;xconf xpath="/cocoon/usecases" unless="/cocoon/usecases/component-instance[@name = 'mypub/admin.addUser']"&gt;
  &lt;component-instance name="mypub/admin.addUser"
                      logger="lenya.usecases.editHeadline"
                      class="org.myproject.lenya.usecases.AddUser"/&gt;
&lt;/xconf&gt;</pre>
          
</li>
        
</ol>
<p>
          Now, when the usecase is invoked from inside the publication mypub, the custom
          handler class will be used.
        </p>
<a name="N10129"></a><a name="Overriding+JX+Templates"></a>
<h3 class="underlined_5">Overriding JX Templates</h3>
<p>
          Overriding the JX template of a usecase follows the
          <a href="../publication-templating/index.html">publication templating</a> principle.
          You just have to put a JX template with the same name in <span class="codefrag">$PUB_HOME/lenya/usecases</span>,
          for instance <span class="codefrag">$PUB_HOME/lenya/usecases/admin/addUser.jx</span>.
        </p>
</div>
    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
 Copyright &copy; 2002-2005 The Apache Software Foundation.</div>
<div id="logos"></div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A01_4/concepts/usecase-framework/index.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
