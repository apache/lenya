<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8-dev">
<meta name="Forrest-skin-name" content="pelt">
<title>Apache Lenya 1.4 install instructions</title>
<link type="text/css" href="../../skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="../../skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="../../skin/print.css" rel="stylesheet">
<link type="text/css" href="../../skin/profile.css" rel="stylesheet">
<script src="../../skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="../../skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="../../skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="../../favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">apache</a> &gt; <a href="http://lenya.apache.org/">lenya</a><script src="../../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="Lenya" src="../../images/apache-lenya-light.png" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href=""></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="lenya.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with ');" size="25" name="q" id="query" type="text" value="Search the site with ">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="base-not-selected" href="../../index.html">Project</a>
</li>
<li class="current">
<a class="base-selected" href="../../1_4/index.html">Version 1.4</a>
</li>
<li>
<a class="base-not-selected" href="../../modules/index.html">Modules</a>
</li>
<li>
<a class="base-not-selected" href="../../1_2_x/index.html">Version 1.2</a>
</li>
<li>
<a class="base-not-selected" href="../../community/index.html">Community</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
             
             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', '../../skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Version 1.4</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../1_4/index.html">Index</a>
</div>
<div class="menuitem">
<a href="../../1_4/faq.html">FAQs</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', '../../skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('../../skin/images/chapter_open.gif');">Installation</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="../../1_4/installation/index.html">Download</a>
</div>
<div class="menuitem">
<a href="../../1_4/installation/subversion.html">Subversion Access</a>
</div>
<div class="menupage">
<div class="menupagetitle">Install Instructions</div>
<div class="menupageitemgroup">
<div class="menupageitem">
<a href="#introduction">Introduction</a>
</div>
<div class="menupageitem">
<a href="#prerequisites">Prerequisites</a>
</div>
<div class="menupageitem">
<a title="1: Standalone Installation (using the built-in Jetty)" href="#1%3A+Standalone+Installation+%28using+the+built-in+Jetty%29">1: Standalone Insta...</a>
</div>
<div class="menupageitem">
<a title="2: Installation with Apache Tomcat" href="#2%3A+Installation+with+Apache+Tomcat">2: Installation wit...</a>
</div>
</div>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.4', '../../skin/')" id="menu_1.1.4Title" class="menutitle">Concepts</div>
<div id="menu_1.1.4" class="menuitemgroup">
<div class="menuitem">
<a href="../../1_4/concepts/publication.html">Publication</a>
</div>
<div class="menuitem">
<a href="../../1_4/concepts/urlMapping.html">URL Mapping</a>
</div>
<div class="menuitem">
<a href="../../1_4/concepts/authoring_live.html">Authoring and Live mode</a>
</div>
<div class="menuitem">
<a href="../../1_4/concepts/wysiwyg.html">WYSIWYG</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.5', '../../skin/')" id="menu_1.1.5Title" class="menutitle">Technical Reference</div>
<div id="menu_1.1.5" class="menuitemgroup">
<div class="menuitem">
<a href="../../1_4/reference/lenya-sitemaps.html">Overview of Lenya Sitemaps</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.2', '../../skin/')" id="menu_1.1.5.2Title" class="menutitle">Usecase Framework</div>
<div id="menu_1.1.5.2" class="menuitemgroup">
<div class="menuitem">
<a href="../../1_4/reference/usecase-framework/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/usecase-framework/abstractusecase.html">AbstractUsecase</a>
</div>
</div>
<div class="menuitem">
<a href="../../1_4/reference/publication-templating/index.html">Publication Templating</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/resource-types.html">Resource Types</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/modules/index.html">Modules</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/metadata.html">Meta data</a>
</div>
<div onclick="SwitchMenu('menu_1.1.5.7', '../../skin/')" id="menu_1.1.5.7Title" class="menutitle">Protocols</div>
<div id="menu_1.1.5.7" class="menuitemgroup">
<div class="menuitem">
<a href="../../1_4/reference/protocols/index.html">Overview</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/protocols/lenya.html">lenya:</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/protocols/lenyadoc.html">lenyadoc:</a>
</div>
</div>
<div class="menuitem">
<a href="../../1_4/reference/link-management.html">Link Management</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/repository/index.html">Repository</a>
</div>
<div class="menuitem">
<a href="../../1_4/reference/tests.html">Writing Tests</a>
</div>
</div>
<div class="menuitem">
<a href="../../../apidocs/1.4/index.html">1.4 API (Javadoc)</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="../../skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2">
<a href="http://apachecon.com/"><img border="0" title="ApacheCon EU 2006" alt="ApacheCon EU 2006 - logo" src="http://www.eu.apachecon.com/konferenzen/apachecon06/images/header-left.gif" style="width: 150px;height: 50px;"></a>
</div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="source_version.pdf"><img alt="PDF -icon" src="../../skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Apache Lenya 1.4 install instructions</h1>
  	
<a name="N1000E"></a><a name="introduction"></a>
<h2 class="h3">Introduction</h2>
<div class="section">
<div class="warning">
<div class="label">Warning</div>
<div class="content">
            Apache Lenya 1.4 is still under heavy development and should not be used for production yet.
          </div>
</div>
<p>
  			This document explains how to install Lenya 1.4 from source.
  			There are different ways to install and run Lenya:
  			<br>
  			Choose between
  		</p>
<ol>
            
<li>running Lenya standalone using the built-in Jetty servlet container</li>
            
<li>using Tomcat and have the build process taking care of deploying Lenya in Tomcat</li>
        
</ol>
<p>
  			Please note that you can use other servlet
        	containers as well, but Jetty and Tomcat are the tested ones.
        </p>
<p>
  			In all cases, you will need to meet the following prerequisites,
  			that describe the setup that is tested and recommended. 
  		</p>
</div>
    
<a name="N1002C"></a><a name="prerequisites"></a>
<h2 class="h3">Prerequisites</h2>
<div class="section">
<ul>
      	      	
        
<li>
          
<p>
            
<strong>Java 2 Platform, Standard Edition</strong>
            
<br>
            version 1.4.2 or newer, <a href="http://issues.apache.org/bugzilla/show_bug.cgi?id=32923">1.5.x works with limitations</a>.
            <br>
            Get it from <a href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>
          
</p>
        
</li>
        
        
<li>
      		
<p>
      		
<strong>Recommended: Create a directory</strong> to better organise the various source files
      		<br>
      		In this document, we will assume the name <span class="codefrag">src/</span> for that directory.
      		This directory will contain the Lenya distribution as well as Cocoon.
      		</p>
      		
      		
<p>
      		After expanding the	downloaded archives or after a <a href="http://subversion.tigris.org/">svn checkout</a>,
      		the directory structure should look like this:
      		</p>
      		
      		
<pre class="code">
            your_home/ (or c:\ on Windows, NOT My Documents)
              `-- src/
                   |-- lenya-1.4.x/            $LENYA_HOME
                     `-- externals/
                       `-- cocoon_2_1_x/       $COCOON_HOME
                         `-- build/
                           `-- webapp/         $COCOON_WEBAPP
     		</pre>
     		
     		
<p>
     		The directories inside cocoon_2_1_x/ will be created when you build Cocoon, cocoon will be built when you build lenya. 
     		The variables will later be used in the local.build.properties file that configures the Lenya build process.
      		</p>
      		
      	
</li>
      	
      	
<li>
          
<p>
            
<strong>Get Apache Lenya</strong>
            
<br>
            (see <a href="../../1_4/installation/index.html">Download Lenya</a>)
            <br>
            Using <a href="../../1_4/installation/subversion.html">Subversion</a>, checkout Lenya inside the
            <span class="codefrag">src/</span> directory. 
          </p>
        
</li>
      
</ul>
</div>


    
<a name="N1007F"></a><a name="1%3A+Standalone+Installation+%28using+the+built-in+Jetty%29"></a>
<h2 class="h3">1: Standalone Installation (using the built-in Jetty)</h2>
<div class="section">
<ol>

        
<li>
          
<p>
            
<strong>Configure Lenya</strong>
          
</p>

          
<p>
            You need to edit your build properties and write
            local.build.properties. To do this execute configure.sh 
            or configure.bat.
          </p>
          
<div class="note">
<div class="label">Note</div>
<div class="content">Cocoon 2.1.x is now placed in Lenya as a svn:external
            you'll find cocoon in $LENYA_HOME/externals/cocoon_2_1_x.
            If you want to use cocoon from another location you can change
            the $COCOON_HOME point to your cocoon src directory.
            </div>
</div>
          
<p>
              Copy $LENYA_HOME/src/cocoon/local.blocks.properties and 
              local.build.properties to $COCOON_HOME.
          </p>
       
</li>

        
<li>
          
<p>
            
<strong>Build Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">build.bat</span> or <span class="codefrag">build.sh</span> in
            your Lenya source directory, depending on your platform.
          </p>
          
<div class="note">
<div class="label">Note</div>
<div class="content">Cocoon will be built when you build lenya. You can manually build or clean
          cocoon in $COCOON_HOME with ./build.sh or ./build.sh clean</div>
</div>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; build.bat
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; ./build.sh
          </pre>
          
<p>
             
<br>
<br>
             If your build fails, because it cant delete cocoon.xconf.ant_patch try:
             in $LENYA_HOME/src/targets/webapp-build.xml LINE 69 add
             verbose="true" failonerror="false" to the delete tag.
             In $LENYA_HOME/src/targets/publets-build.xml LINE 53 add
             verbose="true" failonerror="false" to the delete tag.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Start Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">lenya.bat</span> or <span class="codefrag">lenya.sh
            servlet</span> in your Lenya source directory, depending on
            your platform.  Make sure that you have the environment
            variable <span class="codefrag">JAVA_HOME</span> defined to point to the
            location of the Java SDK you installed (see <a href="#prerequisites">Prerequisites</a>).
          </p>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; lenya.bat
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; ./lenya.sh servlet
          </pre>
        
</li>

        
<li>
          
<p>
            
<strong>Test the installation</strong>
          
</p>

          
<p>
            
<a href="http://localhost:8888">http://localhost:8888/</a>
          
</p>
        
</li>
      
</ol>
</div>

    
<a name="N10107"></a><a name="2%3A+Installation+with+Apache+Tomcat"></a>
<h2 class="h3">2: Installation with Apache Tomcat</h2>
<div class="section">
<ol>

		
<li>
          
<p>
            
<strong>Get Apache Tomcat</strong> for JDK 1.4
            <br>
Lenya is developed and tested with Tomcat 5.0.28; it is assumed in the following instructions, and we highly recommend it. Tomcat 4.0.0+, 4.1.24+, 5.0.18+ and 5.5.0+ should work too.            <br>
            
<br>
            Get it from  <a href="http://jakarta.apache.org/site/binindex.cgi#tomcat-5.0">http://jakarta.apache.org/site/binindex.cgi#tomcat-5.0</a>
          
</p>

        
</li>
        
        
<li>
          
<p>
            
<strong>Install Apache Tomcat</strong>
          
</p>

          
<p>
            See <a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/setup.html">Tomcat 5.0 Setup</a>
          
</p>

          
<p>
            
<strong>MS Windows:</strong>

            
<br>

            Basically you only need to set the <span class="codefrag">JAVA_HOME</span>
            environment variable and run the Tomcat
            installer. Decide to run Tomcat as a Windows
            NT/2000/XP-Service.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Configure Lenya</strong>
          
</p>

          
<p>
            To install Lenya with Tomcat, you need to edit your build
            properties. To do this, copy
            <span class="codefrag">$LENYA_HOME/build.properties</span> to
            <span class="codefrag">$LENYA_HOME/local.build.properties</span>.
          </p>
          
<div class="note">
<div class="label">Note</div>
<div class="content">You can use the configure.sh or configure.bat to configure your local.build.properties.</div>
</div>

          
<p>
            Edit <span class="codefrag">local.build.properties</span>. For the described
            configuration the following settings will work (<strong>MS
            Windows:</strong> Don't use backslashes "<span class="codefrag">\</span>" for
            directory separation.) It is important that
            <span class="codefrag">tomcat.home.dir</span> is an absolute path. Replace
            <span class="codefrag">$TOMCAT_HOME</span> by your Tomcat installation
            directory.  If your Cocoon source directory is not at
            <span class="codefrag">../cocoon_2_1_x</span> relative to Lenya, then change
            the <span class="codefrag">cocoon.webapp.dir</span>, <span class="codefrag">web.app.server</span> and
            <span class="codefrag">cocoon.src.dir</span> properties.
          </p>

          
<ul>
            
<li>
<span class="codefrag">web.app.server=Tomcat</span>
</li>
            
<li>
<span class="codefrag">cocoon.src.dir=$COCOON_HOME</span>
</li>
            
<li>
<span class="codefrag">tomcat.home.dir=$TOMCAT_HOME</span>
</li>
          
</ul>
        
</li>

        
<li>
          
<p>
            
<strong>Build Lenya</strong>
          
</p>

          
<p>
            Execute <span class="codefrag">build</span> in your Lenya source directory.
          </p>
        
</li>

      
<li>
        
<p>
          
<strong>Checked versions of endorsed libraries</strong>
        
</p>
    
        
<p>
          Lenya and Tomcat will inter-operate correctly only if the proper
          versions of the Xalan and Xerces libraries are used consistently
          throughout the deployment.  Unfortunately this can be difficult
          to get to work correctly since both of these libraries are
          shipped with Java 2 SDK, Tomcat, Cocoon and Lenya.
        </p>
    
        
<p>
          The following libraries must be placed in the endorsed library
          directory for your deployment.
        </p>
    
        
<ul>
          
<li>
<span class="codefrag">jakarta-bcel-20040329.jar</span>
</li>
          
<li>
<span class="codefrag">jakarta-regexp-1.3.jar</span>
</li>
          
<li>
<span class="codefrag">xalan-2.6.0.jar</span>
</li>
          
<li>
<span class="codefrag">xercesImpl-2.6.2.jar</span>
</li>
          
<li>
<span class="codefrag">xml-apis.jar</span>
</li>
        
</ul>
    
        
<p>
          They are placed by the build process in the directory specified
          by <span class="codefrag">tomcat.endorsed.dir</span> in
          <span class="codefrag">build.properties</span>.  You should validate that these
          files are indeed in the proper location for your deployment.
          You must then validate that no other instances of these
          libraries exist in any of the following directories:
        </p>
    
        
<ul>
          
<li>
            The Java 2 SDK endorsed standards directories.  This is
            usually <span class="codefrag">${JAVA_HOME}/lib/endorsed/</span>.
          </li>
    
          
<li>
            Any other location in your Tomcat deployment.  Specifically,
            check <span class="codefrag">shared/lib/</span>, <span class="codefrag">common/lib/</span> and
            <span class="codefrag">server/lib/</span>.
          </li>
    
          
<li>
            Any other location in your Lenya deployment.  Specifically,
            check <span class="codefrag">webapps/lenya/WEB-INF/lib/</span>.
          </li>
        
</ul>
    
        
<p>
          A common symptom of incorrect library version are blank pages
          after starting Lenya.  Try carefully checking the location and
          version numbers of each of the libraries.
        </p>
    
        
<p>
          References:
        </p>
    
        
<ul>
          
<li>
            
<a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html">
              Tomcat Class Loader HOWTO (http://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html)
            </a>
          
</li>
    
          
<li>
            
<a href="http://java.sun.com/j2se/1.4.2/docs/guide/standards/index.html">
              Java 2 Endorsed Standards Override Mechanism
              (http://java.sun.com/j2se/1.4.2/docs/guide/standards/index.html)
            </a>
          
</li>
        
</ul>
      
</li>
         
<li>
           
<p>
            
<strong>Clear Tomcat work directory</strong>
          
</p>

          
<p>
            Tomcat's work cache may not be consistent with your newly installed
            Lenya.  This can lead to any number of errors and exceptions.  To
            prevent this, clear the work directory by executing
            <span class="codefrag">build.bat</span> or <span class="codefrag">build.sh</span> in your Lenya source
            directory, depending on your platform.
          </p>

          
<p>
            
<strong>MS Windows</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; build.bat clean 
          </pre>

          
<p>
            
<strong>Unix</strong>
          
</p>

          
<pre class="code">
            $LENYA_HOME &gt; ./build.sh clean
          </pre>
        
</li>
        
<li>
          
<p>
            
<strong>Restart Tomcat</strong>
          
</p>

          
<p>
            Restart Tomcat to load the Lenya webapp.
          </p>
        
</li>

        
<li>
          
<p>
            
<strong>Test the installation</strong>
          
</p>

          
<p>
            
<a href="http://localhost:8080/lenya">http://localhost:8080/lenya/</a>
          
</p>
        
</li>
      
</ol>
</div>
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2002-2005 <a href="http://www.apache.org/licenses/LICENSE-2.0">The Apache Software Foundation.</a>
</div>
<div id="feedback">
    Send feedback about the website to:
  <a id="feedbackto" href="mailto:dev@lenya.apache.org?subject=Feedback%C2%A0for%C2%A01_4/installation/source_version.html">dev@lenya.apache.org</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
